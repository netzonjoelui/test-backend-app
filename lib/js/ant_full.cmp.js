var Ant={isSessionLoaded_:!1,storage:{user_quota:1E3,user_used:0,global_quota:1E3,global_used:0},account:{id:null,name:"",companyName:"Netric"},user:{id:null,name:"",fullName:""},theme:{id:null,name:"",title:""},settings:{email:{dropbox_catchall:"sys.netric.com"}},apps:[],updateStream_:null,isMobile:!1,m_processes:[]};Ant.m_appcontainer=document.getElementById("appbody");Ant.m_document=document;Ant.m_evwnd=window;Ant.f_framed=!1;Ant.m_includes=[];Ant.m_hPopupRef=[];Ant.m_hHinstRef=[];
Ant.init=function(a){var b=new alib.net.Xhr;alib.events.listen(b,"load",function(){Ant.isSessionLoaded_=!0;var b=this.getResponse();b.account&&(Ant.account.id=b.account.id,Ant.account.name=b.account.name,Ant.account.companyName=b.account.companyName);b.user&&(Ant.user.id=b.user.id,Ant.user.name=b.user.name,Ant.user.fullName=b.user.fullName);b.theme&&(Ant.theme.name=b.theme.name);Ant.onload(b);a&&a(b);Ant.keepAlive()});b.send("/controller/User/getSession");this.antResizeTimer=null;alib.dom.addEvent(window,
"resize",function(){Ant&&!Ant.antResizeTimer&&(Ant.antResizeTimer=window.setTimeout(function(){try{Ant.resizeActiveApp()}catch(a){}Ant.antResizeTimer=null},1E3))})};Ant.onload=function(){};
Ant.include=function(a){var b="js_cls_"+a;if(!document.getElementById(b)){this.m_includes[b]=!1;var c=document.createElement("script");c.m_name=b;alib.userAgent.ie?c.onreadystatechange=function(){if("complete"==this.readyState||"loaded"==this.readyState)Ant.m_includes[this.m_name]=!0}:c.onload=function(){Ant.m_includes[this.m_name]=!0};c.type="text/javascript";c.id=b;c.src=a;document.getElementsByTagName("head")[0].appendChild(c);for(a=1;!0!=this.m_includes[b]&&!(30<a);a++)this.wait(1E3)}};
Ant.wait=function(a){date=new Date;var b=null;do b=new Date;while(b-date<a)};Ant.SetDocumentVars=function(){this.m_document=document;ALib.m_evwnd=window;this.m_appcontainer=document.getElementById("appbody");return!0};Ant.setNoBodyOverflow=function(){document.body.style.overflow="hidden";for(var a=0;a<this.appShells.length;a++)this.appShells[a].name==this.last_selected&&(this.m_processes[this.appShells[a].process_id].noOverflow=!0)};Ant.setPopupHandle=function(a,b){this.m_hPopupRef[b]=a};
Ant.getPopupHandle=function(a){return this.m_hPopupRef[a]?this.m_hPopupRef[a]:!1};Ant.setHinst=function(a,b){this.m_hHinstRef[b]=a};Ant.getHinst=function(a){return this.m_hHinstRef[a]?this.m_hHinstRef[a]:!1};Ant.clearHinst=function(a){this.m_hHinstRef[a]&&(this.m_hHinstRef[a]=null)};Ant.setNewEmailMessages=function(){return!0};Ant.keepAlive=function(){try{this.m_email_check_timer||this.setNewEmailMessages()}catch(a){}this.m_keepalive_timer=window.setTimeout("top.Ant.keepAlive()",18E4)};
Ant.getNewEmailMessages=function(a){if(a)for(var b=0;b<this.m_email_nmcount.length;b++){if(this.m_email_nmcount[b][0]==a)return this.m_email_nmcount[b][1]}else return this.m_email_nmcount};Ant.launchTutorials=function(a){window.open("/help/tutorials.php?cat="+a,"tutorials","width=300,height=300,toolbar=no,menubar=no,location=no,directories=no,status=no,resizable=yes")};Ant.getObjectDefinition=function(){"undefined"==typeof this.objectdefs&&(this.objectdefs=[])};Ant.getActiveAppName=function(){return document.location.hash.substring(1).split("/")[0]};
Ant.getActiveApp=function(){var a=this.getActiveAppName();return a&&"undefined"!=typeof this.apps[a]?this.apps[a]:!1};Ant.appIsActive=function(a){this.getActiveAppName();return activeApp==a?!0:!1};Ant.resizeActiveApp=function(){var a=this.getActiveAppName();"undefined"!=typeof this.apps[a]&&"undefined"!=typeof this.apps[a].resize&&this.apps[a].resize()};
Ant.updateAppTitle=function(a,b){this.titleSections||(this.titleSections={});var c="";!b&&a&&(c=a);"notifications"==b&&0!=a&&(c+="("+a+") ");var d=this.getActiveApp(),c=d?"Untitled"==d.shortTitle?c+"Loading...":c+d.shortTitle:c+this.account.companyName;window.document.title=c};
Ant.ShowLogin=function(){"undefined"==typeof this.loginFrmAct&&(this.loginFrmAct=!1);if(!this.loginFrmAct){this.loginFrmAct=!0;var a=new CDialog("Login");a.f_close=!1;var b=alib.dom.createElement("div");a.customDialog(b,300,200);alib.dom.createElement("p",b).innerHTML="Either your session has expired or your internet connection was interrupted. Please log in below to continue working:";var c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"strong");c.innerHTML="User Name:";var d=alib.dom.createElement("div",
b),e=alib.dom.createElement("input");alib.dom.styleSet(e,"width","98%");e.type="text";e.value=this.user.name;d.appendChild(e);c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"strong");c.innerHTML="Password:";d=alib.dom.createElement("div",b);c=alib.dom.createElement("input");alib.dom.styleSet(c,"width","98%");c.type="password";c.value="";d.appendChild(c);d=function(a,b,c){a=[["function","login"],["name",a.value],["password",b.value]];ajax=new CAjax;ajax.cbData.cls=this;ajax.cbData.dlg=
c;ajax.onload=function(a){if(a.getNumChildren()&&(a=a.getChildNodeValByName("retval"),"OK"==a)){this.cbData.dlg.hide();Ant.loginFrmAct=!1;return}alert("There was a problem logging in. Please try again!")};ajax.exec("/security/wapi.php",a)};e.authFunc=d;e.cbDlg=a;e.cbPass=c;e.onkeyup=function(a){a=a||window.event;switch(a.keyCode){case 13:this.authFunc(this,this.cbPass,this.cbDlg),a.preventDefault?a.preventDefault():a.returnValue=!1}};c.authFunc=d;c.cbDlg=a;c.cbName=e;c.onkeyup=function(a){a=a||window.event;
switch(a.keyCode){case 13:this.authFunc(this.cbName,this,this.cbDlg),a.preventDefault?a.preventDefault():a.returnValue=!1}};b=alib.dom.createElement("div",b);alib.dom.styleSet(b,"margin","6px 0px 3px 3px");e=new CButton("OK",d,[e,c,a],"b2");e.print(b);e=new CButton("Log Out",function(){document.location="/logout.php"},[a],"b3");e.print(b)}};
Ant.userCheckin=function(){ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a?"1"==a?window.setTimeout("Ant.userCheckin()",6E4):this.cls.ShowLogin():this.cls.ShowLogin()};var a=0;alib.dom.userActive&&(a=1);var b=[];b[b.length]=["registerActive",a];ajax.exec("/controller/User/userCheckin",b)};Ant.changeTheme=function(a){a!=this.m_theme&&""!=a&&(alib.dom.getElementById("ant_css_theme").href="/css/ant_"+a+".css",this.m_theme=a)};Ant.getBaseUri=function(){return netric.getBaseUri()};
Ant.getUpdateStream=function(){null==this.updateStream_&&(this.updateStream_=new Ant.UpdateStream);return this.updateStream_};
var G_GROUP_COLORS=[["Blue","2A4BD7","ffffff"],["Black","000000","81c57a"],["Gray","575757","ffffff"],["Light Gray","A0A0A0","ffffff"],["White","FFFFFF","000000"],["Green","1D6914","ffee33"],["Brown","814A19","ffee33"],["Purple","8126C0","ffcdf3"],["Light Blue","9DAFFF","000000"],["Light Green","81C57A","000000"],["Tan","E9DEBB","814a19"],["Red","AD2323","ffee33"],["Teal","29D0D0","000000"],["Yellow","FFEE33","000000"],["Orange","FF9233","ffffff"],["Pink","FFCDF3","ad2323"]];
function copy(a){if(window.clipboardData)window.clipboardData.setData("Text",a);else{if(!document.getElementById("flashcopier")){var b=document.createElement("div");b.id="flashcopier";document.body.appendChild(b)}document.getElementById("flashcopier").innerHTML="";a='<embed src="/flash/_clipboard.swf" FlashVars="clipboard='+escape(a)+'" width="0" height="0" type="application/x-shockwave-flash"></embed>';document.getElementById("flashcopier").innerHTML=a}}
function getColorTextForGroup(a){for(var b="000000",c=0;c<G_GROUP_COLORS.length;c++)G_GROUP_COLORS[c][1]==a&&(b=G_GROUP_COLORS[c][2]);return b}function loadSupportDoc(a){window.open("http://www.netric.com/support/solutions/"+a);return!1}function loadDacl(a,b,c){a=new DaclEdit(b,"undefined"!=typeof c?c:null);a.showDialog()}
function objectSetNameLabel(a,b,c){a&&b&&(ajax=new CAjax("json"),ajax.cbData.con=c,ajax.onload=function(a){a.error||(this.cbData.con.innerHTML=unescape(a))},ajax.exec("/controller/Object/getObjName",[["obj_type",a],["id",b]]))}function objectSplitValue(a){a=a.split(":");return{typeTitle:a[0],objTitle:a[1]}}function objectSplitLbl(a){a=a.split(":");return{typeTitle:a[0],objTitle:a[1]}}
function objectPreloadDef(a,b){for(var c=0;c<CAntObjectDefs.length;c++)if(CAntObjectDefs[c].name==a)if(b)CAntObjectDefs.splice(c,1),AntObjectForms.clearCache(a);else return;c=new CAjax;c.onload=function(b){var c={};c.name=a;c.root=b;CAntObjectDefs[CAntObjectDefs.length]=c};c.exec("/objects/xml_get_objectdef.php?oname="+a)}
function loadObjectForm(a,b,c,d,e){e=e?e:[];c=new CDialog("");b=b?b:"";d=alib.dom.createElement("div",document.body);alib.dom.styleSet(d,"height","100%");alib.dom.styleSet(d,"overflow","auto");d.cls=this;d.dlg=c;d.close=function(){this.dlg.hide()};a=new AntObjectLoader(a,b);for(b=0;b<e.length;b++)a.setValue(e[b][0],e[b][1]);a.print(d,this.isPopup);a.objfrmCon=d;a.objBrwsrCls=this;alib.events.listen(a,"close",function(a){a.data.frm.close()},{frm:d});a.onSave=function(){};a.onRemove=function(){};c.customDialog(d,
900,getWorkspaceHeight());return a}
function filterInput(a,b,c,d){var e,f="";if(window.event)e=window.event.keyCode,b=window.event;else if(b)e=b.which;else return!0;0==a?f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ":1==a?f="0123456789":2==a&&(f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789");d&&(f+=d);if(""==f)return!0;b=b.srcElement?b.srcElement:b.target||b.currentTarget;if(null==e||0==e||8==e||9==e||13==e||27==e)return!0;e=String.fromCharCode(e);return-1<f.indexOf(e)?!0:1==a&&c&&"."==e&&-1==b.value.indexOf(".")?
!0:!1}function getWorkspaceHeight(){var a=alib.dom.getClientHeight(),b=document.getElementById("appheader");b&&(a-=alib.dom.getElementHeight(b,!0));(b=document.getElementById("appnav"))&&(a-=alib.dom.getElementHeight(b,!0));"undefined"!=typeof Ant&&(b=Ant.getActiveApp())&&(a-=b.getAppHeaderHeight());return a}var g_EmailThreadGetAdressColorCache=[];function EmailThreadGetAdressColor(){}
function buildTable(a){a=alib.dom.createElement("table",a);a.setAttribute("cellpadding",2);a.setAttribute("cellspacing",2);alib.dom.styleSet(a,"width","100%");return alib.dom.createElement("tbody",a)}
function buildFormInput(a,b){for(formData in a){var c=a[formData],d=buildTdLabel(b,c.label,c.labelWidth);switch(c.type){case "checkbox":var e=d.firstChild;e.innerHTML="";e.setAttribute("colspan",2);alib.dom.styleSetClass(e,"formValue");e.appendChild(c);if(c.label){var f=alib.dom.createElement("label",e);f.innerHTML=c.label}break;case "hidden":alib.dom.styleSet(d,"display","none");e=d.firstChild;e.setAttribute("colspan",2);e.appendChild(c);break;default:e=alib.dom.createElement("td",d),alib.dom.styleSetClass(e,
"formValue"),alib.dom.styleSetClass(c,"fancy"),e.appendChild(c)}c.inputLabel&&(f=alib.dom.createElement("label",e),f.innerHTML=c.inputLabel,alib.dom.styleSet(f,"fontSize","11px"))}return d}
function buildFormInputDiv(a,b,c,d){"undefined"==typeof d&&(d="3px");b.innerHTML="";for(formData in a){var e=a[formData];switch(e.type){default:var f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"float","left");alib.dom.styleSet(f,"marginRight",d);f.appendChild(e);if(e.label){var g=alib.dom.createElement("label",f);alib.dom.styleSet(g,"fontSize","11px");g.innerHTML=e.label;e.floatDir?alib.dom.styleSet(g,"float",e.floatDir):alib.dom.styleSet(g,"float","right");e.labelWidth&&alib.dom.styleSet(g,
"width",e.labelWidth)}}c&&(alib.dom.styleSet(f,"marginBottom","5px"),divClear(b))}return f}function buildTdLabel(a,b,c){var a=alib.dom.createElement("tr",a),d=alib.dom.createElement("td",a);alib.dom.styleSet(d,"fontSize","12px");alib.dom.styleSet(d,"vertical-align","middle");alib.dom.styleSet(d,"paddingBottom","8px");c&&d.setAttribute("width",c);b&&(d.innerHTML=b);return a}
function createInputAttribute(a,b,c,d,e,f,g,h){c&&(a.id=c);b&&(a.type=b);d&&(a.label=d);f&&(a.value=f);e&&alib.dom.styleSet(a,"width",e);g&&(a.labelWidth=g);h&&(a.floatDir=h);return a}function setElementAttr(a,b){for(attribute in b){var c=b[attribute][0],d=b[attribute][1];switch(c){case "width":alib.dom.styleSet(a,"width",d);default:a[c]=d}}return a}function divClear(a){a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"clear","both");alib.dom.styleSet(a,"visibility","hidden")}
function showDialog(a){var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML=a;b.statusDialog(c,250,100);return b}
function getWindowSize(a){var b=0,c=0;if("number"==typeof window.innerWidth)b=window.innerWidth,c=window.innerHeight;else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))b=document.documentElement.clientWidth,c=document.documentElement.clientHeight;else if(document.body&&(document.body.clientWidth||document.body.clientHeight))b=document.body.clientWidth,c=document.body.clientHeight;return a?b:c}
function commentSettings(a,b){"undefined"==typeof b||null==b?(ajax=new CAjax("json"),ajax.cls=this,ajax.onload=function(b){buildCommentSettings(a,b)},ajax.exec("/controller/User/getUserId")):buildCommentSettings(a,b)}
function buildCommentSettings(a,b){var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"borderTop","1px solid");alib.dom.styleSet(c,"paddingTop","5px");var d=alib.dom.createElement("div",c);alib.dom.styleSet(d,"float","left");alib.dom.styleSet(d,"width","190px");d=alib.dom.createElement("p",d);alib.dom.styleSet(d,"fontWeight","bold");alib.dom.styleSet(d,"fontSize","12px");d.innerHTML="Comments";d=alib.dom.createElement("div",c);alib.dom.styleSet(d,"float","left");var e=new AntObjectBrowser("comment");
e.setFilter("associations","user:"+b);e.printComments(d,"user:"+b);divClear(c)}function getHeaderHeights(){var a=0,b=document.getElementById("appheader");b&&(a=alib.dom.getContentHeight(b));var b=0,c=document.getElementById("appnav");c&&(b=alib.dom.getContentHeight(c));var c=0,d=document.getElementById("apptitle");d&&(c=alib.dom.getContentHeight(d));d={};d.appheaderHeight=a;d.appNavHeight=b;d.appTitleHeight=c;d.totalHeaderHeight=a+b+c;return d}
function buildDropdown(a,b,c){for(data in b){var d=b[data],e=a.length,f=!1;if("object"==typeof d)var g=d[0],d=d[1];else g=d;c==g&&(f=!0);a[e]=new Option(d,g,!1,f)}}function checkObjectData(a){for(object in a)return!0;return!1}function getNotifiedParts(a){var b={type:"text",id:"",email:"",name:""},a=a.split("|");b.name=a[0];var c=a[0].split(":");1<c.length?(b.type=c[0],b.id=c[1]):(c=a[0].split("@"),1<c.length&&(b.email=a[0]));1<a.length&&(b.name=a[1]);return b}
function tabSpace(a){for(var b="",c=0;c<a;c++)b+="\t";return b}function checkSpecialCharacters(a,b,c){return!/^[a-zA-Z0-9_ %\[\]\.\(\)%&-]*$/.test(b)?(setTimeout(function(){alert("A "+a+" name can't contain any of the following characters: \n\n / ? < >  : * | \"");c&&c.focus()},0),!1):!0}String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()})};
String.prototype.linkify=function(){if(this.match(/\.(jpeg|jpg|gif|png|bmp)$/))return this;replacedText=this.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>');return replacedText=replacedText.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>')};
function CReport(){this.id=null;this.description=this.name="";this.dimensions=[];this.measures=[];this.mainObject=this.obj_type=this.cube=this.view=null;this.chart_type="";this.chart_width=800;this.fCalculate=this.fDisplayChart=this.fDisplayTable=!0;this.hideloading=!1;this.aggregate_types=[["sum","Sum / Add"],["avg","Average"],["max","Maximum"],["min","Minimum"]];this.timegroup_types=[["minute","Minute"],["hour","Hour"],["day","Day"],["month","Month"],["quarter","Quarter"],["year","Year"]];this.scope=
"system";this.daclId=null;this.customReport="";this.conditions=[]}CReport.prototype.setObjectType=function(a){this.obj_type=a;this.mainObject=new CAntObject(a);this.view=new CAntObjectView(a);this.view.name="Details"};
CReport.prototype.load=function(a){a&&(this.id=a);if(this.id)a=new CAjax,a.m_obj=this,a.onload=function(a){for(var c=0;c<a.getNumChildren();c++){var d=a.getChildNode(c);switch(d.m_name){case "name":this.m_obj.name=unescape(d.m_text);break;case "dimensions":for(var e=0;e<d.getNumChildren();e++){var f=d.getChildNode(e),g=unescape(f.getAttribute("field"));""!=g&&(this.m_obj.dimensions[e]={field:g,group:unescape(f.getAttribute("group"))})}break;case "measures":for(e=0;e<d.getNumChildren();e++)f=d.getChildNode(e),
this.m_obj.measures[e]={field:unescape(f.getAttribute("field")),aggregate:unescape(f.getAttribute("aggregate"))};break;case "description":this.m_obj.description=unescape(d.m_text);break;case "custom_report":this.m_obj.customReport=unescape(d.m_text);break;case "obj_type":this.m_obj.obj_type=unescape(d.m_text);this.m_obj.mainObject=new CAntObject(this.m_obj.obj_type);this.m_obj.view=new CAntObjectView(this.m_obj.obj_type);this.m_obj.view.name="Details";break;case "view":this.m_obj.view=new CAntObjectView(this.m_obj.obj_type);
this.m_obj.view.loadFromXml(d);break;case "chart_type":this.m_obj.chart_type=unescape(d.m_text);break;case "f_display_table":this.m_obj.fDisplayTable="t"==d.m_text?!0:!1;break;case "f_display_chart":this.m_obj.fDisplayChart="t"==d.m_text?!0:!1;break;case "f_calculate":this.m_obj.fCalculate="t"==d.m_text?!0:!1;break;case "dacl_id":this.m_obj.daclId=unescape(d.m_text)}}for(c=0;c<this.m_obj.conditions.length;c++)this.m_obj.view.addCondition(this.m_obj.conditions[c].blogic,this.m_obj.conditions[c].fieldName,
this.m_obj.conditions[c].operator,this.m_obj.conditions[c].condValue);if(this.m_obj.fCalculate)this.m_obj.loadCube();else this.m_obj.onload()},a.exec("/datacenter/xml_get_report.php?rid="+this.id);else this.onloadError(-1,"No report ID to load")};
CReport.prototype.loadCube=function(a){if(this.obj_type&&this.dimensions.length&&this.measures.length){if(this.hideloading)b=null;else{var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Loading report, please wait...";b.statusDialog(c,250,100)}var c=this.dimensions[0].field,d=this.dimensions[0].group;if(1<this.dimensions.length)var e=this.dimensions[1].field,f=this.dimensions[1].group;else f=e="";this.cube=
new COlapCube(this.obj_type,this.view,this.measures);this.cube.cbObj=this;this.cube.loadingDlg=b;this.cube.chart_width=this.chart_width;this.cube.customReport=this.customReport;this.cube.onload=a?function(){this.loadingDlg&&this.loadingDlg.hide();this.cbObj.onCubeUpdate()}:function(){this.loadingDlg&&this.loadingDlg.hide();this.cbObj.onload()};this.cube.load(c,d,e,f,this.chart_type)}else this.onloadError(-1,"Not enough data has been set to load this report")};
CReport.prototype.printCubeMicroForm=function(a,b){var c=b?!1:!0,d=alib.dom.createElement("table",a),d=alib.dom.createElement("tbody",d);if(c&&""==this.customReport){var e=alib.dom.createElement("tr",d),f=alib.dom.createElement("div"),g=alib.dom.createElement("td",e);g.innerHTML="View By:&nbsp;";var g=alib.dom.createElement("td",e),h=alib.dom.createElement("select",g);h.report=this;h.subopt_con1=f;h.mainObject=this.mainObject;h.onchange=function(){var a="";if(this.value){var b=this.mainObject.getFieldByName(this.value);
b&&("date"==b.type||"timestamp"==b.type?(this.subopt_con1.style.display="inline",a=this.report.timegroup_types[3][0]):this.subopt_con1.style.display="none")}this.report.dimensions[0]={field:this.value,group:a};this.report.changeDimension()};for(var k=this.mainObject.getFields(),e=this.dimensions.length?this.dimensions[0].field:"",l=0;l<k.length;l++)"fkey_multi"!=k[l].type&&(h[h.length]=new Option(k[l].title,k[l].name,!1,e==k[l].name?!0:!1));k=alib.dom.createElement("span",f);k.innerHTML="&nbsp;&nbsp;Group By&nbsp;";
var m=alib.dom.createElement("select",f);m.report=this;m.onchange=function(){this.report.dimensions[0]={field:1<this.report.dimensions.length?this.report.dimensions[0].field:"",group:this.value};this.report.changeDimension()};h=this.dimensions.length?this.dimensions[0].group:"month";k=this.mainObject.getFields();for(l=0;l<this.timegroup_types.length;l++)m[m.length]=new Option(this.timegroup_types[l][1],this.timegroup_types[l][0],!1,h==this.timegroup_types[l][0]?!0:!1);g.appendChild(f);f.style.display=
"none";if(e&&(g=this.mainObject.getFieldByName(e)))f.style.display="date"==g.type||"timestamp"==g.type?"inline":"none"}if(c&&1<this.dimensions.length&&""==this.customReport){e=alib.dom.createElement("tr",d);c=alib.dom.createElement("div");g=alib.dom.createElement("td",e);g.innerHTML="Then By:&nbsp;";g=alib.dom.createElement("td",e);f=alib.dom.createElement("select",g);f.report=this;f.subopt_con2=c;f.mainObject=this.mainObject;f.onchange=function(){var a="";if(this.value){var b=this.mainObject.getFieldByName(this.value);
b&&("date"==b.type||"timestamp"==b.type?(this.subopt_con2.style.display="inline",a=this.report.timegroup_types[3][0]):this.subopt_con2.style.display="none")}this.report.dimensions[1]={field:this.value,group:a};this.report.changeDimension()};k=this.mainObject.getFields();e=1<this.dimensions.length?this.dimensions[1].field:"";h=1<this.dimensions.length?this.dimensions[1].group:"";for(l=0;l<k.length;l++)"fkey_multi"!=k[l].type&&(f[f.length]=new Option(k[l].title,k[l].name,!1,e==k[l].name?!0:!1));k=alib.dom.createElement("span",
c);k.innerHTML="&nbsp;&nbsp;Group By&nbsp;";m=alib.dom.createElement("select",c);m.report=this;m.onchange=function(){this.report.dimensions[1]={field:1<this.report.dimensions.length?this.report.dimensions[1].field:"",group:this.value};this.report.changeDimension()};h=1<this.dimensions.length?this.dimensions[1].group:"";k=this.mainObject.getFields();for(l=0;l<this.timegroup_types.length;l++)m[m.length]=new Option(this.timegroup_types[l][1],this.timegroup_types[l][0],!1,h==this.timegroup_types[l][0]?
!0:!1);g.appendChild(c);c.style.display="none";if(e&&(g=this.mainObject.getFieldByName(e)))c.style.display="date"==g.type||"timestamp"==g.type?"inline":"none"}c=this.view?this.view.conditions:null;d=alib.dom.createElement("tr",d);d.vAlign="top";k=alib.dom.createElement("td",d);k.innerHTML="Filter By:";g=alib.dom.createElement("td",d);d=alib.dom.createElement("div",g);g=alib.dom.createElement("div",g);alib.dom.styleSet(d,"display","none");c=this.mainObject.buildAdvancedQuery(d,c);f=alib.dom.createElement("div",
d);alib.dom.styleSet(f,"text-align","right");e=alib.dom.createElement("a",f);e.innerHTML="Apply Filter";e.href="javascript:void(0);";e.conditionObj=c;e.fltr_btn_con=g;e.fltr_query_con=d;e.cls=this;e.onclick=function(){this.fltr_btn_con.style.display="block";this.fltr_query_con.style.display="none";var a=this.conditionObj.getCondDesc(this.cls.obj_type);this.fltr_btn_con.innerHTML="";this.fltr_btn_con.appendChild(a);a=alib.dom.createElement("span",this.fltr_btn_con);a.innerHTML="&nbsp;&nbsp;<a href='javascript:void(0);'>[click to edit]</a>";
this.cls.view.conditions=[];for(a=0;a<this.conditionObj.getNumConditions();a++){var b=this.conditionObj.getCondition(a);this.cls.view.conditions[a]={};this.cls.view.conditions[a].blogic=b.blogic;this.cls.view.conditions[a].fieldName=b.fieldName;this.cls.view.conditions[a].operator=b.operator;this.cls.view.conditions[a].condValue=b.condValue}this.cls.changeDimension();this.cls.onConditionChange()};alib.dom.createElement("span",f).innerHTML="&nbsp;";e=alib.dom.createElement("a",f);e.innerHTML="Cancel Edit";
e.fltr_btn_con=g;e.fltr_query_con=d;e.href="javascript:void(0);";e.onclick=function(){this.fltr_btn_con.style.display="block";this.fltr_query_con.style.display="none"};g.fltr_query_con=d;g.innerHTML="";d=c.getCondDesc(this.obj_type);g.appendChild(d);d=alib.dom.createElement("span",g);d.innerHTML="&nbsp;&nbsp;<a href='javascript:void(0);'>[click to edit]</a>";g.onclick=function(){this.fltr_query_con.style.display="block";this.style.display="none"}};CReport.prototype.changeDimension=function(){this.loadCube(!0)};
CReport.prototype.save=function(){var a=[["name",this.name],["description",this.description],["obj_type",this.obj_type],["scope",this.scope],["chart_type",this.chart_type],["f_display_table",this.fDisplayTable?"t":"f"],["f_display_chart",this.fDisplayChart?"t":"f"],["f_calculate",this.fCalculate?"t":"f"]];this.dimensions.length&&(a[a.length]=["dim_one_fld",this.dimensions[0].field],a[a.length]=["dim_one_grp",this.dimensions[0].group]);1<this.dimensions.length&&(a[a.length]=["dim_two_fld",this.dimensions[1].field],
a[a.length]=["dim_two_grp",this.dimensions[1].group]);this.measures.length&&(a[a.length]=["measure_one_fld",this.measures[0].field],a[a.length]=["measure_one_agg",this.measures[0].aggregate]);this.id&&(a[a.length]=["rid",this.id]);var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Saving report, please wait...";b.statusDialog(c,250,100);new CAjaxRpc("/datacenter/xml_actions.awp","report_save",a,function(a,
b,c){c.hide();a&&(b.id=a,b.view&&(b.view.reportId=a,b.view.save()),b.onsave(a))},[this,b],AJAX_POST)};CReport.prototype.addFilterCondition=function(a,b,c,d){var e=this.conditions.length;this.conditions[e]={};this.conditions[e].blogic=a;this.conditions[e].fieldName=b;this.conditions[e].operator=c;this.conditions[e].condValue=d};CReport.prototype.onsave=function(){};CReport.prototype.onload=function(){};CReport.prototype.onloadError=function(){};CReport.prototype.onCubeUpdate=function(){};
CReport.prototype.onConditionChange=function(){};var TABLE_TABULAR="tabular",TABLE_SUMMARY="summary",TABLE_PIVOT="pivot_matrix",REPORT_TYPE_OBJECT="object",REPORT_TYPE_DATAWARE="dataware",REPORT_TYPE_CUSTOM="custom",GRAPH_TYPE_SINGLE="single",GRAPH_TYPE_MULTI="multi",TABLE_TABULAR="tabular",TABLE_SUMMARY="summary",TABLE_PIVOT="pivot_matrix",MEASURE_COUNT="count";
function Report(a){this.reportId=a;this.mainObject=new CAntObject("report",this.reportId);this.aggregateData=["sum","avg","max","min"];this.sortData=[["asc","Ascending"],["desc","Descending"]];this.formatData=[["Y","Year"],["Y Q","Quarter"],["m","Month"],["Y d","Day"]];this.dimTypeData={};this.measureData={};this.dimensionData={};this.filterData=[];this.finishBuilding=!1;this.displayReportName=!0;this.cube=this.chartHeight=this.chartWidth=this.tableType=null;this.cbData={}}
Report.prototype.onloadGraphs=function(){};Report.prototype.onload=function(){};Report.prototype.onsave=function(){};
Report.prototype.print=function(a){var b={};b.type=this.reportData.chart_type;b.dimension=this.reportData.chart_dim1;b.dimensionFormat=this.reportData.chart_dim1_grp;b.grouping=this.reportData.chart_dim2;b.groupingFormat=this.reportData.chart_dim2_grp;b.measure=this.reportData.chart_measure;b.aggregate=this.reportData.chart_measure_agg;if(this.displayReportName){var c=alib.dom.setElementAttr(alib.dom.createElement("div",a),[["innerHTML",this.reportData.name]]);alib.dom.styleSet(c,"fontWeight","bold");
alib.dom.styleSet(c,"fontSize","12px");alib.dom.styleSet(c,"margin","5px")}this.graphCon=alib.dom.createElement("div",a);this.graphCon.id="GraphCon";this.displayGraph(this.graphCon,b,this.filterData);this.tableResultCon=alib.dom.createElement("div",a);alib.dom.styleSet(this.tableResultCon,"display","none");this.displayTableData()};
Report.prototype.loadReport=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.tableType=a.reportData.table_type;this.cbData.cls.reportData=a.reportData;this.cbData.cls.filterData=a.filters;this.cbData.cls.reportDimensionData=a.dimensions;this.cbData.cls.reportMeasureData=a.measures;this.cbData.cls.cube=new OlapCube(a.reportData.obj_type,a.reportData.custom_report,a.reportData.dataware_cube);var c=this.cbData.cls.cube;c.cls=this.cbData.cls;c.reportData=
a;c.onloadDefinition=function(a,b){this.cls.dimensionData=a;this.cls.measureData=b;for(dimension in this.cls.dimensionData){var c=this.cls.dimensionData[dimension];this.cls.dimTypeData[c.name]=c.type}this.cls.finishBuilding=!0;this.cls.onload(this.reportData)};c.loadDefinition(this.cbData.cls)};var a=[];a[a.length]=["id",this.reportId];ajax.exec("/controller/Datacenter/getReportData",a)};
Report.prototype.getGraphTypes=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onloadGraphs(a)};var b=[];b[b.length]=["gtype",a];ajax.exec("/controller/Datacenter/reportGetGraphTypes",b)};Report.prototype.getObjects=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onload(a)};ajax.exec("/controller/Object/getObjects")};
Report.prototype.displayGraph=function(a,b,c){var d=new OlapCube_Graph(this.cube);if(b.type){a.innerHTML="<div class='loading'></div>";b.dimension.length&&d.addDimension(b.dimension,"asc",b.dimensionFormat);b.grouping.length&&d.addDimension(b.grouping,"asc",b.groupingFormat);var e="";b.measure!==MEASURE_COUNT&&(e=b.aggregate);d.addMeasure(b.measure,e);for(filter in c)e=c[filter],d.addFilter(e.blogic,e.fieldName,e.operator,e.condValue);d.chartType=b.type;d.chartWidth=this.chartWidth;this.chartHeight&&
(d.chartHeight=this.chartHeight);d.print(a,!1)}else a.innerHTML="Report Graph Type is not set.",alib.dom.styleSet(a,"height","50px")};
Report.prototype.displayTableData=function(){if(this.tableType){switch(this.tableType){case TABLE_TABULAR:var a=new AntObjectLoader_Report_Tabular(this);if(this.reportDimensionData.length)for(dimension in this.reportDimensionData){var b=this.reportDimensionData[dimension];a.tabularDimensionData[dimension]={};var c=a.tabularDimensionData[dimension];c.dimension=alib.dom.setElementAttr(alib.dom.createElement("div"),[["innerHTML",b.name]]);c.sort=alib.dom.setElementAttr(alib.dom.createElement("div"),
[["innerHTML",b.sort]])}break;case TABLE_SUMMARY:a=new AntObjectLoader_Report_Summary(this);if(this.reportDimensionData.length)for(dimension in this.reportDimensionData){b=this.reportDimensionData[dimension];a.reportForm.summaryGroup[dimension]={};var c=a.reportForm.summaryGroup[dimension],d=this.dimTypeData[b.name];c.dimension=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.name],["dimType",d]]);c.sort=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.sort]]);
c.format=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.format]])}if(this.reportMeasureData.length)for(measure in this.reportMeasureData)b=this.reportMeasureData[measure],a.reportForm.summarySumm[measure]={},c=a.reportForm.summarySumm[measure],c.measure=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.name]]),c.aggregate=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.aggregate]]);break;case TABLE_PIVOT:a=new AntObjectLoader_Report_PivotMatrix(this);
if(this.reportDimensionData.length)for(dimension in this.reportDimensionData)b=this.reportDimensionData[dimension],d=this.dimTypeData[b.name],"t"==b.f_column?(a.reportForm.pivotColumn[dimension]={},c=a.reportForm.pivotColumn[dimension]):"t"==b.f_row&&(a.reportForm.pivotRow[dimension]={},c=a.reportForm.pivotRow[dimension]),c.dimension=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.name],["dimType",d]]),c.sort=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",
b.sort]]),c.format=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.format]]);if(this.reportMeasureData.length)for(measure in this.reportMeasureData)b=this.reportMeasureData[measure],c=a.reportForm.pivotData,c.measure=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.name]]),c.aggregate=alib.dom.setElementAttr(alib.dom.createElement("hidden"),[["value",b.aggregate]]);a.reportForm.pivotTotals={};b=[["type","checkbox"],["checked","f"==this.reportData.f_sub_totals?
!1:!0]];a.reportForm.pivotTotals.sub=alib.dom.setElementAttr(alib.dom.createElement("input"),b);break;default:return}a.buildOlapData()}};Report.prototype.saveReport=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onsave(a)};ajax.exec("/controller/Datacenter/updateReportData",a)};
Report.prototype.createReport=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onsave(a)};ajax.exec("/controller/Datacenter/saveReportData",a)};Report.prototype.toggleDisplay=function(a){alib.dom.styleSet(this.tableResultCon,"display","none");alib.dom.styleSet(this.graphCon,"display","none");a?alib.dom.styleSet(this.graphCon,"display","block"):alib.dom.styleSet(this.tableResultCon,"display","block")};var CUST_TYPE_CONTACT=1,CUST_TYPE_ACCOUNT=2;
function CCustActivity(a){this.m_aid=a?a:null;this.opportunity_id=this.lead_id=this.customer_id=this.type_id=null}CCustActivity.prototype.showDialog=function(){this.buildInterface()};
CCustActivity.prototype.buildInterface=function(){this.title=this.m_aid?"Edit/View Activity":"Enter New Activity";var a=new CDialog(this.title);this.m_dlg=a;var b=alib.dom.createElement("div");this.m_maindiv=b;b.innerHTML="";var c=alib.dom.createElement("table",b);alib.dom.styleSet(c,"width","100%");c.cellPadding="0";c.cellSpacing="3";var c=alib.dom.createElement("tbody",c),d=alib.dom.createElement("tr",c),e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,
"width","55px");e.innerHTML="Subject:";d=alib.dom.createElement("td",d);this.txtSub=alib.dom.createElement("input",d);alib.dom.styleSet(this.txtSub,"width","100%");this.txtSub.maxLength=32;d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"width","55px");e.innerHTML="Type:";this.dvSelCon=alib.dom.createElement("td",d);alib.dom.styleSet(this.dvSelCon,"margin","0 3px 3px 58px");this.selTypes=alib.dom.createElement("select",this.dvSelCon);
this.selTypes.dlgField=!0;this.getActivityTypes();d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"width","55px");e.innerHTML="Direction:";this.dvDirCon=alib.dom.createElement("td",d);alib.dom.styleSet(this.dvDirCon,"margin","0 3px 3px 58px");this.selDirection=alib.dom.createElement("select",this.dvDirCon);this.selDirection.dlgField=!0;this.selDirection[this.selDirection.length]=new Option("None","",!1,!1);this.selDirection[this.selDirection.length]=
new Option("Outgoing","o",!1,!1);this.selDirection[this.selDirection.length]=new Option("Incoming","i",!1,!1);d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"width","55px");e.innerHTML="Date:";d=alib.dom.createElement("td",d);this.txtDate=alib.dom.createElement("input",d);alib.dom.styleSet(this.txtDate,"width","75px");this.txtDate.value=this.getNowDateString();d=alib.dom.createElement("span",d);d.innerHTML="<img src='/images/calendar.gif' border='0'>";
new CAutoCompleteCal(this.txtDate,d);d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"width","55px");e.innerHTML="Time:";d=alib.dom.createElement("td",d);this.txtTime=alib.dom.createElement("input",d);alib.dom.styleSet(this.txtTime,"width","75px");this.txtTime.value=this.getNowTimeString();new CAutoCompleteTime(this.txtTime);d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");
alib.dom.styleSet(e,"width","55px");e.innerHTML="Public:";d=alib.dom.createElement("td",d);this.ckPublic=alib.dom.createElement("input");this.ckPublic.type="checkbox";this.ckPublic.checked=!0;d.appendChild(this.ckPublic);c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"margin-right","5px");alib.dom.styleSet(c,"border","0");this.taNotes=alib.dom.createElement("textarea",c);alib.dom.styleSet(this.taNotes,"width","100%");alib.dom.styleSet(this.taNotes,"height","250px");alib.dom.styleSet(this.taNotes,
"border","1px solid");c=alib.dom.createElement("div",b);d=new CButton("Save",function(a){a.save()},[this,this.m_dlg]);d.print(c);this.btnSave=d;d=new CButton("Cancel",function(a){a.hide()},[this.m_dlg]);d.print(c);a.customDialog(b,600,420);this.m_aid&&this.loadActivity()};
CCustActivity.prototype.save=function(){var a=[["name",this.txtSub.value],["notes",this.taNotes.value],["type_id",this.selTypes.value],["direction",this.selDirection.value],["time",this.txtTime.value],["date",this.txtDate.value],["f_public",this.ckPublic.checked?"t":"f"]];this.m_aid&&(a[a.length]=["aid",this.m_aid]);this.lead_id&&(a[a.length]=["lead_id",this.lead_id]);this.opportunity_id&&(a[a.length]=["opportunity_id",this.opportunity_id]);this.customer_id&&(a[a.length]=["customer_id",this.customer_id]);
ajax=new CAjax("json");ajax.cls=this;ajax.m_dlg=this.m_dlg;ajax.onload=function(a){this.m_dlg.hide();this.cls.onSave(a)};ajax.exec("/controller/Customer/activitySave",a)};CCustActivity.prototype.onSave=function(){};CCustActivity.prototype.onCancel=function(){};CCustActivity.prototype.getNowTimeString=function(){var a=new Date,b=a.getHours(),a=a.getMinutes(),c="AM";12<=b&&(c="PM",b-=12);0==b&&(b=12);10>a&&(a="0"+a);return b+":"+a+" "+c};
CCustActivity.prototype.getNowDateString=function(){var a=new Date,b=a.getMonth()+1,c=a.getDate(),a=a.getFullYear();return b+"/"+c+"/"+a};CCustActivity.prototype.getActivityTypes=function(){ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){if(a&&a.length)for(types in a){var b=a[types];this.cls.selTypes[cls.selTypes.length]=new Option(b.name,b.id,!1,this.cls.type_id==b.name?!0:!1)}};ajax.exec("/controller/Customer/getActivityTypes")};
CCustActivity.prototype.loadActivity=function(){this.m_ajax=new CAjax;this.m_ajax.m_ccls=this;this.m_ajax.onload=function(a){var c=a.getNumChildren();for(i=0;i<c;i++){var d=a.getChildNode(i);if("activity"==d.m_name){d.getChildNodeValByName("id");var e=d.getChildNodeValByName("name"),f=d.getChildNodeValByName("type_id"),g=d.getChildNodeValByName("direction"),h=d.getChildNodeValByName("type_name"),k=d.getChildNodeValByName("time_entered"),l=d.getChildNodeValByName("date_entered"),m=d.getChildNodeValByName("public"),
n=d.getChildNodeValByName("f_readonly"),o=d.getChildNodeValByName("notes");d.getChildNodeValByName("email_id");var p=d.getChildNodeValByName("opportunity_id"),q=d.getChildNodeValByName("lead_id"),d=d.getChildNodeValByName("customer_id");p&&(this.m_ccls.opportunity_id=p);q&&(this.m_ccls.lead_id=q);d&&(this.m_ccls.customer_id=d);e||(e="untitled");"t"==n&&(this.m_ccls.txtSub.disabled=!0,this.m_ccls.taNotes.disabled=!0,this.m_ccls.txtTime.disabled=!0,this.m_ccls.txtDate.disabled=!0,this.m_ccls.ckPublic.disabled=
!0,this.m_ccls.selTypes.disabled=!0,this.m_ccls.selDirection.disabled=!0,this.m_ccls.btnSave.disable());this.m_ccls.txtSub.value=unescape(e);this.m_ccls.taNotes.value=unescape(o);this.m_ccls.txtTime.value=unescape(k);this.m_ccls.txtDate.value=unescape(l);this.m_ccls.ckPublic.checked="t"==m?!0:!1;if(f)for(intIndex=0;intIndex<this.m_ccls.selTypes.options.length;intIndex++){if(this.m_ccls.selTypes.options[intIndex].value==f){this.m_ccls.selTypes.selectedIndex=intIndex;break}}else this.m_ccls.dvSelCon.innerHTML=
h;if(g)for(intIndex=0;intIndex<this.m_ccls.selDirection.options.length;intIndex++)if(this.m_ccls.selDirection.options[intIndex].value==g){this.m_ccls.selDirection.selectedIndex=intIndex;break}}}c||(this.m_ccls.m_maindiv.innerHTML=" Error loading activity")};var a="/customer/xml_get_activities.php?";this.m_aid&&(a+="aid="+this.m_aid);this.m_ajax.exec(a)};CUST_TYPE_CONTACT=1;CUST_TYPE_ACCOUNT=2;
function CCustomerBrowser(){this.title="Select Customer";this.customerTitle="Customer";this.allowNew=!0;this.filterType=null}
CCustomerBrowser.prototype.showDialog=function(){var a=new CDialog(this.title);this.m_dlg=a;a.f_close=!0;var b=alib.dom.createElement("div");alib.dom.createElement("span",b).innerHTML="Find: ";this.m_txtSearch=alib.dom.createElement("input",b);alib.dom.styleSet(this.m_txtSearch,"width","300px");this.m_txtSearch.m_cls=this;this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);13==("undefined"!=typeof a.keyCode?a.keyCode:a.which)&&this.m_cls.loadCustomers()};
(new CButton("Search",function(a){a.loadCustomers()},[this])).print(b);this.pag_div=alib.dom.createElement("div",b);alib.dom.styleSet(this.pag_div,"margin-bottom","3px");alib.dom.styleSet(this.pag_div,"text-align","right");this.pag_div.innerHTML="Page 1 of 1";this.m_browsedv=alib.dom.createElement("div",b);alib.dom.styleSet(this.m_browsedv,"height","350px");alib.dom.styleSet(this.m_browsedv,"border","1px solid");alib.dom.styleSet(this.m_browsedv,"background-color","white");alib.dom.styleSet(this.m_browsedv,
"overflow","auto");this.m_browsedv.innerHTML="<div style='margin:10px;vertical-align:middle;'><span class='loading'></span></div>";this.dv_new=alib.dom.createElement("div",b);alib.dom.styleSet(this.dv_new,"margin-top","3px");alib.dom.styleSet(this.dv_new,"border","1px solid");alib.dom.styleSet(this.dv_new,"padding","3px");this.createNew();a.customDialog(b,600,420);this.loadCustomers()};CCustomerBrowser.prototype.select=function(a,b){this.m_dlg.hide();this.onSelect(a,b)};
CCustomerBrowser.prototype.createNew=function(a){this.dv_new.innerHTML="";if(a){a=alib.dom.createElement("span",this.dv_new);a.innerHTML="Type :&nbsp;";var b=alib.dom.createElement("select",this.dv_new);b.onchange=function(){};b[b.length]=new Option("Account",CUST_TYPE_ACCOUNT,!1,!0);b[b.length]=new Option("Contact",CUST_TYPE_CONTACT,!1,!1);a=alib.dom.createElement("span",this.dv_new);a.innerHTML="&nbsp;Name:&nbsp;";var c=alib.dom.createElement("input");c.type="text";alib.dom.styleSet(c,"width","150px");
this.dv_new.appendChild(c);a=alib.dom.createElement("span",this.dv_new);a.innerHTML="&nbsp;";a=new CButton("Create",function(a,b,c){b.value&&c.value?a.saveNewCustomer(b.value,c.value):ALib.Dlg.messageBox("Please enter a name",a.m_dlg)},[this,b,c],"b2");a.print(this.dv_new);a=alib.dom.createElement("span",this.dv_new);a.innerHTML="&nbsp;&nbsp;";a=new CButton("Cancel",function(a){a.createNew()},[this])}else a=new CButton("Create Contact/Account",function(a){a.createNew(!0)},[this],"b2");a.print(this.dv_new)};
CCustomerBrowser.prototype.saveNewCustomer=function(a,b){var c=[["name",escape(b)],["type_id",a]];ajax=new CAjax("json");ajax.cls=this;ajax.name=b;ajax.onload=function(a){a&&this.cls.select(a,this.name)};ajax.exec("/controller/Customer/createCustomer",c)};CCustomerBrowser.prototype.onSelect=function(){};CCustomerBrowser.prototype.onCancel=function(){};
CCustomerBrowser.prototype.loadCustomers=function(a){a="undefined"!=typeof a?a:0;this.m_browsedv.innerHTML="<div class='loading'></div>";this.m_ajax=new CAjax;this.m_ajax.m_browseclass=this;this.m_ajax.onload=function(a){var b=a.getNumChildren();if(b){this.m_browseclass.m_browsedv.innerHTML="";this.m_browseclass.pag_div.innerHTML="";this.m_browseclass.m_doctbl=new CToolTable("100%");var e=this.m_browseclass.m_doctbl;e.print(this.m_browseclass.m_browsedv);e.addHeader("ID");e.addHeader("Name");e.addHeader("&nbsp;",
"center","20px");e.addHeader("Phone");e.addHeader("Email");e.addHeader("Group(s)");for(i=0;i<b;i++){var f=e.addRow(),g=a.getChildNode(i);if("contact"==g.m_name){var h=g.getChildNodeValByName("id"),k=g.getChildNodeValByName("number"),l=g.getChildNodeValByName("email"),m=g.getChildNodeValByName("labels");(g=g.getChildNodeValByName("name"))||(g="untitled");var n=alib.dom.createElement("a");n.href="javascript:void(0);";n.innerHTML=unescape(g);n.m_id=unescape(h);n.m_browseclass=this.m_browseclass;n.m_cid=
h;n.m_cname=unescape(g);n.onclick=function(){this.m_browseclass.select(this.m_cid,this.m_cname)};f.addCell(h,!0,"center");f.addCell(n);n=ALib.m_document.createElement("div");n.innerHTML="[open]";alib.dom.styleSet(n,"cursor","pointer");n.m_cid=h;n.m_cname=unescape(g);n.m_browseclass=this.m_browseclass;n.onclick=function(){loadObjectForm("customer",this.cid)};f.addCell(n,!0,"center");f.addCell(unescape(k));f.addCell(unescape(l));f.addCell(unescape(m))}else if("paginate"==g.m_name&&(h=g.getChildNodeValByName("prev"),
f=g.getChildNodeValByName("next"),k=g.getChildNodeValByName("pag_str"),l=alib.dom.createElement("span",this.m_browseclass.pag_div),l.innerHTML=k,h||f))l=alib.dom.createElement("span",this.m_browseclass.pag_div),l.innerHTML=" | ",h&&(k=alib.dom.createElement("span",this.m_browseclass.pag_div),k.innerHTML="&laquo; previous",alib.dom.styleSet(k,"cursor","pointer"),k.start=h,k.m_browseclass=this.m_browseclass,k.onclick=function(){this.m_browseclass.loadCustomers(this.start)}),f&&(h=alib.dom.createElement("span",
this.m_browseclass.pag_div),h.innerHTML=" next &raquo;",alib.dom.styleSet(h,"cursor","pointer"),h.start=f,h.m_browseclass=this.m_browseclass,h.onclick=function(){this.m_browseclass.loadCustomers(this.start)})}}else this.m_browseclass.m_browsedv.innerHTML=" No records found."};var b="/customer/xml_get_customers.awp?fval=0";this.m_txtSearch.value&&"search here"!=this.m_txtSearch.value&&(b+="&search="+escape(this.m_txtSearch.value));this.filterType&&(b+="&type_id="+this.filterType);a&&(b+="&start="+
a);this.m_ajax.exec(b)};g_CWidgetBoxId=0;
function CWidgetBox(a,b){this.m_id=g_CWidgetBoxId;this.m_con=ALib.m_document.createElement("div");this.m_con.m_box=this;DragAndDrop.registerDropzone(this.m_con,a);b&&alib.dom.styleSet(this.m_con,"height",b);alib.dom.styleSetClass(this.m_con,"CWidgetBoxDrSPOff");this.m_con.onDragEnter=function(){alib.dom.styleSetClass(this,"CWidgetBoxDrSPOver")};this.m_con.onDragExit=function(){alib.dom.styleSetClass(this,"CWidgetBoxDrSPOff")};this.m_con.onDragDrop=function(a){var b=a.root.parentNode,e=this.parentNode;
b!=this&&(this.m_box.onBeforeMove(a,this),b.parentNode.removeChild(b),e.insertBefore(b,this),this.m_box.onMoved(b));alib.dom.styleSet(this,"border-top","5px solid transparent")};this.onMoved=new Function;this.onBeforeMove=new Function;g_CWidgetBoxId++}CWidgetBox.prototype.getCon=function(){return this.m_con};CWidgetBox.prototype.print=function(a){a.appendChild(this.m_con)};CWidgetBox.prototype.printBefore=function(a,b){a.insertBefore(this.m_con,b)};
function CFlashObj(a,b){this.m_objStr="";this.m_embedAttrs={};this.m_objAttrs={};this.m_params={};this.isIE=-1!=navigator.appVersion.indexOf("MSIE")?!0:!1;this.isWin=-1!=navigator.appVersion.toLowerCase().indexOf("win")?!0:!1;this.isOpera=-1!=navigator.userAgent.indexOf("Opera")?!0:!1;this.setAttribute("id",a);this.setAttribute("name",a);this.setAttribute("src",b);this.setAttribute("movie",b);this.setAttribute("classid","clsid:166B1BCA-3F9C-11CF-8075-444553540000");this.setAttribute("codebase","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0");
this.setAttribute("quality","high");this.setAttribute("pluginspage","http://www.adobe.com/go/getflashplayer");this.setAttribute("align","middle");this.setAttribute("play","true");this.setAttribute("loop","true");this.setAttribute("scale","showall");this.setAttribute("wmode","window");this.setAttribute("devicefont","false");this.setAttribute("bgcolor","#ffffff");this.setAttribute("name","window");this.setAttribute("menu","true");this.setAttribute("allowFullScreen","false");this.setAttribute("allowScriptAccess",
"sameDomain");this.setAttribute("salign","");this.setAttribute("width","640");this.setAttribute("height","480")}CFlashObj.prototype.generateObj=function(a,b,c){var d="";if(this.isIE&&this.isWin&&!this.isOpera){var d=d+"<object ",e;for(e in a)d+=e+'="'+a[e]+'" ';d+=">";for(e in b)d+='<param name="'+e+'" value="'+b[e]+'" /> ';d+="</object>"}else{d+="<embed ";for(e in c)d+=e+'="'+c[e]+'" ';d+="> </embed>"}return d};
CFlashObj.prototype.getObjHtml=function(){return this.generateObj(this.m_objAttrs,this.m_params,this.m_embedAttrs)};
CFlashObj.prototype.setAttribute=function(a,b){var c=a.toLowerCase();switch(c){case "pluginspage":this.m_embedAttrs[c]=b;break;case "src":case "movie":b=AC_AddExtension(b,".swf");this.m_embedAttrs.src=b;this.m_params.src=b;break;case "onafterupdate":case "onbeforeupdate":case "onblur":case "oncellchange":case "onclick":case "ondblclick":case "ondrag":case "ondragend":case "ondragenter":case "ondragleave":case "ondragover":case "ondrop":case "onfinish":case "onfocus":case "onhelp":case "onmousedown":case "onmouseup":case "onmouseover":case "onmousemove":case "onmouseout":case "onkeypress":case "onkeydown":case "onkeyup":case "onload":case "onlosecapture":case "onpropertychange":case "onreadystatechange":case "onrowsdelete":case "onrowenter":case "onrowexit":case "onrowsinserted":case "onstart":case "onscroll":case "onbeforeeditfocus":case "onactivate":case "onbeforedeactivate":case "ondeactivate":case "type":case "codebase":case "id":case "classid":this.m_objAttrs[c]=b;
break;case "width":case "height":case "align":case "vspace":case "hspace":case "class":case "title":case "accesskey":case "name":case "tabindex":case "type":this.m_embedAttrs[c]=this.m_objAttrs[c]=b;break;default:this.m_embedAttrs[c]=this.m_params[c]=b}};var isIE=-1!=navigator.appVersion.indexOf("MSIE")?!0:!1,isWin=-1!=navigator.appVersion.toLowerCase().indexOf("win")?!0:!1,isOpera=-1!=navigator.userAgent.indexOf("Opera")?!0:!1;
function ControlVersion(){var a,b;try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),a=b.GetVariable("$version")}catch(c){}if(!a)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),a="WIN 6,0,21,0",b.AllowScriptAccess="always",a=b.GetVariable("$version")}catch(d){}if(!a)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),a=b.GetVariable("$version")}catch(e){}if(!a)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),a="WIN 3,0,18,0"}catch(f){}if(!a)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),
a="WIN 2,0,0,11"}catch(g){a=-1}return a}
function GetSwfVer(){var a=-1;if(null!=navigator.plugins&&0<navigator.plugins.length){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var a=navigator.plugins["Shockwave Flash"+(navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"")].description.split(" "),b=a[2].split("."),c=b[0],b=b[1],d=a[3];""==d&&(d=a[4]);"d"==d[0]?d=d.substring(1):"r"==d[0]&&(d=d.substring(1),0<d.indexOf("d")&&(d=d.substring(0,d.indexOf("d"))));a=c+"."+b+"."+d}}else-1!=navigator.userAgent.toLowerCase().indexOf("webtv/2.6")?
a=4:-1!=navigator.userAgent.toLowerCase().indexOf("webtv/2.5")?a=3:-1!=navigator.userAgent.toLowerCase().indexOf("webtv")?a=2:isIE&&isWin&&!isOpera&&(a=ControlVersion());return a}
function DetectFlashVer(a,b,c){versionStr=GetSwfVer();if(-1==versionStr)return!1;if(0!=versionStr){isIE&&isWin&&!isOpera?(tempArray=versionStr.split(" "),tempString=tempArray[1],versionArray=tempString.split(",")):versionArray=versionStr.split(".");var d=versionArray[0],e=versionArray[1],f=versionArray[2];return d>parseFloat(a)||d==parseFloat(a)&&(e>parseFloat(b)||e==parseFloat(b)&&f>=parseFloat(c))?!0:!1}}function AC_AddExtension(a,b){return-1!=a.indexOf("?")?a.replace(/\?/,b+"?"):a+b}
function AC_Generateobj(a,b,c){var d="";if(isIE&&isWin&&!isOpera){var d=d+"<object ",e;for(e in a)d+=e+'="'+a[e]+'" ';d+=">";for(e in b)d+='<param name="'+e+'" value="'+b[e]+'" /> ';d+="</object>"}else{d+="<embed ";for(e in c)d+=e+'="'+c[e]+'" ';d+="> </embed>"}document.write(d)}function AC_FL_RunContent(){var a=AC_GetArgs(arguments,".swf","movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");AC_Generateobj(a.objAttrs,a.params,a.embedAttrs)}
function AC_SW_RunContent(){var a=AC_GetArgs(arguments,".dcr","src","clsid:166B1BCA-3F9C-11CF-8075-444553540000",null);AC_Generateobj(a.objAttrs,a.params,a.embedAttrs)}
function AC_GetArgs(a,b,c,d,e){for(var f={embedAttrs:{},params:{},objAttrs:{}},g=0;g<a.length;g+=2)switch(a[g].toLowerCase()){case "classid":break;case "pluginspage":f.embedAttrs[a[g]]=a[g+1];break;case "src":case "movie":a[g+1]=AC_AddExtension(a[g+1],b);f.embedAttrs.src=a[g+1];f.params[c]=a[g+1];break;case "onafterupdate":case "onbeforeupdate":case "onblur":case "oncellchange":case "onclick":case "ondblclick":case "ondrag":case "ondragend":case "ondragenter":case "ondragleave":case "ondragover":case "ondrop":case "onfinish":case "onfocus":case "onhelp":case "onmousedown":case "onmouseup":case "onmouseover":case "onmousemove":case "onmouseout":case "onkeypress":case "onkeydown":case "onkeyup":case "onload":case "onlosecapture":case "onpropertychange":case "onreadystatechange":case "onrowsdelete":case "onrowenter":case "onrowexit":case "onrowsinserted":case "onstart":case "onscroll":case "onbeforeeditfocus":case "onactivate":case "onbeforedeactivate":case "ondeactivate":case "type":case "codebase":case "id":f.objAttrs[a[g]]=a[g+
1];break;case "width":case "height":case "align":case "vspace":case "hspace":case "class":case "title":case "accesskey":case "name":case "tabindex":f.embedAttrs[a[g]]=f.objAttrs[a[g]]=a[g+1];break;default:f.embedAttrs[a[g]]=f.params[a[g]]=a[g+1]}f.objAttrs.classid=d;e&&(f.embedAttrs.type=e);return f}
function CVideoPlayer(a,b,c,d){var e=new CFlashObj("tutorial","/flash/video_player");e.setAttribute("FlashVars","fwdFileId="+a+(d?"&fwdPlay=1":"&fwdPlay=0"));e.setAttribute("width",b);e.setAttribute("height",c);this.m_flash=e}CVideoPlayer.prototype.getObjHtml=function(){return this.m_flash.getObjHtml()};function CUserBrowser(){this.title="Select User"}
CUserBrowser.prototype.showDialog=function(){var a=new CDialog(this.title);this.m_dlg=a;a.f_close=!0;var b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b);alib.dom.createElement("span",c).innerHTML="Find: ";var d=alib.dom.createElement("span",c);d.className="clearIcon";this.m_txtSearch=createInputAttribute(alib.dom.createElement("input",d),"text");this.inline&&alib.dom.styleAddClass(this.m_txtSearch,"small");alib.dom.styleSet(this.m_txtSearch,"width","300px");alib.dom.styleSet(this.m_txtSearch,
"paddingRight","25px");d=alib.dom.createElement("span",d);d.className="deleteicon";alib.dom.styleSet(d,"visibility","hidden");d.cls=this;d.divWidth=300;d.m_txtSearch=this.m_txtSearch;d.onclick=function(){this.m_txtSearch.value="";this.m_txtSearch.focus();alib.dom.styleSet(this,"visibility","hidden");this.cls.loadUsers()};this.m_txtSearch.m_cls=this;this.m_txtSearch.spanIcon=d;this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);13==("undefined"!=
typeof a.keyCode?a.keyCode:a.which)&&this.m_cls.loadUsers();0<this.m_cls.m_txtSearch.value.length?alib.dom.styleSet(this.spanIcon,"visibility","visible"):alib.dom.styleSet(this.spanIcon,"visibility","hidden")};d=new CButton("Search",function(a){a.loadUsers()},[this]);alib.dom.styleSet(d.m_main,"marginLeft","10px");d.print(c);this.pag_div=alib.dom.createElement("div",b);alib.dom.styleSet(this.pag_div,"margin-bottom","3px");alib.dom.styleSet(this.pag_div,"text-align","right");this.pag_div.innerHTML=
"Page 1 of 1";this.m_browsedv=alib.dom.createElement("div",b);alib.dom.styleSet(this.m_browsedv,"height","350px");alib.dom.styleSet(this.m_browsedv,"border","1px solid");alib.dom.styleSet(this.m_browsedv,"overflow","auto");this.m_browsedv.innerHTML="<div style='margin:10px;vertical-align:middle;'><span class='loading'></span></div>";a.customDialog(b,600,410);this.loadUsers()};CUserBrowser.prototype.select=function(a,b){this.m_dlg.hide();this.onSelect(a,b)};CUserBrowser.prototype.onSelect=function(){};
CUserBrowser.prototype.onCancel=function(){};
CUserBrowser.prototype.loadUsers=function(a){a="undefined"!=typeof a?a:0;this.m_browsedv.innerHTML="<div class='loading'></div>";ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=this.m_browsedv;ajax.onload=function(a){if(a)if(a){this.cbData.con.innerHTML="";this.cbData.cls.pag_div.innerHTML="";this.cbData.cls.m_doctbl=new CToolTable("100%");var b=this.cbData.cls.m_doctbl;b.print(this.cbData.con);b.addHeader("ID");b.addHeader("Name");b.addHeader("Title");b.addHeader("Team");for(user in a){var e=
a[user].details,f=b.addRow();if(e){var g=e.id,h=e.title,k=e.teamName;(e=e.fullName)||(e="untitled");var l=[["href","javascript:void(0);"],["innerHTML",e]],l=alib.dom.setElementAttr(alib.dom.createElement("a"),l);l.id=g;l.name=e;l.cls=this.cbData.cls;l.onclick=function(){this.cls.select(this.id,this.name)};f.addCell(g,!0,"center");f.addCell(l);f.addCell(h);f.addCell(k)}}if(a.paginate&&(f=a.paginate.prev,b=a.paginate.next,a=a.paginate.pag_str,g=alib.dom.createElement("span",this.cbData.cls.pag_div),
g.innerHTML=a,f||b))g=alib.dom.createElement("span",this.cbData.cls.pag_div),g.innerHTML=" | ",null!==f&&(a=alib.dom.createElement("span",this.cbData.cls.pag_div),a.innerHTML="&laquo; previous",alib.dom.styleSet(a,"cursor","pointer"),a.start=f,a.cls=this.cbData.cls,a.onclick=function(){this.cls.loadUsers(this.start)}),null!==b&&(a=alib.dom.createElement("span",this.cbData.cls.pag_div),a.innerHTML=" next &raquo;",alib.dom.styleSet(a,"cursor","pointer"),a.start=b,a.cls=this.cbData.cls,a.onclick=function(){this.cls.loadUsers(this.start)})}else this.cbData.con.innerHTML=
" No records found.";else this.cbData.con.innerHTML=" No records found."};var b=[];this.m_txtSearch.value&&"search here"!=this.m_txtSearch.value&&(b[b.length]=["search",escape(this.m_txtSearch.value)]);a&&(b[b.length]=["start",a]);ajax.exec("/controller/User/getUsers",b)};
function CActivity(a,b,c){this.m_aid=a?a:null;this.mainObject=new CAntObject("activity",a);this.association=b?b:"";c&&this.mainObject.setValue("obj_reference",c);this.opportunity_id=this.lead_id=this.customer_id=this.type_id=null}CActivity.prototype.showDialog=function(){this.buildInterface()};
CActivity.prototype.buildInterface=function(a){if(this.m_aid&&!a)this.mainObject.actObj=this,this.mainObject.onload=function(){this.actObj.buildInterface(!0)},this.mainObject.load();else{a=this.mainObject.getValue("f_readonly")?!0:!1;this.title=this.m_aid?"Edit/View Activity":"Enter New Activity";var b=new CDialog(this.title);this.m_dlg=b;var c=alib.dom.createElement("div");this.m_maindiv=c;c.innerHTML="";b.customDialog(c,600,420);b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"overflow","auto");
alib.dom.styleSet(b,"height","390px");var d=alib.dom.createElement("table",b);alib.dom.styleSet(d,"width","100%");d.cellPadding="0";d.cellSpacing="3";var e=alib.dom.createElement("tbody",d),d=alib.dom.createElement("tr",e),f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");alib.dom.styleSet(f,"width","55px");f.innerHTML="Subject:";d=alib.dom.createElement("td",d);d.colSpan=3;a?d.innerHTML=this.mainObject.getValue("name"):this.mainObject.fieldGetValueInput(d,"name");d=alib.dom.createElement("tr",
e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");alib.dom.styleSet(f,"width","55px");f.innerHTML="Type:";this.dvSelCon=alib.dom.createElement("td",d);a?this.dvSelCon.innerHTML=this.mainObject.getValueName("type_id"):this.mainObject.fieldGetValueInput(this.dvSelCon,"type_id",{filter:["obj_type",""]});f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");alib.dom.styleSet(f,"width","55px");f.innerHTML="Direction:";this.dvDirCon=alib.dom.createElement("td",d);
a?this.dvDirCon.innerHTML=this.mainObject.getValueName("direction"):this.mainObject.fieldGetValueInput(this.dvDirCon,"direction");d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");alib.dom.styleSet(f,"width","55px");f.innerHTML="When:";this.dvWhenCon=alib.dom.createElement("td",d);this.dvWhenCon.colSpan=3;a?this.dvWhenCon.innerHTML=this.mainObject.getValue("ts_entered"):this.mainObject.fieldGetValueInput(this.dvWhenCon,"ts_entered");d=alib.dom.createElement("tr",
e);f=alib.dom.createElement("td",d);f.vAlign="top";alib.dom.styleSetClass(f,"formLabel");alib.dom.styleSet(f,"width","55px");f.innerHTML="Associations:";d=alib.dom.createElement("td",d);d.colSpan=3;this.association&&this.mainObject.setMultiValue("associations",this.association);e=this.mainObject.getMultiValues("associations");for(f=0;f<e.length;f++){var g=e[f].split(":");if(2==g.length){f&&(alib.dom.createElement("span",d).innerHTML="; ");var h=alib.dom.createElement("span",d),h=alib.dom.createElement("a",
h);h.obj_type=g[0];h.oid=g[1];h.href="javascript:void(0)";h.innerHTML=this.mainObject.getValueName("associations",e[f]);h.onclick=function(){loadObjectForm(this.obj_type,this.oid)}}}d=alib.dom.createElement("div",b);alib.dom.styleSet(d,"margin-right","5px");alib.dom.styleSet(d,"border","0");a?(e=this.mainObject.getValue("notes"),d.innerHTML="<div class='formLabel' style='margin-left:3px;'>Details/Notes:</div><div style='margin:5px;'>"+e.replace(RegExp("\n","gi"),"<br />")+"</div>"):this.mainObject.fieldGetValueInput(d,
"notes",{multiLine:!0,height:"300px",width:"100%"});this.m_aid&&(d=alib.dom.createElement("div",b),alib.dom.styleSetClass(d,"formLabel"),d.innerHTML="Comments:",d=new CAntObjectBrowser("comment"),d.setFilter("associations","activity:"+this.m_aid),d.printComments(b,"activity:"+this.m_aid));c=alib.dom.createElement("div",c);a?(a=new CButton("Close",function(a){a.hide()},[this.m_dlg]),a.print(c)):(a=alib.ui.Button("Save &amp; Close",{className:"b2",cls:this,dlg:this.m_dlg,onclick:function(){this.cls.save();
this.dlg.hide()}}),this.btnSave=a.getButton(),c.appendChild(this.btnSave),a=alib.ui.Button("Cancel",{className:"b1",dlg:this.m_dlg,onclick:function(){this.dlg.hide()}}),c.appendChild(a.getButton()))}};
CActivity.prototype.save=function(){var a=new CDialog,b=document.createElement("div");alib.dom.styleSetClass(b,"statusAlert");alib.dom.styleSet(b,"text-align","center");b.innerHTML="Saving, please wait...";a.statusDialog(b,150,100);!this.mainObject.id&&Ant&&this.mainObject.setValue("user_id",Ant.user.id);this.mainObject.actObj=this;this.mainObject.dlgSaving=a;this.mainObject.dlgForm=this.m_dlg;this.mainObject.onsave=function(){this.dlgForm.hide();this.dlgSaving.hide();this.actObj.onSave()};this.mainObject.save()};
CActivity.prototype.onSave=function(){};CActivity.prototype.onCancel=function(){};CActivity.prototype.getActivityTypes=function(){ajax=new CAjax("json");ajax.cbData.cls=me;ajax.onload=function(a){if(a&&a.length)for(types in a){var b=a[types];this.cbData.cls.selTypes[this.cbData.cls.selTypes.length]=new Option(b.name,b.id,!1,this.cbData.cls.type_id==b.id?!0:!1)}};ajax.exec("/controller/Object/getActivityTypes")};
function contactOpen(a,b,c){var d="/contacts/edit_contact.awp?new_win=1";a&&(d+="&cid="+a);b&&(d+="&cbonsave="+b);if(c)for(b=0;b<c.length;b++)d+="&"+c[b][0]+"="+c[b][1];window.open(d,"contact_"+a,"top=200,left=100,width=850,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes")}function CProjectStart(){}CProjectStart.prototype.showDialog=function(){this.buildInterface()};
CProjectStart.prototype.buildInterface=function(){var a=new CDialog("Create New Project");a.f_close=!0;var b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"headerTwo");alib.dom.styleSet(c,"margin-top","5px");c.innerHTML="Project Name (required)";var c=alib.dom.createElement("div",b),d=alib.dom.createElement("input",c);alib.dom.styleSet(d,"width","98%");c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"headerTwo");alib.dom.styleSet(c,"margin-top",
"5px");c.innerHTML="Use Template";var c=alib.dom.createElement("div",b),e=alib.dom.createElement("select",c);e.dlgField=!0;e[e.length]=new Option("None","",!1,!0);this.getTemplates(e);c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"headerTwo");alib.dom.styleSet(c,"margin-top","5px");c.innerHTML="Start Date (required)";var c=alib.dom.createElement("div",b),f=alib.dom.createElement("input",c);alib.dom.styleSet(f,"width","100px");c=new Date;f.value=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear();
c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"headerTwo");alib.dom.styleSet(c,"margin-top","5px");c.innerHTML="Deadline (optional - if blank then project will be ongoing)";var c=alib.dom.createElement("div",b),g=alib.dom.createElement("input",c);alib.dom.styleSet(g,"width","100px");c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"text-align","right");d=new CButton("Continue",function(a,b,c,d,e,f){ajax=new CAjax("json");ajax.cbData.cls=b;ajax.cbData.dlg=a;ajax.onload=function(a){this.cbData.dlg.hide();
if(a.error)this.cbData.cls.onSaveError();else this.cbData.cls.onSave(a)};ajax.exec("/controller/Project/createProject",[["name",c.value],["template_id",d.value],["date_deadline",f.value],["date_started",e.value]])},[a,this,d,e,f,g],"b2");d.print(c);d=new CButton("Cancel",function(a){a.hide()},[a]);d.print(c);a.customDialog(b,450)};
CProjectStart.prototype.save=function(){var a=new CDialog,b=document.createElement("div");alib.dom.styleSetClass(b,"statusAlert");alib.dom.styleSet(b,"text-align","center");b.innerHTML="Creating project, please wait...";a.statusDialog(b,150,100)};CProjectStart.prototype.onSave=function(){};CProjectStart.prototype.onCancel=function(){};
CProjectStart.prototype.getTemplates=function(a){ajax=new CAjax("json");ajax.cbData.selTemplates=a;ajax.onload=function(a){if(a.length)for(template in a){var c=a[template];this.cbData.selTemplates[this.cbData.selTemplates.length]=new Option(c.name,c.id,!1,!1)}};ajax.exec("/controller/Project/getTemplates")};var CUST_TYPE_CONTACT=1,CUST_TYPE_ACCOUNT=2,g_custnewwin=0;function custOpen(a,b,c){loadObjectForm("customer",a,null,null,c)}
function custOppOpen(a,b,c){loadObjectForm("opportunity",b,null,null,c)}function custInvOpen(a,b){var c="";a&&(c+="invid="+a);if(b)for(var d=0;d<b.length;d++)c+="&"+b[d][0]+"="+b[d][1];window.open("/customer/invoice.php?"+c,"inv_"+a,"width=750,height=550,toolbar=no,scrollbars=yes")}function custEmailOpen(a){window.open("/email/message_view.awp?new_win=1&mid="+a,"msg_"+a,"width=750,height=550,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes")}
function custLeadOpen(a,b,c){var d="/customer/lead_edit.php?new_win=1";a&&(d+="&lid="+a);b&&(d+="&cbonsave="+b);if(c)for(b=0;b<c.length;b++)d+="&"+c[b][0]+"="+c[b][1];window.open(d,"lead_"+a,"width=648,height=600,toolbar=no")}var g_evid=0;
function calEventOpen(a,b,c,d){var e=b?Base64.encode(unescape(b)):"",b=a?a:g_evid++,e="/obj/calendar_event?cbonsave="+e;a&&(e+="&oid="+a);if(c)for(a=0;a<c.length;a++)e+="&"+c[a][0]+"="+c[a][1];("undefined"!=typeof d?d:1)?window.open(e,"event_"+b,"width=1080,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes"):document.location=e}
function calEventCoordOpen(a,b,c){b&&Base64.encode(unescape(b));var b=a?a:g_evid++,d="/obj/calendar_event_proposal";a&&(d+="&ecid="+a);if(c)for(a=0;a<c.length;a++)d+="&"+c[a][0]+"="+c[a][1];window.open(d,"eventcooord_"+b,"width=800,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes")}function calGetMonthName(a){var b="January,February,March,April,May,June,July,August,September,October,November,December".split(",");return a&&12>=a?b[a-1]:-1}
function calGetMonthNumDays(a,b){var c=new Date(a,b-1,1);c.od=c.getDay()+1;var d=[31,0,31,30,31,30,31,31,30,31,30,31];d[1]=0!=c.getFullYear()%100&&0==c.getFullYear()%4||0==c.getFullYear()%400?29:28;return d[b-1]}function calGetWeekStartDate(a,b,c){a=new Date(a,b-1,c);(b=a.getDay())&&(a=calDateAddSubtract(a,"day",-b));return a}
function calDateAddSubtract(a,b,c){var d=new Date(a);switch(b){case "minute":b=d.getTime();d.setMinutes(a.getMinutes()+c);break;case "hour":b=d.getTime();d.setTime(b+e*c);break;case "day":var e=864E5;d.setDate(a.getDate()+c);break;case "month":1==c?(a=d.getMonth(),d.setMonth(a+1),d.getMonth()!=a+1&&0!=d.getMonth()&&d.setDate(0)):-1==c&&(a=d.getMonth(),d.setMonth(a-1),d.getMonth()!=a-1&&(11!=d.getMonth()||11==a&&1==d.getDate())&&d.setDate(0))}return d}
function calDaysBetweenDates(a,b){var c=a.getTime(),d=b.getTime(),c=Math.abs(c-d);return Math.round(c/864E5)}function calGetClockTime(a){var b=a.getHours(),c=a.getMinutes();a.getSeconds();a="AM";11<b&&(a="PM");12<b&&(b-=12);0==b&&(b=12);10>b&&(b="0"+b);10>c&&(c="0"+c);return b+":"+c+" "+a}var G_PROJ_NEWWIN_ID=1;
function projTaskOpen(a,b,c){var d=d?"task_"+d:"task_new_"+G_PROJ_NEWWIN_ID,b=b?Base64.encode(unescape(b)):"",d,e="";if(c)for(var f=0;f<c.length;f++)e+="&"+c[f][0]+"="+c[f][1];window.open("/project/task_edit.awp?onexit="+escape("window.close();")+"&cbonsave="+b+"&eid="+(a?a:"")+e,d,"top=200,left=100,width=620,height=550,toolbar=no,menubar=no,scrollbars=no,location=no,directories=no,status=no,resizable=no");G_PROJ_NEWWIN_ID++}
function projOpen(a,b,c){var d=e?"proj_"+e:"proj_new_"+G_PROJ_NEWWIN_ID,b=b?"&cbonsave="+escape(b):"",e=a?a:"",f="";if(c)for(var g=0;g<c.length;g++)f+="&"+c[g][0]+"="+c[g][1];a?window.open("/project/project.awp?new_win=1&onexit="+escape("window.close();")+b+"&pid="+e+f,d,"width=800,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes"):window.open("/project/project_add.awp?new_win=1&onexit="+escape("window.close();")+b+"&pid="+e+f,d,"width=800,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes");
G_PROJ_NEWWIN_ID++}function projTicketOpen(a,b,c){loadObjectForm("case",a,null,null,c)}var g_email_cmpid=1;function emailComposeOpen(a,b){a&&Base64.encode(a);g_email_cmpid++;var c="/obj/email_message";if(b)for(var d=0;d<b.length;d++)c+=0==d?"?":"&",c+=b[d][0]+"="+escape(b[d][1]);window.open(c,null,"width=780,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes")}
function emailAssocObj(a,b){var c=new AntObjectBrowser(b);c.cbData.emailId=a;c.cbData.assocWithOtype=b;c.onSelect=function(a){ajax=new CAjax("json");ajax.onload=function(){ALib.statusShowAlert("Email Activity Created ",3E3,"bottom","right")};ajax.exec("/controller/Email/assocWithObj",[["mid",this.cbData.emailId],["object_id",a],["obj_type",this.cbData.assocWithOtype]])};c.displaySelect()}
function emailListFormatTimeDel(a){var b=a.split("-");1<b.length&&(a=b[0]);b=a.split(" ");1<b.length&&(a=b[0]);return a}
function CRecurrencePattern(a){this.id=this.type=0;this.save_type="all";this.interval=1;this.dateEnd=this.dateStart="";this.fAllDay=this.timeEnd=this.timeStart=null;this.monthOfYear=this.dayOfMonth=1;this.instance=this.duration=this.dayOfWeekMask=null;this.fActive=!0;this.fieldTimeEnd=this.fieldDateEnd=this.fieldTimeStart=this.fieldDateStart=this.useId=this.id=this.dateProcessedTo=this.calendarId=this.parentId=this.object_type=this.object_type_id=null;this.arrChangeLog=[];this.day7=this.day6=this.day5=
this.day4=this.day3=this.day2=this.day1="f";this.dbFieldValues=null;this.humanDesc="";this.dbvalLoaded=!1;this.dbvalLoadCount=null;this.m_dlgElements={};a&&this.load(a)}
CRecurrencePattern.prototype.load=function(a){a&&(this.id=a,this.dbvalLoaded=!1,this.dbvalLoadCount=1,a=new CAjax,a.m_obj=this,a.onload=function(a){a.getNumChildren()&&(this.m_obj.dbFieldValues=JSON.parse(unescape(a.getChildNodeValByName("objpt_json"))),this.m_obj.type=this.m_obj.dbFieldValues.type,this.m_obj.interval=this.m_obj.dbFieldValues.interval,this.m_obj.dateStart=this.m_obj.dbFieldValues.dateStart,this.m_obj.dateEnd=this.m_obj.dbFieldValues.dateEnd,this.m_obj.timeStart=this.m_obj.dbFieldValues.timeStart,
this.m_obj.timeEnd=this.m_obj.dbFieldValues.timeEnd,this.m_obj.fAllDay=this.m_obj.dbFieldValues.fAllDay,this.m_obj.dayOfMonth=this.m_obj.dbFieldValues.dayOfMonth,this.m_obj.monthOfYear=this.m_obj.dbFieldValues.monthOfYear,this.m_obj.dayOfWeekMask=this.m_obj.dbFieldValues.dayOfWeekMask,this.m_obj.duration=this.m_obj.dbFieldValues.duration,this.m_obj.instance=this.m_obj.dbFieldValues.instance,this.m_obj.fActive=this.m_obj.dbFieldValues.fActive,this.m_obj.object_type_id=this.m_obj.dbFieldValues.object_type_id,
this.m_obj.object_type=this.m_obj.dbFieldValues.object_type,this.m_obj.parentId=this.m_obj.dbFieldValues.parentId,this.m_obj.calendarId=this.m_obj.dbFieldValues.calendarId,this.m_obj.dateProcessedTo=this.m_obj.dbFieldValues.dateProcessedTo,this.m_obj.id=this.m_obj.dbFieldValues.id,this.m_obj.useId=this.m_obj.dbFieldValues.useId,this.m_obj.fieldDateStart=this.m_obj.dbFieldValues.fieldDateStart,this.m_obj.fieldTimeStart=this.m_obj.dbFieldValues.fieldTimeStart,this.m_obj.fieldDateEnd=this.m_obj.dbFieldValues.fieldDateEnd,
this.m_obj.fieldTimeEnd=this.m_obj.dbFieldValues.fieldTimeEnd,this.m_obj.arrChangeLog=this.m_obj.dbFieldValues.arrChangeLog,this.m_obj.day1=this.m_obj.dbFieldValues.day1,this.m_obj.day2=this.m_obj.dbFieldValues.day2,this.m_obj.day3=this.m_obj.dbFieldValues.day3,this.m_obj.day4=this.m_obj.dbFieldValues.day4,this.m_obj.day5=this.m_obj.dbFieldValues.day5,this.m_obj.day6=this.m_obj.dbFieldValues.day6,this.m_obj.day7=this.m_obj.dbFieldValues.day7,this.m_obj.dbvalLoaded=!0,this.m_obj.onchange(),this.m_obj.onload())},
a.exec("/objects/xml_get_rp.php?rpid="+this.id))};CRecurrencePattern.prototype.onload=function(){};CRecurrencePattern.prototype.set=function(){this.onchange()};CRecurrencePattern.prototype.onchange=function(){};CRecurrencePattern.prototype.onsave=function(){};
CRecurrencePattern.prototype.save=function(){var a={};a.type=this.type;a.object_type=this.object_type;a.object_type_id=this.object_type_id;a.interval=this.interval;a.dateStart=this.dateStart;a.dateEnd=this.dateEnd;a.timeStart=this.timeStart;a.timeEnd=this.timeEnd;a.fAllDay=this.fAllDay;a.dayOfMonth=this.dayOfMonth;a.monthOfYear=this.monthOfYear;a.dayOfWeekMask=this.dayOfWeekMask;a.instance=this.instance;a.object_type_id=this.object_type_id;a.object_type=this.object_type;a.parentId=this.parentId;a.calendarId=
this.calendarId;a.dateProcessedTo=this.dateProcessedTo;a.id=this.id;a.day1=this.day1;a.day2=this.day2;a.day3=this.day3;a.day4=this.day4;a.day5=this.day5;a.day6=this.day6;a.day7=this.day7;ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(){this.cbData.cls.m_dlg&&(this.cbData.cls.m_dlg.hide(),ALib.statusShowAlert("Recurrence Saved!",3E3,"bottom","right"));this.cbData.cls.m_dlg_saving&&this.cbData.cls.m_dlg_saving.hide();this.cbData.cls.onsave()};a=[["objpt_json",JSON.stringify(a)]];ajax.exec("/controller/Object/saveRecurrencepattern",
a)};
CRecurrencePattern.prototype.showDialog=function(){var a=this;if(0<this.id)if(this.dbvalLoaded)null!=this.dlgLoadFromDB&&(this.dlgLoadFromDB.hide(),this.dlgLoadFromDB=null);else{if(null==this.dlgLoadFromDB){var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Loading, please wait...";b.statusDialog(c);this.dlgLoadFromDB=b}null==this.dbvalLoadCount?this.load():this.dbvalLoadCount++;
if(100>this.dbvalLoadCount)return a=this,setTimeout(function(){a.showDialog()},100),!1}null==this.dbFieldValues&&(this.dbFieldValues={});this.dbFieldValues.type=this.type;this.dbFieldValues.interval=this.interval;this.dbFieldValues.dateStart=this.dateStart;this.dbFieldValues.dateEnd=this.dateEnd;this.dbFieldValues.timeStart=this.timeStart;this.dbFieldValues.timeEnd=this.timeEnd;this.dbFieldValues.fAllDay=this.fAllDay;this.dbFieldValues.dayOfMonth=this.dayOfMonth;this.dbFieldValues.monthOfYear=this.monthOfYear;
this.dbFieldValues.dayOfWeekMask=this.dayOfWeekMask;this.dbFieldValues.duration=this.duration;this.dbFieldValues.instance=this.instance;this.dbFieldValues.fActive=this.fActive;this.dbFieldValues.object_type_id=this.object_type_id;this.dbFieldValues.object_type=this.object_type;this.dbFieldValues.parentId=this.parentId;this.dbFieldValues.calendarId=this.calendarId;this.dbFieldValues.dateProcessedTo=this.dateProcessedTo;this.dbFieldValues.id=this.id;this.dbFieldValues.useId=this.useId;this.dbFieldValues.fieldDateStart=
this.fieldDateStart;this.dbFieldValues.fieldTimeStart=this.fieldTimeStart;this.dbFieldValues.fieldDateEnd=this.fieldDateEnd;this.dbFieldValues.fieldTimeEnd=this.fieldTimeEnd;this.dbFieldValues.arrChangeLog=this.arrChangeLog;this.dbFieldValues.day1=this.day1;this.dbFieldValues.day2=this.day2;this.dbFieldValues.day3=this.day3;this.dbFieldValues.day4=this.day4;this.dbFieldValues.day5=this.day5;this.dbFieldValues.day6=this.day6;this.dbFieldValues.day7=this.day7;this.title=this.id?"Edit/View Recurrence":
"Enter New Recurrence";this.m_dlg=b=new CDialog(this.title);var c=alib.dom.createElement("div"),d=new CWindowFrame("Recurrence pattern",null,"3px");d.print(c);var d=d.getCon(),e=alib.dom.createElement("div",d);alib.dom.styleSet(e,"margin-top","3px");var f=alib.dom.createElement("div",e);alib.dom.styleSet(f,"float","left");alib.dom.styleSet(f,"width","120px");alib.dom.styleSet(f,"margin-top","5px");alib.dom.styleSet(f,"margin-left","3px");f.innerHTML="Repeats: ";var f=alib.dom.createElement("div",
e),g=alib.dom.createElement("select",f);g.rpcls=this;g[g.length]=new Option("Does Not Repeat","0",!1,"0"==this.type?!0:!1);g[g.length]=new Option("Daily","1",!1,"1"==this.type?!0:!1);g[g.length]=new Option("Weekly","2",!1,"2"==this.type?!0:!1);g[g.length]=new Option("Monthly","m",!1,"3"==this.type||"4"==this.type?!0:!1);g[g.length]=new Option("Yearly","y",!1,"5"==this.type||"6"==this.type?!0:!1);g.onchange=function(){this.rpcls.type="m"==this.value?0==this.rpcls.type||0<this.rpcls.interval&&0<this.rpcls.dayOfMonth?
"3":"4":"y"==this.value?0==this.rpcls.type||0<this.rpcls.interval&&0<this.rpcls.dayOfMonth?"5":"6":this.value;this.rpcls.showRecurring(this.rpcls.type)};this.m_dlgElements.dv_range=alib.dom.createElement("div",d);alib.dom.styleSet(this.m_dlgElements.dv_range,"margin-left","4px");alib.dom.styleSet(this.m_dlgElements.dv_range,"margin-top","6px");d=new CWindowFrame("Range of recurrence",null,"3px");d.print(c);d=d.getCon();e=alib.dom.createElement("div",d);alib.dom.styleSet(e,"margin-top","3px");f=alib.dom.createElement("div",
e);alib.dom.styleSet(f,"float","left");alib.dom.styleSet(f,"width","120px");alib.dom.styleSet(f,"margin-top","5px");alib.dom.styleSet(f,"margin-left","3px");f.innerHTML="Start Date: ";f=alib.dom.createElement("div",e);alib.dom.styleSet(f,"margin-left","55px");e=alib.dom.createElement("input");e.type="text";f.appendChild(e);alib.dom.styleSet(e,"width","100px");if(!this.dateStart){var h=new Date;this.dateStart=h.getMonth()+1+"/"+h.getDate()+"/"+h.getFullYear()}e.value=this.dateStart;e.rpcls=this;e.onchange=
function(){this.rpcls.dateStart=this.value};f=alib.dom.createElement("span",f);f.innerHTML="<img src='/images/calendar.gif' border='0' />";new CAutoCompleteCal(e,f);e=alib.dom.createElement("div",d);alib.dom.styleSet(e,"margin-top","3px");f=alib.dom.createElement("div",e);alib.dom.styleSet(f,"float","left");alib.dom.styleSet(f,"width","120px");alib.dom.styleSet(f,"margin-top","5px");alib.dom.styleSet(f,"margin-left","3px");f.innerHTML="End Date: ";f=alib.dom.createElement("div",e);alib.dom.styleSet(f,
"margin-left","55px");e=alib.dom.createElement("input");e.type="text";f.appendChild(e);alib.dom.styleSet(e,"width","100px");!this.dateEnd&&this.type?(e.value="Never",e.disabled=!0):this.dateEnd?e.value=this.dateEnd:this.type||(e.value="Never",e.disabled=!0);e.onchange=function(){a.dateEnd=this.value};f=alib.dom.createElement("span",f);f.innerHTML="<img src='/images/calendar.gif' border='0'>";new CAutoCompleteCal(e,f);d=alib.dom.createElement("div",d);alib.dom.styleSet(d,"padding-left","124px");alib.dom.createElement("span",
d).innerHTML="Never ends ";f=alib.dom.createElement("input");f.type="checkbox";f.m_end_date=e;d.appendChild(f);f.checked=!a.dateEnd?!0:!1;f.onclick=function(){this.checked?(this.m_end_date.value="Never",this.m_end_date.disabled=!0,a.dateEnd=""):(this.m_end_date.value=a.dateStart,a.dateEnd=a.dateStart,this.m_end_date.disabled=!1)};d=alib.dom.createElement("div",c);d.id="rp_dialog_buttons";f=new CButton("OK",function(b){a.set();b.m_dlg.hide()},[a,a.m_dlg]);f.print(d);this.btnSave=f;f=new CButton("Cancel",
function(b){a.type=a.dbFieldValues.type;a.interval=a.dbFieldValues.interval;a.dateStart=a.dbFieldValues.dateStart;a.dateEnd=a.dbFieldValues.dateEnd;a.timeStart=a.dbFieldValues.timeStart;a.timeEnd=a.dbFieldValues.timeEnd;a.fAllDay=a.dbFieldValues.fAllDay;a.dayOfMonth=a.dbFieldValues.dayOfMonth;a.monthOfYear=a.dbFieldValues.monthOfYear;a.dayOfWeekMask=a.dbFieldValues.dayOfWeekMask;a.duration=a.dbFieldValues.duration;a.instance=a.dbFieldValues.instance;a.fActive=a.dbFieldValues.fActive;a.object_type_id=
a.dbFieldValues.object_type_id;a.object_type=a.dbFieldValues.object_type;a.parentId=a.dbFieldValues.parentId;a.calendarId=a.dbFieldValues.calendarId;a.dateProcessedTo=a.dbFieldValues.dateProcessedTo;a.id=a.dbFieldValues.id;a.useId=a.dbFieldValues.useId;a.fieldDateStart=a.dbFieldValues.fieldDateStart;a.fieldTimeStart=a.dbFieldValues.fieldTimeStart;a.fieldDateEnd=a.dbFieldValues.fieldDateEnd;a.fieldTimeEnd=a.dbFieldValues.fieldTimeEnd;a.arrChangeLog=a.dbFieldValues.arrChangeLog;a.day1=a.dbFieldValues.day1;
a.day2=a.dbFieldValues.day2;a.day3=a.dbFieldValues.day3;a.day4=a.dbFieldValues.day4;a.day5=a.dbFieldValues.day5;a.day6=a.dbFieldValues.day6;a.day7=a.dbFieldValues.day7;b.hide()},[a.m_dlg]);f.print(d);b.customDialog(c,320,null);alib.dom.styleSet(g,"visibility","visible");this.showRecurring(this.type);b=document.getElementsByTagName("select");for(c=0;c<b.length;c++)b[c].style.visivility="visible"};
CRecurrencePattern.prototype.showRecurring=function(a){var a=parseInt(a),b=this;this.m_dlgElements.dv_range.innerHTML="";var c=alib.dom.createElement("div",this.m_dlgElements.dv_range);switch(a){case 1:c.style.display="block";var d=alib.dom.createElement("span",c);d.innerHTML="Every ";a=alib.dom.createElement("input",c);a.size=2;a.value=b.interval?b.interval:1;a.onchange=function(){b.interval=this.value};d=alib.dom.createElement("span",c);d.innerHTML=" days";break;case 2:c.style.display="block";d=
alib.dom.createElement("span",c);d.innerHTML="Every ";a=alib.dom.createElement("input",c);a.size=2;a.value=b.interval?b.interval:1;a.onchange=function(){b.interval=this.value};d=alib.dom.createElement("span",c);d.innerHTML=" week(s) on: <br />";var d=alib.dom.createElement("div",c),e=alib.dom.createElement("input");e.type="checkbox";d.appendChild(e);e.checked="t"==b.day1?!0:!1;e.onchange=function(){b.day1=this.checked?"t":"f"};d=alib.dom.createElement("label",d);d.innerHTML=" Sunday";d.onclick=function(){e.checked=
e.checked?!1:!0;b.day1=e.checked?"t":"f"};var d=alib.dom.createElement("div",c),f=alib.dom.createElement("input");f.type="checkbox";d.appendChild(f);f.checked="t"==b.day2?!0:!1;f.onchange=function(){b.day2=this.checked?"t":"f"};d=alib.dom.createElement("label",d);d.innerHTML=" Monday";d.onclick=function(){f.checked=f.checked?!1:!0;b.day2=f.checked?"t":"f"};var d=alib.dom.createElement("div",c),g=alib.dom.createElement("input");g.type="checkbox";d.appendChild(g);g.checked="t"==b.day3?!0:!1;g.onchange=
function(){b.day3=this.checked?"t":"f"};d=alib.dom.createElement("label",d);d.innerHTML=" Tuesday";d.onclick=function(){g.checked=g.checked?!1:!0;b.day3=g.checked?"t":"f"};var d=alib.dom.createElement("div",c),h=alib.dom.createElement("input");h.type="checkbox";d.appendChild(h);h.checked="t"==b.day4?!0:!1;h.onchange=function(){b.day4=this.checked?"t":"f"};d=alib.dom.createElement("label",d);d.innerHTML=" Wednesday";d.onclick=function(){h.checked=h.checked?!1:!0;b.day4=h.checked?"t":"f"};var d=alib.dom.createElement("div",
c),k=alib.dom.createElement("input");k.type="checkbox";d.appendChild(k);k.checked="t"==b.day5?!0:!1;k.onchange=function(){b.day5=this.checked?"t":"f"};d=alib.dom.createElement("label",d);d.innerHTML=" Thursday";d.onclick=function(){k.checked=k.checked?!1:!0;b.day5=k.checked?"t":"f"};var d=alib.dom.createElement("div",c),l=alib.dom.createElement("input");l.type="checkbox";d.appendChild(l);l.checked="t"==b.day6?!0:!1;l.onchange=function(){b.day6=this.checked?"t":"f"};d=alib.dom.createElement("label",
d);d.innerHTML=" Friday";d.onclick=function(){l.checked=l.checked?!1:!0;b.day6=l.checked?"t":"f"};var d=alib.dom.createElement("div",c),m=alib.dom.createElement("input");m.type="checkbox";d.appendChild(m);m.checked="t"==b.day7?!0:!1;m.onchange=function(){b.day7=this.checked?"t":"f"};d=alib.dom.createElement("label",d);d.innerHTML=" Saturday";d.onclick=function(){m.checked=m.checked?!1:!0;b.day7=m.checked?"t":"f"};break;case 3:case 4:c.style.display="block";var c=alib.dom.createElement("table",c),
n=alib.dom.createElement("tbody",c),d=alib.dom.createElement("row",n),c=alib.dom.createElement("td",d),o=alib.dom.createElement("input");o.type="radio";o.name="monthly_type";o.value="day";o.rpcls=this;o.onchange=function(){this.rpcls.type=3;this.rpcls.recurToggleMontlyType()};c.appendChild(o);c=alib.dom.createElement("td",d);d=alib.dom.createElement("span",c);d.innerHTML="Day ";this.m_dlgElements.rt_m_d_day=alib.dom.createElement("input");this.m_dlgElements.rt_m_d_day.style.width="20px";this.m_dlgElements.rt_m_d_day.value=
b.dayOfMonth?b.dayOfMonth:1;this.m_dlgElements.rt_m_d_day.onchange=function(){b.dayOfMonth=this.value};c.appendChild(this.m_dlgElements.rt_m_d_day);d=alib.dom.createElement("span",c);d.innerHTML=" of every ";this.m_dlgElements.rt_m_d_int=alib.dom.createElement("input");this.m_dlgElements.rt_m_d_int.style.width="20px";b.interval?this.m_dlgElements.rt_m_d_int.value=b.interval:(this.m_dlgElements.rt_m_d_int.value=1,b.interval=1);this.m_dlgElements.rt_m_d_int.onchange=function(){b.interval=this.value};
c.appendChild(this.m_dlgElements.rt_m_d_int);d=alib.dom.createElement("span",c);d.innerHTML=" month(s)";d=alib.dom.createElement("row",n);c=alib.dom.createElement("td",d);n=alib.dom.createElement("input");n.type="radio";n.name="monthly_type";n.value="relative";n.rpcls=this;n.onchange=function(){this.rpcls.type=4;this.rpcls.recurToggleMontlyType()};c.appendChild(n);n.checked=!0;c=alib.dom.createElement("td",d);this.m_dlgElements.rt_m_rel_nth=alib.dom.createElement("select",c);for(var p=["First","Second",
"Third","Fourth","Last"],d=0;d<p.length;d++)this.m_dlgElements.rt_m_rel_nth[this.m_dlgElements.rt_m_rel_nth.length]=new Option("The "+p[d],d+1,!1,b.instance==d+1?!0:!1);this.m_dlgElements.rt_m_rel_nth.onchange=function(){b.instance=this.value};d=alib.dom.createElement("br",c);this.m_dlgElements.rt_m_day_nth=alib.dom.createElement("select",c);for(var p="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),q=!1,d=0;d<p.length;d++){q=!1;switch(d){case 0:q="t"==b.day1?!0:!1;break;case 1:q=
"t"==b.day2?!0:!1;break;case 2:q="t"==b.day3?!0:!1;break;case 3:q="t"==b.day4?!0:!1;break;case 4:q="t"==b.day5?!0:!1;break;case 5:q="t"==b.day6?!0:!1;break;case 6:q="t"==b.day7?!0:!1}this.m_dlgElements.rt_m_day_nth[this.m_dlgElements.rt_m_day_nth.length]=new Option(p[d],d+1,!1,q)}this.m_dlgElements.rt_m_day_nth.onchange=function(){b.day1=1==this.value?"t":"f";b.day2=2==this.value?"t":"f";b.day3=3==this.value?"t":"f";b.day4=4==this.value?"t":"f";b.day5=5==this.value?"t":"f";b.day6=6==this.value?"t":
"f";b.day7=7==this.value?"t":"f"};d=alib.dom.createElement("span",c);d.innerHTML="<br />of every ";this.m_dlgElements.rt_m_d_int_nth=alib.dom.createElement("input");this.m_dlgElements.rt_m_d_int_nth.style.width="20px";b.interval?this.m_dlgElements.rt_m_d_int_nth.value=b.interval:(this.m_dlgElements.rt_m_d_int_nth.value=1,b.interval=1);this.m_dlgElements.rt_m_d_int_nth.onchange=function(){b.interval=this.value};c.appendChild(this.m_dlgElements.rt_m_d_int_nth);d=alib.dom.createElement("span",c);d.innerHTML=
" month(s)";3==this.type?(this.recurToggleMontlyType(),o.checked=!0):(this.recurToggleMontlyType(),n.checked=!0);break;case 5:case 6:c.style.display="block";a="January,February,March,April,May,June,July,August,September,October,November,December".split(",");c=alib.dom.createElement("table",c);n=alib.dom.createElement("tbody",c);d=alib.dom.createElement("row",n);c=alib.dom.createElement("td",d);o=alib.dom.createElement("input");o.type="radio";o.name="yearly_type";o.rpcls=this;o.onchange=function(){this.rpcls.type=
5;this.rpcls.recurToggleYearlyType()};c.appendChild(o);c=alib.dom.createElement("td",d);d=alib.dom.createElement("span",c);d.innerHTML="Every ";this.m_dlgElements.rt_y_m=alib.dom.createElement("select",c);this.m_dlgElements.rt_y_m.id="rt_y_m";for(d=0;d<a.length;d++)this.m_dlgElements.rt_y_m[this.m_dlgElements.rt_y_m.length]=new Option(a[d],d+1,!1,b.monthOfYear==d+1?!0:!1);this.m_dlgElements.rt_y_m.onchange=function(){b.monthOfYear=this.value};d=alib.dom.createElement("span",c);d.innerHTML="&nbsp;";
this.m_dlgElements.rt_y_d=alib.dom.createElement("input");this.m_dlgElements.rt_y_d.style.width="20px";this.m_dlgElements.rt_y_d.value=b.dayOfMonth?b.dayOfMonth:1;this.m_dlgElements.rt_y_d.onchange=function(){b.dayOfMonth=this.value};c.appendChild(this.m_dlgElements.rt_y_d);d=alib.dom.createElement("row",n);c=alib.dom.createElement("td",d);n=alib.dom.createElement("input");n.type="radio";n.name="yearly_type";n.rpcls=this;n.onchange=function(){this.rpcls.type=6;this.rpcls.recurToggleYearlyType()};
c.appendChild(n);c=alib.dom.createElement("td",d);this.m_dlgElements.rt_y_rel=alib.dom.createElement("select",c);p=["First","Second","Third","Fourth","Last"];for(d=0;d<p.length;d++)this.m_dlgElements.rt_y_rel[this.m_dlgElements.rt_y_rel.length]=new Option("The "+p[d],d+1,!1,b.instance==d+1?!0:!1);this.m_dlgElements.rt_y_rel.onchange=function(){b.instance=this.value};d=alib.dom.createElement("br",c);this.m_dlgElements.rt_y_day=alib.dom.createElement("select",c);p="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");
q=!1;for(d=0;d<p.length;d++){q=!1;switch(d){case 0:q="t"==b.day1?!0:!1;break;case 1:q="t"==b.day2?!0:!1;break;case 2:q="t"==b.day3?!0:!1;break;case 3:q="t"==b.day4?!0:!1;break;case 4:q="t"==b.day5?!0:!1;break;case 5:q="t"==b.day6?!0:!1;break;case 6:q="t"==b.day7?!0:!1}this.m_dlgElements.rt_y_day[this.m_dlgElements.rt_y_day.length]=new Option(p[d],d+1,!1,q)}this.m_dlgElements.rt_y_day.onchange=function(){b.day1=1==this.value?"t":"f";b.day2=2==this.value?"t":"f";b.day3=3==this.value?"t":"f";b.day4=
4==this.value?"t":"f";b.day5=5==this.value?"t":"f";b.day6=6==this.value?"t":"f";b.day7=7==this.value?"t":"f"};d=alib.dom.createElement("br",c);this.m_dlgElements.rt_y_r_m=alib.dom.createElement("select",c);for(d=0;d<a.length;d++)this.m_dlgElements.rt_y_r_m[this.m_dlgElements.rt_y_r_m.length]=new Option("of "+a[d],d+1,!1,b.monthOfYear==d+1?!0:!1);this.m_dlgElements.rt_y_r_m.onchange=function(){b.monthOfYear=this.value};0==b.type||null==b.instance&&null!=b.dayOfMonth?(this.type=5,this.recurToggleYearlyType(),
o.checked=!0):(this.type=6,b.recurToggleYearlyType(),n.checked=!0);break;default:c.innerHTML="",c.style.display="none"}};
CRecurrencePattern.prototype.getHumanDesc=function(){this.humanDesc="";switch(parseInt(this.type)){case 1:this.humanDesc=1<this.interval?this.humanDesc+(" Every "+this.interval+" days"):this.humanDesc+"Every day ";break;case 2:this.humanDesc=1<this.interval?this.humanDesc+("Every "+this.interval+" weeks on "):this.humanDesc+"Every ";"t"==this.day1&&(this.humanDesc+="Sunday, ");"t"==this.day2&&(this.humanDesc+="Monday, ");"t"==this.day3&&(this.humanDesc+="Tuesday, ");"t"==this.day4&&(this.humanDesc+=
"Wednesday, ");"t"==this.day5&&(this.humanDesc+="Thursday, ");"t"==this.day6&&(this.humanDesc+="Friday, ");"t"==this.day7&&(this.humanDesc+="Saturday, ");this.humanDesc=this.humanDesc.replace(/, $/,"");break;case 3:var a=parseInt(this.dayOfMonth)%100,b=["th","st","nd","rd","th"],a=21>a?4>a?b[a]:b[0]:4<a%10?b[0]:b[a%10];this.humanDesc+=this.dayOfMonth+a+" day of every ";this.humanDesc=1<parseInt(this.interval)?this.humanDesc+(parseInt(this.interval)+" months"):this.humanDesc+(parseInt(this.interval)+
" month");break;case 4:this.humanDesc+="The ";switch(parseInt(this.instance)){case 1:this.humanDesc+="first ";break;case 2:this.humanDesc+="second ";break;case 3:this.humanDesc+="third ";break;case 4:this.humanDesc+="fourth ";break;case 5:this.humanDesc+="last "}this.humanDesc+="t"==this.day1?" Sunday ":"";this.humanDesc+="t"==this.day2?" Monday ":"";this.humanDesc+="t"==this.day3?" Tuesday ":"";this.humanDesc+="t"==this.day4?" Wednesday ":"";this.humanDesc+="t"==this.day5?" Thursday ":"";this.humanDesc+=
"t"==this.day6?" Friday ":"";this.humanDesc+="t"==this.day7?" Saturday ":"";this.humanDesc=1<parseInt(this.interval)?this.humanDesc+(" of every "+parseInt(this.interval)+" months"):this.humanDesc+" of every month";break;case 5:a=parseInt(this.dayOfMonth)%100;b=["th","st","nd","rd","th"];a=21>a?4>a?b[a]:b[0]:4<a%10?b[0]:b[a%10];this.humanDesc+="Every "+this.dayOfMonth+a+" day of ";switch(parseInt(this.monthOfYear)){case 1:this.humanDesc+=" January";break;case 2:this.humanDesc+=" February";break;case 3:this.humanDesc+=
" March";break;case 4:this.humanDesc+=" April";break;case 5:this.humanDesc+=" May";break;case 6:this.humanDesc+=" June";break;case 7:this.humanDesc+=" July";break;case 8:this.humanDesc+=" August";break;case 9:this.humanDesc+=" September";break;case 10:this.humanDesc+=" October";break;case 11:this.humanDesc+=" November";break;case 12:this.humanDesc+=" December"}break;case 6:this.humanDesc+="The ";switch(parseInt(this.instance)){case 1:this.humanDesc+="first ";break;case 2:this.humanDesc+="second ";
break;case 3:this.humanDesc+="third ";break;case 4:this.humanDesc+="fourth ";break;case 5:this.humanDesc+="last "}this.humanDesc+="t"==this.day1?" Sunday ":"";this.humanDesc+="t"==this.day2?" Monday ":"";this.humanDesc+="t"==this.day3?" Tuesday ":"";this.humanDesc+="t"==this.day4?" Wednesday ":"";this.humanDesc+="t"==this.day5?" Thursday ":"";this.humanDesc+="t"==this.day6?" Friday ":"";this.humanDesc+="t"==this.day7?" Saturday ":"";this.humanDesc+="of ";switch(parseInt(this.monthOfYear)){case 1:this.humanDesc+=
" January";break;case 2:this.humanDesc+=" February";break;case 3:this.humanDesc+=" March";break;case 4:this.humanDesc+=" April";break;case 5:this.humanDesc+=" May";break;case 6:this.humanDesc+=" June";break;case 7:this.humanDesc+=" July";break;case 8:this.humanDesc+=" August";break;case 9:this.humanDesc+=" September";break;case 10:this.humanDesc+=" October";break;case 11:this.humanDesc+=" November";break;case 12:this.humanDesc+=" December"}break;default:return this.humanDesc="Does not repeat"}this.humanDesc+=
" effective "+alib.dateTime.format(new Date(this.dateStart),"MM/dd/yyyy");this.dateEnd&&(this.humanDesc+=" until "+alib.dateTime.format(new Date(this.dateEnd),"MM/dd/yyyy"));"f"==this.fAllDay&&(this.humanDesc+=" at "+this.timeStart+" to "+this.timeEnd);return this.humanDesc};
CRecurrencePattern.prototype.recurToggleMontlyType=function(){3==this.type?(this.m_dlgElements.rt_m_d_day.disabled=!1,this.m_dlgElements.rt_m_d_int.disabled=!1,this.m_dlgElements.rt_m_rel_nth.disabled=!0,this.m_dlgElements.rt_m_day_nth.disabled=!0,this.m_dlgElements.rt_m_d_int_nth.disabled=!0,this.instance=1,this.day1=1==this.m_dlgElements.rt_m_d_day.value?"t":"f",this.day2=2==this.m_dlgElements.rt_m_d_day.value?"t":"f",this.day3=3==this.m_dlgElements.rt_m_d_day.value?"t":"f",this.day4=4==this.m_dlgElements.rt_m_d_day.value?
"t":"f",this.day5=5==this.m_dlgElements.rt_m_d_day.value?"t":"f",this.day6=6==this.m_dlgElements.rt_m_d_day.value?"t":"f",this.day7=7==this.m_dlgElements.rt_m_d_day.value?"t":"f",this.interval=this.m_dlgElements.rt_m_d_day.value):(this.m_dlgElements.rt_m_d_day.disabled=!0,this.m_dlgElements.rt_m_d_int.disabled=!0,this.m_dlgElements.rt_m_rel_nth.disabled=!1,this.m_dlgElements.rt_m_day_nth.disabled=!1,this.m_dlgElements.rt_m_d_int_nth.disabled=!1,this.day1=1==this.m_dlgElements.rt_m_day_nth.value?"t":
"f",this.day2=2==this.m_dlgElements.rt_m_day_nth.value?"t":"f",this.day3=3==this.m_dlgElements.rt_m_day_nth.value?"t":"f",this.day4=4==this.m_dlgElements.rt_m_day_nth.value?"t":"f",this.day5=5==this.m_dlgElements.rt_m_day_nth.value?"t":"f",this.day6=6==this.m_dlgElements.rt_m_day_nth.value?"t":"f",this.day7=7==this.m_dlgElements.rt_m_day_nth.value?"t":"f",this.dayOfMonth=this.m_dlgElements.rt_m_day_nth.value,this.interval=this.m_dlgElements.rt_m_d_int_nth.value,this.instance=this.m_dlgElements.rt_m_rel_nth.value)};
CRecurrencePattern.prototype.recurToggleYearlyType=function(){5==this.type?(this.m_dlgElements.rt_y_m.disabled=!1,this.m_dlgElements.rt_y_d.disabled=!1,this.m_dlgElements.rt_y_rel.disabled=!0,this.m_dlgElements.rt_y_day.disabled=!0,this.m_dlgElements.rt_y_r_m.disabled=!0,this.monthOfYear=this.m_dlgElements.rt_y_m.value,this.dayOfMonth=this.m_dlgElements.rt_y_d.value,this.instance=null):(this.m_dlgElements.rt_y_m.disabled=!0,this.m_dlgElements.rt_y_d.disabled=!0,this.m_dlgElements.rt_y_rel.disabled=
!1,this.m_dlgElements.rt_y_day.disabled=!1,this.m_dlgElements.rt_y_r_m.disabled=!1,this.instance=this.m_dlgElements.rt_y_rel.value,this.monthOfYear=this.m_dlgElements.rt_y_r_m.value,this.dayOfMonth=null)};Ant.UpdateStream=function(){this.getUpdates()};
Ant.UpdateStream.prototype.getUpdates=function(){var a=new alib.net.Xhr;alib.events.listen(a,"load",function(){var a=this.getResponse();if(a.length)for(var c in a)try{alib.events.triggerEvent(Ant.getUpdateStream(),a[c].type,a[c].data)}catch(d){alert(d)}setTimeout(function(){Ant.getUpdateStream().getUpdates()},1E3)});alib.events.listen(a,"error",function(){setTimeout(function(){Ant.getUpdateStream().getUpdates()},3E3)});a.send("/controller/User/getUpdateStream")};
Ant.UpdateStream.prototype.listen=function(a,b,c){alib.events.listen(this,a,b,c||{})};
Ant.NewObjectTool=function(){this.con=null;this.mode="popup";this.antView=null;this.objects_=[{title:"Email Message",obj_type:"email_message",icon:"/images/icons/objects/email_message_16.png"},{title:"Task",obj_type:"task",icon:"/images/icons/objects/task_16.png"},{title:"Case",obj_type:"case",icon:"/images/icons/objects/case_16.png"},{title:"Project",obj_type:"project",icon:"/images/icons/objects/project_16.png"},{title:"Log Time",obj_type:"time",icon:"/images/icons/objects/time_16.png"},{title:"Project Story",
obj_type:"project_story",icon:"/images/icons/objects/project_story_16.png"},{title:"Calendar Event",obj_type:"calendar_event",icon:"/images/icons/objects/calendar_event_16.png"},{title:"Reminder",obj_type:"reminder",icon:"/images/icons/objects/reminder_16.png"},{title:"Note",obj_type:"note",icon:"/images/icons/objects/note_16.png"},{title:"Person or Organization",obj_type:"customer",icon:"/images/icons/objects/customers/person_16.png"},{title:"Lead",obj_type:"lead",icon:"/images/icons/objects/lead_16.png"},
{title:"Opportunity",obj_type:"opportunity",icon:"/images/icons/objects/opportunity_16.png"}]};Ant.NewObjectTool.prototype.renderView=function(a){this.antView=a;this.mode="inline";this.getObjects()};Ant.NewObjectTool.prototype.anchorToEl=function(a){this.con=alib.dom.createElement("a",a,"<img src='/images/icons/add_24.png' />");this.con.href="javascript:void(0);";this.con.title="Click to create a new object";this.getObjects()};
Ant.NewObjectTool.prototype.getObjects=function(){return"inline"==this.mode?this.buildViewInterface():this.buildDropDown()};Ant.NewObjectTool.prototype.buildDropDown=function(){var a=new alib.ui.FilteredMenu,b;for(b in this.objects_){var c=new alib.ui.MenuItem(this.objects_[b].title,{icon:"<img src='"+this.objects_[b].icon+"' />"});c.cbData.obj_type=this.objects_[b].obj_type;c.onclick=function(){loadObjectForm(this.cbData.obj_type)};a.addItem(c)}a.attach(this.con)};
Ant.NewObjectTool.prototype.buildViewInterface=function(){var a=this.antView.con,b;for(b in this.objects_){var c=alib.dom.createElement("article",a);alib.dom.styleSetClass(c,"nav");c.innerHTML="<a behavior='selectable' href=\"#"+this.antView.getPath()+"/"+this.objects_[b].obj_type+"\" onclick=\"alib.dom.styleAddClass(this, 'selected');\"><span class='icon'><img src='"+this.objects_[b].icon+"' /></span><h2><span class='more'></span>New "+this.objects_[b].title+"</h2></a>";this.antView.addView(this.objects_[b].obj_type,
{type:this.objects_[b].obj_type}).onshow=function(){this.con.innerHTML="";var a=new AntObjectLoader(this.options.type);a.setAntView(this);a.print(this.con);a.cbData.antView=this;a.onClose=function(){this.cbData.antView.goup()};a.onRemove=function(){};a.onSave=function(){}}}};function DaclEdit(a,b){this.con=null;this.name=a;this.inheritFrom=b?b:null;this.permissions=[];this.entries=[];this.usersAndGroups=[]}
DaclEdit.prototype.showDialog=function(a){this.parentDlg=a?a:null;this.dlg=new CDialog("Edit Permissions",this.parentDlg);this.dlg.f_close=!0;this.con=alib.dom.createElement("div");this.dlg.customDialog(this.con,500,450);this.buildInterface()};
DaclEdit.prototype.buildInterface=function(){this.con.innerHTML="";var a=alib.dom.createElement("div",this.con);alib.dom.styleSet(a,"overflow","hidden");alib.dom.styleSet(a,"margin-bottom","10px");alib.dom.styleSet(a,"height","400px");alib.dom.createElement("h2",a,"Modifying permissions for: "+this.name);alib.dom.createElement("hr",a);if(null!=this.inheritFrom){var b=alib.dom.createElement("div",a),c=alib.dom.createElement("input",b);c.type="checkbox";c.checked=!0;alib.dom.createElement("span",b,
"Inherit from parent object or permission")}alib.dom.createElement("h3",a,"Users &amp; Groups With Access (click to view details)");this.usersCon=alib.dom.createElement("div",a);alib.dom.styleSet(this.usersCon,"max-height","75px");alib.dom.styleSet(this.usersCon,"margin-bottom","5px");alib.dom.styleSet(this.usersCon,"overflow","auto");alib.dom.styleSet(this.usersCon,"padding-left","2px");this.loadUserAndGroups();b=alib.dom.createElement("div",a);c=alib.ui.Button("Add User",{className:"b1",tooltip:"Click to give a specific user permission to this object",
cls:this,onclick:function(){this.cls.addUser()}});c.print(b);c=new AntObjectGroupingSel("Add Group","user","groups");c.cbData.cls=this;c.onSelect=function(a,b){this.setLabel("Add Group");this.cbData.cls.insertUserGroup(null,a,b);this.cbData.cls.setEntry(null,a,"Full Control")};c.print(b);this.permissionsTitle=alib.dom.createElement("h3",a,"Permissions (select a user or group above to edit permissions)");this.permissionsCon=alib.dom.createElement("div",a);alib.dom.styleSet(this.permissionsCon,"max-height",
"146px");alib.dom.styleSet(this.permissionsCon,"overflow","auto");alib.dom.styleSet(this.permissionsCon,"padding","2px");this.loadEntries();b=alib.dom.createElement("div",this.con);alib.dom.styleSet(b,"text-align","right");c=alib.ui.Button("Save &amp; Close",{className:"b2",tooltip:"Save changes and close dialog",cls:this,onclick:function(){this.cls.save(!0)}});c.print(b);c=alib.ui.Button("Save",{className:"b1",tooltip:"Save any changes you have made",cls:this,onclick:function(){this.cls.save()}});
c.print(b);c=alib.ui.Button("Cancel",{className:"b1",tooltip:"Close without saving any changes",cls:this,onclick:function(){this.cls.dlg.hide()}});c.print(b)};
DaclEdit.prototype.loadUserAndGroups=function(a,b){"undefined"==typeof a&&(a=null);"undefined"==typeof b&&(b=null);var c=new CAjax("json");c.cbData.cls=this;c.cbData.selectOnLoad={user:a,group:b,name:""};c.onload=function(a){this.cbData.cls.usersCon.innerHTML="";for(var b=0;b<a.length;b++){var c=a[b];this.cbData.cls.insertUserGroup(c.user_id?c.user_id:null,c.group_id?c.group_id:null,c.name)}};c.exec("/controller/Security/loadDaclUsersAndGroups",[["name",this.name]])};
DaclEdit.prototype.insertUserGroup=function(a,b,c){"undefined"==typeof a&&(a=null);"undefined"==typeof b&&(b=null);var d=-1,e;for(e in this.usersAndGroups)a?this.usersAndGroups[e].user_id==a&&(d=e):b&&this.usersAndGroups[e].group_id==b&&(d=e);-1==d&&(this.usersAndGroups.push({user_id:a,group_id:b,name:c}),d=alib.dom.createElement("div",this.usersCon),alib.dom.styleSetClass(d,"aobListRow"),alib.dom.styleSet(d,"padding","3px"),d.innerHTML="<img src='/images/icons/"+(a?"user_16.png":"group_16.png")+
"'> "+c,d.usrgrp={user_id:a,group_id:b},d.cls=this,d.onclick=function(){this.cls.printEntries(this.usrgrp.user_id,this.usrgrp.group_id)})};DaclEdit.prototype.loadEntries=function(){this.permissionsCon.innerHTML="<div class='loading'></div>";var a=new CAjax("json");a.cbData.cls=this;a.onload=function(a){this.cbData.cls.permissions=a.permissions;this.cbData.cls.entries=a.entries;this.cbData.cls.printEntries()};a.exec("/controller/Security/loadDaclPermissions",[["name",this.name]])};
DaclEdit.prototype.printEntries=function(a,b,c,d,e){a=a?a:null;b=b?b:null;if(a||b)this.permissionsTitle.innerHTML="What would you like "+this.getUsrGrpName(a,b)+" to have access to? (uncheck all to delete)",this.selectUserGroup(a,b);for(var f="undefined"!=typeof c?c:0,g="",h=0;h<c;h++)g+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";"undefined"==typeof e&&(this.permissionsCon.innerHTML="");c="undefined"!=typeof e?e:this.permissions;for(h=0;h<c.length;h++){var e=c[h],k=alib.dom.createElement("div",this.permissionsCon);
k.cls=this;k.name=e.name;k.usrgrp={user_id:a,group_id:b};k.childCons=[];alib.dom.createElement("span",k,g);k.chk=alib.dom.createElement("input",k);k.chk.type="checkbox";k.chk.entCon=k;k.chk.onclick=function(){this.entCon.setToggled(this.checked)};k.chk.checked=this.isEntry(a,b,e.name);!k.chk.checked&&d&&(k.chk.checked=d.chk.checked);null==a&&null==b&&(k.chk.disabled=!0);alib.dom.createElement("span",k,"&nbsp;"+e.name);k.setToggled=function(a){(this.chk.checked=a)?this.cls.setEntry(this.usrgrp.user_id,
this.usrgrp.group_id,this.name):this.cls.removeEntry(this.usrgrp.user_id,this.usrgrp.group_id,this.name);this.pnt&&this.pnt.childrenChanged(a);for(var b=0;b<this.childCons.length;b++)this.childCons[b].setToggled(a)};k.childrenChanged=function(a){if(this.chk.checked&&!a)this.chk.checked=a;else{for(var b=!0,c=0;c<this.childCons.length;c++)this.childCons[c].chk.checked||(b=!1);b&&(this.chk.checked=a)}};k.pnt="undefined"!=typeof d?d:null;"undefined"!=typeof d&&d.childCons.push(k);e.children&&e.children.length&&
this.printEntries(a,b,++f,k,e.children)}};DaclEdit.prototype.selectUserGroup=function(a,b){for(var c=0;c<this.usersCon.childNodes.length;c++){var d=this.usersCon.childNodes[c],e=!1;b?d.usrgrp.group_id&&d.usrgrp.group_id==b&&(e=!0):a&&d.usrgrp.user_id&&d.usrgrp.user_id==a&&(e=!0);alib.dom.styleSetClass(d,e?"aobListRowAct":"aobListRow")}};
DaclEdit.prototype.save=function(a){var b=[["name",this.name]],c;for(c in this.entries)b.push(["entries[]",JSON.stringify(this.entries[c])]);c=new CAjax("json");c.cbData.cls=this;c.cbData.closeOnSave="undefined"!=typeof a?a:!1;c.onload=function(){this.cbData.closeOnSave&&this.cbData.cls.dlg.hide()};c.exec("/controller/Security/saveDaclEntries",b)};
DaclEdit.prototype.addUser=function(){var a=new AntObjectBrowser("user");a.cbData.cls=this;a.onSelect=function(a,c){this.cbData.cls.insertUserGroup(a,null,c);this.cbData.cls.setEntry(a,null,"Full Control")};a.displaySelect(this.dlg)};DaclEdit.prototype.isEntry=function(a,b,c){var a=a?a:null,b=b?b:null,d;for(d in this.entries)if(this.entries[d].pname==c&&(a&&this.entries[d].user_id==a||b&&this.entries[d].group_id==b))return!0;return!1};
DaclEdit.prototype.setEntry=function(a,b,c){var a=a?a:null,b=b?b:null,d=-1,e;for(e in this.entries)if(this.entries[e].pname==c&&(a&&this.entries[e].user_id==a||b&&this.entries[e].group_id==b))d=e;-1==d&&this.entries.push({user_id:a,group_id:b,pname:c})};DaclEdit.prototype.removeEntry=function(a,b,c){var a=a?a:null,b=b?b:null,d;for(d in this.entries)this.entries[d].pname==c&&(a&&this.entries[d].user_id==a||b&&this.entries[d].group_id==b)&&this.entries.splice(d,1)};
DaclEdit.prototype.getUsrGrpName=function(a,b){for(var c in this.usersAndGroups)if(a){if(this.usersAndGroups[c].user_id==a)return this.usersAndGroups[c].name}else if(b&&this.usersAndGroups[c].group_id==b)return this.usersAndGroups[c].name;return a?"User":"Group"};Ant.Emailer={};Ant.Emailer.settingsRetrieved_=!1;Ant.Emailer.composeNetric_=!1;Ant.Emailer.logAllMail_=!1;
Ant.Emailer.compose=function(a,b){var c=b||{},d=null;if("string"===typeof a)d=a;else if("undefined"!=typeof a||0<a.length)for(var e in a)d+=d?","+a[e]:a[e];this.settingsRetrieved_?this.composeNetric_?(e=[],d?e.push(["send_to",d]):c.to&&e.push(["send_to",c.to]),c.subject&&e.push(["subject",c.subject]),c.cc&&e.push(["cc",c.cc]),c.bcc&&e.push(["bcc",c.bcc]),c.body&&e.push(["body",c.body]),loadObjectForm("email_message",null,null,null,e)):(this.logAllMail_&&c.obj_type&&c.oid&&(c.bcc=Ant.account.name+
"-act-"+c.obj_type+"."+c.oid+"@"+Ant.settings.email.dropbox_catchall),e="mailto:",d?e+=d:c.to&&(e+=c.to),e+="?fv=1",c.subject&&(e+="&subject="+escape(c.subject)),c.cc&&(e+="&cc="+escape(c.cc)),c.bcc&&(e+="&bcc="+escape(c.bcc)),c.body&&(e+="&body="+escape(c.body)),window.location.href=e):this.getSettings_(d,c)};
Ant.Emailer.getSettings_=function(a,b){var c=new alib.net.Xhr;alib.events.listen(c,"load",function(c){var e=this.getResponse();e.error||(e["email/compose_netric"]&&(c.data.cls.composeNetric_=1==e["email/compose_netric"]?!0:!1),e["email/log_allmail"]&&(c.data.cls.logAllMail_=1==e["email/log_allmail"]?!0:!1));c.data.cls.settingsRetrieved_=!0;Ant.Emailer.compose(a,b)},{cls:this});alib.events.listen(c,"error",function(){});c.send("/controller/Admin/getSetting","POST",{get:["email/compose_netric","email/log_allmail"]})};
var WF_TIME_UNIT_MINUTE=1,WF_TIME_UNIT_HOUR=2,WF_TIME_UNIT_DAY=3,WF_TIME_UNIT_WEEK=4,WF_TIME_UNIT_MONTH=5,WF_TIME_UNIT_YEAR=6,WF_ATYPE_SENDEMAIL=1,WF_ATYPE_CREATEOBJ=2,WF_ATYPE_UPDATEFLD=3,WF_ATYPE_STARTCHLD=4,WF_ATYPE_STOPWF=5,WF_ATYPE_APPROVAL=8,WF_ATYPE_CALLPAGE=9,WF_ATYPE_ASSIGNRR=10,WF_ATYPE_WAITCONDITION=11,WF_ATYPE_CHECKCONDITION=12;function WorkFlow(a){this.id=a?a:null;this.name="Untitled";this.fActive=!1;this.object_type="";this.conditions=[];this.actions=[];this.gWfCondUid=0}
WorkFlow.prototype.getNumConditions=function(){return this.conditions.length};WorkFlow.prototype.addCondition=function(a,b,c,d,e){e||(e="new"+this.gWfCondUid,this.gWfCondUid++);this.conditions[this.conditions.length]=new WorkFlowCondition(a,b,c,d,e)};WorkFlow.prototype.delConditions=function(){this.conditions=[]};WorkFlow.prototype.getNumTasks=function(){return this.getNumActions()};WorkFlow.prototype.getNumActions=function(){return this.actions.length};
WorkFlow.prototype.addAction=function(a,b){var c=new WorkFlow_Action(a,this);"undefined"!=typeof b&&c.loadFromData(b);return this.actions[this.actions.length]=c};WorkFlow.prototype.removeAction=function(a){for(var b=0;b<this.actions.length;b++)this.actions[b]==a&&(this.actions[b].remove(),this.actions.splice(b,1))};WorkFlow.prototype.delActionById=function(a){for(var b=0;b<this.actions.length;b++)if(this.actions[b].id==a){this.actions[b].edit_status="delete";break}};WorkFlow.prototype.getTasks=function(a){return this.actions[a]};
WorkFlow.prototype.delTask=function(){return this.actions[ind]};
WorkFlow.prototype.load=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.id=this.id;ajax.onload=function(a){if(a){var b=a.wfInfo;this.cbData.cls.id=b.id;this.cbData.cls.name=b.name;this.cbData.cls.notes=b.notes;this.cbData.cls.object_type=b.object_type;this.cbData.cls.fActive=b.f_active;this.cbData.cls.fOnCreate=b.f_on_create;this.cbData.cls.fOnUpdate=b.f_on_update;this.cbData.cls.fOnDelete=b.f_on_delete;this.cbData.cls.fOnDaily=b.f_on_daily;this.cbData.cls.fSingleton=b.f_singleton;
this.cbData.cls.fAllowManual=b.f_allow_manual;this.cbData.cls.fConditionUnmet=b.f_condition_unmet;a=a.wfCondition;for(cond in a)b=a[cond],this.cbData.cls.addCondition(b.blogic,b.field_name,b.operator,b.cond_value,b.id)}this.cbData.cls.loadActions()};ajax.exec("/controller/WorkFlow/getWorkflowDetails",[["wfid",this.id]])};
WorkFlow.prototype.loadActions=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){for(var b=0;b<a.length;b++)this.cbData.cls.addAction(a[b].type,a[b]);this.cbData.cls.onload()};ajax.exec("/controller/WorkFlow/getWorkFlowActions",[["wfid",this.id]])};WorkFlow.prototype.onload=function(){};
WorkFlow.prototype.save=function(){var a=[["name",this.name],["notes",this.notes],["object_type",this.object_type],["f_on_create",this.fOnCreate?"t":"f"],["f_on_update",this.fOnUpdate?"t":"f"],["f_on_delete",this.fOnDelete?"t":"f"],["f_on_daily",this.fOnDaily?"t":"f"],["f_allow_manual",this.fAllowManual?"t":"f"],["f_singleton",this.fSingleton?"t":"f"],["f_active",this.fActive?"t":"f"],["f_condition_unmet",this.fConditionUnmet?"t":"f"]];this.id&&(a[a.length]=["wid",this.id]);for(var b=0;b<this.getNumConditions();b++){var c=
this.conditions[b].id;a[a.length]=["conditions[]",c];a[a.length]=["condition_blogic_"+c,this.conditions[b].blogic];a[a.length]=["condition_fieldname_"+c,this.conditions[b].fieldName];a[a.length]=["condition_operator_"+c,this.conditions[b].operator];a[a.length]=["condition_condvalue_"+c,this.conditions[b].condValue]}ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a)if(this.cbData.cls.id||(this.cbData.cls.id=a),this.cbData.cls.getNumTasks())this.cbData.cls.saveActions();else this.cbData.cls.onsave();
else this.cbData.cls.onsaveError()};ajax.exec("/controller/WorkFlow/saveWorkflow",a)};WorkFlow.prototype.saveActions=function(){for(var a=0;a<this.getNumActions();a++)if(this.actions[a].isDirty(!0)){this.actions[a].cbData.workflow=this;this.actions[a].onsaved=function(){this.cbData.workflow.saveActions()};this.actions[a].save();return}this.onsave()};WorkFlow.prototype.onsave=function(){};WorkFlow.prototype.onsaveError=function(){};
function WorkFlowCondition(a,b,c,d,e){var f={};f.id=e;f.blogic=a;f.fieldName=b;f.operator=c;f.condValue=d;return f}function wfGetTimeUnits(){var a=[];a[0]=[WF_TIME_UNIT_MINUTE,"Minute(s)"];a[1]=[WF_TIME_UNIT_HOUR,"Hour(s)"];a[2]=[WF_TIME_UNIT_DAY,"Day(s)"];a[3]=[WF_TIME_UNIT_WEEK,"Week(s)"];a[4]=[WF_TIME_UNIT_MONTH,"Month(s)"];a[5]=[WF_TIME_UNIT_YEAR,"Year(s)"];return a}function wfGetTimeUnitName(a){for(var b="",c=wfGetTimeUnits(),d=0;d<c.length;d++)c[d][0]==a&&(b=c[d][1]);return b}
function WorkFlow_Selector_User(a){this.objects=[a];this.parentDialog=null}
WorkFlow_Selector_User.prototype.print=function(a,b){var c=alib.dom.createElement("select",a);c.inpt=b;c[c.length]=new Option("Click to select user","",!1,!0);for(var d=0;d<this.objects.length;d++)for(var e=0;e<this.objects[d].getNumFields();e++){var f=this.objects[d].getField(e);"object"==f.type&&"user"==f.subtype&&(c[c.length]=new Option(this.objects[d].title+"."+f.title,"<%"+f.name+"%>"),c[c.length]=new Option(this.objects[d].title+"."+f.title+".Manager","<%"+f.name+".manager_id%>"))}c[c.length]=
new Option("Select Specific User","browse");c.parentDialog=this.parentDialog;c.onchange=function(){if("browse"==this.value){var a=new AntObjectBrowser("user");a.cbData.inpt=b;a.onSelect=function(a){this.cbData.inpt.value=a;try{if(this.cbData.inpt.onchange)this.cbData.inpt.onchange()}catch(b){}};a.displaySelect(this.parentDialog)}else if(this.value){this.inpt.value=this.value;try{if(this.inpt.onchange)this.inpt.onchange()}catch(c){}}this.selectedIndex=0}};
WorkFlow_Selector_User.prototype.setParentDialog=function(a){this.parentDialog=a};function WorkFlow_Selector_MergeField(a){this.objects=[a];this.input=null}
WorkFlow_Selector_MergeField.prototype.attach=function(a,b){var c=new alib.ui.PopupMenu;this.input=b;var d=new alib.ui.MenuItem("Link to "+this.objects[0].title,{cls:this});d.onclick=function(){this.options.cls.insertText("<%object_link%>")};c.addItem(d);for(var e=0;e<this.objects.length;e++)for(var f=0;f<this.objects[e].getNumFields();f++)if(d=this.objects[e].getField(f),"object_multi"!=d.type&&"fkey_multi"!=d.type)if("object"==d.type&&d.subtype){var g=new alib.ui.SubMenu(this.objects[e].title+"."+
d.title);this.addSubObjects(g,d);c.addItem(g)}else d=new alib.ui.MenuItem(this.objects[e].title+"."+d.title,{mergeVal:"<%"+d.name+"%>",cls:this}),d.onclick=function(){this.options.cls.insertText(this.options.mergeVal)},c.addItem(d);c.attach(a)};
WorkFlow_Selector_MergeField.prototype.addSubObjects=function(a,b){for(var c=new CAntObject(b.subtype),d=0;d<c.getNumFields();d++){var e=c.getField(d);"object_multi"!=e.type&&"fkey_multi"!=e.type&&(e=new alib.ui.MenuItem(e.title,{mergeVal:"<%"+b.name+"."+e.name+"%>",cls:this}),e.onclick=function(){this.options.cls.insertText(this.options.mergeVal)},a.addItem(e))}};WorkFlow_Selector_MergeField.prototype.insertText=function(a){this.input.value+=a};var g_ActId=0;
function WorkFlow_Action(a,b,c){this.workflow=b;this.parentAction=c?c:null;this.parentActionId=c?c.id:null;this.id=this.parentActionEvent=null;this.name="Untitled";this.edit_status="nochange";this.conditions=[];this.antConditionsObj=null;this.when={};this.when.interval=0;this.type=this.when.unit=a;this.send_email_fid="object_name/type";this.create_obj_fid=this.create_obj=this.update_to=this.update_field=null;this.create_obj_values=[];this.stop_wfid=this.start_wfid=null;this.childActions=[];this.cbData=
{};this.dirty=!0}
WorkFlow_Action.prototype.save=function(a){if(this.isDirty()||a){alib.m_debug=!0;a=new CAjax("json");a.cbData.cls=this;a.onload=function(a){!this.cbData.cls.id&&a&&(this.cbData.cls.id=a);this.cbData.cls.dirty=!1;this.cbData.cls.saveChildren()};for(var b=[["id",this.id],["workflow_id",this.workflow.id],["type",this.type],["when_interval",this.when.interval],["name",this.name],["send_email_fid",this.send_email_fid],["update_field",this.update_field],["update_to",this.update_to],["parent_action_id",this.parentAction?
this.parentAction.id:this.parentActionId],["parent_action_event",this.parentActionEvent],["create_obj",this.create_obj],["start_wfid",this.start_wfid],["stop_wfid",this.stop_wfid]],c=0;c<this.getNumObjectValues();c++){var d=this.getObjectValueByIdx(c);b[b.length]=["ovals[]",d.name];var e="oval_"+d.name;if(d.isMulti)for(var d=this.getObjectMultiValues(d.name),f=0;f<d.length;f++)b[b.length]=[e+"[]",d[f]];else b[b.length]=[e,d.value]}a.exec("/controller/WorkFlow/saveAction",b)}else this.saveChildren()};
WorkFlow_Action.prototype.saveChildren=function(){for(var a=0;a<this.childActions.length;a++)if(this.childActions[a].isDirty(!0)){this.childActions[a].cbData.parentAct=this;this.childActions[a].onsaved=function(){this.cbData.parentAct.saveChildren()};this.childActions[a].save();return}this.onsaved()};WorkFlow_Action.prototype.onsaved=function(){};WorkFlow_Action.prototype.onupdate=function(){};
WorkFlow_Action.prototype.isDirty=function(a){var b=this.dirty;if(a)for(a=0;a<this.childActions.length;a++)this.childActions[a].isDirty(!0)&&(b=!0);return b};
WorkFlow_Action.prototype.loadFromData=function(a){if("undefined"==typeof a)return!1;a.id&&(this.id=parseInt(a.id));a.type&&(this.type=parseInt(a.type));a.workflow_id&&(this.workflow_id=a.workflow_id);a.when_interval&&(this.when.interval=a.when_interval);a.when_unit&&(this.when.unit=a.when_unit);a.name&&(this.name=a.name);a.send_email_fid&&(this.send_email_fid=parseInt(a.send_email_fid));a.update_field&&(this.update_field=a.update_field);a.update_to&&(this.update_to=a.update_to);a.parentActionId&&
(this.parentActionId=parseInt(a.parentActionId));a.parentActionEvent&&(this.parentActionEvent=a.parentActionEvent);a.create_obj&&(this.create_obj=a.create_obj);a.start_wfid&&(this.start_wfid=parseInt(a.start_wfid));a.stop_wfid&&(this.stop_wfid=parseInt(a.stop_wfid));for(var b in a.object_values)this.setObjectValue(b,a.object_values[b]);for(b=0;b<a.conditions.length;b++)this.addCondition(a.conditions[b].blogic,a.conditions[b].fieldName,a.conditions[b].operator,a.conditions[b].condValue,a.conditions[b].id);
for(b=0;b<a.child_actions.length;b++)this.addAction(parseInt(a.child_actions[b].type),a.child_actions[b]);this.dirty=!1};WorkFlow_Action.prototype.remove=function(){for(var a=0;a<this.childActions.length;a++)this.childActions[a].remove();this.id&&(a=new CAjax("json"),a.onload=function(){},a.exec("/controller/WorkFlow/removeAction",[["id",this.id]]))};
WorkFlow_Action.prototype.addAction=function(a,b){var c=new WorkFlow_Action(a,this.workflow,this);"undefined"!=typeof b&&c.loadFromData(b);return this.childActions[this.childActions.length]=c};WorkFlow_Action.prototype.removeAction=function(a){for(var b=0;b<this.childActions.length;b++)this.childActions[b]==a&&(this.childActions[b].remove(),this.childActions.splice(b,1))};
WorkFlow_Action.prototype.showDialog=function(a){var b=this.id?"Edit Action":"Create New Action",a=new CDialog(b,a?a:null);a.f_close=!0;var c=alib.dom.createElement("div");a.customDialog(c,560);var b=alib.dom.createElement("table",c),b=alib.dom.createElement("tbody",b),d=alib.dom.createElement("tr",b),b=alib.dom.createElement("td",d);alib.dom.styleSetClass(b,"strong");b.innerHTML="Name";b=alib.dom.createElement("td",d);d=alib.dom.createElement("input",b);d.act=this;d.value=this.name;d.onchange=function(){this.act.name=
this.value};b=alib.dom.createElement("span",b);b.innerHTML="&nbsp;give this action a unique name";b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"height","400px");alib.dom.styleSet(b,"overflow","auto");switch(this.type){case WF_ATYPE_SENDEMAIL:(new WorkFlow_Action_Email(this.workflow.object_type)).taskSendEmail(b,this);break;case WF_ATYPE_UPDATEFLD:b=alib.dom.createElement("div",b);(new WorkFlow_Action_Update(this.workflow.object_type,a)).print(b,this);break;case WF_ATYPE_STARTCHLD:b=alib.dom.createElement("div",
b);d=new WorkFlow_Action_Child(this.workflow.object_type,a);d.print(b,this);break;case WF_ATYPE_ASSIGNRR:b=alib.dom.createElement("div",b);d=new WorkFlow_Action_AssignRR(this.workflow.object_type,a);d.print(b,this);break;case WF_ATYPE_APPROVAL:b=alib.dom.createElement("div",b);d=new WorkFlow_Action_Approval(this.workflow.object_type,a);d.print(b,this);break;case WF_ATYPE_CALLPAGE:b=alib.dom.createElement("div",b);d=new WorkFlow_Action_CallPage(this.workflow.object_type,a);d.print(b,this);break;case WF_ATYPE_WAITCONDITION:b=
alib.dom.createElement("div",b);d=new WorkFlow_Action_WaitCondition(this.workflow.object_type,a);d.print(b,this);break;case WF_ATYPE_CHECKCONDITION:b=alib.dom.createElement("div",b);d=new WorkFlow_Action_CheckCondition(this.workflow.object_type,a);d.print(b,this);break;default:"task"==this.create_obj&&(d=new WorkFlow_Action_Task(this.workflow.object_type),d.taskCreateTask(b,this)),"invoice"==this.create_obj&&(new WorkFlow_Action_Invoice(this.workflow.object_type)).taskCreateInvoice(b,this),"notification"==
this.create_obj&&(d=new WorkFlow_Action_Notification(this.workflow.object_type),d.render(b,this))}c=alib.dom.createElement("div",c);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");b=new CButton("Save",function(a,b){b.hide();a.dirty=!0;a.onupdate()},[this,a,this,this.conditions,this.id?!1:!0],"b2");b.print(c);b=new CButton("Cancel",function(a){a.hide()},[a],"b1");b.print(c);a.reposition()};WorkFlow_Action.prototype.getNumObjectValues=function(){return this.create_obj_values.length};
WorkFlow_Action.prototype.getObjectValueByIdx=function(a){return{name:this.create_obj_values[a][0],value:this.create_obj_values[a][1],isMulti:"object"==typeof this.create_obj_values[a][1]?!0:!1}};WorkFlow_Action.prototype.setObjectValue=function(a,b){for(var c=0;c<this.create_obj_values.length;c++)if(this.create_obj_values[c][0]==a){this.create_obj_values[c][1]=b;return}c=this.create_obj_values.length;this.create_obj_values[c]=[];this.create_obj_values[c][0]=a;this.create_obj_values[c][1]=b};
WorkFlow_Action.prototype.getObjectValue=function(a){for(var b=0;b<this.create_obj_values.length;b++)if(this.create_obj_values[b][0]==a)return this.create_obj_values[b][1];return null};
WorkFlow_Action.prototype.setObjectMultiValue=function(a,b){for(var c=0;c<this.create_obj_values.length;c++)if(this.create_obj_values[c][0]==a){for(var d=0;d<this.create_obj_values[c][1].length;d++)this.create_obj_values[c][1][d]==b&&!1;this.create_obj_values[c][1][this.create_obj_values[c][1].length]=b;return}c=this.create_obj_values.length;this.create_obj_values[c]=[];this.create_obj_values[c][0]=a;this.create_obj_values[c][1]=[];this.create_obj_values[c][1][0]=b};
WorkFlow_Action.prototype.getObjectMultiValueExists=function(a,b){for(var c=0;c<this.create_obj_values.length;c++)if(this.create_obj_values[c][0]==a)for(var d=0;d<this.create_obj_values[c][1].length;d++)if(this.create_obj_values[c][1][d]==b)return!0;return!1};
WorkFlow_Action.prototype.getObjectMultiValues=function(a){for(var b=[],c=0;c<this.create_obj_values.length;c++)if(this.create_obj_values[c][0]==a)for(var d=0;d<this.create_obj_values[c][1].length;d++)b[b.length]=this.create_obj_values[c][1][d];return b};
WorkFlow_Action.prototype.delObjectMultiValue=function(a,b){for(var c=0;c<this.create_obj_values.length;c++)if(this.create_obj_values[c][0]==a)for(var d=0;d<this.create_obj_values[c][1].length;d++)this.create_obj_values[c][1][d]==b&&this.create_obj_values[c][1].splice(d,1)};WorkFlow_Action.prototype.addCondition=function(a,b,c,d,e){this.conditions[this.conditions.length]=new WorkFlowCondition(a,b,c,d,e)};
WorkFlow_Action.prototype.addConditionObj=function(a,b,c,d){this.conditions[this.conditions.length]=new WorkFlowCondition(a,b,c,d)};WorkFlow_Action.prototype.delConditions=function(){this.conditions=[]};
WorkFlow_Action.prototype.getTypeDesc=function(){switch(this.type){case WF_ATYPE_SENDEMAIL:return"Send Email";case WF_ATYPE_UPDATEFLD:return"Update Field";case WF_ATYPE_STARTCHLD:return"Start Child Workflow";case WF_ATYPE_STOPWF:return"Stop Workflow";case WF_ATYPE_CREATEOBJ:return"Create New "+this.create_obj;case WF_ATYPE_APPROVAL:return"Request Approval";case WF_ATYPE_CALLPAGE:return"Call Page";case WF_ATYPE_ASSIGNRR:return"Assign";case WF_ATYPE_WAITCONDITION:return"Wait";case WF_ATYPE_CHECKCONDITION:return"Execute Workflow"}};
WorkFlow_Action.prototype.getTypeName=function(){switch(this.type){case WF_ATYPE_SENDEMAIL:return"email";case WF_ATYPE_UPDATEFLD:return"update";case WF_ATYPE_STARTCHLD:return"Start Child Workflow";case WF_ATYPE_STOPWF:return"Stop Workflow";case WF_ATYPE_CREATEOBJ:return"task";case WF_ATYPE_APPROVAL:return"approval";case WF_ATYPE_ASSIGNRR:return"assign"}};
WorkFlow_Action.prototype.getWhenDesc=function(){return this.type==WF_ATYPE_CHECKCONDITION?"If":0==this.when.interval?"Immediately":this.when.interval+" "+wfGetTimeUnitName(this.when.unit)+" after workflow starts"};
WorkFlow_Action.prototype.getCondDesc=function(){var a="";if(this.antConditionsObj){this.conditions=[];for(var b=0;b<this.antConditionsObj.getNumConditions();b++){var c=this.antConditionsObj.getCondition(b);this.addCondition(c.blogic,c.fieldName,c.operator,c.condValue,c.condId);a.length&&(a+=" "+c.blogic+" ");a+=c.fieldName+" "+c.operator+" "+c.condValue}}else for(b=0;b<this.conditions.length;b++)a.length&&(a+=" "+this.conditions[b].blogic+" "),a+=this.conditions[b].fieldName+" "+this.conditions[b].operator+
" "+this.conditions[b].condValue;return a};WorkFlow_Action.prototype.getSubActionEvents=function(){var a=[];a[a.length]={name:"",description:"After Action Completes:"};this.type==WF_ATYPE_APPROVAL&&(a[a.length]={name:"approved",description:"On Approved:"},a[a.length]={name:"declined",description:"On Declined:"});return a};WorkFlow_Action.prototype.getSummary=function(){return this.name+": "+this.getTypeDesc()+" "+this.getWhenDesc()+" "+this.getCondDesc()};
function WorkFlow_Action_Child(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_Child.prototype.print=function(a,b){b.type=WF_ATYPE_STARTCHLD;var c=alib.dom.createElement("div",a);alib.dom.styleSetClass(c,"formLabel");alib.dom.styleSet(c,"margin","6px 0px 3px 3px");c.innerHTML="Select a child workflow to launch: test";c=alib.dom.createElement("div",a);c=alib.dom.createElement("select",c);c.size=20;c.style.width="98%";c.taskObj=b;c.onchange=function(){this.taskObj.start_wfid=this.value};ajax=new CAjax("json");ajax.workflows=c;ajax.taskObj=b;ajax.onload=function(a){if(a.length)for(workflow in a){var b=
a[workflow];"t"==b.f_active&&(this.workflows[this.workflows.length]=new Option(b.name,b.id,b.id==this.taskObj.start_wfid?!0:!1))}};c=[];c[c.length]=["otypes",b.workflow.object_type];ajax.exec("/controller/WorkFlow/getWorkflow",c)};function WorkFlow_Action_Invoice(a){this.g_antObject=new CAntObject(a)}
WorkFlow_Action_Invoice.prototype.taskCreateInvoice=function(a,b){b.create_obj="invoice";b.type=WF_ATYPE_CREATEOBJ;var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Create Invoice";var c=alib.dom.createElement("table",c),e=alib.dom.createElement("tbody",c),c=new CAntObject("invoice"),d=alib.dom.createElement("tr",e),f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Name Title";
f=alib.dom.createElement("td",d);d=alib.dom.createElement("input",f);d.value=b.getObjectValue("name");d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("name",this.value)};d=alib.dom.createElement("span",f);d.innerHTML=" this will be the name of the invoice";d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Status";f=alib.dom.createElement("td",d);d=c.fieldCreateValueInput(f,"status_id",b.getObjectValue("status_id"));d.m_obj=
b;d.onchange=function(){this.m_obj.setObjectValue("status_id",this.value)};d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Owner";f=alib.dom.createElement("td",d);f=alib.dom.createElement("select",f);f.m_act=b;f.onchange=function(){this.m_act.setObjectValue("owner_id",this.value)};for(var d=b.getObjectValue("owner_id"),g=0;g<this.g_antObject.getNumFields();g++){var h=this.g_antObject.getField(g);if("fkey"==h.type&&"users"==h.subtype){var k=
"<%"+h.name+"%>";d||(b.setObjectValue("owner_id",k),d=k);f[f.length]=new Option(this.g_antObject.title+"."+h.title,k,!1,d==k?!0:!1)}}this.wf_frm_loadUsers(f,d);f.m_obj=b;f.onchange=function(){this.m_obj.setObjectValue("owner_id",this.value)};d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Product ID";f=alib.dom.createElement("td",d);d=alib.dom.createElement("input",f);d.value=b.getObjectValue("ent_product_0");d.m_obj=b;d.onchange=
function(){this.m_obj.setObjectValue("ent_product_0",this.value)};d=alib.dom.createElement("span",f);d.innerHTML=" REQUIRED: enter the id of a product";d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Quantity";f=alib.dom.createElement("td",d);d=alib.dom.createElement("input",f);d.value=b.getObjectValue("ent_quantity_0");d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("ent_quantity_0",this.value)};d=alib.dom.createElement("span",
f);d.innerHTML=" REQUIRED: the number of the selected product(s) to add";d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="";f=alib.dom.createElement("td",d);d=alib.dom.createElement("input");d.type="checkbox";f.appendChild(d);d.checked="t"==b.getObjectValue("paywithdefcard")?!0:!1;d.m_obj=b;d.onclick=function(){this.m_obj.setObjectValue("paywithdefcard",this.checked?"1":"0")};d=alib.dom.createElement("span",f);d.innerHTML=" Automatically bill this invoice to customer's default card";
d=alib.dom.createElement("tr",e);f=alib.dom.createElement("td",d);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="";f=alib.dom.createElement("td",d);e=alib.dom.createElement("div",f);e.innerHTML="If transaction is approved:";alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"margin-bottom","5px");a=alib.dom.createElement("div",f);alib.dom.styleSet(a,"margin-bottom","5px");d=alib.dom.createElement("span",a);d.innerHTML="Set invoice status to: ";e=alib.dom.createElement("span",a);d=c.fieldCreateValueInput(e,
"status_id",b.getObjectValue("billing_success_status"));d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("billing_success_status",this.value)};a=alib.dom.createElement("div",f);d=alib.dom.createElement("span",a);d.innerHTML="Send email notification to: ";d=alib.dom.createElement("input",a);d.m_obj=b;d.value=b.getObjectValue("billing_success_notify");d.onchange=function(){this.m_obj.setObjectValue("billing_success_notify",this.value)};e=alib.dom.createElement("div",f);e.innerHTML="If transaction is declined:";
alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"margin","5px 0 5px 0");a=alib.dom.createElement("div",f);alib.dom.styleSet(a,"margin-bottom","5px");d=alib.dom.createElement("span",a);d.innerHTML="Set invoice status to: ";e=alib.dom.createElement("span",a);d=c.fieldCreateValueInput(e,"status_id",b.getObjectValue("billing_fail_status"));d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("billing_fail_status",this.value)};a=alib.dom.createElement("div",f);d=alib.dom.createElement("span",
a);d.innerHTML="Send email notification to: ";d=alib.dom.createElement("input",a);d.m_obj=b;d.value=b.getObjectValue("billing_fail_notify");d.onchange=function(){this.m_obj.setObjectValue("billing_fail_notify",this.value)}};
WorkFlow_Action_Invoice.prototype.wf_frm_loadUsers=function(a,b){var c=new CAjax;c.cbAssignTo=a;c.assigned_to=b;c.onload=function(a){var b=a.getNumChildren();if(b)for(i=0;i<b;i++){var c=a.getChildNode(i);if("user"==c.m_name){var g=c.getChildNodeValByName("id");c.getChildNodeValByName("title");c.getChildNodeValByName("team_name");(c=c.getChildNodeValByName("full_name"))||(c="untitled");this.cbAssignTo[this.cbAssignTo.length]=new Option(unescape(c),g,!1,this.assigned_to==g?!0:!1)}}};c.exec("/users/xml_get_users.php?fval=0")};
function WorkFlow_Action_Task(a){this.g_antObject=new CAntObject(a)}
WorkFlow_Action_Task.prototype.taskCreateTask=function(a,b){b.create_obj="task";b.type=WF_ATYPE_CREATEOBJ;var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Create Task";var c=alib.dom.createElement("table",c),c=alib.dom.createElement("tbody",c),d=alib.dom.createElement("tr",c),e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");e.innerHTML="Subject";e=alib.dom.createElement("td",d);d=
alib.dom.createElement("input",e);d.value=b.getObjectValue("name");d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("name",this.value)};d=alib.dom.createElement("span",e);d.innerHTML=" this will be the name the end-user sees when the task is created";d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");e.innerHTML="Assign To";e=alib.dom.createElement("td",d);e=alib.dom.createElement("select",e);e.m_act=b;e.onchange=function(){this.m_act.setObjectValue("user_id",
this.value)};for(var f=b.getObjectValue("user_id"),d=0;d<this.g_antObject.getNumFields();d++){var g=this.g_antObject.getField(d);if("object"==g.type&&"user"==g.subtype){var h="<%"+g.name+"%>";f||(b.setObjectValue("user_id",h),f=h);e[e.length]=new Option(this.g_antObject.title+"."+g.title,h,!1,f==h?!0:!1);e[e.length]=new Option(this.g_antObject.title+"."+g.title+".Manager","<%"+g.name+".manager_id%>",!1,f=="<%"+g.name+".manager_id%>"?!0:!1)}}this.wf_frm_loadUsers(e,f);e.m_obj=b;e.onchange=function(){this.m_obj.setObjectValue("user_id",
this.value)};d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");e.innerHTML="Task Is Due";e=alib.dom.createElement("td",d);c=alib.dom.createElement("input",e);alib.dom.styleSet(c,"width","14px");(d=b.getObjectValue("due_interval"))||b.setObjectValue("due_interval","0");c.value=null!=d?d:"0";c.m_obj=b;c.onchange=function(){this.m_obj.setObjectValue("due_interval",this.value)};d=alib.dom.createElement("span",e);d.innerHTML="&nbsp;";c=alib.dom.createElement("select",
e);f=wfGetTimeUnits();b.getObjectValue("due_unit")||b.setObjectValue("due_unit",f[2][0]);for(d=2;d<f.length;d++)c[c.length]=new Option(f[d][1],f[d][0],!1,!1);c.m_obj=b;c.onchange=function(){this.m_obj.setObjectValue("due_unit",this.value)};d=alib.dom.createElement("span",e);d.innerHTML=" after task is created (enter 0 for immediate)"};
WorkFlow_Action_Task.prototype.wf_frm_loadUsers=function(a,b){var c=new CAjax;c.cbAssignTo=a;c.assigned_to=b;c.onload=function(a){var b=a.getNumChildren();if(b)for(i=0;i<b;i++){var c=a.getChildNode(i);if("user"==c.m_name){var g=c.getChildNodeValByName("id");c.getChildNodeValByName("title");c.getChildNodeValByName("team_name");(c=c.getChildNodeValByName("full_name"))||(c="untitled");this.cbAssignTo[this.cbAssignTo.length]=new Option(unescape(c),g,!1,this.assigned_to==g?!0:!1)}}};c.exec("/users/xml_get_users.php?fval=0")};
function WorkFlow_Action_Notification(a){this.g_antObject=new CAntObject(a)}
WorkFlow_Action_Notification.prototype.render=function(a,b){b.create_obj="notification";b.type=WF_ATYPE_CREATEOBJ;var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Send Notification";var c=alib.dom.createElement("table",c),c=alib.dom.createElement("tbody",c),d=alib.dom.createElement("tr",c),e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formLabel");e.innerHTML="Subject";e=alib.dom.createElement("td",
d);d=alib.dom.createElement("input",e);d.value=b.getObjectValue("name");d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("name",this.value)};d=alib.dom.createElement("span",e);d.innerHTML=" short description of the notification";d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d,"Send To");alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"vertical-align","top");e=alib.dom.createElement("td",d);d=alib.dom.createElement("select",e);d.m_act=b;d.onchange=function(){this.m_act.setObjectValue("owner_id",
this.value)};for(var f=b.getObjectValue("owner_id"),g=0;g<this.g_antObject.getNumFields();g++){var h=this.g_antObject.getField(g);if("object"==h.type&&"user"==h.subtype){var k="<%"+h.name+"%>";f||(b.setObjectValue("owner_id",k),f=k);d[d.length]=new Option(this.g_antObject.title+"."+h.title,k,!1,f==k?!0:!1)}}this.wf_frm_loadUsers(d,f);d.m_obj=b;d.onchange=function(){this.m_obj.setObjectValue("owner_id",this.value)};d=alib.dom.createElement("div",e);f=alib.dom.createElement("input",d);f.type="checkbox";
f.checked=!0;f.disabled=!0;d=alib.dom.createElement("span",d,"Notification Center");d=alib.dom.createElement("div",e);f=alib.dom.createElement("input",d);f.type="checkbox";f.checked="t"==b.getObjectValue("f_popup")?!0:!1;d=alib.dom.createElement("span",d,"Popup Alert");f.act=b;f.onclick=function(){this.act.setObjectValue("f_popup",this.checked?"t":"f")};d=alib.dom.createElement("div",e);f=alib.dom.createElement("input",d);f.type="checkbox";f.checked="t"==b.getObjectValue("f_email")?!0:!1;d=alib.dom.createElement("span",
d,"Send Email");f.act=b;f.onclick=function(){this.act.setObjectValue("f_email",this.checked?"t":"f")};d=alib.dom.createElement("div",e);f=alib.dom.createElement("input",d);f.type="checkbox";f.checked="t"==b.getObjectValue("f_sms")?!0:!1;d=alib.dom.createElement("span",d,"SMS (text message to mobile)");f.act=b;f.onclick=function(){this.act.setObjectValue("f_sms",this.checked?"t":"f")};d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d,"Message");alib.dom.styleSetClass(e,"formLabel");
alib.dom.styleSet(e,"vertical-align","top");e=alib.dom.createElement("td",d);c=alib.dom.createElement("textarea",e);alib.dom.styleSet(c,"height","200px");alib.dom.styleSet(c,"width","98%");c.value=b.getObjectValue("description");c.act=b;c.onchange=function(){this.act.setObjectValue("description",this.value)}};
WorkFlow_Action_Notification.prototype.wf_frm_loadUsers=function(a,b){var c=new CAjax;c.cbAssignTo=a;c.assigned_to=b;c.onload=function(a){var b=a.getNumChildren();if(b)for(i=0;i<b;i++){var c=a.getChildNode(i);if("user"==c.m_name){var g=c.getChildNodeValByName("id");c.getChildNodeValByName("title");c.getChildNodeValByName("team_name");(c=c.getChildNodeValByName("full_name"))||(c="untitled");this.cbAssignTo[this.cbAssignTo.length]=new Option(unescape(c),g,!1,this.assigned_to==g?!0:!1)}}};c.exec("/users/xml_get_users.php?fval=0")};
function WorkFlow_Action_Email(a){this.g_antObject=new CAntObject(a);this.defaultFrom=""}
WorkFlow_Action_Email.prototype.taskSendEmail=function(a,b){b.type=WF_ATYPE_SENDEMAIL;var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Send Email";var c=alib.dom.createElement("table",c),c=alib.dom.createElement("tbody",c),d=alib.dom.createElement("tr",c),e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"strong");e.innerHTML="From";e=alib.dom.createElement("td",d);d=alib.dom.createElement("input",
e);d.m_task_obj=b;d.onchange=function(){this.m_task_obj.setObjectValue("from",this.value)};e=alib.dom.createElement("select",e);e.txtFrom=d;e.cls=this;e[e.length]=new Option("Default","");e.onchange=function(){this.txtFrom.value=this.value?this.value:this.cls.defaultFrom};for(var f=0;f<this.g_antObject.getNumFields();f++){var g=this.g_antObject.getField(f);"object"==g.type&&"user"==g.subtype&&(e[e.length]=new Option(this.g_antObject.title+"."+g.title,"<%"+g.name+"%>"),e[e.length]=new Option(this.g_antObject.title+
"."+g.title+".Manager","<%"+g.name+".manager_id%>"))}(e=b.getObjectValue("from"))?this.defaultFrom=d.value=e:(e=new CAjax("json"),e.cbData.inp=d,e.cbData.cls=this,e.onload=function(a){this.cbData.inp.value=a;this.cbData.cls.defaultFrom=a},e.exec("/controller/Admin/getNoReply"));d=alib.dom.createElement("tr",c);d.vAlign="top";e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"strong");e.innerHTML="To";e=alib.dom.createElement("td",d);for(f=0;f<this.g_antObject.getNumFields();f++)if(g=this.g_antObject.getField(f),
"email"==g.subtype||"object"==g.type&&"user"==g.subtype){var d=alib.dom.createElement("div",e),h=alib.dom.createElement("input");h.type="checkbox";d.appendChild(h);h.value="<%"+g.name+"%>";h.checked=b.getObjectMultiValueExists("to","<%"+g.name+"%>")?!0:!1;h.m_task_obj=b;h.onchange=function(){this.checked?this.m_task_obj.setObjectMultiValue("to",this.value):this.m_task_obj.delObjectMultiValue("to",this.value)};d=alib.dom.createElement("span",d);d.innerHTML=" "+this.g_antObject.title+"."+g.title;"object"==
g.type&&"user"==g.subtype&&(d=alib.dom.createElement("div",e),h=alib.dom.createElement("input"),h.type="checkbox",d.appendChild(h),h.value="<%"+g.name+".manager_id%>",h.checked=b.getObjectMultiValueExists("to","<%"+g.name+".manager_id%>")?!0:!1,h.m_task_obj=b,h.onchange=function(){this.checked?this.m_task_obj.setObjectMultiValue("to",this.value):this.m_task_obj.delObjectMultiValue("to",this.value)},d=alib.dom.createElement("span",d),d.innerHTML=" "+this.g_antObject.title+"."+g.title+".Manager")}d=
alib.dom.createElement("div",e);e=alib.dom.createElement("input",d);e.value=b.getObjectValue("to_other");e.m_task_obj=b;e.onchange=function(){this.m_task_obj.setObjectValue("to_other",this.value)};d=alib.dom.createElement("span",d);d.innerHTML=" other email addresses - separate with commas";d=alib.dom.createElement("tr",c);d.vAlign="top";e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"strong");e.innerHTML="Cc";e=alib.dom.createElement("td",d);for(f=0;f<this.g_antObject.getNumFields();f++)if(g=
this.g_antObject.getField(f),"email"==g.subtype||"object"==g.type&&"user"==g.subtype)d=alib.dom.createElement("div",e),h=alib.dom.createElement("input"),h.type="checkbox",h.value="<%"+g.name+"%>",h.checked=b.getObjectMultiValueExists("cc","<%"+g.name+"%>")?!0:!1,h.m_task_obj=b,h.onchange=function(){this.checked?this.m_task_obj.setObjectMultiValue("cc",this.value):this.m_task_obj.delObjectMultiValue("cc",this.value)},d.appendChild(h),d=alib.dom.createElement("span",d),d.innerHTML=" "+this.g_antObject.title+
"."+g.title,"object"==g.type&&"user"==g.subtype&&(d=alib.dom.createElement("div",e),h=alib.dom.createElement("input"),h.type="checkbox",d.appendChild(h),h.value="<%"+g.name+".manager_id%>",h.checked=b.getObjectMultiValueExists("cc","<%"+g.name+".manager_id%>")?!0:!1,h.m_task_obj=b,h.onchange=function(){this.checked?this.m_task_obj.setObjectMultiValue("cc",this.value):this.m_task_obj.delObjectMultiValue("cc",this.value)},d=alib.dom.createElement("span",d),d.innerHTML=" "+this.g_antObject.title+"."+
g.title+".Manager");d=alib.dom.createElement("div",e);e=alib.dom.createElement("input",d);e.value=b.getObjectValue("cc_other");e.m_task_obj=b;e.onchange=function(){this.m_task_obj.setObjectValue("cc_other",this.value)};d=alib.dom.createElement("span",d);d.innerHTML=" other email addresses - separate with commas";d=alib.dom.createElement("tr",c);d.vAlign="top";e=alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"strong");e.innerHTML="Bcc";e=alib.dom.createElement("td",d);for(f=0;f<this.g_antObject.getNumFields();f++)if(g=
this.g_antObject.getField(f),"email"==g.subtype||"object"==g.type&&"user"==g.subtype)d=alib.dom.createElement("div",e),h=alib.dom.createElement("input"),h.type="checkbox",h.value="<%"+g.name+"%>",h.checked=b.getObjectMultiValueExists("bcc","<%"+g.name+"%>")?!0:!1,h.m_task_obj=b,h.onchange=function(){this.checked?this.m_task_obj.setObjectMultiValue("bcc",this.value):this.m_task_obj.delObjectMultiValue("bcc",this.value)},d.appendChild(h),d=alib.dom.createElement("span",d),d.innerHTML=" "+this.g_antObject.title+
"."+g.title,"object"==g.type&&"user"==g.subtype&&(d=alib.dom.createElement("div",e),h=alib.dom.createElement("input"),h.type="checkbox",d.appendChild(h),h.value="<%"+g.name+".manager_id%>",h.checked=b.getObjectMultiValueExists("bcc","<%"+g.name+".manager_id%>")?!0:!1,h.m_task_obj=b,h.onchange=function(){this.checked?this.m_task_obj.setObjectMultiValue("bcc",this.value):this.m_task_obj.delObjectMultiValue("bcc",this.value)},d=alib.dom.createElement("span",d),d.innerHTML=" "+this.g_antObject.title+
"."+g.title+".Manager");d=alib.dom.createElement("div",e);e=alib.dom.createElement("input",d);e.value=b.getObjectValue("bcc_other");e.m_task_obj=b;e.onchange=function(){this.m_task_obj.setObjectValue("bcc_other",this.value)};d=alib.dom.createElement("span",d);d.innerHTML=" other email addresses - separate with commas";d=alib.dom.createElement("tr",c);e=alib.dom.createElement("td",d);e.colSpan=2;c=alib.dom.createElement("input");c.checked=!b.getObjectValue("fid")?!0:!1;c.type="radio";c.name="email_compose";
c.m_task_obj=b;c.onchange=function(){document.getElementById("frmComposeNewEmail").style.display="block";document.getElementById("frmComposeTemplate").style.display="none";document.getElementById("fileNameLabel").innerHTML="No File Selected&nbsp;&nbsp;";this.m_task_obj.setObjectValue("fid","");this.m_task_obj.setObjectValue("fname","")};e.appendChild(c);d=alib.dom.createElement("span",e);d.innerHTML="Compose New Email ";c=alib.dom.createElement("input");c.type="radio";c.checked=b.getObjectValue("fid")?
!0:!1;c.name="email_compose";c.m_task_obj=b;c.onchange=function(){document.getElementById("frmComposeNewEmail").style.display="none";document.getElementById("frmComposeTemplate").style.display="block"};e.appendChild(c);d=alib.dom.createElement("span",e);d.innerHTML="Use Email Template ";c=alib.dom.createElement("div",e);c.id="frmComposeNewEmail";alib.dom.styleSet(c,"margin","10px 0 0 10px");d=alib.dom.createElement("div",c);alib.dom.styleSet(c,"display",b.getObjectValue("fid")?"none":"block");alib.dom.styleSetClass(d,
"strong");d.innerHTML="Subject";alib.dom.styleSet(d,"text-align","left");d=alib.dom.createElement("div",c);d=alib.dom.createElement("input",d);d.value=b.getObjectValue("subject");d.m_task_obj=b;d.onchange=function(){this.m_task_obj.setObjectValue("subject",this.value)};d=alib.dom.createElement("div",c);alib.dom.styleSetClass(d,"strong");d.innerHTML="Body ";f=alib.dom.createElement("a",d,"Insert Merge Field");f.href="javascript:void(0);";alib.dom.styleSet(d,"text-align","left");d=alib.dom.createElement("div",
c);c=alib.dom.createElement("textarea",d);alib.dom.styleSet(c,"height","200px");alib.dom.styleSet(c,"width","98%");c.value=b.getObjectValue("body");c.m_task_obj=b;c.onchange=function(){this.m_task_obj.setObjectValue("body",this.value)};(new WorkFlow_Selector_MergeField(this.g_antObject)).attach(f,c);c=alib.dom.createElement("div",e);alib.dom.styleSet(c,"margin","10px 0 0 10px");c.id="frmComposeTemplate";alib.dom.styleSet(c,"display",b.getObjectValue("fid")?"block":"none");d=alib.dom.createElement("span",
c);alib.dom.styleSetClass(d,"strong");d.id="fileNameLabel";d.innerHTML=b.getObjectValue("fname")?b.getObjectValue("fname"):"No File Selected&nbsp;&nbsp;";(new CButton("Select Template",function(a,b,c){var d=new AntObjectBrowser("html_template");d.cbData.cls=b;d.cbData.task_obj=c;d.cbData.lbl=a;d.onSelect=function(a,b){this.cbData.lbl.innerHTML=b+"&nbsp;&nbsp;";this.cbData.task_obj.setObjectValue("fid",a);this.cbData.task_obj.setObjectValue("fname",b)};d.displaySelect()},[d,this,b],"b1")).print(c)};
function WorkFlow_Action_Approval(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_Approval.prototype.print=function(a,b){var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");alib.dom.createElement("legend",c).innerHTML="Request Approval";var c=alib.dom.createElement("table",c),c=alib.dom.createElement("tbody",c),d=alib.dom.createElement("tr",c),e=alib.dom.createElement("td",d);e.innerHTML="Request Approval From: ";e=alib.dom.createElement("td",d);c=alib.dom.createElement("input",e);c.act=b;c.value=b.getObjectValue("owner_id");
c.onchange=function(){this.act.setObjectValue("owner_id",this.value)};e=alib.dom.createElement("td",d);d=alib.dom.createElement("span",e);e=new WorkFlow_Selector_User(this.mainObject);e.setParentDialog(this.dialog);e.print(d,c)};function WorkFlow_Action_CallPage(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_CallPage.prototype.print=function(a,b){var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");alib.dom.createElement("legend",c).innerHTML="Call Page";var c=alib.dom.createElement("table",c),c=alib.dom.createElement("tbody",c),d={};d.url=alib.dom.setElementAttr(alib.dom.createElement("input"),[["type","text"],["value",b.getObjectValue("url")],["label","Url:"],["width","500px"]]);buildFormInput(d,c);d.url.act=b;d.url.onchange=function(){this.act.setObjectValue("url",
this.value)}};function WorkFlow_Action_AssignRR(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_AssignRR.prototype.print=function(a,b){var c=alib.dom.createElement("div",a);c.innerHTML="Set: ";var c=alib.dom.createElement("select",c),d=new CAntObject(b.workflow.object_type);c.m_taskObj=b;c.m_ant_obj=d;c.onchange=function(){this.m_taskObj.update_field=this.value};for(var d=d.getFields(),e=0;e<d.length;e++)if("object"==d[e].type&&"user"==d[e].subtype&&(c[c.length]=new Option(d[e].title,d[e].name,!1,b.update_field==d[e].name?!0:!1),d[e].subtype))for(var f=new CAntObject(d[e].subtype),
g=f.getFields(),h=0;h<g.length;h++){var k=d[e].name+"."+f.name+"."+g[h].name;c[c.length]=new Option(d[e].title+"."+g[h].title,k,!1,b.update_field==k?!0:!1)}c=alib.dom.createElement("div",a);c.innerHTML="Assign to (enter users names separated by a comma ',': ";c=alib.dom.createElement("div",a);c=alib.dom.createElement("textarea",c);alib.dom.styleSet(c,"width","100%");c.value=b.getObjectValue("update_to");c.act=b;c.onchange=function(){this.act.setObjectValue("update_to",this.value)}};
function WorkFlow_Action_Update(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_Update.prototype.print=function(a,b){var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Update Field";d=alib.dom.createElement("div",c);d.innerHTML="Change: ";var e=alib.dom.createElement("select",d),d=alib.dom.createElement("div",c);d.innerHTML="To: ";c=alib.dom.createElement("span",d);d=new CAntObject(b.workflow.object_type);e.m_taskObj=b;e.m_inp_con=c;e.m_ant_obj=d;e.onchange=function(){if(-1!=
this.value.indexOf(".")){var a=this.value.split(".");3==a.length&&(this.m_taskObj.frm_changeto=(new CAntObject(a[1])).fieldCreateValueInput(this.m_inp_con,a[2]))}else this.m_taskObj.frm_changeto=this.m_ant_obj.fieldCreateValueInput(this.m_inp_con,this.value);this.m_taskObj.update_field=this.value};for(var f=d.getFields(),g=0;g<f.length;g++)if(e[e.length]=new Option(f[g].title,f[g].name,!1,b.update_field==f[g].name?!0:!1),"object"==f[g].type)if(f[g].subtype)for(var h=new CAntObject(f[g].subtype),k=
h.getFields(),l=0;l<k.length;l++){var m=f[g].name+"."+h.name+"."+k[l].name;e[e.length]=new Option(f[g].title+"."+k[l].title,m,!1,b.update_field==m?!0:!1)}else for(var n=0;n<this.g_objTypes.length;n++)if(this.g_objTypes[n][0]!=d.name){h=new CAntObject(this.g_objTypes[n][0]);k=h.getFields();for(l=0;l<k.length;l++)m=f[g].name+"."+h.name+"."+k[l].name,e[e.length]=new Option(f[g].title+"."+h.title+"."+k[l].title,m,!1,b.update_field==m?!0:!1)}b.frm_changeto=d.fieldCreateValueInput(c,b.update_field?b.update_field:
f[0].name,b.getObjectValue("update_to"));b.frm_changeto.act=b;b.frm_changeto.onchange=function(){this.act.setObjectValue("update_to",this.value)}};function WorkFlow_Action_WaitCondition(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_WaitCondition.prototype.print=function(a,b){var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Wait Condition";c=alib.dom.createElement("table",c);c=alib.dom.createElement("tbody",c);d=alib.dom.createElement("tr",c);c=alib.dom.createElement("td",d);alib.dom.styleSetClass(c,"strong");c.innerHTML="When";c=alib.dom.createElement("td",d);d=alib.dom.createElement("input",c);alib.dom.styleSet(d,
"width","28px");d.act=b;d.value=b.when.interval;d.onchange=function(){this.act.when.interval=this.value};d=alib.dom.createElement("span",c);d.innerHTML="&nbsp;";for(var d=alib.dom.createElement("select",c),e=wfGetTimeUnits(),f=0;f<e.length;f++)d[d.length]=new Option(e[f][1],e[f][0],!1,b.when.unit==e[f][0]?!0:!1);d.act=b;d.onchange=function(){this.act.when.unit=this.value};d=alib.dom.createElement("span",c);d.innerHTML=" after workflow starts (enter 0 for immediate)"};
function WorkFlow_Action_CheckCondition(a,b){this.mainObject=new CAntObject(a);this.dialog=b?b:null}
WorkFlow_Action_CheckCondition.prototype.print=function(a,b){var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Check Condition";d=alib.dom.createElement("table",c);c=alib.dom.createElement("tbody",d);d=alib.dom.createElement("tr",c);d=alib.dom.createElement("td",d);d.colSpan=2;alib.dom.styleSetClass(d,"strong");d.innerHTML="Only execute action if the following conditions are met:";d=alib.dom.createElement("tr",
c);d=alib.dom.createElement("td",d);d.colSpan=2;d=alib.dom.createElement("div",d);c=new CAntObject(b.workflow.object_type);b.antConditionsObj=c.buildAdvancedQuery(d,b.conditions)};function WorkFlow_ActionsGrid(a,b){this.workflow=a;this.parentAction=b?b:null;this.parentDlg=this.gridCon=this.parentActionEvent=null}
WorkFlow_ActionsGrid.prototype.print=function(a){this.gridCon=alib.dom.createElement("div",a);a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"padding","3px");a=alib.dom.createElement("a",a,null==this.parentAction?"Add Action":"Add Sub-Action");a.href="javascript:void(0);";var b=new alib.ui.PopupMenu,c=new alib.ui.MenuItem("Send Email",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_SENDEMAIL)};b.addItem(c);c=new alib.ui.MenuItem("Send Notification",{cls:this});c.onclick=
function(){this.options.cls.newAction(WF_ATYPE_CREATEOBJ,"notification")};b.addItem(c);c=new alib.ui.MenuItem("Create Task",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_CREATEOBJ,"task")};b.addItem(c);c=new alib.ui.MenuItem("Create Invoice",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_CREATEOBJ,"invoice")};b.addItem(c);c=new alib.ui.MenuItem("Update Field",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_UPDATEFLD)};b.addItem(c);
c=new alib.ui.MenuItem("Start Child Workflow",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_STARTCHLD)};b.addItem(c);c=new alib.ui.MenuItem("Request Approval",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_APPROVAL)};b.addItem(c);c=new alib.ui.MenuItem("Call Page",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_CALLPAGE)};b.addItem(c);c=new alib.ui.MenuItem("Assign Round Robin",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_ASSIGNRR)};
b.addItem(c);c=new alib.ui.MenuItem("Wait Condition",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_WAITCONDITION)};b.addItem(c);c=new alib.ui.MenuItem("Check Condition",{cls:this});c.onclick=function(){this.options.cls.newAction(WF_ATYPE_CHECKCONDITION)};b.addItem(c);b.attach(a);this.loadActions()};
WorkFlow_ActionsGrid.prototype.loadActions=function(){if(this.parentAction)for(var a=0;a<this.parentAction.childActions.length;a++){var b=!0;this.parentActionEvent?this.parentActionEvent!=this.parentAction.childActions[a].parentActionEvent&&(b=!1):this.parentAction.childActions[a].parentActionEvent&&(b=!1);b&&this.insertActionRow(this.parentAction.childActions[a])}else if(this.workflow)for(a=0;a<this.workflow.actions.length;a++)this.insertActionRow(this.workflow.actions[a])};
WorkFlow_ActionsGrid.prototype.newAction=function(a,b){if(this.parentAction)var c=this.parentAction.addAction(a);else if(this.workflow)c=this.workflow.addAction(a);else return!1;b&&(c.create_obj=b);this.parentActionEvent&&(c.parentActionEvent=this.parentActionEvent);c.cbData.actGrid=this;c.onupdate=function(){this.cbData.actGrid.insertActionRow(this)};c.showDialog(this.parentDlg)};
WorkFlow_ActionsGrid.prototype.editAction=function(a,b){a.showDialog(this.parentDlg);a.cbData.descCon=b;a.onupdate=function(){this.cbData.descCon.innerHTML=this.getSummary()}};
WorkFlow_ActionsGrid.prototype.insertActionRow=function(a){var b=alib.dom.createElement("div",this.gridCon);alib.dom.styleSet(b,"margin-bottom","5px");alib.dom.styleSet(b,"padding","3px 0 3px 3px");alib.dom.styleSet(b,"border-bottom","1px solid #ccc");b.myAct=a;var c=alib.dom.createElement("img",b);c.src="/images/icons/tri.png";alib.dom.styleSet(c,"margin-right","3px");c=alib.dom.createElement("span",b);c.innerHTML=a.getSummary();alib.dom.styleSet(c,"cursor","pointer");alib.dom.styleSet(c,"padding-right",
"10px");alib.dom.styleSetClass(c,"strong");c.act=a;c.wfagcls=this;c.onclick=function(){this.wfagcls.editAction(this.act,this)};c=alib.dom.createElement("a",b);c.innerHTML="<img src='/images/icons/delete_10.png' />";c.href="javascript:void(0);";c.wfagcls=this;c.act=a;c.actCon=b;c.onclick=function(){this.wfagcls.removeAction(this.act,this.actCon)};for(var c=a.getSubActionEvents(),d=0;d<c.length;d++){var e=alib.dom.createElement("div",b);alib.dom.styleSet(e,"padding-left","15px");var f=alib.dom.createElement("div",
e);f.innerHTML=c[d].description;alib.dom.styleSetClass(f,"italic");f=new WorkFlow_ActionsGrid(this.workflow,a);f.parentActionEvent=c[d].name;f.print(e)}};WorkFlow_ActionsGrid.prototype.removeAction=function(a,b){this.parentAction?this.parentAction.removeAction(a):this.workflow?this.workflow.removeAction(a):a.remove();this.gridCon.removeChild(b)};
function AntViewsRouter(){this.defaultView=this.lastLoaded=this.cloneId="";this.options={};var a=this;this.interval=window.setInterval(function(){a.checkNav()},50)}AntViewsRouter.prototype.checkNav=function(){var a="";document.location.hash&&(a=document.location.hash.substring(1));""==a&&""!=this.defaultView&&(a=this.defaultView);""!=a&&a!=this.lastLoaded&&(this.lastLoaded=a,this.onchange(a))};AntViewsRouter.prototype.onchange=function(){};
function AntViewManager(){this.currViewName=this.path="";this.views=[];this.isMobile=this.pageViewSingle=this.pageView=!1}
AntViewManager.prototype.addView=function(a,b,c,d){for(var e=d?d:null,c=c?c:null,f=0;f<this.views.length;f++)if(this.views[f].nameMatch(a))return this.views[f];var g=new AntView(a,this,e);g.options=b;c?g.conOuter=c:d&&d.conOuter&&(g.conOuter=d.conOuter);this.isMobile?(b=document.getElementById(g.getPath()+"_con"),b||(a=g.getPath(),b=alib.dom.createElement("div",document.getElementById("main")),b.style.display="none",b.style.position="absolute",b.style.top="0px",b.style.width="100%",b.id=a,d=alib.dom.createElement("div",
b),alib.dom.styleSetClass(d,"header"),e=alib.dom.createElement("button",d),alib.dom.styleSetClass(e,"right"),g.hasback()&&(e=alib.dom.createElement("button",d,"Back"),alib.dom.styleSetClass(e,"left arrow"),e.view=g,e.onclick=function(){g.goup()}),e=alib.dom.createElement("h1",d),"undefined"!=typeof Ant&&(e.innerHTML=g.getTitle()),d=alib.dom.createElement("div",d),b=alib.dom.createElement("div",b),b.id=a+"_con",alib.dom.styleSetClass(b,"viewBody"),g.conAppTitle=d),g.con=b):(g.con=g.conOuter?alib.dom.createElement("div",
g.conOuter):null,g.con&&(g.con.style.display="none"));return this.views[this.views.length]=g};AntViewManager.prototype.resizeActiveView=function(){if(this.currViewName){var a=this.getView(this.currViewName);a&&a.resize()}};
AntViewManager.prototype.load=function(a){this.path=a;var b="";if(-1!=this.path.indexOf("/")){if(a=this.path.split("/"),this.currViewName=a[0],1<a.length)for(var c=1;c<a.length;c++)""!=b&&(b+="/"),b+=a[c]}else this.currViewName=a;c="";a=this.currViewName.split(":");1<a.length&&(this.currViewName=a[0],c=a[1]);return this.loadView(this.currViewName,c,b)};AntViewManager.prototype.onload=function(){};
AntViewManager.prototype.getView=function(a){for(var b=0;b<this.views.length;b++)if(this.views[b].name==a)return this.views[b];return null};
AntViewManager.prototype.loadView=function(a,b,c){var d=!1;c||(c="");for(var e=0;e<this.views.length;e++)this.views[e].name==a?(this.views[e].variable=b,d=!0,this.pageViewSingle&&this.views[e].parentView&&this.views[e].parentView.hide(),""!=c?(!1==this.views[e].isRendered&&(this.views[e].render(),this.views[e].isRendered=!0),this.pageViewSingle||this.views[e].show(),this.views[e].load(c)):(this.views[e].show(),this.views[e].hideChildren()),this.views[e].triggerEvents("load")):this.pageView&&(this.views[e].hide(),
this.views[e].hideChildren());return d};AntViewManager.prototype.setViewsToggle=function(a){this.pageView=a};AntViewManager.prototype.setViewsSingle=function(a){this.pageViewSingle=a};AntViewManager.prototype.getActiveViews=function(){var a=[],b;for(b in this.views)this.views[b].isActive()&&a.push(this.views[b]);return a};
function AntView(a,b,c){this.boundEvents=[];this.parentViewManager=b;this.viewManager=null;this.parentView=c?c:null;this.activeChildView=null;this.isRendered=this.isActive=!1;this.options={};this.conChildren=this.con=this.conOuter=null;this.defaultView=this.title=this.pathRelative=this.variable="";this.setOnTitleChange=[];this.fromClone=!1;this.name=a.split(":")[0]}AntView.prototype.on=function(a,b,c){this.boundEvents[this.boundEvents.length]={cb:b,opts:c,name:a}};
AntView.prototype.bindOnViewLoad=function(a,b){this.on("load",a,b)};AntView.prototype.triggerEvents=function(a){for(var b=0;b<this.boundEvents.length;b++)this.boundEvents[b].name==a&&("load"==a?this.boundEvents[b].cb(this.boundEvents[b].opts,this.pathRelative):this.boundEvents[b].cb(this.boundEvents[b].opts))};AntView.prototype.setDefaultView=function(a){this.defaultView=a};AntView.prototype.resize=function(a){a&&this.viewManager.resizeActiveView();this.onresize()};
AntView.prototype.show=function(){this.isRendered||(this.isRendered=!0,this.render());this.con&&alib.dom.styleSet(this.con,"display","block");if(this.parentViewManager.isMobile){var a=window.avChangePageback?!0:!1;changePage(this.getPath(!0),a);window.avChangePageback=!1}this.defaultView&&!this.hasChildrenVisible()&&this.navigate(this.defaultView);this.triggerEvents("show");this.onshow();this.onresize();this.isActive=!0};
AntView.prototype.hide=function(){if(!this.isActive)return!1;this.con&&(this.con.style.display="none");this.isActive=!1;this.isRendered&&(this.triggerEvents("hide"),this.onhide())};AntView.prototype.addView=function(a,b,c){c=c?c:null;null==this.viewManager&&(this.viewManager=new AntViewManager,this.parentViewManager&&(this.viewManager.isMobile=this.parentViewManager.isMobile));return this.viewManager.addView(a,b,c,this)};
AntView.prototype.getView=function(a){return this.viewManager?this.viewManager.getView(a):null};AntView.prototype.setViewsToggle=function(a){null==this.viewManager&&(this.viewManager=new AntViewManager,this.parentViewManager&&(this.viewManager.isMobile=this.parentViewManager.isMobile));this.viewManager.setViewsToggle(a)};
AntView.prototype.setViewsSingle=function(a){null==this.viewManager&&(this.viewManager=new AntViewManager,this.parentViewManager&&(this.viewManager.isMobile=this.parentViewManager.isMobile));this.viewManager.setViewsSingle(a)};AntView.prototype.getParentView=function(){return this.parentView?this.parentView:!1};AntView.prototype.getPath=function(a){var b=this.name;this.variable&&!1==("undefined"!=typeof a?a:!1)&&(b+=":"+this.variable);return this.parentView?this.parentView.getPath()+"/"+b:b};
AntView.prototype.getTitle=function(a){if(this.title)var b=this.title;else b=this.name.replace("-"," "),b=this.name.replace("_"," "),b=b.replace(/^([a-z])|\s+([a-z])/g,function(a){return a.toUpperCase()});if("undefined"!=typeof a)a.innerHTML=b,this.setOnTitleChange[this.setOnTitleChange.length]=a;else return b};AntView.prototype.setTitle=function(a){this.title=a;for(var b=0;b<this.setOnTitleChange.length;b++)try{this.setOnTitleChange[b].innerHTML=a}catch(c){}};
AntView.prototype.nameMatch=function(a){if("undefined"==typeof a)throw"No view name was passed to AntView::nameMatch for "+this.getPath();a=a.split(":")[0];return a==this.name?!0:!1};AntView.prototype.navigate=function(a){document.location.hash="#"+this.getPath()+"/"+a};AntView.prototype.hasback=function(){var a=!1;-1!=this.getPath().indexOf("/")&&1<history.length&&(a=!0);return a};
AntView.prototype.goup=function(){this.parentView?document.location.hash="#"+this.parentView.getPath():history.go(-1);window.avChangePageback=!0};AntView.prototype.hasChildrenVisible=function(){return document.location.hash=="#"+this.getPath()||""==document.location.hash?!1:!0};AntView.prototype.goback=function(){history.go(-1);window.avChangePageback=!0};
AntView.prototype.load=function(a){this.pathRelative=a;null!=this.viewManager?this.viewManager.load(a)||(this.m_tmpLoadPath=a):this.m_tmpLoadPath=a};AntView.prototype.setViewsLoaded=function(){this.m_tmpLoadPath&&(this.load(this.m_tmpLoadPath),this.m_tmpLoadPath="");this.defaultView&&!this.hasChildrenVisible()&&this.navigate(this.defaultView);this.triggerEvents("load")};
AntView.prototype.hideChildren=function(){if(this.viewManager)for(var a=0;a<this.viewManager.views.length;a++)this.viewManager.views[a].hide(),this.viewManager.views[a].hideChildren();this.pathRelative=""};AntView.prototype.getHashObjectId=function(a){if(this.name==a)return this.variable;if(this.parentView)var b=this.parentView.getHashObjectId(a);return b?b:!1};AntView.prototype.render=function(){};AntView.prototype.onshow=function(){};AntView.prototype.onhide=function(){};
AntView.prototype.onresize=function(){};
AntObjectForms={loadedForms:[],loadForm:function(a,b,c,d){var d=d||"default",c=c||{},e;for(e in this.loadedForms)if(this.loadedForms[e].objType==a&&this.loadedForms[e].scope==d)return this.loaded(b,c,this.loadedForms[e].xml);e=new CAjax("xml");e.cbData.cls=this;e.cbData.callback=b;e.cbData.callbackData=c;e.cbData.objType=a;e.cbData.scope=d;e.onload=function(a){this.cbData.cls.loadedForms.push({objType:this.cbData.objType,scope:this.cbData.scope,xml:a});this.cbData.cls.loaded(this.cbData.callback,this.cbData.callbackData,
a)};e.exec("/controller/Object/getFormUIML",[["obj_type",a],["scope",d]])},getFormXml:function(a,b){var b=b||"default",c;for(c in this.loadedForms)if(this.loadedForms[c].objType==a&&this.loadedForms[c].scope==b)return this.loadedForms[c].xml;c=(new CAjax("xml")).exec("/controller/Object/getFormUIML",[["obj_type",a],["scope",b]],!1);this.cbData.cls.loadedForms.push({objType:a,scope:b,xml:c});return c},loaded:function(a,b,c){if("function"==typeof a)a(c,b);else if(a.context&&a.method)a.context[a.method](c,
b);return!0},clearCache:function(a){for(var b in this.loadedForms)this.loadedForms[b].objType==a&&(this.loadedForms.splice(b,1),this.clearCache(a))}};var CAntObjectDefs=[];
function CAntObject(a,b){this.titlePl=this.title=a;this.label="";this.obj_type=this.name=a;this.id=b?b:null;this.loaded=!1;this.nameField="id";this.repressOnSave=this.dirty=!1;this.cbProps={};this.associations=[];this.fields=[];this.values=[];this.views=[];this.m_filters=[];this.teamFormLayouts=[];this.addfields=[];this.removefields=[];this.propertyFormOrder=[];this.security={};this.security.view=!0;this.security.edit=!0;this.security.del=!0;this.security.childObjects=[];this.showper=0;this.browserMode=
"table";this.browserBlankStateMsg="";this.cbData={};this.recurRules=this.recurrencePattern=null;this.loadQuerySubObjects=!0;this.iconName=this.newWindowArgs=null;this.def=Ant.EntityDefinitionLoader.get(a);this.title=this.def.title;this.titlePl="y"==this.title.charAt(this.title.length-1)?this.title.substr(0,this.title.length-1)+"ies":"s"!=this.title.charAt(this.title.length-1)?this.title+"s":this.title;this.nameField=this.def.listTitle;this.views=this.def.getViews();this.def.browserMode&&(this.browserMode=
this.def.browserMode);this.def.recurRules&&(this.recurRules={},this.recurRules.fieldTimeStart=this.def.recurRules.field_time_start,this.recurRules.fieldTimeEnd=this.def.recurRules.field_time_end,this.recurRules.fieldDateStart=this.def.recurRules.field_date_start,this.recurRules.fieldDateEnd=this.def.recurRules.field_date_end,this.recurRules.fieldRecurId=this.def.recurRules.field_recur_id);var c=this.def.getFields(),d;for(d in c){var e=c[d],f={optional_vals:[],name:e.name,title:e.title,type:e.type,
subtype:e.subtype,useWhen:e.useWhen,iconName:"",default_value:e.getDefault("null"),readonly:e.readonly,required:e.required,system:e.system,tabnum:0,fieldsetnum:0};if(e.optionalValues)for(var g in e.optionalValues)f.optional_vals[f.optional_vals.length]=[g,e.optionalValues[g],!1,!1];this.fields[this.fields.length]=f}this.condition=new CAntObjectCond;c="";e=this.obj_type.split("_");for(d=0;d<e.length;d++)c+=e[d].charAt(0).toUpperCase()+e[d].substr(1);c="CAntObject_"+c;if("undefined"!=typeof c){d=null;
try{d=eval(c)}catch(h){}null!=d&&d(this)}}
CAntObject.prototype.load=function(a){a="undefined"!=typeof a?a:this.id;if(null!=a){var b=new CAjax("json");b.m_obj=this;b.onload=function(a){if(a){this.m_obj.id=a.id;a.security&&(this.m_obj.security.view=a.security.view,this.m_obj.security.edit=a.security.view,this.m_obj.security.del=a.security.view);a.iconName&&(this.m_obj.iconName=a.iconName);for(var b=0;b<this.m_obj.fields.length;b++){var e=this.m_obj.fields[b];if(!(this.m_obj.newWindowArgs&&"undefined"==typeof this.m_obj.newWindowArgs[e.name]))if("fkey_multi"==
e.type||"object_multi"==e.type){if(this.m_obj.newWindowArgs)for(var f=unescape_utf8(this.m_obj.newWindowArgs[e.name][0]).split(","),g=unescape_utf8(this.m_obj.newWindowArgs[e.name+"Multi"][0]).split(","),h=0;h<f.length;h++){if(f[h].length){this.m_obj.setMultiValue(e.name,f[h],g[h]);for(var k=!1,l=0;l<e.optional_vals;l++)e.optional_vals[l][0]==f[h]&&(k=!0);k||(k=e.optional_vals.length,e.optional_vals[k]=[],e.optional_vals[k][0]=f[h],e.optional_vals[k][1]=unescape(g[h]))}}else if(a[e.name+"_fval"])for(var m in a[e.name+
"_fval"])this.m_obj.setMultiValue(e.name,m,a[e.name+"_fval"][m]);(e=document.getElementById("divBlankState"))&&e.parentNode.removeChild(e)}else if("fkey"==e.type||"object"==e.type)if(this.m_obj.newWindowArgs)this.m_obj.setValue(e.name,this.m_obj.newWindowArgs[e.name][0],unescape_utf8(this.m_obj.newWindowArgs[e.name+"Fkey"][0]));else{if(a[e.name+"_fval"])for(m in a[e.name+"_fval"])this.m_obj.setValue(e.name,m,a[e.name+"_fval"][m])}else"bool"==e.type?(this.m_obj.newWindowArgs?(f=this.m_obj.newWindowArgs[e.name][0],
"t"==f?f=!0:"f"==f&&(f=!1),this.m_obj.setValue(e.name,f)):this.m_obj.setValue(e.name,"t"==a[e.name]?!0:!1),"f_readonly"==e.name&&"t"==a[e.name]&&(this.m_obj.security.edit=!1)):this.m_obj.newWindowArgs?this.m_obj.setValue(e.name,unescape_utf8(this.m_obj.newWindowArgs[e.name][0])):this.m_obj.setValue(e.name,a[e.name])}}if(null!=this.m_obj.recurRules)if(this.m_obj.getValue(this.m_obj.recurRules.fieldRecurId))a=this.m_obj.getRecurrencePattern(!0),a.objcls=this.m_obj,a.onload=function(){this.objcls.onload()},
a.load(this.m_obj.getValue(this.m_obj.recurRules.fieldRecurId));else this.m_obj.onload();else this.m_obj.onload();this.m_obj.loaded=!0;this.m_obj.dirty=!1};b.exec("/svr/entity/get?obj_type="+this.name+"&id="+a)}};
CAntObject.prototype.setData=function(a){a.id&&(this.id=a.id);for(var b=0;b<this.fields.length;b++){var c=this.fields[b];if("undefined"!=typeof a[c.name]){var d=a[c.name];if("fkey_multi"==c.type||"object_multi"==c.type){if(d)for(var e=0;e<d.length;e++)if(d[e].key){this.setMultiValue(c.name,d[e].key,d[e].value);for(var f=!1,g=0;g<c.optional_vals;g++)c.optional_vals[g][0]==d[e].key&&(f=!0);f||(f=c.optional_vals.length,c.optional_vals[f]=[],c.optional_vals[f][0]=d[e].key,c.optional_vals[f][1]=d[e].value)}}else"fkey"==
c.type||"object"==c.type?this.setValue(c.name,d.key,d.value):"bool"==c.type&&"string"===typeof d?this.setValue(c.name,"t"==d?!0:!1):this.setValue(c.name,d)}}this.loaded=!0;this.dirty=!1};
CAntObject.prototype.getData=function(a){a={};a.id&&(a.id=this.id);for(var b=0;b<this.fields.length;b++){var c=this.fields[b];if("fkey_multi"==c.type||"object_multi"==c.type){var d=this.getMultiValues(c.name);if(d){a[c.name]=[];for(var e=0;e<d.length;e++){var f=d[0],g=this.getValueName(c.name,f);a[c.name][a[c.name].length]={key:f,value:g}}}}else a[c.name]="fkey"==c.type||"object"==c.type||"alias"==c.type?{key:this.getValue(c.name),value:this.getValueName(c.name)}:this.getValue(c.name)}a.security=
{};a.security.view=this.security.view;a.security.edit=this.security.edit;a.security["delete"]=this.security.del;a.iconName=this.iconName;a.iconPath=this.getIcon(16,16);this.loaded=!0;this.dirty=!1;return a};CAntObject.prototype.onload=function(){};CAntObject.prototype.getCachedObjDef=function(a){for(var b=0;b<CAntObjectDefs.length;b++)if(CAntObjectDefs[b].name==a)return b;return-1};
CAntObject.prototype.getName=function(){return this.getValue("name")?this.getValue("name"):this.getValue("title")?this.getValue("title"):this.getValue("subject")?this.getValue("subject"):this.getValue("id")?this.getValue("id"):""};CAntObject.prototype.getLabel=function(){return this.getName()};
CAntObject.prototype.getFields=function(){for(var a=[],b=0;b<this.fields.length;b++)if(this.fields[b].useWhen){var c=this.fields[b].useWhen.split(":");this.getValue(c[0])==c[1]&&(a[a.length]=this.fields[b])}else a[a.length]=this.fields[b];return a};
CAntObject.prototype.getFieldByName=function(a){if(-1!=a.indexOf(".")){if(a=a.split("."),2==a.length){var b=this.getFieldByName(a[0]);if(b&&"object"==b.type&&b.subtype)return(new CAntObject(b.subtype)).getFieldByName(a[1])}}else for(b=0;b<this.fields.length;b++)if(this.fields[b].name==a)return this.fields[b];return null};CAntObject.prototype.getField=function(a){return this.fields[a]};CAntObject.prototype.getNumFields=function(){return this.fields.length};
CAntObject.prototype.buildAdvancedQuery=function(a,b,c){c=c?c:{};this.dv_querygroups=alib.dom.createElement("div",a);var d=alib.dom.createElement("div",this.dv_querygroups);this.tblQuery=new CToolTable;this.tblQuery.print(d);b&&b.length&&this.queryLoadSaved(b,c);a=alib.dom.createElement("div",a);a=alib.dom.createElement("a",a);a.cls=this;a.onclick=function(){this.cls.addQueryRow()};a.innerHTML="Add Condition";a.href="javascript:void(0);";return this.condition};
CAntObject.prototype.queryLoadSaved=function(a,b){var c=b?b:{};this.condition.clearConditions();for(var d=0;d<a.length;d++){var e=0==d?!0:!1,f=this.getFieldByName(a[d].fieldName);"object"==f.type&&f.subtype&&this.setValue(a[d].fieldName,a[d].condValue);this.addQueryRow(e,a[d].blogic,a[d].fieldName,a[d].operator,a[d].condValue,c,a[d].id)}};
CAntObject.prototype.addQueryRow=function(a,b,c,d,e,f,g){var a=f?f:{},f=this.tblQuery.addRow(),h=alib.dom.createElement("select");h[h.length]=new Option("And","and",!1,"and"==b?!0:!1);h[h.length]=new Option("Or","or",!1,"or"==b?!0:!1);f.addCell(h,!1,"center","50px");for(var b=alib.dom.createElement("select"),k=alib.dom.createElement("div"),l=alib.dom.createElement("select"),m=0;m<this.fields.length;m++)if(l[l.length]=new Option(this.fields[m].title,this.fields[m].name,!1,c==this.fields[m].name?!0:
!1),"object"==this.fields[m].type&&this.fields[m].subtype&&this.loadQuerySubObjects)for(var n=new CAntObject(this.fields[m].subtype),o=0;o<n.fields.length;o++)l[l.length]=new Option(this.fields[m].title+"."+n.fields[o].title,this.fields[m].name+"."+n.fields[o].name,!1,c==this.fields[m].name+"."+n.fields[o].name?!0:!1);l.m_cond_cb=b;l.m_dv_val=k;l.m_cls=this;l.opts=a;l.onchange=function(){this.m_cls.queryGetCondCombo(this.m_cond_cb,this.value);this.m_cls.querySetValueInput(this.m_dv_val,this.value,
null,this.opts)};this.queryGetCondCombo(b,l.value);g=this.condition.addWatchCondition(h,l,b,g);k.cid=g;this.querySetValueInput(k,l.value,null,a);f.addCell(l);f.addCell(b);f.addCell(k);h=alib.dom.createElement("div");f.addCell(h,!0,"center");h.innerHTML="<img border='0' src='"+("undefined"==typeof Ant?"/images/icons/deleteTask.gif":"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif")+"' />";alib.dom.styleSet(h,"cursor","pointer");h.m_rw=f;h.m_condition=this.condition;h.m_cid=g;h.onclick=function(){this.m_condition.delCondition(this.m_cid);
this.m_rw.deleteRow()};if(c)for(m=0;m<l.options.length;m++)l.options[m].value==c&&(l.selectedIndex=m,this.queryGetCondCombo(b,c),this.querySetValueInput(k,c,e,a));if(d){b.m_cond.operator=d;for(m=0;m<b.options.length;m++)b.options[m].value==d&&(b.selectedIndex=m)}if(e){if("select"==k.inptType)for(m=0;m<k.inpRef.options.length;m++)k.inpRef.options[m].value==e&&(k.inpRef.selectedIndex=m);if("dynselect"==k.inptType)k.dynSel.onSelect(e);else"rte"==k.inptType?k.inpRef.setValue(e):k.inpRef&&(k.inpRef.value=
e)}};CAntObject.prototype.queryGetCondCombo=function(a,b){for(var c=a.options.length-1;0<=c;c--)a.options[c]=null;for(var c=this.getCondOperators(this.getFieldByName(b).type),d=0;d<c.length;d++)a.options[a.options.length]=new Option(c[d][1],c[d][0]);a.selectedIndex=0;a.m_cond&&(a.m_cond.operator=a.value)};
CAntObject.prototype.getCondOperators=function(a){switch(a){case "fkey_multi":case "fkey":a=[["is_equal","is equal to"],["is_not_equal","is not equal to"]];break;case "number":case "real":case "integer":a=[["is_equal","is equal to"],["is_not_equal","is not equal to"],["is_greater","is greater than"],["is_less","is less than"],["is_greater_or_equal","is greater than or equal to"],["is_less_or_equal","is less than or equal to"],["begins_with","begins with"]];break;case "date":case "timestamp":a=[["is_equal",
"is equal to"],["is_not_equal","is not equal to"],["is_greater","is greater than"],["is_less","is less than"],["day_is_equal","day is equal to"],["month_is_equal","month is equal to"],["year_is_equal","year is equal to"],["is_greater_or_equal","is greater than or equal to"],["is_less_or_equal","is less than or equal to"],["last_x_days","within last (x) days"],["last_x_weeks","within last (x) weeks"],["last_x_months","within last (x) months"],["last_x_years","within last (x) years"],["next_x_days",
"within next (x) days"],["next_x_weeks","within next (x) weeks"],["next_x_months","within next (x) months"],["next_x_years","within next (x) years"]];break;case "bool":a=[["is_equal","is equal to"],["is_not_equal","is not equal to"]];break;default:a=[["is_equal","is equal to"],["is_not_equal","is not equal to"],["begins_with","begins with"],["contains","contains"]]}return a};
CAntObject.prototype.querySetValueInput=function(a,b,c,d){d=d?d:{};a.innerHTML="";var e=this.getFieldByName(b),f=this.name;if(-1!=b.indexOf(".")&&(b=b.split("."),2==b.length&&(b=this.getFieldByName(b[0]))))f=b.subtype;if("fkey"==e.type||"fkey_multi"==e.type){d=new AntObjectGroupingSel("None",f,e.name,c);for(e=0;e<this.m_filters.length;e++)d.setFilter(this.m_filters[e].fieldName,this.m_filters[e].value);d.print(a);this.condition.addWatchConditionDynSel(a.cid,d);f=d.getInput();a.dynSel=d;a.inptType=
"dynselect"}else if("object"==e.type&&e.subtype){f=alib.dom.createElement("div");c=alib.dom.createElement("span");if(b=this.getValue(e.name)){c.innerHTML="";var g=alib.dom.createElement("a",c);g.href="javascript:void(0);";g.objid=b;g.obj_type=e.subtype;g.onclick=function(){loadObjectForm(this.obj_type,this.objid)};var h=this.getValueName(e.name);h?g.innerHTML=h:objectSetNameLabel(e.subtype,b,g);e.required||(g=alib.dom.createElement("span",c),g.innerHTML="&nbsp;",g=alib.dom.createElement("a",c),g.href=
"javascript:void(0);",g.mainObject=this,g.fname=e.name,g.lbl=c,g.onclick=function(){this.lbl.innerHTML="None&nbsp;&nbsp;&nbsp;";this.mainObject.setValue(this.fname,"")},g.innerHTML="<img src='/images/icons/delete_10.png' />");g=alib.dom.createElement("span",c);g.innerHTML="&nbsp;&nbsp;&nbsp;";this.condition.addWatchConditionBrowse(a.cid,b)}else c.innerHTML="None Selected&nbsp;&nbsp;&nbsp;";d=new CButton("Select",function(a,b,c,d,e){var f=new AntObjectBrowser(a.subtype);f.cbData.dv=d;f.cbData.cls=
e;f.cbData.lbl=c;f.cbData.field=a;f.cbData.field_name=a.name;f.cbData.obj_type=a.subtype;f.onSelect=function(a){this.cbData.lbl.innerHTML="";this.cbData.cls.setValue(this.cbData.field_name,a);var b=alib.dom.createElement("a",this.cbData.lbl);b.href="javascript:void(0);";b.options={oid:a,obj_type:this.cbData.obj_type};b.onclick=function(){loadObjectForm(this.options.obj_type,this.options.oid)};b.innerHTML=a;if(!this.cbData.field.required){var c=alib.dom.createElement("span",this.cbData.lbl);c.innerHTML=
"&nbsp;";c=alib.dom.createElement("a",this.cbData.lbl);c.href="javascript:void(0);";c.mainObject=this.cbData.cls;c.fname=this.cbData.field.name;c.lbl=this.cbData.lbl;c.onclick=function(){this.lbl.innerHTML="None&nbsp;&nbsp;&nbsp;";this.mainObject.setValue(this.fname,"")};c.innerHTML="<img src='/images/icons/delete_10.png' />"}c=alib.dom.createElement("span",this.cbData.lbl);c.innerHTML="&nbsp;&nbsp;&nbsp;";this.cbData.cls.condition.addWatchConditionBrowse(this.cbData.dv.cid,a);objectSetNameLabel(this.cbData.obj_type,
a,b)};f.displaySelect(b.parent_dlg)},[e,d,c,a,this],"b1");f.appendChild(c);f.appendChild(d.getButton())}else"bool"==e.type?(f=alib.dom.createElement("select",a),f[f.length]=new Option("True","t",!1,"t"==c?!0:!1),f[f.length]=new Option("False","f",!1,"t"!=c?!0:!1),a.appendChild(f),f.checked="t"==c?!0:!1,a.inptType="select",c&&(f.val_field=c),this.condition.addWatchConditionVal(a.cid,f)):e.optional_vals&&e.optional_vals.length?(f=alib.dom.createElement("select",a),c&&(f.val_field=c),this.buildInputDropDown(f,
e.optional_vals,c),a.inptType="select",a.inpRef=f,this.condition.addWatchConditionVal(a.cid,f)):(f=alib.dom.createElement("input"),f.type="text",c&&(f.value=c),"number"==e.type&&"double precision"==e.subtype&&(f.maxLength=15),c&&(f.val_field=c,alib.dom.addEvntListener(f,"change",function(a){alib.userAgent.ie?a.srcElement.val_field=a.srcElement.value:this.val_field=this.value})),a.inptType="input");a.appendChild(f);a.inpRef=f;this.condition.addWatchConditionVal(a.cid,f);return f};
CAntObject.prototype.buildInputDropDown=function(a,b,c,d,e){for(var c=c?c:null,d=d?d:"",e=e?e:"",f=0;f<b.length;f++)b[f][3]==d&&(a[a.length]=new Option(e+b[f][1],b[f][0],!1,c==b[f][0]?!0:!1),b[f][2]&&this.buildInputDropDown(a,b,c,b[f][0],e+"\u00a0\u00a0"))};
CAntObject.prototype.fieldCreateValueInput=function(a,b,c,d){var e=d?d:{};a.innerHTML="";b=this.getFieldByName(b);if("fkey"==b.type||"fkey_multi"==b.type){if("user"==b.subtype)c=alib.dom.createElement("div",a),b=alib.dom.createElement("label",c),b.innerHTML="None Selected",alib.dom.styleSet(b,"font-size","12px"),alib.dom.styleSet(b,"margin-right","10px"),c=alib.dom.setElementAttr(alib.dom.createElement("input",c),[["type","button"],["value","Select"]]),c.userLabel=b,c.userId=0,c.onclick=function(){var a=
new CUserBrowser;a.selectCls=this;a.onSelect=function(a,b){this.selectCls.onSelect(a);this.selectCls.userLabel.innerHTML=b};a.showDialog()},a.inptType="userBrowser";else{c=new AntObjectGroupingSel("None",this.name,b.name,c,this,e);for(b=0;b<this.m_filters.length;b++)c.setFilter(this.m_filters[b].fieldName,this.m_filters[b].value);d=c.getInput();c.print(a);a.inptType="dynselect"}a.inpRef=c}else if("object"==b.type&&b.subtype){c=alib.dom.createElement("div",a);d=alib.dom.createElement("label",c);d.innerHTML=
"None Selected";alib.dom.styleSet(d,"font-size","12px");alib.dom.styleSet(d,"margin-right","10px");var f=(new CButton("Select",function(a,b){var c=new AntObjectBrowser(a);c.onSelect=function(a,c){b.innerHTML=c;f.onSelect(a)};c.displaySelect()},[b.subtype,d],"b1")).getButton();c.appendChild(f);a.inptType="objectBrowser";a.inpRef=f}else if(b.optional_vals&&b.optional_vals.length)d=alib.dom.createElement("select",a),this.buildInputDropDown(d,b.optional_vals,c),a.inptType="select",a.inpRef=d;else if("alias"==
b.type){d=alib.dom.createElement("select",a);for(e=0;e<this.fields.length;e++){var g=this.fields[e];b.subtype==g.subtype&&"alias"!=g.type&&(d[d.length]=new Option(g.title,g.name,!1,c==g.name?!0:!1))}a.inptType="select";a.inpRef=d}else"bool"==b.type?(d=alib.dom.createElement("input"),d.type="checkbox",d.checked=c?!0:!1,a.inptType="checkbox"):(e.rich?(d=alib.ui.Editor(),a.inptType="rte"):e.multiLine?(d=alib.dom.createElement("textarea"),a.inptType="input"):(d=alib.dom.createElement("input"),d.type=
"text",a.inptType="input",alib.dom.styleSetClass(d,"fancy")),e.height&&alib.dom.styleSet(d,"height",e.height),e.width&&alib.dom.styleSet(d,"width",e.width),c&&!e.rich&&(d.value=c),"real"==b.type&&(d.maxLength=15)),a.inpRef=d,e.rich?(d.print(a,"100%","250px"),c&&d.setValue(c)):a.appendChild(d),"date"==b.type?(new CAutoCompleteCal(d),alib.dom.styleSet(d,"width","100px")):"timestamp"==b.type?("time"==e.part?(new CAutoCompleteTime(d),alib.dom.styleSet(d,"width","75px")):(new CAutoCompleteCal(d),alib.dom.styleSet(d,
"width","100px")),e.part&&(d.part=e.part,d.value=this.getInputPartValue(b.name,c,e.part))):"bool"==b.type?alib.dom.styleSet(d,"width","15px"):alib.dom.styleSet(d,"width","99%"),e.multiLine&&!e.rich&&alib.dom.textAreaAutoResizeHeight(d,50,400);return a.inpRef};
CAntObject.prototype.fieldGetValueInput=function(a,b,c){c=c?c:{};a.innerHTML="";var d=this.getValue(b),e=this.getFieldByName(b);this.fieldCreateValueInput(a,e.name,d,c);if("fkey_multi"==e.type){var b=this.getMultiValues(e.name),f=alib.dom.createElement("div",a),c=alib.dom.createElement("div",a);c.id=e.name;a.inpRef.field=e;a.inpRef.m_cls=this;a.inpRef.dv_opt_con=c;a.inpRef.onSelect=function(){if(""!=this.value){this.m_cls.setMultiValue(this.field.name,this.value);for(var a=this.valueName,b=0;b<this.field.optional_vals.length;b++)this.field.optional_vals[b][0]==
this.value&&(a=this.field.optional_vals[b][1]);b=alib.dom.createElement("div",this.dv_opt_con);b.innerHTML=unescape(a+"&nbsp;");var c=alib.dom.createElement("a",b);c.href="javascript:void(0);";c.innerHTML="[X]";c.m_id=this.value;c.m_label=unescape(a);c.m_div=b;c.m_sel=this;c.m_fieldname=this.field.name;c.onclick=function(){this.m_div.style.display="none";this.m_sel[this.m_sel.length]=new Option(this.m_label,this.m_id,!1,!1);this.m_sel.m_cls.delMultiValue(this.m_fieldname,this.m_id)}}};for(d=0;d<b.length;d++){var g=
b[d],h=g,h=this.getValueName(e.name,g);if(""==h||null==h)h=g;for(f=0;f<e.optional_vals.length;f++)e.optional_vals[f][0]==g&&(h=e.optional_vals[f][1]);f=alib.dom.createElement("div",c);alib.dom.createElement("span",f).innerHTML=h+" ";if(g==h){var k=new CAjax("json");k.onload=function(a){if(a)for(var b in a.groups){var c=a.groups[b];if(c.id==g){this.cbData.lblsp.innerHTML=c.name+" ";break}}}.bind(this);k.exec("/svr/entity/getGroupings",[["obj_type",this.obj_type],["field_name",e.name]])}k=alib.dom.createElement("a",
f);k.href="javascript:void(0);";k.innerHTML="[X]";k.m_id=g;k.m_label=h;k.m_div=f;k.m_cls=this;k.m_fieldname=e.name;k.dynSelObject=a.inpRef;k.onclick=function(){this.m_div.style.display="none";this.m_cls.delMultiValue(this.m_fieldname,this.m_id);for(mVar in this.dynSelObject.multiVars)this.m_id==this.dynSelObject.multiVars[mVar]&&delete this.dynSelObject.multiVars[mVar]}}}else if(a.inpRef)switch(a.inpRef.cls=this,a.inpRef.fieldName=b,a.inptType){case "checkbox":a.inpRef.onclick=function(){this.cls.setValue(this.fieldName,
this.checked)};break;case "text":case "input":a.inpRef.cls=this,a.inpRef.onblur=function(){"file"==this.cls.obj_type&&"name"==e.name&&checkSpecialCharacters("file",this.value,this)};case "select":a.inpRef.skiponchange=!1;a.inpRef.onchange=function(){if(!this.skiponchange){var a=this.value;this.part&&(a=this.cls.getInputPartFullValue(this.fieldName,a,this.part));this.cls.setValue(this.fieldName,a)}};break;case "dynselect":a.inpRef.onSelect=function(){this.cls.setValue(this.fieldName,this.value,this.valueName)};
break;case "rte":a.inpRef.onChange=function(){this.cls.setValue(this.fieldName,this.getValue())}}};
CAntObject.prototype.save=function(a){for(var a=a?a:{},b=!1,c={},d=0;d<this.fields.length;d++){var e=this.fields[d];if("fkey_multi"==e.type||"object_multi"==e.type){var f=this.getMultiValues(e.name);if(f&&0<f.length){c[e.name]=f;c[e.name+"_fval"]={};for(var g=0;g<f.length;g++){var h=f[g];c[e.name+"_fval"][h]=this.getValueName(e.name,h)}}else c[e.name]=null}else"obj_type"==e.name?c["field:obj_type"]=this.getValue(e.name):c[e.name]=this.getValue(e.name);e.required&&!this.getValue(e.name)&&"fkey_multi"!=
e.type&&"object_multi"!=e.type&&(b="ERROR: "+e.title+" is a required field. Be sure to set it before saving changes.")}null!=this.recurrencePattern&&(d={},d.type=this.recurrencePattern.type,d.save_type=this.recurrencePattern.save_type,d.object_type=this.recurrencePattern.object_type,d.object_type_id=this.recurrencePattern.object_type_id,d.interval=this.recurrencePattern.interval,d.dateStart=this.recurrencePattern.dateStart,d.dateEnd=this.recurrencePattern.dateEnd,d.timeStart=this.recurrencePattern.timeStart,
d.timeEnd=this.recurrencePattern.timeEnd,d.fAllDay=this.recurrencePattern.fAllDay,d.dayOfMonth=this.recurrencePattern.dayOfMonth,d.monthOfYear=this.recurrencePattern.monthOfYear,d.dayOfWeekMask=this.recurrencePattern.dayOfWeekMask,d.instance=this.recurrencePattern.instance,d.object_type_id=this.recurrencePattern.object_type_id,d.object_type=this.recurrencePattern.object_type,d.parentId=this.recurrencePattern.parentId,d.calendarId=this.recurrencePattern.calendarId,d.dateProcessedTo=this.recurrencePattern.dateProcessedTo,
d.id=this.recurrencePattern.id,d.day1=this.recurrencePattern.day1,d.day2=this.recurrencePattern.day2,d.day3=this.recurrencePattern.day3,d.day4=this.recurrencePattern.day4,d.day5=this.recurrencePattern.day5,d.day6=this.recurrencePattern.day6,d.day7=this.recurrencePattern.day7,c.recurrence_pattern=d);if(b)this.onsaveError(b);else ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.cbData.options=a,ajax.onload=function(a){a=a.error?0:parseInt(a.id);if(0<a){try{this.cbData.cls.id||(this.cbData.cls.id=a.id,
this.cbData.cls.onValueChange("id",a.id),alib.events.triggerEvent(this.cbData.cls,"fieldchange",{fieldName:"id",value:a.id,valueName:a.name||a.id}))}catch(b){alert("CAntObject::save::error - "+b)}this.cbData.cls.dirty=!1;this.cbData.options.repressOnSave||(this.cbData.cls.onsave(),alib.events.triggerEvent(this.cbData.cls,"save"))}else if(-2==a)this.cbData.cls.onsaveError("ERROR: You do not have sufficient permissions!");else if(-3==a)this.cbData.cls.onsaveError("ERROR: Unable to update Recurrence Pattern!");
else this.cbData.cls.onsaveError()},c.obj_type=this.name,this.id&&(c.id=this.id),ajax.exec("/svr/entity/save",JSON.stringify(c))};CAntObject.prototype.onsave=function(){};CAntObject.prototype.onsaveError=function(){};
CAntObject.prototype.remove=function(){if(this.id){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a.error)this.cbData.cls.onremoveError();else this.cbData.cls.onremove()};var a=[["obj_type",this.name],["oid",this.id]];null!=this.recurrencePattern&&(a[a.length]=["recurrence_save_type",this.recurrencePattern.save_type]);ajax.exec("/controller/Object/deleteObject",a)}else this.onremoveError()};CAntObject.prototype.onremove=function(){};CAntObject.prototype.onremoveError=function(){};
CAntObject.prototype.getValueByIdx=function(a){return{name:this.create_obj_values[a][0],value:this.create_obj_values[a][1],isMulti:"object_multi"==typeof this.create_obj_values[a][1]?!0:!1}};CAntObject.prototype.getInputPartFullValue=function(a,b,c){var d=this.getFieldByName(a);(a=this.getValue(a))||(a=b);switch(d.type){case "timestamp":d=new Date(a),"time"==c?a=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear()+" "+b:"date"==c&&(a=b+" "+calGetClockTime(d))}return a};
CAntObject.prototype.getInputPartValue=function(a,b,c){a=this.getFieldByName(a);if(!b)return"";switch(a.type){case "timestamp":a=new Date(b),"time"==c?b=calGetClockTime(a):"date"==c&&(b=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear())}return b};
CAntObject.prototype.setValue=function(a,b,c){if("undefined"!=typeof a){var c=c||null,d=this.getFieldByName(a);if(d){if("fkey_multi"==d.type||"object_multi"==d.type){if(b instanceof Array)for(var e in b)this.setMultiValue(a,b[e]);else this.setMultiValue(a,b,c);return!0}if("bool"==d.type)switch(b){case 1:case "t":b=!0;break;case 0:case "f":b=!1}if(-1==a.indexOf(".")){this.dirty=!0;for(e=0;e<this.values.length;e++)if(this.values[e][0]==a){this.values[e][1]=b;c&&(this.values[e][2]=c);this.onValueChange(a,
b,c);alib.events.triggerEvent(this,"fieldchange",{fieldName:a,value:b,valueName:c});return}if(!c&&d&&"fkey"!=d.type&&"fkey_multi"!=d.type&&"object"!=d.type&&"object_multi"!=d.type&&d.optional_vals)for(e=0;e<d.optional_vals.length;e++)d.optional_vals[e][0]==b&&(c=d.optional_vals[e][1]);d=this.values.length;this.values[d]=[];this.values[d][0]=a;this.values[d][1]=b;this.values[d][2]=c?c:null;this.onValueChange(a,b,c);alib.events.triggerEvent(this,"fieldchange",{fieldName:a,value:b,valueName:c})}}}};
CAntObject.prototype.getValue=function(a){var b="";if(!a)return b;for(var c=0;c<this.values.length;c++)if(this.values[c][0]==a){b=this.values[c][1];break}a=this.getFieldByName(a);try{""==b&&a.optional_vals&&a.optional_vals.length&&(b=a.optional_vals[0][0])}catch(d){}return b};
CAntObject.prototype.getValueName=function(a,b){var c=this.getFieldByName(a);if(c&&"alias"==c.type)return b||(b=this.getValue(a)),this.getValue(b);if("object"==c.type||"fkey"==c.type||"object_multi"==c.type||"fkey_multi"==c.type)for(var d=0;d<this.values.length;d++){if(this.values[d][0]==a)if(b)for(c=0;c<this.values[d][1].length;c++){if(this.values[d][1][c]==b&&this.values[d][2])return this.values[d][2][c]}else if(null!=this.values[d][2]&&"null"!=this.values[d][2])return this.values[d][2]}else if(c.optional_vals.length)for(d=
0;d<c.optional_vals.length;d++){if(c.optional_vals[d][0]==this.getValue(a))return c.optional_vals[d][1]}else return this.getValue(a);return""};CAntObject.prototype.getValueStr=function(a){var b=this.getValueName(a);b||(b=this.getValue(a));return b};
CAntObject.prototype.setMultiValue=function(a,b,c){c=c||null;this.onValueChange(a,b);alib.events.triggerEvent(this,"fieldchange",{fieldName:a,value:b,valueName:c});this.dirty=!0;for(var d=0;d<this.values.length&&(this.id||!this.newWindowArgs);d++)if(this.values[d][0]==a){for(a=0;a<this.values[d][1].length;a++)this.values[d][1][a]==b&&!1;var e=this.values[d][1].length;this.values[d][1][e]=b;this.values[d][2][e]=c?c:null;return}e=this.values.length;this.values[e]=[];this.values[e][0]=a;this.values[e][1]=
[];this.values[e][1][0]=!this.id&&this.newWindowArgs?c:b;this.values[e][2]=[];this.values[e][2][0]=c?c:null};CAntObject.prototype.getMultiValueExists=function(a,b){for(var c=0;c<this.values.length;c++)if(this.values[c][0]==a)for(var d=0;d<this.values[c][1].length;d++)if(this.values[c][1][d]==b)return!0;return!1};
CAntObject.prototype.getMultiValues=function(a){for(var b=[],c=0;c<this.values.length;c++)if(this.values[c][0]==a)for(var d=0;d<this.values[c][1].length;d++)b[b.length]=this.values[c][1][d];return b};
CAntObject.prototype.getMultiValueStr=function(a){for(var b="",c=0;c<this.values.length;c++)if(this.values[c][0]==a&&"undefined"!=typeof this.values[c][2]&&null!=this.values[c][2])for(var d=0;d<this.values[c][2].length;d++)b&&(b+="; "),"undefined"!=typeof this.values[c][2][d]&&null!=this.values[c][2][d]&&(b+=this.values[c][2][d]);return b};
CAntObject.prototype.delMultiValue=function(a,b){this.dirty=!0;for(var c=0;c<this.values.length;c++)if(this.values[c][0]==a)for(var d=0;d<this.values[c][1].length;d++)this.values[c][1][d]==b&&this.values[c][1].splice(d,1)};CAntObject.prototype.delMultiValues=function(a){for(var b=0;b<this.values.length;b++)this.values[b][0]==a&&(this.values[b][1]=[])};CAntObject.prototype.onValueChange=function(){};CAntObject.prototype.getObjType=function(){return this.obj_type};
CAntObject.prototype.getDefaultView=function(a){for(var a=a?a:"",b=0;b<this.views.length;b++)if(this.views[b].fDefault&&a==this.views[b].filterKey)return this.views[b];if(this.views.length)return this.views[0]};CAntObject.prototype.defaultViewExists=function(a){for(var a=a?a:"",b=0;b<this.views.length;b++)if(this.views[b].fDefault&&a==this.views[b].filterKey)return!0;return!1};
CAntObject.prototype.getViewById=function(a){for(var b=0;b<this.views.length;b++)if(this.views[b].id==a)return this.views[b];return null};CAntObject.prototype.setViewed=function(){this.id&&(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.onload=function(){},ajax.exec("/controller/Object/setViewed",[["obj_type",this.name],["oid",this.id]]))};
CAntObject.prototype.getIcon=function(a,b){if(this.getValue("image_id")){var c="/antfs/images/"+this.getValue("image_id");if(a||b)c=c+"/"+(a?a:"0");b&&(c+="/"+b);return c}if(this.iconName)return"/images/icons/objects/"+this.iconName+"_"+a+".png"};CAntObject.prototype.isDirty=function(){return this.dirty};CAntObject.prototype.setFilter=function(a,b){var c=this.m_filters.length;this.m_filters[c]={};this.m_filters[c].fieldName=a;this.m_filters[c].value=b};CAntObject.prototype.clearConditions=function(){return this.condition.clearConditions()};
CAntObject.prototype.toggleEdit=function(a){this.onToggleEdit(a)};CAntObject.prototype.onToggleEdit=function(){};CAntObject.prototype.loadRecurrencePattern=function(a){this.getRecurrencePattern(!0,a)};
CAntObject.prototype.getRecurrencePattern=function(a,b){if(null==this.recurRules)return null;if(a)this.recurrencePattern||("undefined"==typeof b&&(b=null),this.recurrencePattern=new CRecurrencePattern,this.recurrencePattern.object_type=this.name,this.recurrencePattern.object_type_id=this.object_type_id,this.recurrencePattern.parentId=this.id,this.recurrencePattern.fieldDateStart=this.recurRules.fieldDateStart,this.recurrencePattern.fieldTimeStart=this.recurRules.fieldTimeStart,this.recurrencePattern.fieldDateEnd=
this.recurRules.fieldDateEnd,this.recurrencePattern.fieldTimeEnd=this.recurRules.fieldTimeEnd,this.recurrencePattern.fieldRecurId=this.recurRules.fieldRecurId,b&&this.recurrencePattern.load(b));else{if(null==this.recurrencePattern)return null;this.recurrencePattern.object_type=this.name;this.recurrencePattern.object_type_id=this.object_type_id;this.recurrencePattern.parentId=this.id}return this.recurrencePattern};
function CAntObjects(){this.appName=this.tblObject=this.objCls=null;this.fObjectReference=!1}CAntObjects.prototype.onLoadObjects=function(){};
CAntObjects.prototype.addNewObject=function(){var a=new CDialog("Create New Object"),b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b),d=alib.dom.createElement("div",b);alib.dom.styleSet(d,"margin-top","20px");d.align="right";alib.dom.setElementAttr(alib.dom.createElement("label",c),[["innerHTML","Object Name: "]]);c=alib.dom.setElementAttr(alib.dom.createElement("input",c));alib.dom.styleSet(c,"width","200px");c=new CButton("Save Object",function(a,b,c){a.saveNewObject(b.value);c.hide()},
[this,c,a],"b2");d.appendChild(c.getButton());c=new CButton("Cancel",function(a,b){b.hide()},[this,a],"b1");d.appendChild(c.getButton());a.customDialog(b,280)};
CAntObjects.prototype.saveNewObject=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.dlg=showDialog("Saving, please wait...");ajax.cbData.objectName=a;ajax.onload=function(a){this.cbData.dlg.hide();if(a)if(a.error)ALib.statusShowAlert(a.error,3E3,"bottom","right");else{var b={};b.fullTitle=this.cbData.objectName;b.id=a.id;b.name=a.name;this.cbData.cls.listObject(b);ALib.statusShowAlert("Object "+this.cbData.objectName+" successfully saved",3E3,"bottom","right")}};var b=[];b[b.length]=
["obj_name",a];b[b.length]=["app",this.appName];ajax.exec("/controller/Application/createObject",b)};
CAntObjects.prototype.loadObjects=function(a){this.tblObject.clear();loadingCon=alib.dom.createElement("element",a);loadingCon.innerHTML="<div class='loading'></div>";ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.loadingCon=loadingCon;ajax.onload=function(a){this.cbData.loadingCon.parentNode.removeChild(this.cbData.loadingCon);this.cbData.cls.mapObject(a);this.cbData.cls.onLoadObjects()};this.fObjectReference?(a=[],a[a.length]=["app",this.appName],ajax.exec("/controller/Application/getObjectReference",
a)):ajax.exec("/controller/Object/getObjects")};CAntObjects.prototype.mapObject=function(a){for(object in a)this.listObject(a[object])};
CAntObjects.prototype.listObject=function(a){var b=this.tblObject.addRow(),c=a.fullTitle;"undefined"==typeof c&&(c=a.name);var d=alib.dom.createElement("a");d.innerHTML=c;d.href="javascript:void(0);";d.obj_type=a.name;d.onclick=function(){(new Ant.EntityDefinitionEdit(this.obj_type)).showDialog()};b.addCell(d,!1,"left");d=alib.dom.createElement("a");d.innerHTML="[import data]";d.href="javascript:void(0);";d.obj_type=a.name;d.onclick=function(){(new AntWizard("EntityImport",{obj_type:this.obj_type})).show()};
b.addCell(d,!1,"center");a.fSystem?b.addCell("&nbsp;",!1,"center"):(d=alib.dom.createElement("a"),d.innerHTML="[delete]",d.href="javascript:void(0);",d.objectName=a.name,d.cls=this,d.row=b,d.onclick=function(){this.cls.deleteObject(this.objectName,this.row)},b.addCell(d,!1,"center"))};
CAntObjects.prototype.deleteObject=function(a,b){if(confirm("Are you sure you want to delete this "+a+" object?","Delete Referenced Object")){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.dlg=showDialog("Deleting, please wait...");ajax.cbData.row=b;ajax.cbData.objectName=a;ajax.onload=function(a){this.cbData.dlg.hide();a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):(this.cbData.row.deleteRow(),ALib.statusShowAlert("Object "+this.cbData.objectName+" successfully saved",3E3,
"bottom","right")))};var c=[];c[c.length]=["obj_type",a];c[c.length]=["app",this.appName];c[c.length]=["f_obj_reference",this.fObjectReference];ajax.exec("/controller/Application/deleteObjectReference",c)}};function CAntObjectView(a){this.id=null;this.name="";this.obj_type=a;this.description="";this.fSystem=!1;this.conditions=[];this.sort_order=[];this.view_fields=[];this.reportId=this.filterKey=""}
CAntObjectView.prototype.loadFromXml=function(a){if("view"==a.m_name){this.id=unescape(a.getChildNodeValByName("id"));this.name=unescape(a.getChildNodeValByName("name"));this.description=unescape(a.getChildNodeValByName("description"));this.fSystem="t"==a.getChildNodeValByName("f_system")?!0:!1;this.fDefault="t"==a.getChildNodeValByName("f_default")?!0:!1;var b=a.getChildNodeValByName("filter_key");this.filterKey=b?unescape(b):"";var c=a.getChildNodeByName("view_fields");if(c)for(b=0;b<c.getNumChildren();b++){var d=
c.getChildNode(b),e=this.view_fields.length;this.view_fields[e]={};this.view_fields[e].id=null;this.view_fields[e].fieldName=d.m_text}if(c=a.getChildNodeByName("conditions"))for(b=0;b<c.getNumChildren();b++)d=c.getChildNode(b),e=this.conditions.length,this.conditions[e]={},this.conditions[e].blogic=unescape(d.getChildNodeValByName("blogic")),this.conditions[e].fieldName=unescape(d.getChildNodeValByName("field_name")),this.conditions[e].operator=unescape(d.getChildNodeValByName("operator")),this.conditions[e].condValue=
unescape(d.getChildNodeValByName("value"));if(a=a.getChildNodeByName("sort_order"))for(b=0;b<a.getNumChildren();b++)c=a.getChildNode(b),e=this.sort_order.length,this.sort_order[e]={},this.sort_order[e].fieldName=unescape(c.getChildNodeValByName("field_name")),this.sort_order[e].order=unescape(c.getChildNodeValByName("order"))}};
CAntObjectView.prototype.fromData=function(a){this.id=a.id;this.name=a.name;this.description=a.description;this.fSystem=a.f_system;this.fDefault=a.f_default;this.filterKey=a.filter_key;for(var b in a.view_fields)this.view_fields[this.view_fields.length]={id:null,fieldName:a.view_fields[b]};for(b in a.conditions)this.conditions[this.conditions.length]={blogic:a.conditions[b].blogic,fieldName:a.conditions[b].field_name,operator:a.conditions[b].operator,condValue:a.conditions[b].value};for(b in a.sort_order)this.sort_order[this.sort_order.length]=
{fieldName:a.sort_order[b].field_name,order:a.sort_order[b].order}};
CAntObjectView.prototype.save=function(){var a=[["obj_type",this.obj_type],["name",this.name],["description",this.description],["filter_key",this.filterKey],["report_id",this.reportId]];this.id&&(a[a.length]=["vid",this.id]);for(var b=0;b<this.conditions.length;b++){var c=this.conditions[b];a[a.length]=["conditions[]",b];a[a.length]=["condition_blogic_"+b,c.blogic];a[a.length]=["condition_fieldname_"+b,c.fieldName];a[a.length]=["condition_operator_"+b,c.operator];a[a.length]=["condition_condvalue_"+
b,c.condValue]}for(b=0;b<this.sort_order.length;b++)c=this.sort_order[b],a[a.length]=["sort_order[]",b],a[a.length]=["sort_order_fieldname_"+b,c.fieldName],a[a.length]=["sort_order_order_"+b,c.order];for(b=0;b<this.view_fields.length;b++)c=this.view_fields[b],a[a.length]=["view_fields[]",b],a[a.length]=["view_field_fieldname_"+b,c.fieldName];ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a.error)cls.onsaveError();else if(this.cbData.cls.id||(this.cbData.cls.id=a),!this.cbData.cls.repressOnSave)this.cbData.cls.onsave(a)};
ajax.exec("/controller/Object/saveView",a)};CAntObjectView.prototype.reset=function(){this.conditions=[];this.sort_order=[];this.view_fields=[]};CAntObjectView.prototype.addCondition=function(a,b,c,d){var e=this.conditions.length;this.conditions[e]={};this.conditions[e].blogic=a;this.conditions[e].fieldName=b;this.conditions[e].operator=c;this.conditions[e].condValue=d};CAntObjectView.prototype.onsave=function(){};CAntObjectView.prototype.onsaveError=function(){};
var AntObjectInfobox={loaders:[],maxCached:25,dialogWidth:450};AntObjectInfobox.attach=function(a,b,c){alib.events.listen(c,"mouseover",function(a){this.active=!0;AntObjectInfobox.delayShow(a.data.type,a.data.id,a.data.div)},{type:a,id:b,div:c});alib.events.listen(c,"mouseout",function(){this.active=!1})};AntObjectInfobox.delayShow=function(a,b,c){c.showTimer||(c.showTimer=window.setTimeout(function(){c.showTimer=null;c.active&&AntObjectInfobox.show(a,b,c)},500))};
AntObjectInfobox.show=function(a,b,c){var d=alib.dom.getElementPosition(c),e=d.x,d=d.b;e+22+this.dialogWidth>alib.dom.getClientWidth()&&(e=alib.dom.getClientWidth()-(this.dialogWidth+25));var f=this.getBoxDiv(a,b);alib.dom.styleSet(f,"top",d+"px");alib.dom.styleSet(f,"left",e+"px");alib.dom.styleSet(f,"display","block");f.rendered||this.renderLoader(a,b,f);alib.events.listen(c,"mouseout",function(a){AntObjectInfobox.delayHide(a.data.objType,a.data.oid)},{objType:a,oid:b});f.hidetimer&&(window.clearTimeout(f.hidetimer),
f.hidetimer=null)};AntObjectInfobox.delayHide=function(a,b,c){var d=this.getBoxDiv(a,b);d.hidetimer||(d.hidetimer=window.setTimeout(function(){d.hidetimer=null;alib.dom.styleSet(d,"display","none")},c||1E3))};AntObjectInfobox.stopHide=function(a,b){var c=this.getBoxDiv(a,b);c.hidetimer&&(window.clearTimeout(c.hidetimer),c.hidetimer=null)};
AntObjectInfobox.getBoxDiv=function(a,b){for(var c in this.loaders)if(this.loaders[c].objType==a&&this.loaders[c].id==b)return this.loaders[c].divCon;c=alib.dom.createElement("div",document.body);alib.dom.styleSet(c,"position","absolute");alib.dom.styleSet(c,"top","0");alib.dom.styleSet(c,"left","0");alib.dom.styleSet(c,"width",this.dialogWidth+"px");alib.dom.styleSet(c,"display","none");alib.dom.styleSetClass(c,"objectInfobox");c.rendered=!1;this.loaders.push({objType:a,id:b,divCon:c,loader:null});
alib.events.listen(c,"mouseover",function(a){AntObjectInfobox.stopHide(a.data.objType,a.data.oid)},{objType:a,oid:b});for(alib.events.listen(c,"mouseout",function(a){AntObjectInfobox.delayHide(a.data.objType,a.data.oid)},{objType:a,oid:b});25<this.loaders.length;)document.body.removeChild(this.loaders[0].divCon),this.loaders.splice(0,1);return c};
AntObjectInfobox.renderLoader=function(a,b,c){c.rendered=!0;var d=alib.dom.createElement("div",c),e=new AntObjectLoader(a,b);e.hideToolbar=!0;e.printInline(d,!1,"infobox");c=alib.dom.createElement("div",c);alib.dom.styleSet(c,"text-align","right");d=alib.ui.Button("View More Details",{className:"b1 medium",tooltip:"Click to open full details",objType:a,oid:b,onclick:function(){loadObjectForm(this.objType,this.oid)}});d.print(c);d=alib.ui.Button("Close",{className:"b1 medium",tooltip:"Dismiss this dialog",
objType:a,oid:b,onclick:function(){AntObjectInfobox.delayHide(this.objType,this.oid,1)}});d.print(c)};
function AntObjectGroupingSel(a,b,c,d,e,f){if(b&&c)this.mainObjectType=b,this.mainObjectField=c;else if(b)this.mainObjectType=b,this.mainObjectField="";else return null;this.mainObject=e?e:null;this.m_lbl=alib.dom.createElement("span");this.m_input=alib.dom.createElement("input");this.m_input.type="hidden";this.m_filters=[];this.value=d?d:"";this.opts=f?f:{};this.fieldType=null;this.multiVars=[];this.cbData={};this.mainObject&&(this.fieldType=this.mainObject.getFieldByName(c).type,"fkey_multi"==this.fieldType&&
"email_thread"!==b&&(this.multiVars=this.mainObject.getMultiValues(c),a="Select"));this.m_lbl.innerHTML=a?a:"Select";d&&"fkey_multi"!==this.fieldType&&(c?this.getForeignValueLabel(d):this.getObjectName(d))}AntObjectGroupingSel.prototype.print=function(a,b){this.mainObjectType&&this.mainObjectField?this.printGrouping(a,b?b:null):this.printObject(a)};AntObjectGroupingSel.prototype.setLabel=function(a){this.m_lbl.innerHTML=a+" &#9660;"};
AntObjectGroupingSel.prototype.printObject=function(a){switch(this.mainObjectType){case "user":(new CButton(this.m_lbl,function(a){var c=new CUserBrowser;c.dynselcls=a;c.onSelect=function(a,b){this.dynselcls.onSelect(a,b);this.dynselcls.setLabel(b)};c.showDialog()},[this])).print(a)}};
AntObjectGroupingSel.prototype.printTable=function(a,b){var c=b?b:null,d=new CDropdownMenu,e=d.addCon();e.onclick=function(){};var f=alib.dom.createElement("div",e);alib.dom.styleSet(f,"padding-left","5px");alib.dom.styleSet(f,"width","180px");alib.dom.styleSet(f,"max-height","300px");alib.dom.styleSet(f,"overflow","auto");a.appendChild(d.createButtonMenu(this.m_lbl,function(a,b,c){b.loadTable(a,null,c)},[f,this,e],c))};
AntObjectGroupingSel.prototype.printGrouping=function(a,b){var c=b?b:"b1",d=new alib.ui.FilteredMenu;alib.events.listen(d,"onShow",function(a){a.data.cls.loadGroupingItems(a.data.menu)},{cls:this,menu:d});(new alib.ui.MenuButton(this.m_lbl,d,{className:c})).print(a)};AntObjectGroupingSel.prototype.onSelect=function(){};AntObjectGroupingSel.prototype.onchange=function(){};
AntObjectGroupingSel.prototype.tableSelect=function(a,b){!this.opts.staticLabel&&"fkey_multi"!==this.fieldType&&(this.m_lbl.innerHTML=b);this.value=a;this.valueName=b;this.m_input.value=a;this.onSelect(a,b);this.onchange()};AntObjectGroupingSel.prototype.select=function(a,b){!this.opts.staticLabel&&"fkey_multi"!==this.fieldType&&(this.m_lbl.innerHTML=b);this.value=a;this.valueName=b;this.m_input.value=a;this.onSelect(a,b);this.onchange()};
AntObjectGroupingSel.prototype.loadGroupingItems=function(a){for(var b=[],c=0;c<this.m_filters.length;c++){var d=this.m_filters[c];b[b.length]=[d.fieldName,d.value]}this.opts.filter&&(b[b.length]=["conditions[]",1],b[b.length]=["condition_blogic_1","and"],b[b.length]=["condition_fieldname_1",this.opts.filter[0]],b[b.length]=["condition_operator_1","is_equal"],b[b.length]=["condition_condvalue_1",this.opts.filter[1]]);if(this.mainObject){d=this.mainObject.getFields();for(c=0;c<d.length;c++)b[b.length]=
[d[c].name,this.mainObject.getValue(d[c].name)]}this.mainObjectType&&(b[b.length]=["obj_type",this.mainObjectType]);this.mainObjectField&&(b[b.length]=["field",this.mainObjectField]);ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.menu=a;ajax.onload=function(a){if(a)if(a.error)ALib.statusShowAlert(a.error,3E3,"bottom","right");else{var b=[{}];b[0].id="";b[0].title="None / Null";b[0].viewname="None / Null";!this.cbData.cls.opts.noNull&&"fkey_multi"!==this.cbData.cls.fieldType&&this.cbData.cls.populateItems(b,
this.cbData.menu);this.cbData.cls.populateItems(a,this.cbData.menu)}};ajax.exec("/controller/Object/getGroupings",b)};
AntObjectGroupingSel.prototype.loadTable=function(a,b,c){a.innerHTML=" <div class='loading'></div>";for(var d=[],e=0;e<this.m_filters.length;e++){var f=this.m_filters[e];d[d.length]=[f.fieldName,f.value]}this.opts.filter&&(d[d.length]=["conditions[]",1],d[d.length]=["condition_blogic_1","and"],d[d.length]=["condition_fieldname_1",this.opts.filter[0]],d[d.length]=["condition_operator_1","is_equal"],d[d.length]=["condition_condvalue_1",this.opts.filter[1]]);if(this.mainObject){f=this.mainObject.getFields();
for(e=0;e<f.length;e++)d[d.length]=[f[e].name,this.mainObject.getValue(f[e].name)]}this.mainObjectType&&(d[d.length]=["obj_type",this.mainObjectType]);this.mainObjectField&&(d[d.length]=["field",this.mainObjectField]);b&&(d[d.length]=["offset",b]);ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=a;ajax.cbData.dropdownCon=c;ajax.onload=function(a){if(a)if(a.error)ALib.statusShowAlert(a.error,3E3,"bottom","right");else{this.cbData.con.fLoaded=!0;this.cbData.con.innerHTML="";var b=[{}];b[0].id=
"";b[0].title="None / Null";b[0].viewname="None / Null";var c=alib.dom.createElement("div",this.cbData.con),d=alib.dom.createElement("div",this.cbData.con),e=0;for(group in a)a[group].children&&a[group].children.length&&(e+=a[group].children.length);if(10<a.length+e){var f=alib.dom.createElement("span",c),c=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["type","text"]]);alib.dom.styleSet(c,"width","150px");alib.dom.styleSet(c,"margin","5px 0");alib.dom.styleSet(c,"paddingRight","25px");
f.className="clearIcon";f=alib.dom.createElement("span",f);f.className="deleteicon";alib.dom.styleSet(f,"visibility","hidden");f.cls=this;f.textSearch=c;f.onclick=function(){this.textSearch.value="";this.textSearch.focus();alib.dom.styleSet(this,"visibility","hidden");this.textSearch.onkeyup()};c.focus();c.cls=this.cbData.cls;c.data=a;c.con=d;c.nullEntry=b;c.spanIcon=f;c.onkeyup=function(){this.con.innerHTML="";!this.cls.opts.noNull&&"fkey_multi"!==this.cls.fieldType&&this.cls.populateSelect(this.nullEntry,
this.con);this.cls.populateSelect(this.data,this.con,this.value.toLowerCase());0<this.value.length?alib.dom.styleSet(this.spanIcon,"visibility","visible"):alib.dom.styleSet(this.spanIcon,"visibility","hidden")}}alib.dom.styleSet(d,"cursor","pointer");d.dropdownCon=this.cbData.dropdownCon;d.spanIcon=f;d.onclick=function(){alib.dom.styleSet(this.spanIcon,"visibility","hidden");this.dropdownCon.menuref.unloadMe()};!this.cbData.cls.opts.noNull&&"fkey_multi"!==this.cbData.cls.fieldType&&this.cbData.cls.populateSelect(b,
d);this.cbData.cls.populateSelect(a,d)}else this.cbData.con.innerHTML=" <div style='padding:3px;'>None</div>"};ajax.exec("/controller/Object/getGroupings",d)};
AntObjectGroupingSel.prototype.populateSelect=function(a,b,c,d){"undefined"==typeof d&&(d="");if(a.length)for(value in a){var e=a[value],f=!1;for(mVar in this.multiVars)if(this.multiVars[mVar]==e.id){f=!0;break}f||(c?-1!==e.title.toLowerCase().indexOf(c)&&this.addEntry(b,e,d+e.title):this.addEntry(b,e,d+e.title),e.children&&e.children.length&&this.populateSelect(e.children,b,c,d+"\u00a0\u00a0\u00a0\u00a0"))}else b.innerHTML=" <div style='padding: 3px;'>None</div>"};
AntObjectGroupingSel.prototype.populateItems=function(a,b,c){"undefined"==typeof c&&(c="");if(a.length)for(value in a){var d=a[value],e=!1;for(mVar in this.multiVars)if(this.multiVars[mVar]==d.id){e=!0;break}e||(e=b.getItemById(d.id),e||(e=new alib.ui.MenuItem(c+d.title,{},d.id),e.cbData.id=d.id,e.cbData.title=d.title,e.cbData.cls=this,e.onclick=function(){this.cbData.cls.select(this.cbData.id,this.cbData.title)},b.addItem(e)),d.children&&d.children.length&&this.populateItems(d.children,b,c+d.title+
"/"))}};AntObjectGroupingSel.prototype.addEntry=function(a,b,c){a=alib.dom.createElement("div",a);a.cls=this;a.id=b.id;a.title=b.title;a.onclick=function(){this.cls.tableSelect(this.id,this.title)};a.innerHTML=c};
AntObjectGroupingSel.prototype.loadObjectForm=function(a){var b=a?a:null;switch(this.mainObject.name){case "customer":custOpen(a);break;case "lead":custLeadOpen(b);break;case "opportunity":custOppOpen(b);break;case "task":projTaskOpen(b);break;case "case":projTicketOpen(b);break;default:a="/obj/"+this.mainObject.name,b&&(a+="/"+b),b=this.mainObject.name.replace(".","_")+"_"+(b?b:"new"),window.open(a,b,"width=750,height=550,toolbar=no,scrollbars=yes")}};
AntObjectGroupingSel.prototype.setFilter=function(a,b){var c=this.m_filters.length;this.m_filters[c]={};this.m_filters[c].fieldName=a;this.m_filters[c].value=b};AntObjectGroupingSel.prototype.getInput=function(){return this.m_input};
AntObjectGroupingSel.prototype.getObjectName=function(a){this.mainObjectType&&(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.onload=function(a){a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):this.cbData.cls.m_lbl.innerHTML=unescape(a)+"&#9660;")},ajax.exec("/controller/Object/getObjName",[["obj_type",this.mainObjectType],["id",a]]))};
AntObjectGroupingSel.prototype.getForeignValueLabel=function(a){this.mainObjectType&&(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.onload=function(a){a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):this.cbData.cls.m_lbl.innerHTML=unescape(a)+"&#9660;")},ajax.exec("/controller/Object/getFkeyValName",[["obj_type",this.mainObjectType],["field",this.mainObjectField],["id",a]]))};function AntObjectTypeSel(a){this.value=a||"";this.cbData={}}AntObjectTypeSel.prototype.onchange=function(){};
AntObjectTypeSel.prototype.getValue=function(){return this.value};AntObjectTypeSel.prototype.render=function(a){var b=new CDropdownMenu,c=b.addCon();c.onclick=function(){};c=alib.dom.createElement("div",c);alib.dom.styleSet(c,"padding-left","5px");alib.dom.styleSet(c,"width","180px");alib.dom.styleSet(c,"max-height","300px");alib.dom.styleSet(c,"overflow","auto");a.appendChild(b.createButtonMenu("Select",function(a,b,c){c.loadTypes(a,b)},[c,b,this],"b1"))};
AntObjectTypeSel.prototype.loadTypes=function(a,b){a.innerHTML="<div class='loading'></div>";var c=new CAjax("json");c.cbData.cls=this;c.cbData.con=a;c.cbData.dropDown=b;c.onload=function(a){this.cbData.con.innerHTML="";for(var b in a){var c=alib.dom.createElement("div",this.cbData.con);alib.dom.styleSet(c,"padding","5px 0 5px 0");alib.dom.styleSet(c,"cursor","pointer");c.innerHTML=a[b].title;c.otype=a[b].name;c.cbData=this.cbData;c.onclick=function(){this.cbData.cls.onchange(this.otype);this.cbData.dropDown.unloadMe()}}};
c.exec("/controller/Object/getObjects")};function CAntObjectCond(){this.conditions=[];this.last_id=1}
CAntObjectCond.prototype.addWatchCondition=function(a,b,c,d){var e=this.last_id++,f={};f.id=e;this.id;f.blogic=a.value;a.m_cond=f;alib.dom.addEvntListener(a,"change",function(a){alib.userAgent.ie?a.srcElement.m_cond.blogic=a.srcElement.value:this.m_cond.blogic=this.value});f.fieldName=b.value;b.m_cond=f;alib.dom.addEvntListener(b,"change",function(a){alib.userAgent.ie?a.srcElement.m_cond.fieldName=a.srcElement.value:this.m_cond.fieldName=this.value});f.operator=c.value;c.m_cond=f;alib.dom.addEvntListener(c,
"change",function(a){alib.userAgent.ie?a.srcElement.m_cond.operator=a.srcElement.value:this.m_cond.operator=this.value});f.condId=d;this.conditions[this.conditions.length]=f;return e};CAntObjectCond.prototype.addWatchConditionVal=function(a,b){var c=this.getConditionById(a);c&&("undefined"!==typeof b.value&&(c.condValue=b.value),b.cond=c,alib.dom.addEvntListener(b,"change",function(a){alib.userAgent.ie?a.srcElement.cond.condValue=a.srcElement.value:this.cond.condValue=this.value}))};
CAntObjectCond.prototype.addWatchConditionDynSel=function(a,b){var c=this.getConditionById(a);c&&(c.condValue=b.value,b.cond=c,b.onSelect=function(){this.cond.condValue=this.value})};CAntObjectCond.prototype.addWatchConditionObSel=function(a,b){var c=this.getConditionById(a);c&&(c.condValue=sel.value,sel.cond=c,sel.onSelect=function(){this.cond.condValue=this.value},b.cond=c,b.onSelect=function(a){this.cond.condValue=a})};
CAntObjectCond.prototype.addWatchConditionBrowse=function(a,b){var c=this.getConditionById(a);c&&(c.condValue=b)};CAntObjectCond.prototype.delCondition=function(a){for(var b=0;b<this.conditions.length;b++)this.conditions[b].id==a&&this.conditions.splice(b,1)};CAntObjectCond.prototype.getNumConditions=function(){return this.conditions.length};CAntObjectCond.prototype.getConditionById=function(a){for(var b=0;b<this.conditions.length;b++)if(this.conditions[b].id==a)return this.conditions[b];return null};
CAntObjectCond.prototype.getCondition=function(a){return this.conditions[a]};CAntObjectCond.prototype.clearConditions=function(){return this.conditions=[]};
CAntObjectCond.prototype.getCondDesc=function(a){for(var b=a?new CAntObject(a):null,c=alib.dom.createElement("span"),d=0;d<this.conditions.length;d++){if(0<d){var e=alib.dom.createElement("span",c);e.innerHTML=", "+this.conditions[d].blogic+" "}var f=this.conditions[d].fieldName,g=this.conditions[d].operator,h=this.conditions[d].condValue;if(b){for(var k=b.getFieldByName(this.conditions[d].fieldName),f=k.title,e=b.getCondOperators(k.type),l=0;l<e.length;l++)e[l][0]==this.conditions[d].operator&&(g=
e[l][1]);if(-1!=g.search(/last \(x\)/i)||-1!=g.search(/next \(x\)/i))g=g.replace("(x)",h),h="";e=alib.dom.createElement("span",c);e.innerHTML=f+" "+g+" ";"fkey"==k.type||"fkey_multi"==k.type?(f=alib.dom.createElement("span",c),this.setForeignValueLabel(a,k.name,h,f)):e.innerHTML+=h}else e=alib.dom.createElement("span",c),e.innerHTML=f+" "+g+" "+h}return c};
CAntObjectCond.prototype.setForeignValueLabel=function(a,b,c,d){a&&(ajax=new CAjax("json"),ajax.cbData.con=d,ajax.onload=function(a){a.error||(this.cbData.con.innerHTML=unescape(a))},ajax.exec("/controller/Object/getFkeyValName",[["obj_type",a],["field",b],["id",c]]))};
Ant.EntityDefinitionEdit=function(a){this.obj_type=a;this.g_antObject=new CAntObject(a,null);this.form_tbl=new CToolTable("100%");this.g_tbl=new CToolTable("100%");this.viewTbl=new CToolTable("100%");this.frmObj={};this.default_form=this.default_mobile_form=!1;this.g_references=[];this.g_theme=Ant.m_theme;this.getObjects()};
Ant.EntityDefinitionEdit.prototype.showDialog=function(a){this.parentDlg=a?a:null;this.m_dlg=new CDialog("Object Editor",this.parentDlg);this.m_dlg.f_close=!0;a=this.m_dlg;this.body_dv=alib.dom.createElement("div");a.customDialog(this.body_dv,800);this.buildInterface();a.reposition()};
Ant.EntityDefinitionEdit.prototype.buildInterface=function(){var a=alib.dom.createElement("div",this.body_dv);a.innerHTML="";var b=new CWindowFrame("General Properties",null,"3px");this.buildGeneralForm(b.getCon());b.print(a);b=new CTabs;this.tabProperties(b.addTab("Properties"));var c=b.addTab("Forms");c.id="form_tab";this.tabForm(c);c=b.addTab("Views");c.id="tabView";this.tabView(c);c=b.addTab("Browse");c.id="tabBrose";this.tabBrowse(c);b.print(a);a=alib.dom.createElement("div",this.body_dv);alib.dom.styleSetClass(a,
"wizardFooter");(new CButton("Close",function(a){a.refreshLocalObject();a.m_dlg.hide()},[this],"b1")).print(a)};
Ant.EntityDefinitionEdit.prototype.buildGeneralForm=function(a){var b=alib.dom.createElement("table");a.appendChild(b);a=alib.dom.createElement("tbody",b);a=alib.dom.createElement("tr",a);b=alib.dom.createElement("td",a);alib.dom.styleSetClass(b,"label");b.innerHTML="Title: ";var c=alib.dom.createElement("input");c.type="text";c.setAttribute("maxlength",256);c.value=this.g_antObject.title;c.onchange=function(){this.g_antObject.title=this.value};b.appendChild(c);b=alib.dom.createElement("td",a);alib.ui.Button("Edit Permissions",
{className:"b2",editCls:this,onclick:function(){loadDacl(null,"/objects/"+this.editCls.obj_type)}}).print(b)};Ant.EntityDefinitionEdit.prototype.tabProperties=function(a){var b=new CWindowFrame("Add New Property",null,"3px");this.buildNewColForm(b.getCon());b.print(a);var b=new CWindowFrame("Properties"),c=b.getCon();alib.dom.styleSet(c,"height","258px");alib.dom.styleSet(c,"overflow","auto");this.loadColumns(c);b.print(a)};
Ant.EntityDefinitionEdit.prototype.buildNewColForm=function(a){var b=ALib.m_document.createElement("table");b.cls=this;a.appendChild(b);a=ALib.m_document.createElement("tbody");b.appendChild(a);var c=null,b=null,c=ALib.m_document.createElement("tr");a.appendChild(c);b=ALib.m_document.createElement("td");c.appendChild(b);b.innerHTML="Title";b=ALib.m_document.createElement("td");c.appendChild(b);this.frmObj.m_colname=ALib.m_document.createElement("input");b.appendChild(this.frmObj.m_colname);b=ALib.m_document.createElement("td");
c.appendChild(b);b.innerHTML="Type";b=ALib.m_document.createElement("td");c.appendChild(b);this.frmObj.m_coltype=ALib.m_document.createElement("select");this.frmObj.m_coltype.cls=this;this.frmObj.m_coltype.onchange=function(){this.cls.viewSubtype(this.value)};b.appendChild(this.frmObj.m_coltype);this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("select type","");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("text","text");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=
new Option("number","numeric");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("date","date");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("date & time","timestamp");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("auto incremented number","serial");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("boolean: yes/no","bool");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("category","fkey");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=
new Option("categories: multiple","fkey_multi");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("File","file");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("Folder","folder");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("object reference: single","object");this.frmObj.m_coltype[this.frmObj.m_coltype.length]=new Option("object reference: multiple","object_multi");b=alib.dom.createElement("td",c);b.id="subtype_lbl";b=alib.dom.createElement("td",c);
b.id="subtype_inp";b=ALib.m_document.createElement("td");c.appendChild(b);b.innerHTML="&nbsp;";b=ALib.m_document.createElement("td");c.appendChild(b);a=new CButton("Add",function(a){a.createProperty()},[this],"b1");b.appendChild(a.getButton())};
Ant.EntityDefinitionEdit.prototype.viewSubtype=function(a){var b=document.getElementById("subtype_lbl"),c=document.getElementById("subtype_inp");b.innerHTML="";c.innerHTML="";this.frmObj.subtype="";this.frmObj.fkey_table_key="";this.frmObj.fkey_table_title="";switch(a){case "text":b.innerHTML="Length: ";a=alib.dom.createElement("select",c);a.cls=this;a.onchange=function(){this.cls.frmObj.subtype=this.value};a[a.length]=new Option("Unlimited","");a[a.length]=new Option("Up To 512 Chars","512");a[a.length]=
new Option("Up To 256 Chars","256");a[a.length]=new Option("Up To 128 Chars","128");a[a.length]=new Option("Up To 64 Chars","64");a[a.length]=new Option("Up To 32 Chars","32");a[a.length]=new Option("Up To 16 Chars","16");a[a.length]=new Option("Up To 8 Chars","8");break;case "fkey":case "fkey_multi":this.frmObj.subtype="object_groupings";break;case "object":case "object_multi":b.innerHTML="References: ";a=alib.dom.createElement("select",c);a.cls=this;a.onchange=function(){this.cls.frmObj.subtype=
this.value};for(b=0;b<this.g_references.length;b++)a[a.length]=new Option(this.g_references[b][0],this.g_references[b][1]);break;case "":b.innerHTML=""}};
Ant.EntityDefinitionEdit.prototype.createProperty=function(){var a=new alib.net.Xhr;alib.events.listen(a,"load",function(a){var b=this.getResponse();b.error?alert(b.error):(a.data.editClass.frmObj.m_colname.value="",a.data.editClass.addProperty(b),a.data.editClass.refreshLocalObject())},{editClass:this});alib.events.listen(a,"error",function(){},{editClass:this});var b={obj_type:this.obj_type,name:this.escapePropertyTitle(this.frmObj.m_colname.value),title:this.frmObj.m_colname.value,notes:"",type:this.frmObj.m_coltype.value,
subtype:this.frmObj.subtype,readonly:!1,system:!1,required:!1};a.send("/controller/Object/addField","POST",b)};Ant.EntityDefinitionEdit.prototype.escapePropertyTitle=function(a){a=a.toLowerCase();a=a.replace(" ","_");return a=a.replace(/[^a-zA-Z0-9_]+/g,"")};
Ant.EntityDefinitionEdit.prototype.addProperty=function(a){if(a.name&&a.type){var b=this.g_tbl.addRow();b.addCell(a.title);b.addCell(a.name);b.addCell(a.type);var c=alib.dom.createElement("input");c.type="checkbox";c.checked=a.required;c.fname=a.name;c.cls=this;a.readonly?c.disabled=!0:c.onclick=function(){this.cls.setFieldRequired(this.fname,this.checked)};b.addCell(c,!1,"center");var d=alib.dom.createElement("div");if(!a.readonly&&("text"==a.type||"number"==a.type))c=alib.dom.createElement("a",
d),c.href="javascript:void(0);",c.innerHTML="edit drop-down values",c.fname=a.name,c.cls=this,c.onclick=function(){this.cls.fieldEditOptionalValues(this.fname)};else if(!a.readonly&&("fkey"==a.type||"fkey_multi"==a.type))c=alib.dom.createElement("a",d),c.href="javascript:void(0);",c.innerHTML="edit values",c.fname=a.name,c.cls=this,c.onclick=function(){this.cls.fieldEditGroupingValues(this.fname)};b.addCell(d,!1,"center");d=alib.dom.createElement("div");!a.readonly&&"fkey_multi"!=a.type&&"object_multi"!=
a.type&&(c=alib.dom.createElement("a",d),c.href="javascript:void(0);",c.innerHTML="set default",c.fname=a.name,c.cls=this,c.onclick=function(){this.cls.fieldLoadDefault(this.fname)});b.addCell(d,!1,"center");a.system?b.addCell("&nbsp;",!0,"center"):(c=ALib.m_document.createElement("div"),b.addCell(c,!0,"center"),c.innerHTML="<img border='0' src='/images/icons/delete_16.png' />",alib.dom.styleSet(c,"cursor","pointer"),c.m_rw=b,c.m_name=a.name,c.cls=this,c.onclick=function(){confirm("Are you sure you want to delete "+
this.m_name+"?")&&this.cls.deleteCol(this.m_name,this.m_rw)})}};Ant.EntityDefinitionEdit.prototype.setFieldRequired=function(a,b){if(this.g_antObject.getFieldByName(a))ajax=new CAjax("json"),ajax.exec("/controller/Object/fieldSetRequired",[["obj_type",this.g_antObject.name],["name",a],["required",b?"t":"f"]]);else for(var c=0;c<this.g_antObject.addFields.length;c++)this.g_antObject.addFields[c].name==a&&(this.g_antObject.addFields[c].required=b)};
Ant.EntityDefinitionEdit.prototype.fieldEditOptionalValues=function(a){var b=this.g_antObject.getFieldByName(a);if(b){var a=new CDialog("Optional Values for "+b.title,this.m_dlg),c=alib.dom.createElement("div");a.customDialog(c,300);var d=alib.dom.createElement("select"),e=alib.dom.createElement("div",c);alib.dom.styleSetClass(e,"label");e.innerHTML="Add New Value";var e=alib.dom.createElement("div",c),f=alib.dom.createElement("input",e);alib.dom.styleSet(f,"width","220px");alib.dom.styleSet(f,"margin-right",
"3px");f=new CButton("Add",function(a,b,c,d){a.fieldEditOptionalValuesAdd(b,c,d)},[this,f,d,b.name],"b2");f.print(e);e=alib.dom.createElement("div",c);alib.dom.styleSetClass(e,"label");e.innerHTML="Drop-Down Values";e=alib.dom.createElement("div",c);alib.dom.styleSet(d,"width","98%");d.size=10;e.appendChild(d);if(b.optional_vals&&b.optional_vals.length)for(f=0;f<b.optional_vals.length;f++)d[d.length]=new Option(b.optional_vals[f][1],b.optional_vals[f][0]);e=alib.dom.createElement("a",e);e.innerHTML=
"Delete Selected";e.href="javascript:void(0);";e.options={cls:this,cbv:d,fname:b.name};e.onclick=function(){this.options.cls.fieldEditOptionalValuesDeleteSel(this.options.cbv,this.options.fname)};b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"text-align","right");f=new CButton("Done",function(a){a.hide()},[a],"b2");f.print(b);f=new CButton("Cancel",function(a){a.hide()},[a],"b3");f.print(b);a.reposition()}else ALib.Dlg.messageBox("Please save changes before editing optional values for this field",
this.m_dlg)};
Ant.EntityDefinitionEdit.prototype.fieldEditOptionalValuesAdd=function(a,b,c){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.txt=a;ajax.cbData.cb=b;ajax.onload=function(a){a&&!a.error&&(this.cbData.cb[this.cbData.cb.length]=new Option(this.cbData.txt.value,this.cbData.txt.value),(a=this.cbData.cls.g_antObject.getFieldByName(c))&&a.optional_vals&&(a.optional_vals[a.optional_vals.length]=[this.cbData.txt.value,this.cbData.txt.value,!1,""]),this.cbData.txt.value="")};ajax.exec("/controller/Object/fieldAddOption",[["obj_type",
this.g_antObject.name],["name",c],["value",a.value]])};
Ant.EntityDefinitionEdit.prototype.fieldEditOptionalValuesDeleteSel=function(a,b){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.cb=a;ajax.cbData.fname=b;ajax.onload=function(a){if(a&&!a.error){if((a=this.cbData.cls.g_antObject.getFieldByName(this.cbData.fname))&&a.optional_vals&&a.optional_vals.length)for(var b=0;b<a.optional_vals.length;b++)a.optional_vals[b][0]==this.cbData.cb.value&&a.optional_vals.splice(b,1);for(b=0;b<this.cbData.cb.options.length;b++)this.cbData.cb.options[b].selected&&(this.cbData.cb.options[b]=
null)}};ajax.exec("/controller/Object/fieldDeleteOption",[["obj_type",this.g_antObject.name],["name",b],["value",a.value]])};
Ant.EntityDefinitionEdit.prototype.fieldEditGroupingValues=function(a){var b=this.g_antObject.getFieldByName(a);if(b){var b=new CDialog("Values for "+b.title,this.m_dlg),c=alib.dom.createElement("div");b.customDialog(c,500);var d=alib.dom.createElement("div"),e=alib.dom.createElement("div",c);alib.dom.styleSet(e,"padding","5px");e=alib.dom.createElement("a",e);e.innerHTML="Add Value";e.href="javascript:void(0);";e.con=d;e.fname=a;e.cls=this;e.onclick=function(){this.cls.addGrouping(this.con,this.fname)};
c.appendChild(d);alib.dom.styleSet(d,"height","200px");alib.dom.styleSet(d,"overflow","auto");this.fieldGroupingsLoadValues(a,d);a=alib.dom.createElement("div",c);alib.dom.styleSet(a,"text-align","right");c=new CButton("Done",function(a){a.hide()},[b],"b2");c.print(a);c=new CButton("Cancel",function(a){a.hide()},[b],"b3");c.print(a);b.reposition()}else ALib.Dlg.messageBox("Please save changes before editing optional values for this field",this.m_dlg)};
Ant.EntityDefinitionEdit.prototype.fieldGroupingsLoadValues=function(a,b){b.innerHTML="";var c=new CToolTable("100%");c.addHeader("Id","center","15px");c.addHeader("Name (click to rename)");c.addHeader("Color","center","50px");c.addHeader("Delete","center","20px");c.print(b);ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.tbl=c;ajax.cbData.fname=a;ajax.onload=function(a){a.length&&this.cbData.cls.populateGroupings(this.cbData.tbl,a,this.cbData.fname)};ajax.exec("/controller/Object/getGroupings",
[["obj_type",this.obj_type],["field",a]])};
Ant.EntityDefinitionEdit.prototype.populateGroupings=function(a,b,c){for(var d=0;d<b.length;d++){var e=a.addRow(),f=alib.dom.createElement("a");f.href="javascript:void(0)";f.innerHTML=b[d].title;f.cls=this;f.curname=b[d].title;f.gid=b[d].id;f.fname=c;f.onclick=function(){this.cls.renameGrouping(this.fname,this.gid,this.curname,this)};b[d].system&&(f=b[d].title);var g=alib.dom.createElement("select");g.onchange=function(){};for(var h=0;h<b.length;h++)g[g.length]=new Option(h+1,h+1,!1,h==d?!0:!1);b[d].system&&
(g="&nbsp;");h=alib.dom.createElement("input");h.type="checkbox";h.checked=b[d].f_closed;h.onclick=function(){};b[d].system&&(h="&nbsp;");g=alib.dom.createElement("div");b[d].color&&(g.style.backgroundColor="#"+b[d].color);for(var k=new CDropdownMenu,h=0;h<G_GROUP_COLORS.length;h++)k.addEntry(G_GROUP_COLORS[h][0],function(a,b,c,d,e){a.changeGroupingColor(b,c,e,d)},null,"<div style='width:9px;height:9px;background-color:#"+G_GROUP_COLORS[h][1]+"'></div>",[this,c,g,b[d].id,G_GROUP_COLORS[h][1]]);g.appendChild(k.createLinkMenu("set color"));
h=alib.dom.createElement("a");h.innerHTML="<img src='/images/icons/deleteTask.gif' border='0'>";h.href="javascript:void(0)";h.cls=this;h.fname=c;h.gid=b[d].id;h.gname=b[d].title;h.row=e;h.onclick=function(){confirm("Are you sure you want to delete "+this.gname+"?")&&this.cls.deleteGrouping(this.fname,this.gid,this.row)};b[d].system&&(h="&nbsp;");e.addCell(b[d].id,!1,"center");e.addCell(f);e.addCell(g,!1,"center");e.addCell(h,!0,"center")}};
Ant.EntityDefinitionEdit.prototype.changeGroupingColor=function(a,b,c,d){ajax=new CAjax("json");ajax.cbData.clrdv=b;ajax.cbData.clr=c;ajax.onload=function(a){a&&alib.dom.styleSet(this.cbData.clrdv,"background-color","#"+this.cbData.clr)};ajax.exec("/controller/Object/setGroupingColor",[["obj_type",this.obj_type],["field",a],["color",c],["gid",d]])};
Ant.EntityDefinitionEdit.prototype.addGrouping=function(a,b){var c=prompt("Enter a name for new subgroup","New Group");c&&(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.cbData.field_name=b,ajax.cbData.con=a,ajax.onload=function(a){a&&a.id&&(this.cbData.cls.fieldGroupingsLoadValues(this.cbData.field_name,this.cbData.con),Ant.EntityDefinitionLoader.get(this.cbData.cls.obj_type).load())},ajax.exec("/controller/Object/createGrouping",[["obj_type",this.obj_type],["field",b],["parent_id",""],["title",
c]]))};Ant.EntityDefinitionEdit.prototype.renameGrouping=function(a,b,c,d){d="undefined"!=typeof d?d:null;if(c=prompt("Enter a name",c))ajax=new CAjax("json"),ajax.cbData.lbldv=d,ajax.cbData.title=c,ajax.onload=function(a){a&&this.cbData.lbldv&&(this.cbData.lbldv.innerHTML=this.cbData.title)},ajax.exec("/controller/Object/renameGrouping",[["obj_type",this.obj_type],["field",a],["title",c],["gid",b]])};
Ant.EntityDefinitionEdit.prototype.deleteGrouping=function(a,b,c){ajax=new CAjax("json");ajax.cbData.row=c;ajax.onload=function(a){a&&this.cbData.row.deleteRow()};ajax.exec("/controller/Object/deleteGrouping",[["obj_type",this.obj_type],["field",a],["gid",b]])};
Ant.EntityDefinitionEdit.prototype.fieldLoadDefault=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.fname=a;ajax.onload=function(a){a&&this.cbData.cls.fieldEditDefault(this.cbData.fname,a)};ajax.exec("/controller/Object/fieldGetDefault",[["obj_type",this.g_antObject.name],["name",a]])};
Ant.EntityDefinitionEdit.prototype.fieldEditDefault=function(a,b){var c=this.g_antObject.getFieldByName(a);if(c){var d={on:b.on,value:b.value,fname:a},e=new CDialog("Default values for "+c.title,this.m_dlg),f=alib.dom.createElement("div");e.customDialog(f,300);var g=alib.dom.createElement("div",f);alib.dom.styleSetClass(g,"label");g.innerHTML="Use default when field value is:";var g=alib.dom.createElement("div",f),h=alib.dom.createElement("select");h[h.length]=new Option("none - no default value",
"",!1,""==b.on?!0:!1);h[h.length]=new Option("null - value is not set","null",!1,"null"==b.on?!0:!1);h[h.length]=new Option("update - object is updated","update",!1,"update"==b.on?!0:!1);h[h.length]=new Option("create - object is created","create",!1,"create"==b.on?!0:!1);h.frmData=d;h.onchange=function(){this.frmData.on=this.value};g.appendChild(h);g=alib.dom.createElement("div",f);alib.dom.styleSetClass(g,"label");g.innerHTML="Set value to:";g=alib.dom.createElement("div",f);this.g_antObject.fieldCreateValueInput(g,
c.name,b.value);if(g.inpRef)switch(g.inpRef.frmData=d,d.value=g.inpRef.value,g.inptType){case "checkbox":g.inpRef.onclick=function(){this.frmData.value=this.checked?"t":"f"};break;case "text":case "input":alib.dom.styleSet(g.inpRef,"width","90%");case "select":g.inpRef.onchange=function(){this.frmData.value=this.value};break;case "dynselect":g.inpRef.onSelect=function(){this.frmData.value=this.value}}c=alib.dom.createElement("div",f);alib.dom.styleSet(c,"text-align","right");d=new CButton("Done",
function(a,b,c){a.fieldEditDefaultSet(c);b.hide()},[this,e,d],"b2");d.print(c);d=new CButton("Cancel",function(a){a.hide()},[e]);d.print(c);e.reposition()}else ALib.Dlg.messageBox("Please save changes before editing defaults for this field",this.m_dlg)};
Ant.EntityDefinitionEdit.prototype.fieldEditDefaultSet=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){a&&a.status&&ALib.statusShowAlert(a.status,3E3,"bottom","right")};ajax.exec("/controller/Object/fieldSetDefault",[["obj_type",this.g_antObject.name],["name",a.fname],["on",a.on],["value",a.value]])};
Ant.EntityDefinitionEdit.prototype.tabForm=function(a){a.innerHTML="";var b=alib.dom.createElement("p",a);alib.dom.styleSetClass(b,"notice");b.innerHTML="Forms define how objects are viewed and edited. Each object type will always have two required form views: a default view for everyone and then a mobile view for mobile/smartphone users. Both of these forms can be fully customized. In addition to the defaults, new forms can be created for individual users and teams.";this.form_tbl.print(a);this.form_tbl.addHeader("Scope");
this.form_tbl.addHeader("Team");this.form_tbl.addHeader("User");this.form_tbl.addHeader("Edit");this.form_tbl.addHeader("Delete");this.addFrmTbl();a=alib.dom.createElement("div",a);b=alib.dom.createElement("select",a);alib.dom.styleSet(b,"float","left");b.cls=this;b.onchange=function(){this.cls.newForm(this.value)};b[b.length]=new Option("Create New Form","");b[b.length]=new Option("Team Form","team");b[b.length]=new Option("User Form","user");a=alib.dom.createElement("div",a);b=new CButton("Refresh",
function(a){a.addFrmTbl()},[this],"b1");a.appendChild(b.getButton())};Ant.EntityDefinitionEdit.prototype.newForm=function(a){if("team"==a){var b="/objects/form_editor.php?obj_type="+this.obj_type+"&scope=Team";window.open(b,"","fullscreen=yes")}"user"==a&&(b="/objects/form_editor.php?obj_type="+this.obj_type+"&scope=User",window.open(b,"","fullscreen=yes"))};
Ant.EntityDefinitionEdit.prototype.addFrmTbl=function(){this.form_tbl.clear();var a=new CAjax("json");a.cbData.cls=this;a.onload=function(a){a&&(0<a.length&&this.cbData.cls.createFrmTbl(a),this.cbData.cls.addDefaultForms())};a.exec("/controller/Object/getForms",[["obj_type",this.obj_type]])};
Ant.EntityDefinitionEdit.prototype.createFrmTbl=function(a){for(form in a){var b=a[form],c=this.form_tbl.addRow(),d={},e=b.type_id,f=b.scope;"default"==f&&(this.default_form=!0);"mobile"==f&&(this.default_mobile_form=!0);c.addCell(f);var g=b.team_id;c.addCell(b.team_name);var h=alib.dom.createElement("div"),k="",k=b.user_id;objectSetNameLabel("user",k,h);c.addCell(h);d.obj_type=this.obj_type;d.type_id=e;d.scope=f;d.user_id=k;d.team_id=g;b=alib.dom.createElement("div");e=alib.dom.createElement("a",
b);e.href="javascript:void(0);";e.innerHTML="edit form";e.cls=this;e.form=d;e.onclick=function(){var a="/objects/form_editor.php?obj_type="+this.cls.obj_type;"default"==this.form.scope&&(a+="&scope=Default");"mobile"==this.form.scope&&(a+="&scope=Mobile");""!=this.form.team_id&&null!=this.form.team_id&&(a+="&scope=Team&team_id="+this.form.team_id);""!=this.form.user_id&&null!=this.form.user_id&&(a+="&scope=User&user_id="+this.form.user_id);window.open(a,"","fullscreen=yes")};c.addCell(b);d=new CButton("X",
function(a,b){a.deleteForm(b)},[this,d],"b3");c.addCell(d.getButton())}};
Ant.EntityDefinitionEdit.prototype.addDefaultForms=function(){if(!this.default_form){var a=this.form_tbl.addRow();a.addCell("default");a.addCell("");a.addCell("");var b=alib.dom.createElement("div"),c=alib.dom.createElement("a",b);c.href="javascript:void(0);";c.innerHTML="edit form";c.cls=this;c.onclick=function(){window.open("/objects/form_editor.php?obj_type="+this.cls.obj_type+"&scope=Default","","fullscreen=yes")};a.addCell(b);a.addCell("")}this.default_mobile_form||(a=this.form_tbl.addRow(),
a.addCell("mobile"),a.addCell(""),a.addCell(""),b=alib.dom.createElement("div"),c=alib.dom.createElement("a",b),c.href="javascript:void(0);",c.innerHTML="edit form",c.cls=this,c.onclick=function(){window.open("/objects/form_editor.php?obj_type="+this.cls.obj_type+"&scope=Mobile&mobile=0","","fullscreen=yes")},a.addCell(b),a.addCell(""))};
Ant.EntityDefinitionEdit.prototype.deleteForm=function(a){var b=new CDialog("Delete Form",this.m_dlg),c=alib.dom.createElement("div");b.customDialog(c,240,40);var d=alib.dom.createElement("div",c);d.innerHTML="Are you sure you want to delete this form?";c.appendChild(d);c=alib.dom.createElement("div",c);alib.dom.styleSet(c,"text-align","right");a=new CButton("Ok",function(a,b,c){var d="",k="",l=c.scope;"default"==c.scope&&(d=c.scope);"mobile"==c.scope&&(k=c.scope);ajax=new CAjax("json");ajax.cbData.cls=
a;ajax.cbData.dlg=b;ajax.cbData.scope=l;ajax.onload=function(a){this.cbData.dlg.hide();"-1"!=a?("default"==this.cbData.scope&&(this.cbData.cls.default_form=!1),"mobile"==this.cbData.scope&&(this.cbData.cls.default_mobile_form=!1),this.cbData.cls.addFrmTbl(),ALib.statusShowAlert("Form Deleted!",3E3,"bottom","right")):ALib.statusShowAlert("ERROR DELETING FORM!",3E3,"bottom","right")};ajax.exec("/controller/Object/deleteForm",[["obj_type",c.obj_type],["default",d],["mobile",k],["team_id",c.team_id],
["user_id",c.user_id]])},[this,b,a],"b1");a.print(c);a=new CButton("Cancel",function(a){a.hide()},[b],"b1");a.print(c)};
Ant.EntityDefinitionEdit.prototype.deleteCol=function(a,b){var c=Ant.EntityDefinitionLoader.get(this.obj_type).getField(a);a&&b&&(c?(c=new alib.net.Xhr,alib.events.listen(c,"load",function(a){var b=this.getResponse();b.error?alert(b.error):(a.data.row.deleteRow(),a.data.editClass.refreshLocalObject())},{editClass:this,row:b}),alib.events.listen(c,"error",function(){},{editClass:this}),c.send("/controller/Object/removeField","POST",{obj_type:this.obj_type,fname:a})):b.deleteRow())};
Ant.EntityDefinitionEdit.prototype.loadColumns=function(a){this.g_tbl.print(a);this.g_tbl.addHeader("Name");this.g_tbl.addHeader("System Name");this.g_tbl.addHeader("Type");this.g_tbl.addHeader("Required");this.g_tbl.addHeader("&nbsp;");this.g_tbl.addHeader("&nbsp;");this.g_tbl.addHeader("Delete","center","50px");for(a=0;a<this.g_antObject.fields.length;a++){var b=this.g_antObject.fields[a];"account_id"!=b.name&&this.addProperty(b)}};
Ant.EntityDefinitionEdit.prototype.reloadFieldTable=function(){this.g_tbl.clear();this.g_antObject=new CAntObject(this.obj_type,null);for(var a=0;a<this.g_antObject.fields.length;a++){var b=this.g_antObject.fields[a];"account_id"!=b.name&&this.addProperty(b)}};
Ant.EntityDefinitionEdit.prototype.tabView=function(a){a.innerHTML="";var b=alib.dom.createElement("p",a);alib.dom.styleSetClass(b,"notice");b.innerHTML="Views define how users see lists of this object. A view has three scopes: (1) 'Eveyone' views are applied to everyone. (2) 'team' views are only available to users who are part of a selected team. (3) 'user' views are unique to individual users. Each of these scopes can have a default view meaning the first time a user loads the object list they will see the 'default' view. 'user' defaults override 'team' defaults and 'team' defaults will override 'everyone' defaults if set.";this.viewTbl.print(a);
this.viewTbl.addHeader("Name");this.viewTbl.addHeader("Scope");this.viewTbl.addHeader("User");this.viewTbl.addHeader("Team");this.viewTbl.addHeader("Default","left","50px");this.viewTbl.addHeader("Edit","left","50px");this.viewTbl.addHeader("Delete","left","50px");this.getViews();a=alib.dom.createElement("div",a);b=new CButton("Create New View",function(a){a.dialogView(null,!0)},[this],"b1");a.appendChild(b.getButton());b=new CButton("Refresh Views",function(a){a.getViews()},[this],"b1");a.appendChild(b.getButton())};
Ant.EntityDefinitionEdit.prototype.getViews=function(){this.viewTbl.clear();this.viewTbl.addRow().addCell("<div class='loading'></div>");var a=new CAjax("json");a.cbData.cls=this;a.onload=function(a){a&&(a.error&&ALib.statusShowAlert(a.error,3E3,"bottom","right"),a&&0<a.length&&this.cbData.cls.displayViews(a))};a.exec("/controller/Object/getViews",[["objectType",this.obj_type],["fromViewManager",!0]])};
Ant.EntityDefinitionEdit.prototype.displayViews=function(a){this.viewTbl.clear();for(view in a){var b=a[view],c=this.viewTbl.addRow();c.addCell(b.name);c.addCell(b.scope);c.addCell(b.userName);c.addCell(b.teamName);var d="no";if(b.fDefault||"t"==b.fDefault)d="yes";b.fSystem=b.f_system;c.addCell(d);var e=d="";if(b.f_system){var f=[["href","javascript:void(0);"],["innerHTML","[view]"]],d=alib.dom.setElementAttr(alib.dom.createElement("a"),f);d.cls=this;d.view=b;d.onclick=function(){this.cls.dialogView(this.view)}}else f=
[["href","javascript:void(0);"],["innerHTML","[edit]"]],d=alib.dom.setElementAttr(alib.dom.createElement("a"),f),d.cls=this,d.view=b,d.onclick=function(){this.cls.dialogView(this.view)},f=[["src","/images/icons/delete_10.png"]],e=alib.dom.setElementAttr(alib.dom.createElement("img"),f),alib.dom.styleSet(e,"cursor","pointer"),e.cls=this,e.row=c,e.view=b,e.onclick=function(){confirm("Are you sure you want to delete "+this.view.name+"?")&&this.cls.deleteView(this.view,this.row)};c.addCell(d);c.addCell(e)}};
Ant.EntityDefinitionEdit.prototype.dialogView=function(a,b){var c=new AntObjectViewEditor(this.obj_type,a);c.fEditor=!0;c.showDialog(b);c.cbData.cls=this;c.onSave=function(){this.cbData.cls.getViews()}};Ant.EntityDefinitionEdit.prototype.deleteView=function(a,b){ajax=new CAjax("json");ajax.row=b;ajax.onload=function(){this.row.deleteRow()};var c=[];c[c.length]=["dvid",a.id];ajax.exec("/controller/Object/deleteView",c)};
Ant.EntityDefinitionEdit.prototype.getObjects=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a){var b=[];for(object in a){var c=a[object];b[b.length]=[c.fullTitle,c.name,c.ObjectTable,"id",c.listTitle]}}this.cbData.cls.g_references=b};ajax.exec("/controller/Object/getObjects")};Ant.EntityDefinitionEdit.prototype.refreshLocalObject=function(){this.mainObject=new CAntObject(this.obj_type);Ant.EntityDefinitionLoader.get(this.obj_type).load()};
Ant.EntityDefinitionEdit.prototype.saveDone=function(a,b){b="undefined"!=typeof b?b:!1;a.hide();ALib.statusShowAlert(this.g_antObject.title+" Saved!",3E3,"bottom","right");b?this.m_dlg.hide():this.reloadFieldTable()};Ant.EntityDefinitionEdit.prototype.tabBrowse=function(a){a.innerHTML="";a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"height","300px");alib.dom.styleSet(a,"overflow","auto");(new AntObjectBrowser(this.obj_type)).printInline(a)};
function CAntObjectMergeWizard(a){this.objects=[];this.fields=[];this.obj_type=a;this.mainObject=new CAntObject(this.obj_type);this.steps=[];this.steps[0]="Getting Started";this.steps[1]="Define Fields";this.steps[2]="Finished"}CAntObjectMergeWizard.prototype.showDialog=function(a){this.parentDlg=a?a:null;this.m_dlg=new CDialog("Merge "+this.mainObject.titlePl,this.parentDlg);this.m_dlg.f_close=!0;a=this.m_dlg;this.body_dv=alib.dom.createElement("div");a.customDialog(this.body_dv,650,510);this.showStep(0)};
CAntObjectMergeWizard.prototype.showStep=function(a){this.body_dv.innerHTML="";this.cbTemplates=null;this.verify_step_data={};this.nextStep=a+1;this.pathDiv=alib.dom.createElement("div",this.body_dv);this.pathDiv.innerHTML="Step "+(a+1)+" of "+this.steps.length+" - "+this.steps[a];alib.dom.styleSetClass(this.pathDiv,"wizardTitle");var b=alib.dom.createElement("div",this.body_dv);alib.dom.styleSetClass(b,"wizardBody");switch(a){case 0:var c=alib.dom.createElement("h2",b);c.innerHTML="Data Merge Wizard";
c=alib.dom.createElement("h3",b);alib.dom.styleSet(c,"margin","5px 0 3px 0");c.innerHTML="This wizard will guide you through merging multiple "+this.mainObject.titlePl+" without losing data.";this.veriftyStep=function(){return!0};break;case 1:c=alib.dom.createElement("h2",b);c.innerHTML="Select Data To Merge";c=alib.dom.createElement("p",b);alib.dom.styleSet(c,"margin","0 0 10px 0");c.innerHTML="Select which record you would like to use for each value.";this.buildFrmData(b);this.veriftyStep=function(){return!0};
break;case 2:b.innerHTML="<h2>Data is ready to be merged!</h2><h3>WARNING: This cannot be undone so use caution to assure you intended to permanantly merge all the data.</h3>Click 'Finish' below to merge "+this.mainObject.titlePl+" and exit this wizard."}b=alib.dom.createElement("div",this.body_dv);alib.dom.styleSet(b,"margin-top","8px");alib.dom.styleSet(b,"text-align","right");c=new CButton("Back",function(a,b){a.showStep(b-1)},[this,a]);c.print(b);0==a&&c.disable();c=a==this.steps.length-1?new CButton("Finish",
function(a){a.merge()},[this],"b2"):new CButton("Next",function(a,b){a.veriftyStep()?a.showStep(b+1):ALib.Dlg.messageBox(a.verify_step_data.message,a.m_dlg)},[this,a],"b2");c.print(b);c=new CButton("Cancel",function(a){a.hide()},[this.m_dlg],"b3");c.print(b)};CAntObjectMergeWizard.prototype.veriftyStep=function(){return!0};CAntObjectMergeWizard.prototype.onCancel=function(){};CAntObjectMergeWizard.prototype.onFinished=function(){};
CAntObjectMergeWizard.prototype.merge=function(){for(var a=[["obj_type",this.obj_type]],b=0;b<this.objects.length;b++)a[a.length]=["objects[]",this.objects[b].id];for(b=0;b<this.fields.length;b++)a[a.length]=["fld_use_"+this.fields[b].name,this.fields[b].object_id];this.m_dlg.hide();var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Merging data, please wait...";b.statusDialog(c,250,100);ajax=new CAjax("json");
ajax.cbData.cls=this;ajax.cbData.dlg=b;ajax.onload=function(a){this.cbData.dlg.hide();if(!a.error)this.cbData.cls.onFinished(a,this.cbData.cls.message)};ajax.exec("/controller/Object/mergeObjects",a)};CAntObjectMergeWizard.prototype.addObject=function(a){a=new CAntObject(this.obj_type,a);a.mergeCls=this;a.onload=function(){3==this.mergeCls.nextStep&&this.mergeCls.showStep(2)};a.load();this.objects[this.objects.length]=a};
CAntObjectMergeWizard.prototype.buildFrmData=function(a){var b=new CToolTable("100%");b.print(a);b.addHeader("&nbsp;");for(a=0;a<this.objects.length;a++)b.addHeader("&nbsp;","12px"),b.addHeader(this.mainObject.title+" "+this.objects[a].id);for(var c=this.mainObject.getFields(),a=0;a<c.length;a++)if("id"!=c[a].name&&"ts_created"!=c[a].name&&"ts_updated"!=c[a].name&&"account_id"!=c[a].name){var d=b.addRow();d.addCell(c[a].title,!0);for(var e=0;e<this.objects.length;e++){var f=alib.dom.createElement("input");
f.type="radio";f.name="use_opt_"+c[a].name;f.field_name=c[a].name;f.value=this.objects[e].id;f.cls=this;f.checked=this.getFieldUse(c[a].name)==this.objects[e].id?!0:!1;f.onclick=function(){this.cls.setFieldUse(this.field_name,this.value)};d.addCell(f,!1,"center");"fkey_multi"==c[a].type?d.addCell(this.objects[e].getMultiValueStr(c[a].name),!1):"fkey"==c[a].type?d.addCell(this.objects[e].getValueName(c[a].name),!1):d.addCell(this.objects[e].getValue(c[a].name),!1)}}};
CAntObjectMergeWizard.prototype.setFieldUse=function(a,b){for(var c=0;c<this.fields.length;c++)if(this.fields[c].name==a){this.fields[c].object_id=b;return}this.fields[this.fields.length]={name:a,object_id:b}};CAntObjectMergeWizard.prototype.getFieldUse=function(a){for(var b=0;b<this.fields.length;b++)if(this.fields[b].name==a)return this.fields[b].object_id;for(var c=0,b=0;b<this.objects.length;b++)if(this.objects[b].getValue(a)){c=b;break}this.setFieldUse(a,this.objects[c].id);return this.objects[c].id};
function AntObjectFormEditor(a){this.mainObject=new CAntObject(a);this.cbData={};this.canvasCon=this.toolbarCon=this.editorCon=this.mainCon=null;this.dropZoneName="dropZone";this.scope="default";this.teamId=this.userId=this.scopeType=null;this.numTabs=this.dropZoneGroup=this.containerIndex=0;this.availableTabs=[];this.formViewTabs=new CTabs;this.uiml={};this.codeViewChanged=!1}AntObjectFormEditor.prototype.print=function(a){this.mainCon=a;this.checkDefaultForm()};
AntObjectFormEditor.prototype.buildInterface=function(){this.numTabs=this.dropZoneGroup=this.containerIndex=0;this.availableTabs=[];this.formViewTabs=new CTabs;this.mainCon.innerHTML="";this.toolbarCon=alib.dom.createElement("div",this.mainCon);this.editorCon=alib.dom.createElement("div",this.mainCon);this.buildToolbar();this.buildEditor()};
AntObjectFormEditor.prototype.buildToolbar=function(){var a=new CToolbar,b=alib.ui.Button("Close",{className:"b1",callback:this,onclick:function(){window.close()}});a.AddItem(b.getButton());b=alib.ui.Button("Save & Close",{className:"b2",callback:this,onclick:function(){this.callback.saveObjectForm(!0)}});a.AddItem(b.getButton());b=alib.ui.Button("Save",{className:"b2",callback:this,onclick:function(){this.callback.saveObjectForm(!1)}});a.AddItem(b.getButton());a.print(this.toolbarCon)};
AntObjectFormEditor.prototype.buildEditor=function(){this.tabsEditor=new CTabs;var a=this.tabsEditor.addTab("Form View"),b=this.tabsEditor.addTab("Code View",function(a){a.setupCodeView()},[this]);this.tabsEditor.cbData.cls=this;this.tabsEditor.onSelectTab=function(a){if(0==a){var b=this.cbData.cls;if(b.codeViewChanged)return ALib.Dlg.confirmBox("Swtiching to Form View needs to save the changes made. Do you want to proceed?","Confirm Changes"),ALib.Dlg.onConfirmOk=function(){b.saveObjectForm(!1);
b.codeViewChanged=!1;return!0},!1}return!0};a.id="formView";b.id="codeView";this.tabsEditor.print(this.editorCon);var c=new CSplitContainer;c.resizable=!0;this.formCanvas=c.addPanel("*");this.formFields=c.addPanel("230px");c.print(a);this.buildFormView();this.buildCodeView(b)};
AntObjectFormEditor.prototype.buildFormViewToolbar=function(){var a=alib.dom.createElement("div",this.formCanvas),b=new CToolbar,c=alib.ui.Button("Delete Tab",{className:"b3",callback:this,onclick:function(){var a=this.callback;ALib.Dlg.confirmBox("Are you sure you want to delete this tab?","Delete Tab");ALib.Dlg.onConfirmOk=function(){a.deleteTab()}}});b.AddItem(c.getButton(),"right");c=alib.ui.Button("Rename Tab",{className:"b1",callback:this,onclick:function(){this.callback.setOptions({id:"tab"})}});
b.AddItem(c.getButton(),"right");c=alib.ui.Button("Add Tab",{className:"b2",callback:this,onclick:function(){this.callback.addTab(this.callback.canvasCon,"New Tab",!0)}});b.AddItem(c.getButton(),"right");b.print(a)};
AntObjectFormEditor.prototype.buildFormView=function(){this.buildFormViewToolbar();this.canvasCon=alib.dom.createElement("div",this.formCanvas);alib.dom.setElementAttr(alib.dom.createElement("h2",this.canvasCon),[["innerHTML",this.mainObject.title]]);var a=getWorkspaceHeight()-this.toolbarCon.offsetHeight-100+"px";alib.dom.styleSet(this.canvasCon,"max-height",a);alib.dom.styleSet(this.canvasCon,"overflow","auto");"*"!=this.xmlFormLayoutText&&this.buildEditorForm(this.canvasCon,this.xmlFormLayout);
this.buildFields()};AntObjectFormEditor.prototype.buildCodeView=function(a){a=alib.dom.createElement("div",a);this.codeViewInput=alib.dom.createElement("textarea",a);this.codeViewInput.cls=this;this.codeViewInput.onchange=function(){this.cls.codeViewChanged=!0};alib.dom.styleSet(this.codeViewInput,"width","99%");alib.dom.styleSet(this.codeViewInput,"height",alib.dom.getDocumentHeight()-80+"px")};
AntObjectFormEditor.prototype.buildEditorForm=function(a,b){for(var c=0,d=0,e=null,f=0;f<b.getNumChildren();f++){var g=b.getChildNode(f);"column"==g.m_name&&c++}c||(c=1);for(f=0;f<b.getNumChildren();f++)switch(g=b.getChildNode(f),g.m_name){case "tab":this.buildEditorForm(this.addTab(a,g.getAttribute("name"),!1).childNodes[1],g);break;case "plugin":var h=alib.dom.createElement("div");""!=g.getAttribute("name")&&(h.name=g.getAttribute("name"));h.id="plugin";h.title="Plugin name='"+g.getAttribute("name")+
"'";this.appendXmlContainer(h,a);this.buildEditorForm(h,g);break;case "recurrence":h=alib.dom.createElement("div");h.id="recurrence";h.title="Recurrence";this.appendXmlContainer(h,a);this.buildEditorForm(h,g);break;case "report":h=alib.dom.createElement("div");""!=g.getAttribute("id")&&(h.reportid=g.getAttribute("id"));""!=g.getAttribute("filterby")&&(h.filterby=g.getAttribute("filterby"));h.id="report";h.title="Report";this.appendXmlContainer(h,a);this.buildEditorForm(h,g);break;case "fieldset":var k=
alib.dom.createElement("div");""!=g.getAttribute("name")&&(h=g.getAttribute("name"),h=h.replace("&","&amp;"),k.name=h);""!=g.getAttribute("showif")?(h=g.getAttribute("showif"),k.showifType=h.substring(0,h.indexOf("=")),k.showifValue=h.substring(h.indexOf("=")+1,h.length)):(k.showifType=null,k.showifValue=null);k.id="fieldset";k.title=k.name=g.getAttribute("name");this.appendXmlDropContainer(k,a);this.buildEditorForm(k,g);break;case "objectsref":h=alib.dom.createElement("div");h.objType=""!=g.getAttribute("obj_type")?
g.getAttribute("obj_type"):null;h.refField=""!=g.getAttribute("ref_field")?g.getAttribute("ref_field"):null;h.id="objectsref";h.title="Objectsref";this.appendXmlContainer(h,a);this.buildEditorForm(h,g);break;case "spacer":h=alib.dom.createElement("div");h.id="spacer";h.title="Spacer";this.appendXmlContainer(h,a);this.buildEditorForm(h,g);break;case "row":k=alib.dom.createElement("div");""!=g.getAttribute("showif")?(h=g.getAttribute("showif"),k.showifType=h.substring(0,h.indexOf("=")),k.showifValue=
h.substring(h.indexOf("=")+1,h.length)):(k.showifType=null,k.showifValue=null);k.id="row";k.title="Row";this.appendXmlDropContainer(k,a);this.buildEditorForm(k,g);break;case "column":e||(h=alib.dom.createElement("table",a),alib.dom.styleSet(h,"table-layout","fixed"),alib.dom.styleSet(h,"width","100%"),e=alib.dom.createElement("tbody",h),e=alib.dom.createElement("tr",e),h.numCol=c);d++;k=alib.dom.createElement("td",e);alib.dom.styleSet(k,"vertical-align","top");var l=alib.dom.createElement("div");
l.showifType=null;l.showifValue=null;l.styleAttr=null;if((h=g.getAttribute("width"))&&"undefined"!=typeof h)200>h.slice(0,-2)&&(h="200px"),l.width=h,k.style.width=h;h=g.getAttribute("showif");""!=h&&(l.showifType=h.substring(0,h.indexOf("=")),l.showifValue=h.substring(h.indexOf("=")+1,h.length));h=g.getAttribute("style");"undefined"!=typeof h&&(l.styleAttr=h);l.id="column";l.title="Column";this.appendXmlDropContainer(l,k);this.buildEditorForm(l,g);break;case "field":h=this.getFieldTitle(g.getAttribute("name"));
k=alib.dom.createElement("div");k.title=h;k.label=h;k.tooltip=null;k.part=null;k.hidelabel=!1;"image_id"==g.getAttribute("name")&&("t"==g.getAttribute("profile_image")?(k.profile_image=!0,k.path=g.getAttribute("path")):(k.profile_image=!1,k.path=""));g.getAttribute("multiline")&&(k.multiline="t"==g.getAttribute("multiline")?!0:!1,k.rich="t"==g.getAttribute("rich")?!0:!1);"t"==g.getAttribute("hidelabel")&&(k.hidelabel=!0);g.getAttribute("tooltip")&&(k.tooltip=g.getAttribute("tooltip"));g.getAttribute("part")&&
(k.part=g.getAttribute("part"));g.getAttribute("label")&&(k.label=g.getAttribute("label"));k.type="field";k.id=g.getAttribute("name");this.appendXmlContainer(k,a);this.buildEditorForm(k,g);break;case "all_additional":h=alib.dom.createElement("div"),h.id="all_additional",h.title="All Additional",this.appendXmlContainer(h,a),this.buildEditorForm(h,g)}};
AntObjectFormEditor.prototype.buildFormTab=function(a){var b=alib.dom.setElementAttr(alib.dom.createElement("div",a),[["innerHTML","<center><h2>Drag items here</h2></center>"],["margin","3px 0 0 0"],["width","100%"]]),c=alib.dom.createElement("div",a);b.rootdz=!0;DragAndDrop.registerDropzone(b,this.dropZoneName);b.cls=this;b.onDragEnter=function(){alib.dom.styleSet(this,"border","1px solid blue")};b.onDragExit=function(){alib.dom.styleSet(this,"border","")};b.onDragDrop=function(a){alib.dom.styleSet(this,
"border","");this.cls.appendDragDrop(a,c)};b.onResort=function(){};c.dropZoneName="dz"+this.dropZoneGroup;DragAndDrop.registerDropzone(c,c.dropZoneName);DragAndDrop.registerSortable(c)};
AntObjectFormEditor.prototype.appendXmlContainer=function(a,b){this.containerIndex++;a.oid=this.containerIndex;a.pnode=b;a.antType="field";var c=alib.dom.setElementAttr(alib.dom.createElement("div",b),[["id","divObjContainer"],["margin","5px 5px 5px 5px"],["border","1px solid black"],["padding","5px"],["cursor","move"]]);"tab"==b.id?DragAndDrop.registerDragableChild(null,c,null,b.dropZoneName):DragAndDrop.registerDragableChild(b.parentNode,c,null,b.dropZoneName);a.innerHTML=a.label?a.label:a.title;
alib.dom.styleSet(a,"float","left");c.appendChild(a);var d=alib.dom.setElementAttr(alib.dom.createElement("div",c),[["float","right"]]),d=alib.dom.setElementAttr(alib.dom.createElement("div",d),[["float","right"]]);if("all_additional"!=a.id&&"recurrence"!=a.id&&"spacer"!=a.id){var e=alib.ui.Button("Options",{className:"b1 small",callback:this,con:a,onclick:function(){this.callback.setOptions(this.con)}},"link");d.appendChild(e.getButton())}e=alib.ui.Button("X",{className:"b3 small",callback:this,
mainCon:c,con:a,onclick:function(){this.callback.deleteItem(this.mainCon,this.con)}},"link");d.appendChild(e.getButton());alib.dom.setElementAttr(alib.dom.createElement("div",d),[["clear","both"]]);alib.dom.setElementAttr(alib.dom.createElement("div",c),[["clear","both"]])};
AntObjectFormEditor.prototype.appendXmlDropContainer=function(a,b,c){this.containerIndex++;a.oid=this.containerIndex;a.pnode=b;a.antType="con";var d=[["id","divDropContainer"],["margin","5px 5px 5px 5px"],["border","1px solid black"],["padding","5px"],["cursor","move"]],e=alib.dom.setElementAttr(alib.dom.createElement("div",b),d);if(c)for(attr in c)alib.dom.styleSet(e,attr,c[attr]);var f=alib.dom.setElementAttr(alib.dom.createElement("div",e),[["float","right"]]),d=alib.dom.setElementAttr(alib.dom.createElement("div",
f),[["float","right"]]),g=new CDropdownMenu;g.addEntry("1",function(b){b.addColumn(a,1)},null,null,[this]);g.addEntry("2",function(b){b.addColumn(a,2)},null,null,[this]);g.addEntry("3",function(b){b.addColumn(a,3)},null,null,[this]);g.addEntry("4",function(b){b.addColumn(a,4)},null,null,[this]);d.appendChild(g.createLinkMenu("Columns"));g=alib.ui.Button("Options",{className:"b1 small",callback:this,con:a,onclick:function(){this.callback.setOptions(this.con)}},"link").getButton();alib.dom.styleSet(g,
"margin-left","3px");d.appendChild(g);g=alib.ui.Button("X",{className:"b3 small",callback:this,mainCon:e,con:a,onclick:function(){this.callback.deleteItem(this.mainCon,this.con)}},"link");d.appendChild(g.getButton());alib.dom.setElementAttr(alib.dom.createElement("div",e),[["innerHTML",a.title],["margin","0 145px 0 0"]]);alib.dom.setElementAttr(alib.dom.createElement("div",e),[["height","5px"]]);"column"==a.id?a.dropZoneName="col"+this.dropZoneGroup:(this.dropZoneGroup++,a.dropZoneName="dz"+this.dropZoneGroup);
DragAndDrop.registerDropzone(a,a.dropZoneName);DragAndDrop.registerSortable(a);"tab"==b.id?DragAndDrop.registerDragableChild(null,e,null,b.dropZoneName):"column"==a.id?c?DragAndDrop.registerDragableChild(b.parentNode,e,null,b.parentNode.dropZoneName):DragAndDrop.registerDragableChild(b.parentNode.parentNode.parentNode.parentNode.parentNode,e,null,b.parentNode.dropZoneName):DragAndDrop.registerDragableChild(b.parentNode,e,null,b.dropZoneName);d=[["innerHTML","<center><strong>Drag items here</strong></center>"],
["margin","5px"],["padding","5px"],["height","15px"]];b=alib.dom.setElementAttr(alib.dom.createElement("div",e),d);b.cls=this;DragAndDrop.registerDropzone(b,this.dropZoneName);b.onDragEnter=function(){alib.dom.styleSet(this,"border","1px solid blue")};b.onDragExit=function(){alib.dom.styleSet(this,"border","")};b.onDragDrop=function(b){alib.dom.styleSet(this,"border","");this.cls.appendDragDrop(b,a)};b.onResort=function(){};alib.dom.setElementAttr(alib.dom.createElement("div",f),[["clear","both"]]);
alib.dom.setElementAttr(alib.dom.createElement("div",e),[["clear","both"]]);e.appendChild(a)};AntObjectFormEditor.prototype.appendDragDrop=function(a,b){var c=alib.dom.createElement("div");c.id=a.id;c.title=a.title;switch(a.id){case "row":case "fieldset":c.showifType=null;c.showifValue=null;this.appendXmlDropContainer(c,b);break;default:this.appendXmlContainer(c,b)}};
AntObjectFormEditor.prototype.buildFields=function(){alib.dom.setElementAttr(alib.dom.createElement("label",this.formFields),[["innerHTML","Available Fields"],["font-weight","bold"]]);var a=[["border","1px solid"],["height","300px"],["overflow","auto"],["margin-bottom","15px"]],b=alib.dom.setElementAttr(alib.dom.createElement("div",this.formFields),a),a=alib.dom.setElementAttr(alib.dom.createElement("div",b),[["width","99%"],["height","99%"]]);this.createDragDrop(a,"all_additional","All Additional");
this.createDragDrop(a,"objectsref","All Objectsref");this.createDragDrop(a,"plugin","Plugin");this.createDragDrop(a,"recurrence","Recurrence");this.createDragDrop(a,"report","Report");this.createDragDrop(a,"spacer","Spacer");for(field in this.mainObject.fields){var c=this.mainObject.fields[field],d=this.createDragDrop(a,c.name,c.title);d.type=c.type;d.subtype=c.subtype}alib.dom.setElementAttr(alib.dom.createElement("label",this.formFields),[["innerHTML","Containers"],["font-weight","bold"]]);a=[["border",
"1px solid"],["overflow","auto"]];a=alib.dom.setElementAttr(alib.dom.createElement("div",this.formFields),a);alib.dom.setElementAttr(alib.dom.createElement("div",b),[["width","99%"],["height","99%"]]);this.createDragDrop(a,"row","Row");this.createDragDrop(a,"row","Fieldset")};
AntObjectFormEditor.prototype.createDragDrop=function(a,b,c){var d=[["innerHTML",c],["border","1px solid"],["margin","3px"],["padding","3px"],["cursor","move"]],a=alib.dom.setElementAttr(alib.dom.createElement("div",a),d);a.id=b;a.title=c;DragAndDrop.registerDragable(a,null,this.dropZoneName);return a};
AntObjectFormEditor.prototype.saveObjectForm=function(a){0==this.tabsEditor.curr_index&&this.setupCodeView();this.testXmlString()&&(ajax=new CAjax("json"),ajax.cbData.dlg=showDialog("Saving, please wait..."),ajax.cbData.cls=this,ajax.onload=function(b){b?(this.cbData.dlg.hide(),a?window.close():this.cbData.cls.checkDefaultForm()):(this.cbData.dlg.hide(),ALib.statusShowAlert("Error occurred while saving changes.!",3E3,"bottom","right"))},ajax.exec("/controller/Object/saveForm",[["obj_type",this.mainObject.obj_type],
["form_layout_xml",this.codeViewInput.value],["default",this.scope],["team_id",this.teamId],["user_id",this.userId]]))};
AntObjectFormEditor.prototype.checkDefaultForm=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a)if(a.error)ALib.statusShowAlert(a.error,3E3,"bottom","right");else{for(form in a){var b=a[form];"default"==b.scope&&"default"==this.cbData.cls.scope?this.cbData.cls.scopeType="default":"mobile"==b.scope&&"mobile"==this.cbData.cls.scope&&(this.cbData.cls.scopeType="mobile")}this.cbData.cls.getXmlForm()}};ajax.exec("/controller/Object/getForms",[["obj_type",this.mainObject.obj_type]])};
AntObjectFormEditor.prototype.getXmlForm=function(){var a=new CAjax;a.cbData.cls=this;a.onload=function(a){this.cbData.cls.xmlFormLayout=a.getChildNodeByName("form");this.cbData.cls.xmlFormLayoutText=unescape(a.getChildNodeValByName("form_layout_text"));this.cbData.cls.buildInterface()};var b="/controller/Object/loadForm?obj_type="+this.mainObject.obj_type;this.scopeType&&(b+="&"+this.scopeType+"=1");this.teamId&&(b+="&team_id="+this.teamId);this.userId&&(b+="&user_id="+this.teamId);a.exec(b)};
AntObjectFormEditor.prototype.getFieldTitle=function(a){return this.mainObject.getFieldByName(a).title};AntObjectFormEditor.prototype.addColumn=function(a,b){var c=[];c.width=100/b-5+"%";c["float"]="left";for(var d=0;d<b;d++){var e=alib.dom.createElement("div");e.id="column";e.title="Column";e.showifType="";e.showifValue="";this.appendXmlDropContainer(e,a,c)}alib.dom.setElementAttr(alib.dom.createElement("div",a),[["clear","both"]]);for(c=a.parentNode.parent;c;)c.dragable=!0,c=c.parentNode};
AntObjectFormEditor.prototype.setOptions=function(a){if("tab"!=a.id)for(var b=a.parentNode.parent;b;)b.dragable=!0,b=b.parentNode;var b=new CDialog,c=alib.dom.createElement("div"),d=90;b.m_title=a.id.capitalize()+" Options";var e={className:"b2",dlg:b,con:a,formViewTabs:this.formViewTabs,onclick:function(){this.tabName&&(this.formViewTabs.setTabTitle(this.tabIdx,this.tabName.value),this.formViewTabs.getPageCon(this.tabIdx).name=this.tabName.value);this.name&&""!=this.name.value&&(this.con.name=this.name.value,
"plugin"==this.con.id?this.con.parentNode.childNodes[0].innerHTML="Plugin name='"+this.name.value+"'":this.con.parentNode.childNodes[1].innerHTML=this.name.value);this.styleAttr&&""!=this.styleAttr.value&&(this.con.styleAttr=this.styleAttr.value);if(this.width&&""!=this.width.value&&1!=this.con.parentNode.parentNode.parentNode.parentNode.parentNode.numCol){this.con.parentNode.parentNode.style.width=this.width.value;this.con.width=this.width.value;for(var a=0;a<this.con.parentNode.parentNode.parentNode.childNodes.length;a++)this.con.parentNode.parentNode.parentNode.childNodes[a].width!=
this.width.value&&(this.con.parentNode.parentNode.parentNode.childNodes[a].childNodes[0].childNodes[4].width=alib.dom.styleGet(this.con.parentNode.parentNode.parentNode.childNodes[a],"width"))}this.showifType&&""!=this.showifType.value&&""!=this.showifValue.value&&(this.con.showifType=this.showifType.value,this.con.showifValue=this.showifValue.value);this.objType&&(this.con.objType=this.objType.value);this.refField&&(this.con.refField=this.refField.value);this.hideLabel&&(this.con.hidelabel=this.hideLabel.checked);
this.tooltip&&(this.con.tooltip=this.tooltip.value);this.multiline&&(this.con.multiline=this.multiline.checked);this.rich&&(this.con.rich=this.rich.checked);this.part&&(this.con.part=this.part.value);this.label&&(this.con.label=this.label.value,this.con.parentNode.childNodes[0].innerHTML=this.label.value);this.dlg.hide()}};switch(a.id){case "plugin":case "fieldset":var f=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML","Name:"]]);f=alib.dom.setElementAttr(alib.dom.createElement("input",
f),[["value",a.name],["width","190px"]]);alib.dom.styleSet(f,"margin-left","15px");e.name=f;break;case "column":d=110;f=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML","Width:"]]);var f=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["value",alib.dom.styleGet(a.parentNode.parentNode,"width")],["width","85px"]]),g=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",g),[["innerHTML","Style:"]]);g=
alib.dom.setElementAttr(alib.dom.createElement("input",g),[["value",a.styleAttr],["width","190px"]]);alib.dom.styleSet(f,"margin-left","14px");alib.dom.styleSet(g,"margin","5px 0 0 18px");e.width=f;e.styleAttr=g}switch(a.id){case "tab":d=this.formViewTabs.getIndex();f=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML","Name:"]]);f=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["value",this.formViewTabs.getPageCon(d).name],["width",
"200px"]]);e.tabName=f;e.tabIdx=d;alib.dom.styleSet(f,"margin-left","5px");d=60;break;case "fieldset":case "column":case "row":f=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML","Show If:"]]);g=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["value",a.showifType],["width","85px"]]);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML"," = "]]);a=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["value",
a.showifValue],["width","85px"]]);e.showifType=g;e.showifValue=a;alib.dom.styleSet(f,"margin-top","5px");alib.dom.styleSet(g,"margin-left","5px");break;case "objectsref":f=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML","Object Type:"]]);f=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["value",a.objType],["width","165px"]]);g=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",g),[["innerHTML",
"Ref Field:"]]);a=alib.dom.setElementAttr(alib.dom.createElement("input",g),[["value",a.refField],["width","166px"]]);alib.dom.styleSet(f,"margin-left","14px");alib.dom.styleSet(a,"margin-left","30px");alib.dom.styleSet(a,"margin-top","5px");e.objType=f;e.refField=a;break;case "plugin":case "all_additional":case "recurrence":case "spacer":break;default:d+=30;b.m_title=a.title+" Options";f=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",f),[["innerHTML","Label: "]]);
f=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["value",a.label],["width","190px"]]);alib.dom.styleSet(f,"margin-left","7px");alib.dom.styleSet(f,"margin-bottom","5px");var h=alib.dom.createElement("div",c);alib.dom.setElementAttr(alib.dom.createElement("label",h),[["innerHTML","Tooltip: "]]);g=alib.dom.setElementAttr(alib.dom.createElement("input",h),[["value",a.tooltip],["width","190px"]]);alib.dom.styleSet(h,"margin-bottom","5px");if(a.part){d+=20;h=alib.dom.createElement("div",c);
alib.dom.setElementAttr(alib.dom.createElement("label",h),[["innerHTML","Part: "]]);var k=alib.dom.setElementAttr(alib.dom.createElement("input",h),[["value",a.part],["width","190px"]]);alib.dom.styleSet(k,"margin-left","12px");alib.dom.styleSet(h,"margin-bottom","5px");e.part=k}if(null!=a.multiline&&null!=a.rich){d+=30;k=alib.dom.createElement("div",c);h=alib.dom.setElementAttr(alib.dom.createElement("input",k),[["type","checkbox"],["checked",a.multiline]]);alib.dom.setElementAttr(alib.dom.createElement("label",
k),[["innerHTML"," Multiline"]]);var k=alib.dom.createElement("div",c),l=alib.dom.setElementAttr(alib.dom.createElement("input",k),[["type","checkbox"],["checked",a.rich]]);alib.dom.setElementAttr(alib.dom.createElement("label",k),[["innerHTML"," Rich"]]);e.multiline=h;e.rich=l}h=alib.dom.createElement("div",c);a=alib.dom.setElementAttr(alib.dom.createElement("input",h),[["type","checkbox"],["checked",a.hidelabel]]);alib.dom.setElementAttr(alib.dom.createElement("label",h),[["innerHTML"," Hide Label"]]);
e.label=f;e.tooltip=g;e.hideLabel=a}a=alib.dom.createElement("div",c);e=alib.ui.Button("Ok",e);a.appendChild(e.getButton());e=alib.ui.Button("Cancel",{className:"b1",dlg:b,onclick:function(){this.dlg.hide()}});a.appendChild(e.getButton());alib.dom.styleSet(a,"float","right");alib.dom.styleSet(a,"margin-top","5px");alib.dom.divClear(c);b.customDialog(c,260,d)};
AntObjectFormEditor.prototype.deleteItem=function(a,b){"column"==b.id?(b.parentNode.conState=!1,alib.dom.styleSet(b.parentNode,"display","none")):(b.conState=!1,alib.dom.styleSet(a,"display","none"));for(var c=a.parent;c;)c.dragable=!0,c=c.parentNode};
AntObjectFormEditor.prototype.addTab=function(a,b,c){this.availableTabs[this.availableTabs.length]={available:!0};this.containerIndex++;this.numTabs++;var b=b.replace("&","&amp;"),d=this.formViewTabs.addTab(b);d.oid=this.containerIndex;d.id="tab";d.antType="con";d.name=b;c?this.formViewTabs.selectTab(this.numTabs-1):this.formViewTabs.print(a);this.buildFormTab(d);return d};
AntObjectFormEditor.prototype.deleteTab=function(){var a=this.formViewTabs.getIndex();this.availableTabs[a].available=!1;this.formViewTabs.getPageCon(a).conState=!1;this.formViewTabs.deleteTab(a);if(0==this.formViewTabs.getNumTabs())this.addTab(this.canvasCon,"New Tab",!0);else for(tab in this.availableTabs)if(!0==this.availableTabs[tab].available){this.formViewTabs.selectTab(tab);break}};
AntObjectFormEditor.prototype.generateUIML=function(a,b){var c=tabSpace(b);if(a.children&&a.children.length)for(node in a.children){var d=a.children[node];switch(d.type){case "tab":var e=d.name.replace("&","&amp;");this.xmlFormLayoutText+="<tab name='"+e+"'>\n";null!=d.children&&this.generateUIML(d,b+1);this.xmlFormLayoutText+="</tab>\n";break;case "column":this.xmlFormLayoutText+=c+"<column";null!=d.width&&(this.xmlFormLayoutText+=" width='"+d.width+"'");null!=d.styleAttr&&(this.xmlFormLayoutText+=
" style='"+d.styleAttr+"'");null!=d.showif&&(this.xmlFormLayoutText+=" showif='"+d.showif+"'");this.xmlFormLayoutText+=">\n";null!=d.children&&this.generateUIML(d,b+1);this.xmlFormLayoutText+=c+"</column>\n";break;case "row":this.xmlFormLayoutText=null!=d.showif?this.xmlFormLayoutText+(c+"<row showif='"+d.showif+"'>\n"):this.xmlFormLayoutText+(c+"<row>\n");null!=d.children&&this.generateUIML(d,b+1);this.xmlFormLayoutText+=c+"</row>\n";break;case "fieldset":e=d.name.replace("&","&amp;");this.xmlFormLayoutText=
null!=d.showif?this.xmlFormLayoutText+(c+"<fieldset name='"+e+"' showif='"+d.showif+"'>\n"):this.xmlFormLayoutText+(c+"<fieldset name='"+e+"'>\n");null!=d.children&&this.generateUIML(d,b+1);this.xmlFormLayoutText+=c+"</fieldset>\n";break;case "objectsref":this.xmlFormLayoutText+=c+"<objectsref obj_type='"+d.objType+"'";null!=d.refField&&(this.xmlFormLayoutText+=" ref_field='"+d.refField+"'");this.xmlFormLayoutText+="></objectsref>\n";break;case "report":this.xmlFormLayoutText+=c+"<report id='"+d.reportid+
"' filterby='"+d.filterby+"'></report>\n";break;case "all_additional":case "recurrence":case "spacer":this.xmlFormLayoutText+=c+"<"+d.type+"></"+d.type+">\n";break;case "plugin":this.xmlFormLayoutText+=c+"<plugin name='"+d.name+"'></plugin>\n";break;default:this.xmlFormLayoutText+=c+"<field name='"+d.type+"' ","undefined"!==typeof d.multiline&&(this.xmlFormLayoutText=!0==d.multiline?this.xmlFormLayoutText+"multiline='t' ":this.xmlFormLayoutText+"multiline='f' "),"undefined"!==typeof d.rich&&(this.xmlFormLayoutText=
!0==d.rich?this.xmlFormLayoutText+"rich='t' ":this.xmlFormLayoutText+"rich='f' "),d.tooltip&&(this.xmlFormLayoutText+="tooltip='"+d.tooltip+"' "),d.part&&(this.xmlFormLayoutText+="part='"+d.part+"' "),d.label&&d.label!=d.title&&(this.xmlFormLayoutText+="label='"+d.label+"' "),this.xmlFormLayoutText=d.hidelabel?this.xmlFormLayoutText+"hidelabel='t'":this.xmlFormLayoutText+"hidelabel='f'",d.profileimage&&(this.xmlFormLayoutText+=" profile_image='t' path='"+d.path),this.xmlFormLayoutText+="></field>\n"}}};
AntObjectFormEditor.prototype.mapNodes=function(a){for(node in a.childNodes){var b=a.childNodes[node];if(null==b.antType&&null!=b.childNodes)this.mapNodes(b);else switch(b.antType){case "con":if(!1==b.conState)break;this.buildFormArray(b);this.mapNodes(b);break;case "field":if(!1==b.conState)break;this.buildFormArray(b)}}};
AntObjectFormEditor.prototype.buildFormArray=function(a){var b={conId:a.oid,type:a.id,children:[]};a.name&&(b.name=a.name);if("tab"==a.id)this.uiml.children[this.uiml.children.length]=b;else if("column"==a.id)a.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.oid?this.mapChildNodes(this.uiml,a,a.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.oid):this.mapChildNodes(this.uiml,a,a.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.oid);else if(a.pnode.oid)this.mapChildNodes(this.uiml,
a,a.parentNode.parentNode.oid);else if(a.parentNode.parentNode.parentNode.oid)this.mapChildNodes(this.uiml,a,a.parentNode.parentNode.parentNode.oid);else{switch(a.id){case "plugin":b.children=null;break;case "column":b.width=a.width,b.styleAttr=a.styleAttr;default:b.showif=null,null!=a.showifType&&null!=a.showifValue&&(b.showif=a.showifType+"="+a.showifValue),a.part&&(b.part=a.part)}this.uiml.children[this.uiml.children.length]=b}};
AntObjectFormEditor.prototype.mapChildNodes=function(a,b,c){if(a.children&&a.children.length)for(node in a.children){var d=a.children[node];if(d.conId==c){var e={conId:b.oid,type:b.id,children:[]};d.children[d.children.length]=e;b.name&&(e.name=b.name);if("con"==b.antType)switch(b.id){case "column":e.width=b.width,e.styleAttr=b.styleAttr;default:e.showif=null,null!=b.showifType&&null!=b.showifValue&&(e.showif=b.showifType+"="+b.showifValue)}else switch(e.children=null,b.id){case "all_additional":case "recurrence":case "spacer":case "plugin":break;
case "objectsref":null!=b.refField&&(e.refField=b.refField);break;case "report":e.reportid=b.reportid;e.filterby=b.filterby;break;case "image_id":e.profileimage=b.profile_image;e.path=b.path;e.hidelabel=b.hidelabel;break;default:e.label=b.label,e.title=b.title,e.tooltip=b.tooltip,e.hidelabel=b.hidelabel,null!=b.multiline&&null!=b.rich&&(e.multiline=b.multiline,e.rich=b.rich),b.part&&(e.part=b.part)}}else null!=d.children&&this.mapChildNodes(d,b,c)}};
AntObjectFormEditor.prototype.setupCodeView=function(){this.xmlFormLayoutText="";this.uiml={type:"root",children:[]};this.mapNodes(this.canvasCon);this.generateUIML(this.uiml,0);this.codeViewInput.value=this.xmlFormLayoutText};
AntObjectFormEditor.prototype.testXmlString=function(){if(""==this.codeViewInput.value)return!0;var a="<doc>"+this.codeViewInput.value+"</doc>";try{if(window.DOMParser)var b=(new DOMParser).parseFromString(a,"text/xml");else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);a=null;b.parseError&&0!=b.parseError.errorCode?a=b.parseError.reason+" at line "+b.parseError.line+" at position "+b.parseError.linepos:b.documentElement?"parsererror"==b.documentElement.nodeName&&(a=b.documentElement.childNodes[0].nodeValue):
a="XML Parsing Error!";if(a)throw a;return!0}catch(c){return alert("Error detected in XML. Please correct before saving: "+c),!1}};Ant.EntityDefinition=function(a){this.objType=a;this.id=this.recurRules=this.title="";this.revision=0;this.isPrivate=!1;this.browserMode=this.icon=this.listTitle=this.parentField="";this.system=!0;this.fields=[];this.views=[];this.browserBlankContent=""};
Ant.EntityDefinition.prototype.load=function(a){var b=new alib.net.Xhr;a?b.setAsync(!1):alib.events.listen(b,"load",function(a){var b=this.getResponse();a.data.defCls.fromData(b)},{defCls:this});alib.events.listen(b,"error",function(){},{defCls:this});b.send("/controller/Object/getDefinition","POST",{obj_type:this.objType});a&&this.fromData(b.getResponse())};
Ant.EntityDefinition.prototype.fromData=function(a){this.id=a.id;this.title=a.title;this.revision=a.revision;this.isPrivate=a.is_private;this.recurRules=a.recur_rules;this.parentField=a.parent_field;this.listTitle=a.list_title;this.icon=a.icon;this.browserMode=a.browser_mode;this.browserBlankContent=a.browser_blank_content;this.system=a.system;this.fields=[];for(var b in a.fields){var c=new Ant.EntityDefinition.Field;c.fromArray(a.fields[b]);this.fields.push(c)}this.views=[];for(var d in a.views)b=
new AntObjectBrowserView,b.fromData(a.views[d]),this.views.push(b);alib.events.triggerEvent(this,"load")};Ant.EntityDefinition.prototype.getField=function(a){for(var b in this.fields)if(this.fields[b].name==a)return this.fields[b];return!1};Ant.EntityDefinition.prototype.getFields=function(){return this.fields};Ant.EntityDefinition.prototype.getViews=function(){return this.views};Ant.EntityDefinition.prototype.getBrowserBlankContent=function(){return this.browserBlankContent};
Ant.EntityDefinition.Field=function(){this.mask=this.subtype=this.type=this.title=this.name=this.id="";this.unique=this.readonly=this.system=this.required=!1;this.useWhen="";this.optionalValues=this.defaultVal=null;this.autocreate=!1;this.autocreatename=this.autocreatebase=""};
Ant.EntityDefinition.Field.prototype.fromArray=function(a){this.id=a.id;this.name=a.name;this.title=a.title;this.type=a.type;this.subtype=a.subtype;this.defaultVal=a["default"];this.mask=a.mask;this.required=a.required;this.system=a.system;this.readonly=a.readonly;this.unique=a.unique;this.useWhen=a.use_when;this.optionalValues=a.optional_values};Ant.EntityDefinition.Field.prototype.toArray=function(){};
Ant.EntityDefinition.Field.prototype.getDefault=function(a){return!this.defaultVal?"":this.defaultVal.on==a&&this.defaultVal.value?this.defaultVal.value:""};Ant.EntityDefinitionLoader={};Ant.EntityDefinitionLoader.definitions_=[];Ant.EntityDefinitionLoader.get=function(a,b){if(this.definitions_[a])return this.definitions_[a];var c=b?!1:!0,d=new Ant.EntityDefinition(a);b&&alib.events.listen(d,"load",b);d.load(c);return this.definitions_[a]=d};
function AntObjectTemp(a,b){this.tid=b;this.objType=a;this.values=[]}AntObjectTemp.prototype.setValue=function(a,b){this.values[a]=b};AntObjectTemp.prototype.getValue=function(a){return this.values[a]};AntObjectTemp.prototype.addMValue=function(a,b,c){"Array"!=typeof this.values[a]&&(this.values[a]=[]);this.values[a].push({key:b,value:c||""})};AntObjectTemp.prototype.save=function(){alib.events.trigger(this,"saved")};
function AntObjectTempLoader(a,b,c){this.mainObject=new CAntObject(a);this.template=new AntObjectTemp(a,b);this.parentTemplate=c||null;this.tid=b;this.objType=a;this.dialog=null}AntObjectTempLoader.prototype.showDialog=function(){this.dialog=new CDialog("Template Editor");this.dialog.f_close=!0;var a=alib.dom.createElement("div");this.dialog.customDialog(a,800);this.renderForm(a);this.dialog.reposition()};
AntObjectTempLoader.prototype.renderForm=function(a){var b=alib.dom.createElement("div",a),b=alib.dom.createElement("table",b),b=alib.dom.createElement("tbody",b),c=this.mainObject.getFields(),d;for(d in c)if(!("object_multi"==c[d].type||c[d].readonly)){var e=alib.dom.createElement("tr",b),f=alib.dom.createElement("td",e);alib.dom.styleSetClass(f,"formLabel");f.innerHTML=c[d].title;e=alib.dom.createElement("td",e);alib.dom.styleSetClass(e,"formValue")}"project"==this.objType&&(d=new CWindowFrame("Tasks"),
b=d.getCon(),d.print(a),a=alib.dom.createElement("div",b),a=alib.dom.createElement("a",a,"Add Task"),a.href="javascript:void(0);",a.parentTemplate=this.template,a.onclick=function(){(new AntObjectTempLoader("task",null,this.parentTemplate)).showDialog()})};function AntObjectList(a){this.objType=a;this.conditions=[];this.sortOrder=[];this.objects=[];this.offset=0;this.limit=100;this.totalNum=0;this.async=!0;this.cbData={};this.pagination={}}
AntObjectList.prototype.addCondition=function(a,b,c,d){var e={};e.blogic=a;e.fieldName=b;e.operator=c;e.condValue=d;this.conditions[this.conditions.length]=e};AntObjectList.prototype.clearConditions=function(){this.conditions=[]};AntObjectList.prototype.addSortOrder=function(a,b){this.sortOrder[this.sortOrder.length]={fieldName:a,order:b?b:"asc"}};AntObjectList.prototype.clearSorting=function(){this.sortOrder=[]};
AntObjectList.prototype.getObjects=function(a,b){"undefined"!=typeof a&&(this.offset=a);"undefined"!=typeof b&&(this.limit=b);var c=new CAjax("json");c.cbData.cls=this;c.onload=function(a){this.cbData.cls.totalNum=a.totalNum;a.entities.length&&(this.cbData.cls.objects=a.entities);this.cbData.cls.onLoad()};for(var d=[["obj_type",this.objType],["offset",this.offset],["limit",this.limit]],e=0;e<this.conditions.length;e++){var f=this.conditions[e];d[d.length]=["where[]",[f.blogic,f.fieldName,f.operator,
f.condValue]]}for(e=0;e<this.sortOrder.length;e++)d[d.length]=["order_by[]",this.sortOrder[e].fieldName+","+this.sortOrder[e].order];c.exec("/svr/entity/query",d,this.async)};AntObjectList.prototype.onLoad=function(){};AntObjectList.prototype.getNumObjects=function(){return this.objects.length};AntObjectList.prototype.getObject=function(a){if(a>=this.objects.length)return!1;var b=new CAntObject(this.objType,this.objects[a].id);b.setData(this.objects[a]);return b};
AntObjectList.prototype.getObjectData=function(a){return a>=this.objects.length?!1:this.objects[a]};
function AntObjectBrowser(a){this.mainObject=new CAntObject(a);this.objectList=[];this.currentView=this.objectContext=null;this.conditions=[];this.sort_order=[];this.view_fields=[];this.m_filters=[];this.conditionObj=null;this.obj_type=a;this.options={};this.antView=this.m_advancedSearchDlg=null;this.loadView(this.mainObject.getDefaultView());this.searchView=new AntObjectBrowserView(a);this.viewsFilterKey="";this.fAllSelected=!1;this.chkBoxes=[];this.customActions=[];this.optActions=this.optDelete=
this.optCreateNew=!0;this.searchTitleText="Search "+this.mainObject.titlePl;this.optForceFullRefresh=!1;this.limit=this.mainObject.showper?this.mainObject.showper:50;this.mainBrowserWorkspace=this.useSelect=this.hideCheckbox=!1;this.selectedObjId=this.curObjLoaded=this.loaderCls=this.titleCon=this.browserCon=this.outerCon=null;this.cbData={};this.mobile="undefined"!=typeof Ant&&Ant.isMobile?!0:!1;this.firstLoaded=!1;this.mobile&&(this.mainObject.browserMode="table");switch(this.mainObject.browserMode){case "previewH":this.viewmode=
"table",this.preview=!0,this.previewOrientation="h";case "previewV":this.viewmode="details";this.preview=!0;this.previewOrientation="v";break;default:this.viewmode="activity"==a||"status_update"==a||"notification"==a?"details":"table",this.preview=!1,this.previewOrientation="v"}this.showDeleted=!1;this.open_handler="";this.refreshInterval=null;this.inline=this.skipLoad=!1;this.browseByRootId=this.browseByPath=this.browseByField=this.m_listTableBody=this.m_listTable=null;this.toolbarSearchCons={};
this.deletingQueue=[]}AntObjectBrowser.prototype.setTitle=function(a){this.titleCon&&(this.titleCon.innerHTML=a)};AntObjectBrowser.prototype.print=function(a){this.preview&&(this.viewmode="details");this.mobile&&(this.viewmode="details");this.browserCon=a;this.mainBrowserWorkspace=!0;this.buildInterface()};
AntObjectBrowser.prototype.printInline=function(a,b,c){this.currentView&&c&&(this.currentView.name=c);this.preview=!1;this.inline=!0;this.viewmode=this.mobile||"activity"==this.obj_type||"comment"==this.obj_type||"status_update"==this.obj_type?"details":"table";this.browserCon=a;this.buildInterface(!0,b?b:!1)};AntObjectBrowser.prototype.printComments=function(a,b,c,d){b&&(this.obj_reference=b);c&&(this.parentObject=c);d&&(this.skipLoad=!0);this.viewmode="details";this.printInline(a,!0)};
AntObjectBrowser.prototype.displaySelect=function(a){a=new CDialog("Select "+this.mainObject.title,a);a.f_close=!0;this.m_dlg=a;this.useSelect=this.hideCheckbox=!0;this.limit=50;var b=alib.dom.createElement("div");this.m_viewsdd_con=alib.dom.createElement("span",b);var c=this.buildViewsDropdown();alib.dom.styleAddClass(c,"noshadow");this.m_txtSearch=alib.dom.createElement("input",b);this.m_txtSearch.type="text";alib.dom.styleSetClass(this.m_txtSearch,"fancy");alib.dom.styleAddClass(this.m_txtSearch,
"grLeft");this.m_txtSearch.m_cls=this;this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);13==("undefined"!=typeof a.keyCode?a.keyCode:a.which)&&this.m_cls.getObjects()};c=alib.ui.Button("Search",{className:"b1 grRight noshadow nomargin",tooltip:"Search",cls:this,onclick:function(){this.cls.getObjects()}});c.print(b);this.browserCon=alib.dom.createElement("div",b);alib.dom.styleSet(this.browserCon,"margin-top","3px");alib.dom.styleSetClass(this.browserCon,
"mgb1");this.mobile||(alib.dom.styleSet(this.browserCon,"height","350px"),alib.dom.styleSet(this.browserCon,"border","1px solid"),alib.dom.styleSet(this.browserCon,"overflow","auto"));a.customDialog(b,600);this.mobile&&(this.viewmode="details");this.buildInterface(!0,!0);var d=alib.dom.createElement("div",b);alib.dom.styleSet(d,"text-align","right");var e=alib.ui.Button("New "+this.mainObject.title,{className:"b2",tooltip:"Click to createa a new new "+this.mainObject.title.toLowerCase(),dlg:a,bcls:this,
onclick:function(){var a=loadObjectForm(this.bcls.mainObject.obj_type),b;for(b in this.bcls.m_filters)a.setValue(this.bcls.m_filters[b].fieldName,this.bcls.m_filters[b].value);alib.events.listen(a,"close",function(a){a.data.cls.select(a.data.ol.mainObject.id,a.data.ol.mainObject.getName())},{cls:this.bcls,ol:a})}});e.print(d);e=alib.ui.Button("Cancel",{className:"b1 nomargin",tooltip:"Cancel",dlg:a,onclick:function(){this.dlg.hide()}});e.print(d);alib.dom.styleSet(this.m_txtSearch,"width",alib.dom.getElementWidth(b)-
c.getWidth()-2+"px");a.reposition()};AntObjectBrowser.prototype.displaySelectInline=function(){this.useSelect=!0;this.limit=50;this.buildInterface(!0,!0)};AntObjectBrowser.prototype.select=function(a,b){this.m_dlg&&this.m_dlg.hide();this.onSelect(a,b)};AntObjectBrowser.prototype.onLoad=function(){this.useSelect&&(this.m_resultsCon.removeAttribute("style"),alib.dom.styleSet(this.browserCon,"padding-left","5px"))};AntObjectBrowser.prototype.onSelect=function(){};
AntObjectBrowser.prototype.onCancel=function(){};AntObjectBrowser.prototype.addAction=function(a,b,c,d){var e={args:[]};e.name=a;e.url=b;e.funct="";e.toolbar=!1;e.refresh=!0;e.icon=c?c:"/images/icons/circle_blue.png";e.flush=d?!0:!1;e.doneMsg="";return this.customActions[this.customActions.length]=e};AntObjectBrowser.prototype.addToolbarAction=function(a,b){var c={};c.cb_funct=a;c.cb_args=b;c.toolbar=!0;return this.customActions[this.customActions.length]=c};
AntObjectBrowser.prototype.setBrowseBy=function(a,b,c){if(!a||!b)return!1;this.browseByField=a;this.browseByPath=b;c&&(this.browseByRootId=c)};
AntObjectBrowser.prototype.buildBrowseByPath=function(){alib.dom.styleSet(this.listTitleDiv,"display","none");alib.dom.styleSet(this.fsBreadcrumbCon,"display","block");this.fsBreadcrumbCon.innerHTML="";for(var a=this.browseByPath.split("/"),b="",c=0,d=0;d<a.length;d++){var e=a[d],f=e;0==d&&""==e?(f="Global Files",e="/",c=1):0==d&&"%userdir%"==e&&(f="My Files",c=0);d>c&&(b+="/");b+=e;0<d&&alib.dom.createElement("span",this.fsBreadcrumbCon,"&nbsp;/&nbsp;");e=alib.dom.createElement("a",this.fsBreadcrumbCon);
e.innerHTML=f;e.href="javascript:void(0);";e.fullPath=b;e.bcls=this;e.onclick=function(){this.bcls.changeBrowseByPath(this.fullPath)}}};AntObjectBrowser.prototype.loadView=function(a){null!=a&&(this.conditions=a.conditions.slice(0),this.sort_order=a.sort_order.slice(0),this.view_fields=a.view_fields.slice(0),this.currentView=a,this.listTitleDiv&&this.listTitleDiv.lbl&&(a.name?this.listTitleDiv.lbl.innerHTML=a.name:this.preview||(this.listTitleDiv.lbl.innerHTML="Search Results")))};
AntObjectBrowser.prototype.clearView=function(){this.conditions=[];this.currentView=null;this.listTitleDiv&&view.name&&(this.listTitleDiv.lbl.innerHTML=this.mainObject.titlePl)};AntObjectBrowser.prototype.addCondition=function(a,b,c,d,e){var f=!0;if(e)for(e=0;this.conditions.length;e++)this.conditions[e].fieldName==b&&(f=!1);f&&(f={},f.blogic=a,f.fieldName=b,f.operator=c,f.condValue=d,this.conditions[this.conditions.length]=f)};
AntObjectBrowser.prototype.addSortOrder=function(a,b){this.sort_order[this.sort_order.length]={fieldName:a,order:b?b:"asc"}};
AntObjectBrowser.prototype.buildInterface=function(a,b){if(a)c=this.browserCon;else if(this.preview||(this.titleCon=alib.dom.createElement("div",this.browserCon),alib.dom.styleSetClass(this.titleCon,"aobListHeader"),this.antView?this.antView.getTitle(this.titleCon):this.setTitle("Browse "+this.mainObject.titlePl)),this.innerCon=alib.dom.createElement("div",this.browserCon),this.innerCon.className="aobBody",this.preview){this.spCon=new CSplitContainer("verticle","100%","100%");this.spCon.resizable=
!0;var c=this.spCon.addPanel("300px");this.previewCon=this.spCon.addPanel("*");this.spCon.print(this.innerCon)}else c=this.innerCon;this.m_browserCon=c;b||this.buildToobar(c);switch(this.obj_type){case "comment":this.listTitleDiv=alib.dom.createElement("div");this.m_contextCon=alib.dom.createElement("div",c);this.m_resultsCon=alib.dom.createElement("div",c);this.printInlineAddComment(alib.dom.createElement("div",c));break;default:this.m_contextCon=alib.dom.createElement("div",c);alib.dom.styleSet(this.m_contextCon,
"float","right");alib.dom.styleSetClass(this.m_contextCon,"aobListRight");this.fsBreadcrumbCon=alib.dom.createElement("div",c);alib.dom.styleSetClass(this.fsBreadcrumbCon,"aobListBreadCrumbs");alib.dom.styleSet(this.fsBreadcrumbCon,"display","none");this.listTitleDiv=alib.dom.createElement("div",c);alib.dom.styleSetClass(this.listTitleDiv,"aobListTitle");if(this.preview){alib.dom.styleSet(this.listTitleDiv,"padding-left","6px");var d=alib.dom.createElement("input");d.type="checkbox";d.cls=this;d.onclick=
function(){this.cls.fAllSelected=this.checked;this.cls.toggleSelectAll()};this.listTitleDiv.appendChild(d)}else this.browseByField?this.buildBrowseByPath():(d=alib.dom.createElement("a",this.listTitleDiv,(this.currentView&&this.currentView.name?this.currentView.name:this.mainObject.titlePl)+" &#9660;"),d.href="javascript:void(0);",this.getViewsMenu().attach(d),this.listTitleDiv.lbl=d);this.m_resultsCon=alib.dom.createElement("div",c)}this.blankMessageCon=alib.dom.createElement("div",this.m_resultsCon);
this.listObjectsCon=alib.dom.createElement("div",this.m_resultsCon);this.getObjects();this.resize()};
AntObjectBrowser.prototype.buildToobar=function(a){this.m_toolbarCon=alib.dom.createElement("div",a);alib.dom.styleSetClass(this.m_toolbarCon,"aobToolbar");this.m_toolbarCon=alib.dom.createElement("div",a);alib.dom.styleSetClass(this.m_toolbarCon,"aobToolbar");a=new CToolbar;switch(this.obj_type){case "file":case "folder":return this.buildToolbarFiles(a)}var b=new alib.ui.PopupMenu;this.addAdditionalActions();for(var c=0;c<this.customActions.length;c++)if(!this.customActions[c].toolbar){var d=new alib.ui.MenuItem(this.customActions[c].name,
{icon:this.customActions[c].icon?"<img src='"+this.customActions[c].icon+"' />":null});d.cbData.cls=this;d.cbData.act=this.customActions[c];d.onclick=function(){this.cbData.cls.actionCustom(this.cbData.act)};b.addItem(d)}d=new alib.ui.MenuItem("Print",{icon:"<img src='/images/icons/print_10.png' />"});d.cbData.cls=this;d.onclick=function(){this.cbData.cls.actionPrint()};this.mobile||b.addItem(d);d=new alib.ui.MenuItem("Export",{icon:"<img src='/images/icons/excel_10.png' />"});d.cbData.cls=this;d.onclick=
function(){this.cbData.cls.actionExport()};b.addItem(d);d=new alib.ui.MenuItem("Import",{icon:"<img src='/images/icons/excel_10.png' />"});d.cbData.cls=this;d.onclick=function(){this.cbData.cls.actionImport()};b.addItem(d);this.objectHasEmail()&&(d=new alib.ui.MenuItem("Email",{icon:"<img src='/images/icons/email-b_10.png' />"}),d.cbData.cls=this,d.onclick=function(){this.cbData.cls.actionEmail()},b.addItem(d));d=new alib.ui.MenuItem("Edit",{icon:"<img src='/images/icons/edit_10.png' />"});d.cbData.cls=
this;d.onclick=function(){this.cbData.cls.actionEdit()};b.addItem(d);d=new alib.ui.MenuItem("Merge Records",{icon:"<img src='/images/icons/merge_10.png' />"});d.cbData.cls=this;d.onclick=function(){this.cbData.cls.actionMerge()};b.addItem(d);for(c=0;c<this.customActions.length;c++)this.customActions[c].toolbar&&this.customActions[c].cb_funct(a,this,this.customActions[c].cb_args[0]);this.preview||this.mobile?(a.styleSet("margin-bottom","0"),c=new CButton("Delete",function(a){a.deleteObjects()},[this],
"b1"),a.AddItem(c.getButton(),"right"),a.print(this.m_toolbarCon),this.optCreateNew&&this.mobile&&(c=new CButton("New",function(a){a.loadObjectForm()},[this],this.inline?"b2 medium":"b2"),a.AddItem(c.getButton(),"left")),this.m_viewsdd_con=alib.dom.createElement("span"),a.AddItem(this.m_viewsdd_con),"email_thread"==this.obj_type||"email_message"==this.obj_type?(c=new AntObjectGroupingSel("Move","email_thread","mailbox_id",null,this.mainObject,{noNull:!0,staticLabel:!0}),c.print(this.m_viewsdd_con,
"b1"),c.brwsercls=this,c.onSelect=function(a,b){this.brwsercls.cbData.groupingId!=a&&this.brwsercls.actionCustom({url:"/controller/Object/moveByGrouping",args:[["obj_type",this.brwsercls.obj_type],["field_name","mailbox_id"],["move_from",19],["move_to",a]],refresh:!0,doneMsg:"Moved to "+b,flush:!0})}):this.buildViewsDropdown(),c=new alib.ui.MenuButton("Actions",b,{className:"b1"}),a.AddItem(c.getButton()),b=alib.ui.Button("<img src='/images/icons/refresh_12.png' />",{className:"b1",tooltip:"Refresh",
cls:this,onclick:function(){this.cls.refresh()}}),a.AddItem(b.getButton(),"left"),a=alib.dom.createElement("div",a.getContainer()),alib.dom.styleSet(a,"clear","both"),alib.dom.styleSet(a,"visibility","hidden"),a=alib.dom.createElement("div",this.m_toolbarCon),alib.dom.styleSetClass(a,"aobSearch"),c=alib.dom.createElement("div",a),this.buildToolbarSearch(c)):(c=ALib.m_document.createElement("div"),alib.dom.styleSet(c,"width","270px"),a.AddItem(c,"right"),this.buildToolbarSearch(c),this.optCreateNew&&
(c=new CButton("New "+this.mainObject.title,function(a){a.loadObjectForm()},[this],this.inline?"b2 medium":"b2"),a.AddItem(c.getButton(),"left")),this.m_viewsdd_con=alib.dom.createElement("span"),a.AddItem(this.m_viewsdd_con),this.buildViewsDropdown(),c=new alib.ui.MenuButton("Actions",b,{className:this.inline?"b1 medium":"b1"}),a.AddItem(c.getButton()),b=alib.ui.Button("<img src='/images/icons/refresh_"+(this.inline?"10":"12")+".png' />",{className:this.inline?"b1 medium":"b1",tooltip:"Refresh",
cls:this,onclick:function(){this.cls.refresh()}}),a.AddItem(b.getButton(),"left"),this.optDelete&&(c=new CButton("Delete",function(a){a.deleteObjects()},[this],this.inline?"b1 grRight medium":"b1 grRight"),a.AddItem(c.getButton(),"left")),a.print(this.m_toolbarCon))};
AntObjectBrowser.prototype.buildToolbarSearch=function(a){var b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"float","left");var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"float","right");c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"float","right");a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"overflow","hidden");var d=alib.ui.Button("&#9660;",{className:this.inline||this.preview?"b1 grLeft medium noshadow":"b1  grLeft noshadow",tooltip:"Click to view advanced search options",
cls:this,onclick:function(){this.cls.showAdvancedSearch()}});d.print(b);a.className="clearIcon";this.m_txtSearch=createInputAttribute(alib.dom.createElement("input",a),"text");alib.dom.styleSet(this.m_txtSearch,"width","100%");alib.dom.setInputBlurText(this.m_txtSearch,this.searchTitleText,"inputBlurText","","");alib.dom.styleAddClass(this.m_txtSearch,"fancy");alib.dom.styleAddClass(this.m_txtSearch,"grLeft");alib.dom.styleAddClass(this.m_txtSearch,"grRight");(this.inline||this.preview)&&alib.dom.styleAddClass(this.m_txtSearch,
"medium");d=alib.dom.createElement("span",a);d.className="deleteicon";alib.dom.styleSet(d,"visibility","hidden");d.cls=this;d.divWidth=195;d.m_txtSearch=this.m_txtSearch;d.onclick=function(){this.m_txtSearch.value="";this.m_txtSearch.focus();alib.dom.styleSet(this,"visibility","hidden");this.cls.getObjects()};this.m_txtSearch.m_cls=this;this.m_txtSearch.spanIcon=d;this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);13==("undefined"!=typeof a.keyCode?
a.keyCode:a.which)&&this.m_cls.getObjects();0<this.m_cls.m_txtSearch.value.length?alib.dom.styleSet(this.spanIcon,"visibility","visible"):alib.dom.styleSet(this.spanIcon,"visibility","hidden")};d=alib.ui.Button("Go",{className:this.inline||this.preview?"b1 grRight medium noshadow":"b1 grRight noshadow",tooltip:"Click to search",cls:this,onclick:function(){this.cls.getObjects()}});d.print(c);this.toolbarSearchCons.divFilter=b;this.toolbarSearchCons.divInput=a;this.toolbarSearchCons.divGo=c};
AntObjectBrowser.prototype.buildToolbarFiles=function(a){if(this.preview||this.mobile){a.styleSet("margin-bottom","0");var b=new CButton("Delete",function(a){a.deleteObjects()},[this],"b1");a.AddItem(b.getButton(),"right");a.print(this.m_toolbarCon);this.m_viewsdd_con=alib.dom.createElement("span");a.AddItem(this.m_viewsdd_con);if("email_thread"==this.obj_type||"email_message"==this.obj_type){var c=new AntObjectGroupingSel("Move","email_thread","mailbox_id",null,this.mainObject,{noNull:!0,staticLabel:!0});
c.print(this.m_viewsdd_con,"b1 grLeft");c.brwsercls=this;c.onSelect=function(a,b){this.brwsercls.cbData.groupingId!=a&&this.brwsercls.actionCustom({url:"/controller/Object/moveByGrouping",args:[["obj_type",this.brwsercls.obj_type],["field_name","mailbox_id"],["move_from",19],["move_to",a]],refresh:!0,doneMsg:"Moved to "+b,flush:!0})}}else this.buildViewsDropdown();c=new CDropdownMenu;this.addAdditionalActions();for(b=0;b<this.customActions.length;b++)this.customActions[b].toolbar||c.addEntry(this.customActions[b].name,
function(a,b){a.actionCustom(b)},this.customActions[b].icon,null,[this,this.customActions[b]]);c.addEntry("Print",function(a){a.actionPrint()},"/images/icons/print_10.png",null,[this]);c.addEntry("Export",function(a){a.actionExport()},"/images/icons/excel_10.png",null,[this]);c.addEntry("Import",function(a){a.actionImport()},"/images/icons/excel_10.png",null,[this]);this.objectHasEmail()&&c.addEntry("Email",function(a){a.actionEmail()},"/images/icons/email-b_10.png",null,[this]);a.AddItem(c.createButtonMenu("Actions",
null,null,"b1 grRight"));c.addEntry("Edit",function(a){a.actionEdit()},"/images/icons/edit_10.png",null,[this]);c.addEntry("Merge Records",function(a){a.actionMerge()},"/images/icons/merge_10.png",null,[this]);for(b=0;b<this.customActions.length;b++)this.customActions[b].toolbar&&this.customActions[b].cb_funct(a,this,this.customActions[b].cb_args[0]);c=alib.ui.Button("<img src='/images/icons/refresh_12.png' />",{className:"b1",tooltip:"Refresh",cls:this,onclick:function(){this.cls.refresh()}});a.AddItem(c.getButton(),
"left");c=alib.dom.createElement("div",a.getContainer());alib.dom.styleSet(c,"clear","both");alib.dom.styleSet(c,"visibility","hidden");c=alib.dom.createElement("div",this.m_toolbarCon);alib.dom.styleSet(c,"marginTop","5px");b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"float","left");var d=alib.dom.createElement("span",b);d.className="clearIcon";this.m_txtSearch=createInputAttribute(alib.dom.createElement("input",d),"text");alib.dom.styleSet(this.m_txtSearch,"width","195px");alib.dom.styleSet(this.m_txtSearch,
"paddingRight","25px");alib.dom.setInputBlurText(this.m_txtSearch,this.searchTitleText,"inputBlurText","","");alib.dom.styleAddClass(this.m_txtSearch,"fancy");alib.dom.styleAddClass(this.m_txtSearch,"grRight");d=alib.dom.createElement("span",d);d.className="deleteicon";alib.dom.styleSet(d,"visibility","hidden");d.cls=this;d.divWidth=195;d.m_txtSearch=this.m_txtSearch;d.onclick=function(){this.m_txtSearch.value="";this.m_txtSearch.focus();alib.dom.styleSet(this,"visibility","hidden");this.cls.getObjects()};
this.m_txtSearch.m_tb=a;this.m_txtSearch.m_cls=this;this.m_txtSearch.spanIcon=d;this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);13==("undefined"!=typeof a.keyCode?a.keyCode:a.which)&&this.m_cls.getObjects();0<this.m_cls.m_txtSearch.value.length?alib.dom.styleSet(this.spanIcon,"visibility","visible"):alib.dom.styleSet(this.spanIcon,"visibility","hidden")};divClear(b);a=alib.dom.createElement("div",c);alib.dom.styleSet(a,"float","left");b=
alib.ui.Button("<img src='/images/icons/arrow_down_12.png'>",{className:this.inline?"b1 grRight medium":"b1 grRight",tooltip:"Click to view advanced search options",cls:this,onclick:function(){this.cls.showAdvancedSearch()}});b.print(a);divClear(c)}else b=alib.ui.Button("<img src='/images/icons/arrow_down_12.png'>",{className:this.inline?"b1 grRight medium":"b1 grRight",tooltip:"Click to view advanced search options",cls:this,onclick:function(){this.cls.showAdvancedSearch()}}),a.AddItem(b.getButton(),
"right"),b=ALib.m_document.createElement("div"),d=alib.dom.createElement("span",b),d.className="clearIcon",this.m_txtSearch=createInputAttribute(alib.dom.createElement("input",d),"text"),this.inline&&alib.dom.styleAddClass(this.m_txtSearch,"medium"),alib.dom.styleSet(this.m_txtSearch,"width","150px"),alib.dom.styleSet(this.m_txtSearch,"paddingRight","25px"),alib.dom.setInputBlurText(this.m_txtSearch,this.searchTitleText,"inputBlurText","",""),alib.dom.styleAddClass(this.m_txtSearch,"fancy"),alib.dom.styleAddClass(this.m_txtSearch,
"grRight"),d=alib.dom.createElement("span",d),d.className="deleteicon",alib.dom.styleSet(d,"visibility","hidden"),d.cls=this,d.divWidth=150,d.m_txtSearch=this.m_txtSearch,d.onclick=function(){this.m_txtSearch.value="";this.m_txtSearch.focus();alib.dom.styleSet(this,"visibility","hidden");this.cls.getObjects()},this.m_txtSearch.m_tb=a,this.m_txtSearch.m_cls=this,this.m_txtSearch.spanIcon=d,this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);
13==("undefined"!=typeof a.keyCode?a.keyCode:a.which)&&this.m_cls.getObjects();0<this.m_cls.m_txtSearch.value.length?alib.dom.styleSet(this.spanIcon,"visibility","visible"):alib.dom.styleSet(this.spanIcon,"visibility","hidden")},divClear(b),a.AddItem(b,"right"),this.optCreateNew&&(c=alib.ui.Button("Upload File(s)",{className:this.inline?"b1 medium":"b2",tooltip:"Upload files from your computer",cls:this,onclick:function(){this.cls.antFsUpload()}}),a.AddItem(c.getButton(),"left"),c=alib.ui.Button("New Folder",
{className:this.inline?"b1 medium":"b1",tooltip:"Crate a new folder",cls:this,onclick:function(){this.cls.antFsCreateFolder()}}),a.AddItem(c.getButton(),"left")),c=alib.ui.Button("Move",{className:this.inline?"b1 grLeft medium":"b1 grLeft",tooltip:"Move selected files and folders",cls:this,onclick:function(){this.cls.antFsMove()}}),a.AddItem(c.getButton(),"left"),c=alib.ui.Button("<img src='/images/icons/refresh_"+(this.inline?"10":"12")+".png' />",{className:this.inline?"b1 grCenter medium":"b1 grCenter",
tooltip:"Refresh",cls:this,onclick:function(){this.cls.refresh()}}),a.AddItem(c.getButton(),"left"),this.optDelete&&(b=new CButton("Delete",function(a){a.deleteObjects()},[this],this.inline?"b1 grRight medium":"b1 grRight"),a.AddItem(b.getButton(),"left")),a.print(this.m_toolbarCon)};
AntObjectBrowser.prototype.resize=function(){if(!this.mobile){if(this.preview){alib.dom.styleSet(this.innerCon,"height","200px");this.spCon&&this.spCon.setHeight&&this.spCon.setHeight("300px");var a=getWorkspaceHeight();this.titleCon&&(a-=alib.dom.getElementHeight(this.titleCon));alib.dom.styleSet(this.innerCon,"height",a-3+"px");a=alib.dom.getContentHeight(this.innerCon);0<a&&this.spCon&&this.spCon.setHeight&&this.spCon.setHeight(a+"px");a=alib.dom.getElementHeight(this.m_browserCon);this.m_toolbarCon&&
(a-=alib.dom.getElementHeight(this.m_toolbarCon));this.listTitleDiv&&(a-=alib.dom.getElementHeight(this.listTitleDiv));this.fsBreadcrumbCon&&(a-=alib.dom.getElementHeight(this.fsBreadcrumbCon));0<a&&(alib.dom.styleSet(this.m_resultsCon,"height",a+"px"),alib.dom.styleSet(this.m_resultsCon,"overflow","auto"))}else this.inline||(a=getWorkspaceHeight(),this.titleCon&&(a-=alib.dom.getElementHeight(this.titleCon)),this.m_toolbarCon&&(a-=alib.dom.getElementHeight(this.m_toolbarCon)),this.listTitleDiv&&(a-=
alib.dom.getElementHeight(this.listTitleDiv)),this.fsBreadcrumbCon&&(a-=alib.dom.getElementHeight(this.fsBreadcrumbCon)),0<a&&(alib.dom.styleSet(this.m_resultsCon,"height",a+"px"),alib.dom.styleSet(this.m_resultsCon,"overflow","auto")));this.toolbarSearchCons.divInput&&this.toolbarSearchCons.divFilter&&this.toolbarSearchCons.divGo&&(a=this.toolbarSearchCons.divGo.offsetWidth,alib.userAgent.ie&&(a+=3),a&&alib.dom.styleSet(this.m_txtSearch,"width","100%"))}};
AntObjectBrowser.prototype.buildViewsDropdown=function(){this.m_viewsdd_con.innerHTML="";var a=this.getViewsMenu();return new alib.ui.MenuButton("Views",a,{className:this.inline?"b1 grLeft medium":"b1 grLeft"})};
AntObjectBrowser.prototype.getViewsDropdown=function(){for(var a=new CDropdownMenu,b=0;b<this.mainObject.views.length;b++)var c=this.mainObject.views[b],d=a.addEntry(c.name,function(a,b){a.loadView(b);a.getObjects()},"/images/icons/magnify_10.png",null,[this,c]);a.addEntry("Manage Views",function(a){a.toggleViewsForm()},"/images/icons/settings_10.png",null,[this,c]);d=a.addSubmenu("Show Num Records",null,null,null);d.addEntry("25 Records",function(a){a.setShowPer(25)},"/images/icons/circle_blue.png",
null,[this]);d.addEntry("50 Records",function(a){a.setShowPer(50)},"/images/icons/circle_blue.png",null,[this]);d.addEntry("100 Records",function(a){a.setShowPer(100)},"/images/icons/circle_blue.png",null,[this]);d.addEntry("200 Records",function(a){a.setShowPer(200)},"/images/icons/circle_blue.png",null,[this]);d.addEntry("500 Records",function(a){a.setShowPer(500)},"/images/icons/circle_blue.png",null,[this]);d.addEntry("1000 Records",function(a){a.setShowPer(1E3)},"/images/icons/circle_blue.png",
null,[this]);d=a.addSubmenu("Layout",null,null,null);d.addEntry("List Mode",function(a){a.setBrowserMode("table")},"/images/icons/circle_blue.png",null,[this]);d.addEntry("Preview Mode",function(a){a.setBrowserMode("previewV")},"/images/icons/circle_blue.png",null,[this]);return a};
AntObjectBrowser.prototype.getViewsMenu=function(){for(var a=new alib.ui.PopupMenu,b=0;b<this.mainObject.views.length;b++){var c=this.mainObject.views[b],d=new alib.ui.MenuItem(c.name,{icon:"<img src='/images/icons/magnify_10.png' />"});d.cbData.cls=this;d.cbData.view=c;d.onclick=function(){this.cbData.cls.loadView(this.cbData.view);this.cbData.cls.getObjects()};a.addItem(d)}d=new alib.ui.MenuItem("Manage Views",{icon:"<img src='/images/icons/settings_10.png' />"});d.cbData.cls=this;d.onclick=function(){this.cbData.cls.toggleViewsForm()};
a.addItem(d);c=new alib.ui.SubMenu("Show Num Records");for(b=25;500>b;b+=25)d=new alib.ui.MenuItem(b+" Records"),d.cbData.cnt=b,d.cbData.cls=this,d.onclick=function(){this.cbData.cls.setShowPer(this.cbData.cnt)},c.addItem(d);a.addItem(c);c=new alib.ui.SubMenu("Layout");d=new alib.ui.MenuItem("List Mode",{});d.cbData.cls=this;d.onclick=function(){this.cbData.cls.setBrowserMode("table")};c.addItem(d);d=new alib.ui.MenuItem("Preview Mode",{});d.cbData.cls=this;d.onclick=function(){this.cbData.cls.setBrowserMode("previewV")};
c.addItem(d);a.addItem(c);return a};AntObjectBrowser.prototype.setShowPer=function(a){this.limit=a;this.getObjects();ajax=new CAjax("json");ajax.exec("/controller/User/setSettingUser",[["set","/objects/browse/showper/"+this.mainObject.name],["val",a]])};
AntObjectBrowser.prototype.addAdditionalActions=function(){switch(this.obj_type){case "email_thread":this.addAction("Mark as Read","/controller/Email/markRead","/images/icons/read_10.png"),this.addAction("Mark as Unread","/controller/Email/markUnread","/images/icons/unread_10.png"),this.addAction("Mark as Junk Mail","/controller/Email/markJunk","/images/icons/spam_10.png"),this.addAction("Not Junk Mail","/controller/Email/markNotjunk","/images/icons/notspam_10.png"),this.addAction("Flag Message(s)",
"/controller/Email/markFlag","/images/icons/flag_on_10.png")}};AntObjectBrowser.prototype.setBrowserMode=function(a){switch(a){case "table":this.preview=!1;this.viewmode="table";this.browserCon.innerHTML="";this.print(this.browserCon);break;case "previewV":this.preview=!0,this.viewmode="details",this.browserCon.innerHTML="",this.print(this.browserCon)}ajax=new CAjax("json");ajax.exec("/controller/User/setSettingUser",[["set","/objects/browse/mode/"+this.mainObject.name],["val",a]])};
AntObjectBrowser.prototype.toggleSelectAll=function(){for(var a=0;a<this.objectList.length;a++)this.objectList[a].select(this.fAllSelected)};
AntObjectBrowser.prototype.getObjects=function(a,b){if(this.skipLoad)this.skipLoad=!1;else{"undefined"!=typeof a&&null!=a?(a!=this.m_lastOffset&&(this.firstLoaded=b=!1),this.m_lastOffset=a):a=this.m_lastOffset=0;b||(this.blankMessageCon.innerHTML="<div class='loading'></div>",alib.dom.styleSet(this.listObjectsCon,"display","none"));this.m_ajax&&(this.m_ajax.abort(),!this.firstLoaded&&b&&(b=!1));this.refreshTimer&&clearTimeout(this.refreshTimer);this.m_ajax=new CAjax("json");this.m_ajax.m_browseclass=
this;this.m_ajax.updateMode=b?!0:!1;this.m_ajax.onload=function(a){this.updateMode||(this.m_browseclass.objectList=[]);this.m_browseclass.firstLoaded=!0;var b=[],c=0;this.updateMode||(this.m_browseclass.listObjectsCon.innerHTML="",this.m_browseclass.m_listTable=null);a&&a.browseByCurPath&&a.browseByCurPath!=this.m_browseclass.browseByPath&&(this.m_browseclass.browseByPath=a.browseByCurPath);if(a&&a.browseByObjects&&a.browseByObjects.length){this.m_browseclass.blankMessageCon.innerHTML="";alib.dom.styleSet(this.m_browseclass.listTitleDiv,
"display","block");alib.dom.styleSet(this.m_browseclass.listObjectsCon,"display","block");parseInt(a.browseByObjects.length);for(var g=0;g<a.browseByObjects.length;g++){var h=a.browseByObjects[g];h.isBrowse=!0;var k="";"/"!=this.m_browseclass.browseByPath&&(k=this.m_browseclass.browseByPath);h.browseByPath=k+"/"+h.name;this.updateMode?b[b.length]=h:this.m_browseclass.addObjectItem(h)}}if(a&&a.objects.length){this.m_browseclass.blankMessageCon.innerHTML="";alib.dom.styleSet(this.m_browseclass.listTitleDiv,
"display","block");alib.dom.styleSet(this.m_browseclass.listObjectsCon,"display","block");this.m_browseclass.m_contextCon.innerHTML="";this.m_browseclass.m_contextCon&&"undefined"!=a.totalNum&&(h=alib.dom.createElement("span",this.m_browseclass.m_contextCon),h.innerHTML=this.m_browseclass.preview?a.totalNum+" Items":a.totalNum+" "+this.m_browseclass.mainObject.titlePl);if(a.paginate&&(g=a.paginate.prevPage,c=a.paginate.nextPage,k=a.paginate.desc,h=alib.dom.createElement("span",this.m_browseclass.m_contextCon),
h.innerHTML=" | "+k,0<=g||0<=c))h=alib.dom.createElement("span",this.m_browseclass.m_contextCon),h.innerHTML=" | ",-1!=g&&(h=alib.dom.createElement("span",this.m_browseclass.m_contextCon),h.innerHTML="&laquo; previous",alib.dom.styleSet(h,"cursor","pointer"),h.start=g,h.m_browseclass=this.m_browseclass,h.onclick=function(){this.m_browseclass.getObjects(this.start)}),c&&(g=alib.dom.createElement("span",this.m_browseclass.m_contextCon),g.innerHTML=" next &raquo;",alib.dom.styleSet(g,"cursor","pointer"),
g.start=c,g.m_browseclass=this.m_browseclass,g.onclick=function(){this.m_browseclass.getObjects(this.start)});c=parseInt(a.objects.length);for(g=0;g<a.objects.length;g++)h=a.objects[g],this.updateMode&&-1==alib.indexOf(this.m_browseclass.deletingQueue,h.id)?b[b.length]=h:this.m_browseclass.addObjectItem(h);this.updateMode&&this.m_browseclass.refreshUpdate(b)}else if(!a&&!a.browseByObjects||a.browseByObjects&&!a.browseByObjects.length)a=this.m_browseclass.mainObject.getObjType(),this.m_browseclass.blankMessageCon.innerHTML=
Ant.EntityDefinitionLoader.get(a).getBrowserBlankContent(),alib.dom.styleSet(this.m_browseclass.listObjectsCon,"display","none");this.m_browseclass.preview&&c&&!this.updateMode&&this.m_browseclass.selectObjectRow();if(this.m_browseclass.refreshInterval){var l=this.m_browseclass;this.m_browseclass.refreshTimer=setTimeout(function(){l.refresh()},l.refreshInterval)}this.m_browseclass.m_ajax=null;this.m_browseclass.resize();this.m_browseclass.onLoad(c)};var c=[];c[c.length]=["obj_type",this.obj_type];
c[c.length]=["offset",a];c[c.length]=["limit",this.limit];this.showDeleted&&(c[c.length]=["showdeleted","1"]);b&&(c[c.length]=["updatemode","1"]);this.browseByField&&(c[c.length]=["browsebyfield",this.browseByField]);this.browseByPath&&(c[c.length]=["browsebypath",this.browseByPath]);this.browseByRootId&&(c[c.length]=["browsebyroot",this.browseByRootId]);this.getFormConditions(null,c);this.m_ajax.exec("/controller/ObjectList/query",c)}};
AntObjectBrowser.prototype.setAutoRefresh=function(a){a||(this.refreshInterval=null,clearTimeout(this.refreshTimer),this.refreshTimer=null);this.refreshInterval=a;if(!this.refreshTimer&&a){var b=this;this.refreshTimer=setTimeout(function(){b.refresh()},this.refreshInterval)}};
AntObjectBrowser.prototype.refresh=function(){var a="undefined"!=typeof this.m_lastOffset?this.m_lastOffset:0;this.m_ajax&&!this.firstLoaded&&this.m_ajax.loading||this.m_txtSearch&&this.m_txtSearch.value&&this.m_txtSearch.value!=this.searchTitleText||(0<this.deletingQueue.length?console.log("Skipping refresh because there are "+this.deletingQueue.length+" items in the deleting queue"):this.getObjects(a,this.optForceFullRefresh?!1:!0))};
AntObjectBrowser.prototype.refreshUpdate=function(a){for(var b=this.listObjectsCon,c=[],d=0;d<this.objectList.length;d++)-1==this.refreshUpdateItemInList(this.objectList[d].id,a)&&(c[c.length]=this.objectList[d]);for(d=0;d<c.length;d++)c[d].remove();c=null;c=[];for(d=0;d<a.length;d++){var e=this.refreshUpdateItemInList(a[d].id,this.objectList,!0);if(-1!=e){if(a[d].revision>this.objectList[e].revision||a[d].num_comments!=this.objectList[e].objData.num_comments){var f=new CAntObject(this.mainObject.name,
a[d].id);f.objListItem=this.objectList[e];f.onload=function(){this.objListItem.update(this.getData())};f.load()}e!=d&&(c[c.length]={obj:this.objectList[e],toidx:d})}else f=new CAntObject(this.mainObject.name,a[d].id),f.appBrowserClass=this,f.appObjectCon=b,f.appObjectConInsBefore=d+1>this.objectList.length?null:this.objectList[d],f.onload=function(){this.appBrowserClass.addObjectItem(this.getData(),this.appObjectConInsBefore)},e=new AntObjectBrowser_Item({id:a[d].id,security:{view:!0},revision:a[d].revision},
this),d+1>this.objectList.length?this.objectList.push(e):this.objectList.splice(d,0,e),f.load()}for(d=0;d<c.length;d++)c[d].obj.move(c[d].toidx);c=null};AntObjectBrowser.prototype.refreshUpdateItemInList=function(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return c;return-1};
AntObjectBrowser.prototype.addObjectItem=function(a,b,c){if(c)for(b=0;b<this.objectList.length;b++)this.objectList[b].id==c&&this.objectList[b].update(a);else{this.m_listTable||this.createListTable();c=new AntObjectBrowser_Item(a,this);c.selectedObjId=this.selectedObjId;a.isBrowse&&a.browseByPath&&(c.isBrowse=a.isBrowse,c.browseByPath=a.browseByPath);b?c.print(this.m_listTableBody,b):c.print(this.m_listTableBody);a=-1;for(b=0;b<this.objectList.length;b++)this.objectList[b].id==c.id&&(a=b);0<=a?this.objectList[a]=
c:this.objectList[this.objectList.length]=c}};
AntObjectBrowser.prototype.createListTable=function(){this.m_listTable=alib.dom.createElement("table",this.listObjectsCon);alib.dom.styleSetClass(this.m_listTable,"aobListTable");this.m_listTable.cellPadding=0;this.m_listTable.cellSpacing=0;this.m_listTableBody=alib.dom.createElement("tbody",this.m_listTable);if("table"==this.viewmode){var a=alib.dom.createElement("tr",this.m_listTableBody),b=alib.dom.createElement("input");b.type="checkbox";b.cls=this;b.onclick=function(){this.cls.fAllSelected=this.checked;
this.cls.toggleSelectAll()};if(!this.hideCheckbox){var c=alib.dom.createElement("th",a);alib.dom.styleSet(c,"text-align","center");alib.dom.styleSet(c,"padding-left","0px");alib.dom.styleSet(c,"padding-right","5px");c.appendChild(b)}for(b=0;b<this.view_fields.length;b++)(c=this.mainObject.getFieldByName(this.view_fields[b].fieldName))&&(c=alib.dom.createElement("th",a,c.title))}};
AntObjectBrowser.prototype.selectObjectRow=function(a,b){var c=!1,d=!1,e=!1,f="";window.event?(c=window.event.shiftKey,d=window.event.ctrlKey):b&&(c=b.shiftKey,d=b.ctrlKey);a||(a=this.objectList.length?this.objectList[0].id:"");var g=a;if(c)return this.selectDetRowShift(this.curObjLoaded,a);for(c=0;c<this.objectList.length;c++)this.objectList[c].id==a?(d?(this.objectList[c].selected()?this.objectList[c].select(!1):this.objectList[c].select(!0),this.objectList[c].seen=!0):(g=this.objectList[c].getName(),
this.objectList[c].select(!0)),this.objectList[c].isBrowse&&(e=this.objectList[c].isBrowse,f=this.objectList[c].browseByPath)):d||this.objectList[c].select(!1);!d&&a?e&&f?this.changeBrowseByPath(f):this.loadObjectForm(a,null,g):!d&&""==a&&(this.previewCon.innerHTML="")};AntObjectBrowser.prototype.changeBrowseByPath=function(a){this.browseByPath=a;this.getObjects(0,!1);this.buildBrowseByPath()};
AntObjectBrowser.prototype.selectDetRowShift=function(a,b){var c=null,d=null;for(i=0;i<this.objectList.length;i++)this.objectList[i].id==a&&(c=i);for(i=0;i<this.objectList.length;i++)this.objectList[i].id==b&&(d=i);var e=c<d?c:d,c=c>d?c:d;for(i=0;i<this.objectList.length;i++)i>=e&&i<=c?this.objectList[i].select(!0):this.objectList[i].select(!1)};
AntObjectBrowser.prototype.setUserImage=function(a,b,c){c="/files/userimages/"+(b?b:c)+"/48/48";a=alib.dom.createElement("img",a);alib.dom.styleSet(a,"width","48px");a.src=c;b&&AntObjectInfobox.attach("user",b,a)};
AntObjectBrowser.prototype.setAntView=function(a){this.antView=a;this.antView.setViewsSingle(!0);this.antView.options.bcls=this;this.antView.onresize=function(){this.options.bcls.resize()};var b=6E4;switch(this.obj_type){case "comment":b=1E4}this.antView.on("show",function(a){a.cls.setAutoRefresh(b)},{cls:this});this.antView.on("hide",function(a){a.cls.setAutoRefresh(null)},{cls:this});this.setAutoRefresh(b);this.getObjectView(this.obj_type)};
AntObjectBrowser.prototype.getObjectView=function(a){if(!this.antView)return null;if(this.antView.getView(a+":[id]"))return this.antView.getView(a+":[id]");var b=this.antView.addView(a+":[id]",{});b.options.obj_type=a;b.options.bwserCls=this;b.options.loadLoaded=null;b.options.parentPath=this.antView.getPath();b.render=function(){};b.onshow=function(){if(this.options.lastLoaded==this.variable&&!this.fromClone)return!0;this.title=this.con.innerHTML="";var a=new AntObjectLoader(this.options.obj_type,
this.variable);a.setAntView(this);if(!this.variable){for(var b=0;b<this.options.bwserCls.m_filters.length;b++){var e=this.options.bwserCls.m_filters[b];"associations"==this.options.bwserCls.m_filters[b].fieldName?a.mainObject.setMultiValue("associations",e.value):a.setValue(e.fieldName,e.value)}this.options.bwserCls.obj_reference&&a.setValue("obj_reference",this.options.bwserCls.obj_reference);if(null!=this.options.bwserCls.objectContext){var e=this.options.bwserCls.objectContext.getFields(),f=this.options.bwserCls.mainObject.getFields();
for(b in e){var g=e[b],h;for(h in f){var k=f[h];if(("object"==k.type||"fkey"==k.type)&&k.name==g.name&&k.type==g.type&&k.subtype==g.subtype)a.getValue(k.name)||a.setValue(k.name,this.options.bwserCls.objectContext.getValue(k.name))}}}}a.print(this.con);a.cbData.antView=this;a.cbData.bwserCls=this.options.bwserCls;a.cbData.parentPath=this.options.parentPath;a.onClose=function(){this.cbData.antView.options.lastLoaded=this.mainObject.id;var a=this.cbData.bwserCls;setTimeout(function(){a.refresh()},1E3);
this.cbData.antView.goup()};a.onRemove=function(){this.cbData.bwserCls.refresh()};this.options.lastLoaded=a.cloneObject?null:this.variable};return b};AntObjectBrowser.prototype.antFsUpload=function(){var a=new AntFsUpload(this.browseByPath,this.m_dlg);a.cbData.cls=this;a.onUploadFinished=function(){this.cbData.cls.getObjects()};a.showDialog()};
AntObjectBrowser.prototype.antFsCreateFolder=function(){var a=new CDialog;a.promptBox("Name:","New Folder Name","New Folder");a.m_cls=this;a.onPromptOk=function(a){a=[["path",this.m_cls.browseByPath],["name",a]];ajax=new CAjax("json");ajax.cbData.cls=this.m_cls;ajax.onload=function(a){a.error?alert(a.error):this.cbData.cls.getObjects()};ajax.exec("/controller/AntFs/newFolder",a)};a.m_input.onblur=function(){checkSpecialCharacters("folder",this.value,this)}};
AntObjectBrowser.prototype.antFsMove=function(a){var b="undefined"!=typeof a?a:null;if(null==b)a=new AntFsOpen,a.filterType="folder",a.setTitle("Move Files &amp; Folders To:"),a.cls=this,a.onSelect=function(a){this.cls.antFsMove(a)},a.showDialog();else{var a=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Moving items, please wait...";a.statusDialog(c,150,100);for(var b=[["obj_type",this.mainObject.name],["move_to_id",
b]],c=!1,d=0;d<this.objectList.length;d++)this.objectList[d].selected()&&(b[b.length]=["objects[]",this.objectList[d].id],c=!0);if(!c){if(!confirm("This will move all "+this.mainObject.titlePl+" in the current view. Are you sure you want to continue?")){a.hide();return}b[b.length]=["all_selected","1"]}this.getFormConditions(null,b);ajax=new CAjax("json");ajax.cls=this;ajax.dlg=a;ajax.onload=function(a){this.dlg.hide();if(a.error)ALib.statusShowAlert("ERROR: Could not contact server!",3E3,"bottom",
"right");else{var b=!1;for(moved in a){var c=a[moved];if("-1"!=c)for(var d=0;d<this.cls.objectList.length;d++)this.cls.objectList[d].id==c&&this.cls.objectList[d].remove();else b=!0}b?ALib.statusShowAlert("ERROR: Not all objects were moved!",3E3,"bottom","right"):ALib.statusShowAlert(a.length+" Items Moved!",3E3,"bottom","right");"details"==this.cls.viewmode&&this.cls.refresh()}};ajax.exec("/controller/AntFs/move",b)}};
AntObjectBrowser.prototype.loadObjectForm=function(a,b,c,d){var e=b?b:[];b||(b=null);d=d||this.obj_type;for(b=0;b<this.m_filters.length;b++){var f=this.m_filters[b];e[e.length]="associations"==this.m_filters[b].fieldName?["associations[]",f.value]:[f.fieldName,f.value]}this.obj_reference&&(e[e.length]=["obj_reference",this.obj_reference]);if(f=a?a:"")this.curObjLoaded=f;if(!f&&null!=this.objectContext){var g=this.objectContext.getFields(),h=this.mainObject.getFields();for(b in g){var k=g[b],l;for(l in h){var m=
h[l];if(("object"==m.type||"fkey"==m.type)&&m.name==k.name&&m.type==k.type&&m.subtype==k.subtype){var n=!0,o;for(o in e)e[o][0]==m.name&&(n=!1);n&&(e[e.length]=[m.name,this.objectContext.getValue(m.name)])}}}}if(this.useSelect)this.select(f,c);else if(this.open_handler)switch(this.open_handler){case "email_message_draft":loadObjectForm("email_message",f)}else if(this.antView&&!this.preview&&this.getObjectView(d))this.antView.navigate(d+":"+f);else if(this.mainBrowserWorkspace&&this.browserCon){c=
alib.dom.getScrollPosTop();if(this.preview&&this.previewCon){this.previewCon.innerHTML="";var p=this.previewCon;p.cls=this;p.oldScrollTop=c;p.close=function(){}}else alib.dom.styleSet(this.titleCon,"display","none"),alib.dom.styleSet(this.innerCon,"display","none"),p=alib.dom.createElement("div",this.browserCon),p.cls=this,p.oldScrollTop=c,p.close=function(){this.style.display="none";alib.dom.styleSet(this.cls.titleCon,"display","block");alib.dom.styleSet(this.cls.innerCon,"display","block");p.cls.browserCon.removeChild(this);
alib.dom.setScrollPosTop(this.oldScrollTop)};d=new AntObjectLoader(d,f);this.preview&&(d.fEnableClose=!1,d.inline=!0);if(!a){for(b=0;b<this.m_filters.length;b++)f=this.m_filters[b],"associations"==this.m_filters[b].fieldName?d.mainObject.setMultiValue("associations",f.value):d.setValue(f.fieldName,f.value);this.obj_reference&&d.setValue("obj_reference",this.obj_reference)}d.print(p);d.objfrmCon=p;d.objBrwsrCls=this;d.onClose=function(){this.objfrmCon.close()};this.preview||(d.onSave=function(){this.objBrwsrCls.getObjects()});
d.onRemove=function(){this.objBrwsrCls.getObjects()}}else if(this.loaderCls){c=alib.dom.getScrollPosTop();this.loaderCls.hide();p=alib.dom.createElement("div",this.loaderCls.outerCon);p.cls=this;p.oldScrollTop=c;p.close=function(){this.style.display="none";p.cls.loaderCls.show();p.cls.loaderCls.outerCon.removeChild(this);alib.dom.setScrollPosTop(this.oldScrollTop)};d=new AntObjectLoader(d,f);for(b=0;b<this.m_filters.length;b++)f=this.m_filters[b],"associations"==this.m_filters[b].fieldName?d.mainObject.setMultiValue("associations",
f.value):d.setValue(f.fieldName,f.value);this.obj_reference&&d.setValue("obj_reference",this.obj_reference);d.print(p,this.loaderCls.isPopup);d.objfrmCon=p;d.objBrwsrCls=this;d.onClose=function(){this.objfrmCon.close()};d.onSave=function(){this.objBrwsrCls.getObjects()};d.onRemove=function(){this.objBrwsrCls.getObjects()}}else loadObjectForm(d,f,null,null,e)};
AntObjectBrowser.prototype.showAdvancedSearch=function(){var a=new AntObjectViewEditor(this.obj_type,this.currentView);a.cbData.cls=this;a.showDialog();a.onApply=function(a){this.cbData.cls.loadView(a);this.cbData.cls.getObjects()}};
AntObjectBrowser.prototype.toggleViewsForm=function(){if(this.m_viewsDlg)try{this.m_viewsDlg.hide(),this.m_viewsDlg=null}catch(a){}else this.m_viewsDlg=new CDialog("Manage "+this.mainObject.title+" Views"),this.m_viewsDiv=alib.dom.createElement("div"),this.m_viewsDlg.customDialog(this.m_viewsDiv,600,400),this.showViewsDialog()};
AntObjectBrowser.prototype.showViewsDialog=function(){var a=alib.dom.createElement("p",this.m_viewsDiv);alib.dom.styleSetClass(a,"info");a.innerHTML="Views are a simple way to save advanced queries and quickly reload them. You can select your default view by checking the 'Default' column which means the first time you load this form, the selected view will be used to filter your results. To create a new view, click 'Create New View' below.";a=new CWindowFrame("Views",null,"0px");a.print(this.m_viewsDiv);
var b=a.getCon();alib.dom.styleSet(b,"height","250px");alib.dom.styleSet(b,"overflow","auto");a=new CToolTable("100%");a.print(b);a.addHeader("Name (click to edit)");a.addHeader("Description");a.addHeader("Default","center","30px");a.addHeader("&nbsp;","center","20px");for(var b="undefined"==typeof Ant?"/images/icons/deleteTask.gif":"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif",c=0;c<this.mainObject.views.length;c++){var d=this.mainObject.views[c];if(d.filterKey==this.viewsFilterKey){var e=
a.addRow(),f=alib.dom.createElement("a");f.innerHTML=d.name;f.href="javascript:void(0)";f.cls=this;f.view=d;f.onclick=function(){this.cls.toggleViewsForm();this.cls.showAdvancedSearch(this.view)};e.addCell(f);e.addCell(d.description);f=alib.dom.createElement("input");f.type="radio";f.name="default_view";f.cls=this;f.checked=d.fDefault;f.view=d;f.onclick=function(){this.cls.setDefaultView(this.view)};e.addCell(f);d.fSystem?f=alib.dom.createElement("span"):(f=alib.dom.createElement("a"),f.innerHTML=
"<img src='"+b+"' border='0' />",f.href="javascript:void(0)",f.cls=this,f.row=e,f.view=d,f.onclick=function(){this.cls.deleteView(this.view,this.row)});e.addCell(f,!1,"center")}}a=alib.dom.createElement("div",this.m_viewsDiv);alib.dom.styleSet(a,"margin","3px");b=new CButton("Close",function(a){a.toggleViewsForm()},[this],"b1");b.print(a);b=new CButton("Create New View",function(a){a.toggleViewsForm();a.showAdvancedSearch()},[this],"b1");b.print(a)};
AntObjectBrowser.prototype.setDefaultView=function(a){for(var b=0;b<this.mainObject.views.length;b++)this.mainObject.views[b].fDefault=this.mainObject.views[b]==a?!0:!1;a=[["obj_type",this.mainObject.name],["view_id",a.id],["filter_key",this.viewsFilterKey]];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a.error?ALib.statusShowAlert("ERROR: Could not contact server!",3E3,"bottom","right"):(Ant.EntityDefinitionLoader.get(this.cls.obj_type).load(),ALib.statusShowAlert("Default View Changed!",
3E3,"bottom","right"))};ajax.exec("/controller/Object/setViewDefault",a)};
AntObjectBrowser.prototype.saveViewDialog=function(a,b){var c=new CDialog("Save View",this.m_advancedSearchDlg),d=alib.dom.createElement("div"),e=alib.dom.createElement("div",d);alib.dom.styleSetClass(e,"label");e.innerHTML="Name This View";var e=alib.dom.createElement("div",d),f=alib.dom.createElement("input",e);alib.dom.styleSet(f,"width","98%");e=alib.dom.createElement("div",d);alib.dom.styleSetClass(e,"label");e.innerHTML="Description";var e=alib.dom.createElement("div",d),g=alib.dom.createElement("textarea",
e);alib.dom.styleSet(g,"width","98%");var h="";a?(f.value=a.name,g.value=a.description,b?f.value+=" (copy)":h=a.id):(f.value="My Custom View",g.value="Describe this view here");e=alib.dom.createElement("div",d);f=new CButton("Save",function(a,b,c,d,e){b.hide();a.saveView(c.value,d.value,e)},[this,c,f,g,h],"b2");f.print(e);f=new CButton("Cancel",function(a){a.hide()},[c],"b1");f.print(e);c.customDialog(d,300,130)};
AntObjectBrowser.prototype.saveView=function(a,b,c){var d=new CDialog(null,this.m_advancedSearchDlg),e=document.createElement("div");alib.dom.styleSetClass(e,"statusAlert");alib.dom.styleSet(e,"text-align","center");e.innerHTML="Saving, please wait...";d.statusDialog(e,150,100);e=null;this.searchView.conditions=[];for(e=0;e<this.conditionObj.getNumConditions();e++){var f=this.conditionObj.getCondition(e);this.searchView.conditions[e]={};this.searchView.conditions[e].blogic=f.blogic;this.searchView.conditions[e].fieldName=
f.fieldName;this.searchView.conditions[e].operator=f.operator;this.searchView.conditions[e].condValue=f.condValue}if(e=c?this.mainObject.getViewById(c):new AntObjectBrowserView(this.mainObject.name))e.conditions=this.searchView.conditions.slice(0),e.sort_order=this.searchView.sort_order.slice(0),e.view_fields=this.searchView.view_fields.slice(0),e.name=a,e.filterKey=this.viewsFilterKey,e.description=b,e.cls=this,e.save_view_id=c?c:null,e.dlg=d,e.onsave=function(){d.hide();this.save_view_id||(this.cls.mainObject.views[this.cls.mainObject.views.length]=
this);ALib.statusShowAlert("View Saved!",3E3,"bottom","right");this.cls.buildViewsDropdown();this.cls.showAdvancedSearch();this.cls.runSearch(this);"undefined"!=typeof objectPreloadDef&&objectPreloadDef(this.cls.mainObject.name,!0)},e.onsaveError=function(){d.hide();ALib.statusShowAlert("ERROR: Unable to connect to server!",3E3,"bottom","right")},e.save()};
AntObjectBrowser.prototype.runSearch=function(a){this.searchView.conditions=[];for(var b=0;b<this.conditionObj.getNumConditions();b++){var c=this.conditionObj.getCondition(b);this.searchView.conditions[b]={};this.searchView.conditions[b].blogic=c.blogic;this.searchView.conditions[b].fieldName=c.fieldName;this.searchView.conditions[b].operator=c.operator;this.searchView.conditions[b].condValue=c.condValue}this.loadView(a?a:this.searchView);this.getObjects()};
AntObjectBrowser.prototype.addOrderBy=function(a,b,c){var b=b?b:"",d=c?c:"asc";"undefined"==typeof this.orderBySerial?this.orderBySerial=1:this.orderBySerial++;c=alib.dom.createElement("div",a);if(this.searchView.sort_order.length){var e=alib.dom.createElement("span",c);e.innerHTML="Then By: "}var f=this.searchView.sort_order.length;this.searchView.sort_order[f]={};this.searchView.sort_order[f].id=this.orderBySerial;this.searchView.sort_order[f].fieldName=b;this.searchView.sort_order[f].order=d;e=
alib.dom.createElement("select",c);e.orderobj=this.searchView.sort_order[f];e.onchange=function(){this.orderobj.fieldName=this.value};for(var g=this.mainObject.getFields(),h=0;h<g.length;h++)"fkey_multi"!=g[h].type&&(e[e.length]=new Option(g[h].title,g[h].name,!1,b==g[h].name?!0:!1));this.searchView.sort_order[f].fieldName||(this.searchView.sort_order[f].fieldName=e.value);e=alib.dom.createElement("span",c);e.innerHTML=" ";b=alib.dom.createElement("select",c);b.orderobj=this.searchView.sort_order[f];
b.onchange=function(){this.orderobj.order=this.value};b[b.length]=new Option("Ascending","asc",!1,"asc"==d?!0:!1);b[b.length]=new Option("Descending","desc",!1,"desc"==d?!0:!1);e=alib.dom.createElement("span",c);e.innerHTML=" ";b="undefined"==typeof Ant?"/images/icons/deleteTask.gif":"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif";d=alib.dom.createElement("a",c);d.innerHTML="<img src='"+b+"' border='0' />";d.href="javascript:void(0)";d.odv=c;d.pdv=a;d.cls=this;d.orderid=this.orderBySerial;
d.onclick=function(){for(var a=0;a<this.cls.searchView.sort_order.length;a++)this.cls.searchView.sort_order[a].id==this.orderid&&this.cls.searchView.sort_order.splice(a,1);this.pdv.removeChild(this.odv)}};
AntObjectBrowser.prototype.addViewColumn=function(a,b){var c=b?b:"";"undefined"==typeof this.viewCOlSerial?this.viewCOlSerial=1:this.viewCOlSerial++;var d=alib.dom.createElement("div",a),e=this.searchView.view_fields.length;this.searchView.view_fields[e]={};this.searchView.view_fields[e].id=this.viewCOlSerial;this.searchView.view_fields[e].fieldName=c;var f=alib.dom.createElement("select",d);f.viewobj=this.searchView.view_fields[e];f.onchange=function(){this.viewobj.fieldName=this.value};for(var g=
this.mainObject.getFields(),h=0;h<g.length;h++)f[f.length]=new Option(g[h].title,g[h].name,!1,g[h].name==c?!0:!1);this.searchView.view_fields[e].fieldName||(this.searchView.view_fields[e].fieldName=f.value);alib.dom.createElement("span",d).innerHTML=" ";c="undefined"==typeof Ant?"/images/icons/deleteTask.gif":"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif";e=alib.dom.createElement("a",d);e.innerHTML="<img src='"+c+"' border='0' />";e.href="javascript:void(0)";e.odv=d;e.pdv=a;e.cls=this;e.viewid=
this.viewCOlSerial;e.onclick=function(){for(var a=0;a<this.cls.searchView.view_fields.length;a++)this.cls.searchView.view_fields[a].id==this.viewid&&this.cls.searchView.view_fields.splice(a,1);this.pdv.removeChild(this.odv)}};
AntObjectBrowser.prototype.deleteObjects=function(a){ALib.Dlg.confirmBox("Are you sure you want to delete the selected items?","Delete "+this.mainObject.titlePl,[this,a?a:null]);ALib.Dlg.onConfirmOk=function(a,c){for(var d=[["obj_type",a.mainObject.name]],e=!1,f=0;f<a.objectList.length;f++)a.objectList[f].selected()&&(d[d.length]=["objects[]",a.objectList[f].id],e=!0);c&&(d[d.length]=["objects[]",c],e=!0);if(!e&&!c){if(!confirm("This will delete all "+a.mainObject.titlePl+" in the current view. Are you sure you want to continue?"))return;
d[d.length]=["all_selected","1"]}var g=[];if(e)for(f in d)e=a.refreshUpdateItemInList(d[f][1],a.objectList),-1!=e&&g.push(a.objectList[e]);else for(f=0;f<a.objectList.length;f++)a.objectList[f].selected()&&g.push(a.objectList[f]);for(f=0;f<g.length;f++)a.deletingQueue.push(g[f].id),g[f].remove();g=null;a.getFormConditions(null,d);f=new CAjax("json");f.cls=a;f.onload=function(a){if(a.error)ALib.statusShowAlert("ERROR: Could not contact server!",3E3,"bottom","right");else{var b=!1;for(deleted in a){var c=
a[deleted];if("-1"!=c)for(var d in this.cls.deletingQueue)if(null==c){this.cls.deletingQueue=[];break}else this.cls.deletingQueue[d]==c&&this.cls.deletingQueue.splice(d,1);else b=!0,this.cls.deletingQueue=[]}b?ALib.statusShowAlert("ERROR: Not all objects were deleted!",3E3,"bottom","right"):ALib.statusShowAlert(a.length+" Items Deleted!",3E3,"bottom","right");var e=this.cls;setTimeout(function(){e.refresh()},1E3)}};f.exec("/controller/ObjectList/deleteObjects",d)}};
AntObjectBrowser.prototype.deleteView=function(a,b){var c=new CDialog("",this.m_viewsDlg);c.confirmBox("Are you sure you want to delete "+a.name+"?","Delete View",[a.id,b,this]);c.onConfirmOk=function(a,b,c){ajax=new CAjax("json");ajax.cls=c;ajax.row=b;ajax.onload=function(){this.row.deleteRow();for(var a=0;a<this.cls.mainObject.views.length;a++)this.cls.mainObject.views[a].id==id&&this.cls.mainObject.views.splice(a,1);ALib.statusShowAlert("View Deleted!",3E3,"bottom","right");this.cls.buildViewsDropdown()};
ajax.exec("/controller/Object/deleteView",[["dvid",a]])}};AntObjectBrowser.prototype.objectHasEmail=function(){for(var a=!1,b=this.mainObject.getFields(),c=0;c<b.length;c++)if("email"==b[c].subtype){a=!0;break}return a};
AntObjectBrowser.prototype.actionEmail=function(){var a={method:"standard",useFields:[],send:"compose",template_id:"",inp_field:"cmp_to"},b=new CDialog("Send Email"),c=alib.dom.createElement("div"),d=alib.dom.createElement("div");c.appendChild(d);var e=alib.dom.createElement("div",d);alib.dom.styleSetClass(e,"label");e.innerHTML="Send Method:";e=alib.dom.createElement("div",d);d=alib.dom.createElement("input");d.type="radio";d.name="using";d.checked=!0;d.frmData=a;d.onclick=function(){this.checked&&
(this.frmData.inp_field="cmp_to")};e.appendChild(d);d=alib.dom.createElement("span",e);d.innerHTML="&nbsp;To&nbsp;";d=alib.dom.createElement("input");d.type="radio";d.name="using";d.frmData=a;d.onclick=function(){this.checked&&(this.frmData.inp_field="cmp_cc")};e.appendChild(d);d=alib.dom.createElement("span",e);d.innerHTML="&nbsp;Cc&nbsp;";d=alib.dom.createElement("input");d.type="radio";d.name="using";d.frmData=a;d.onclick=function(){this.checked&&(this.frmData.inp_field="cmp_bcc")};e.appendChild(d);
d=alib.dom.createElement("span",e);d.innerHTML="&nbsp;Bcc&nbsp;";e=alib.dom.createElement("div",c);alib.dom.styleSetClass(e,"label");e.innerHTML="Use Address:";for(var d=this.mainObject.getFields(),f=0;f<d.length;f++){var g=d[f];if("email"==g.subtype){var e=alib.dom.createElement("div",c),h=alib.dom.createElement("input");h.type="checkbox";h.name="use_field[]";h.checked=!1;h.value=g.name;h.frmData=a;e.appendChild(h);e=alib.dom.createElement("span",e);e.innerHTML="&nbsp;"+g.title;h.onclick=function(){if(this.checked)this.frmData.useFields[this.frmData.useFields.length]=
this.value;else for(var a=0;a<this.frmData.useFields.length;a++)this.frmData.useFields[a]==this.value&&this.frmData.useFields.splice(a,1)}}}e=alib.dom.createElement("div",c);alib.dom.styleSet(e,"margin-top","10px");a=new CButton("Compose Email",function(a,b,c){a.actionEmailSubmit(c);b.hide()},[this,b,a],"b2");a.print(e);a=new CButton("Cancel",function(a){a.hide()},[b]);a.print(e);b.customDialog(c,300,170)};
AntObjectBrowser.prototype.actionEmailSubmit=function(a){var b=alib.dom.createElement("div",alib.dom.m_document.body);alib.dom.styleSet(b,"display","none");alib.dom.styleSet(b,"position","absolute");var c=alib.dom.createElement("form",b);c.setAttribute("method","post");c.setAttribute("target","emailcmp_objbrowser");c.setAttribute("action","/obj/email_message");var d=alib.dom.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","fid");d.setAttribute("value",a.template_id);c.appendChild(d);
d=alib.dom.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","inp_field");d.setAttribute("value",a.inp_field);c.appendChild(d);d=alib.dom.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","obj_type");d.setAttribute("value",this.mainObject.name);c.appendChild(d);d=alib.dom.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","send_method");d.setAttribute("value","bulk"==a.method?"1":"0");c.appendChild(d);for(var e=!1,f=0;f<
this.objectList.length;f++)this.objectList[f].selected()&&(e=!0,d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","objects[]"),d.setAttribute("value",this.objectList[f].id),c.appendChild(d));e||(this.getFormConditions(c),d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","all_selected"),d.setAttribute("value","1"),c.appendChild(d));for(f=0;f<a.useFields.length;f++)a.useFields[f]&&(d=alib.dom.createElement("input"),d.setAttribute("type",
"hidden"),d.setAttribute("name","using[]"),d.setAttribute("value",a.useFields[f]),c.appendChild(d));window.open("","emailcmp_objbrowser","width=780,height=600,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes");c.submit();alib.dom.m_document.body.removeChild(b)};
AntObjectBrowser.prototype.getFormConditions=function(a,b,c){if(this.m_txtSearch&&this.m_txtSearch.value&&this.m_txtSearch.value!=this.searchTitleText){if(a){var d=alib.dom.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","cond_search");d.setAttribute("value",this.m_txtSearch.value);a.appendChild(d)}b&&(b[b.length]=["cond_search",this.m_txtSearch.value]);c&&(c.cond_search=this.m_txtSearch.value)}for(var e=0,f=0;f<this.conditions.length;f++,++e){var g=this.conditions[f];
a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","conditions[]"),d.setAttribute("value",e),a.appendChild(d));b&&(b[b.length]=["conditions[]",e]);c&&(c.conditions||(c.conditions=[]),c.conditions.push(e));a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_blogic_"+e),d.setAttribute("value",g.blogic),a.appendChild(d));b&&(b[b.length]=["condition_blogic_"+e,g.blogic]);c&&(c["condition_blogic_"+e]=g.blogic);
a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_fieldname_"+e),d.setAttribute("value",g.fieldName),a.appendChild(d));b&&(b[b.length]=["condition_fieldname_"+e,g.fieldName]);c&&(c["condition_fieldname_"+e]=g.fieldName);a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_operator_"+e),d.setAttribute("value",g.operator),a.appendChild(d));b&&(b[b.length]=["condition_operator_"+e,g.operator]);c&&(c["condition_operator_"+
e]=g.operator);a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_condvalue_"+e),d.setAttribute("value",g.condValue),a.appendChild(d));b&&(b[b.length]=["condition_condvalue_"+e,g.condValue]);c&&(c["condition_condvalue_"+e]=g.condValue)}for(f=0;f<this.m_filters.length;f++,++e)g=this.m_filters[f],a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","conditions[]"),d.setAttribute("value",e),a.appendChild(d)),b&&
(b[b.length]=["conditions[]",e]),c&&(c.conditions||(c.conditions=[]),c.conditions.push(e)),a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_blogic_"+e),d.setAttribute("value",g.blogic),a.appendChild(d)),b&&(b[b.length]=["condition_blogic_"+e,g.blogic]),c&&(c["condition_blogic_"+e]="and"),a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_fieldname_"+e),d.setAttribute("value",g.fieldName),a.appendChild(d)),
b&&(b[b.length]=["condition_fieldname_"+e,g.fieldName]),c&&(c["condition_fieldname_"+e]=g.fieldName),a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_operator_"+e),d.setAttribute("value","is_equal"),a.appendChild(d)),b&&(b[b.length]=["condition_operator_"+e,"is_equal"]),c&&(c["condition_operator_"+e]="is_equal"),a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","condition_condvalue_"+e),d.setAttribute("value",
g.value),a.appendChild(d)),b&&(b[b.length]=["condition_condvalue_"+e,g.value]),c&&(c["condition_condvalue_"+e]=g.value);for(f=0;f<this.sort_order.length;f++)a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","order_by[]"),d.setAttribute("value",this.sort_order[f].fieldName+" "+this.sort_order[f].order),a.appendChild(d)),b&&(b[b.length]=["order_by[]",this.sort_order[f].fieldName+" "+this.sort_order[f].order]),c&&(c.order_by||(c.order_by=[]),c.order_by.push(this.sort_order[f].fieldName+
" "+this.sort_order[f].order));this.browseByField&&(a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","browsebyfield"),d.setAttribute("value",this.browseByField),a.appendChild(d)),b&&(b[b.length]=["browsebyfield",this.browseByField]),c&&(c.browsebyfield=this.browseByField));this.browseByPath&&(a&&(d=alib.dom.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","browsebypath"),d.setAttribute("value",this.browseByPath),a.appendChild(d)),
b&&(b[b.length]=["browsebypath",this.browseByPath]),c&&(c.browsebypath=this.browseByPath))};
AntObjectBrowser.prototype.actionEdit=function(){var a={fieldName:"bulk",act:"add",value:""},b=new CDialog("Edit Multiple "+this.mainObject.titlePl),c=alib.dom.createElement("div");b.customDialog(c,300);var d=alib.dom.createElement("div"),e=alib.dom.createElement("div",c);alib.dom.styleSetClass(e,"label");e.innerHTML="Select a field to update:";for(var e=alib.dom.createElement("select",c),f=this.mainObject.getFields(),g=0;g<f.length;g++)f[g].readonly||(e[e.length]=new Option(f[g].title,f[g].name,
!1,!1));e.val_div=d;e.frmData=a;e.cls=this;e.onchange=function(){this.cls.actionEditBuildValue(this.value,this.val_div,this.frmData);this.frmData.fieldName=this.value};c.appendChild(d);this.actionEditBuildValue(e.value,d,a);c=alib.dom.createElement("div",c);alib.dom.styleSet(c,"margin-top","3px");a=alib.ui.Button("Make Changes",{className:"b2",callback:this,frmData:a,dlg:b,onclick:function(){this.callback.actionEditSubmit(this.frmData);this.dlg.hide()}});c.appendChild(a.getButton());a=alib.ui.Button("Cancel Edit",
{className:"b1",dlg:b,onclick:function(){this.dlg.hide()}});c.appendChild(a.getButton());b.reposition()};
AntObjectBrowser.prototype.actionEditBuildValue=function(a,b,c){alib.dom.styleSet(b,"margin-top","5px");b.innerHTML="";a=this.mainObject.getFieldByName(a);switch(a.type){case "fkey_multi":var d=alib.dom.createElement("div",b);alib.dom.styleSetClass(d,"label");d.innerHTML="Do the following:";d=alib.dom.createElement("select",b);d[d.length]=new Option("Add","add",!1,!0);d[d.length]=new Option("Remove","remove",!1,!1);d.frmData=c;d.onchange=function(){this.frmData.act=this.value};case "fkey":b=alib.dom.createElement("div",
b);this.mainObject.fieldCreateValueInput(b,a.name);b.inpRef.frmData=c;c.value=b.inpRef.value;"select"==b.inptType?b.inpRef.onchange=function(){this.frmData.value=this.value}:"dynselect"==b.inptType&&(b.inpRef.onSelect=function(){this.frmData.value=this.value});break;default:if(d=alib.dom.createElement("div",b),alib.dom.styleSetClass(d,"label"),d.innerHTML="Set value to:",b=alib.dom.createElement("div",b),this.mainObject.fieldCreateValueInput(b,a.name),b.inpRef)switch(b.inpRef.frmData=c,c.value=b.inpRef.value,
b.inptType){case "checkbox":b.inpRef.onclick=function(){this.frmData.value=this.checked?!0:!1};break;case "text":case "input":alib.dom.styleSet(b.inpRef,"width","90%");case "select":b.inpRef.onchange=function(){this.frmData.value=this.value};break;case "userBrowser":case "objectBrowser":b.inpRef.onSelect=function(a){this.frmData.value=a};break;case "dynselect":b.inpRef.onSelect=function(){this.frmData.value=this.value}}}};
AntObjectBrowser.prototype.actionEditSubmit=function(a){var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Saving changes, please wait...";b.statusDialog(c,150,100);for(var a=[["obj_type",this.mainObject.name],["field_name",a.fieldName],["action",a.act],["value",a.value]],c=!1,d=0;d<this.objectList.length;d++)this.objectList[d].selected()&&(c=!0,a[a.length]=["objects[]",this.objectList[d].id]);if(!c&&(this.getFormConditions(null,
a),a[a.length]=["all_selected","1"],!confirm("This will edit all "+this.mainObject.titlePl+" in the current view. Are you sure you want to continue?"))){b.hide();return}ajax=new CAjax("json");ajax.cls=this;ajax.dlg=b;ajax.onload=function(a){this.dlg.hide();a.error?ALib.statusShowAlert("ERROR: Could not contact server!",3E3,"bottom","right"):(ALib.statusShowAlert(this.cls.mainObject.titlePl+"Saved!",3E3,"bottom","right"),this.cls.getObjects())};ajax.exec("/controller/Object/editObjects",a)};
AntObjectBrowser.prototype.actionImport=function(){("undefined"!=typeof Ant||g_userid)&&(new AntWizard("EntityImport",{obj_type:this.mainObject.name})).show()};
AntObjectBrowser.prototype.actionExport=function(){var a=alib.dom.createElement("div",alib.dom.m_document.body);alib.dom.styleSet(a,"display","none");alib.dom.styleSet(a,"position","absolute");var b=alib.dom.createElement("form",a);b.setAttribute("method","post");b.setAttribute("target","_blank");b.setAttribute("action","/objects/export_csv.php?obj_type="+this.obj_type);for(var c=!1,d=0;d<this.objectList.length;d++)if(this.objectList[d].selected()){var c=!0,e=alib.dom.createElement("input");e.setAttribute("type",
"hidden");e.setAttribute("name","objects[]");e.setAttribute("value",this.objectList[d].id);b.appendChild(e)}c||(this.getFormConditions(b),e=alib.dom.createElement("input"),e.setAttribute("type","hidden"),e.setAttribute("name","all_selected"),e.setAttribute("value","1"),b.appendChild(e));b.submit();alib.dom.m_document.body.removeChild(a)};
AntObjectBrowser.prototype.actionPrint=function(){var a=alib.dom.createElement("div",alib.dom.m_document.body);alib.dom.styleSet(a,"display","none");alib.dom.styleSet(a,"position","absolute");var b=alib.dom.createElement("form",a);b.setAttribute("method","post");b.setAttribute("target","_blank");b.setAttribute("action","/print/engine.php?obj_type="+this.obj_type);for(var c=!1,d=0;d<this.objectList.length;d++)if(this.objectList[d].selected()){var c=!0,e=alib.dom.createElement("input");e.setAttribute("type",
"hidden");e.setAttribute("name","objects[]");e.setAttribute("value",this.objectList[d].id);b.appendChild(e)}c||(this.getFormConditions(b),e=alib.dom.createElement("input"),e.setAttribute("type","hidden"),e.setAttribute("name","all_selected"),e.setAttribute("value","1"),b.appendChild(e));b.submit();alib.dom.m_document.body.removeChild(a)};
AntObjectBrowser.prototype.actionMerge=function(){for(var a=[],b=0;b<this.objectList.length;b++)this.objectList[b].selected()&&(a[a.length]=this.objectList[b].id);if(2>a.length)ALib.Dlg.messageBox("Please select at least two records to merge");else{for(var c=new CAntObjectMergeWizard(this.obj_type),b=0;b<a.length;b++)c.addObject(a[b]);c.browserClass=this;c.onFinished=function(){this.browserClass.getObjects()};c.showDialog()}};
AntObjectBrowser.prototype.actionCreateAssoc=function(a){for(var b=[],c=0;c<this.objectList.length;c++)this.objectList[c].selected()&&(b[b.length]=this.obj_type+":"+this.objectList[c].id);1>b.length?ALib.Dlg.messageBox("Please select at least one record to associate with"):loadObjectForm(a,"",null,b)};
AntObjectBrowser.prototype.actionCustom=function(a){for(var b=[["obj_type",this.mainObject.name]],c=!1,d=[],e=0;e<this.objectList.length;e++)this.objectList[e].selected()&&(c=!0,b[b.length]=["objects[]",this.objectList[e].id],d[d.length]=this.objectList[e]);if(a.flush)for(e=0;e<d.length;e++)d[e].remove();if(a.args)for(e=0;e<a.args.length;e++)b[b.length]=[a.args[e][0],a.args[e][1]];if(!c&&(this.getFormConditions(null,b),b[b.length]=["all_selected","1"],!confirm("This apply to all "+this.mainObject.titlePl+
" in the current view. Are you sure you want to continue?"))){f.hide();return}if(a.options){var f=new CDialog("Options"),c=alib.dom.createElement("div");f.customDialog(c,300,100);for(var g=alib.dom.createElement("div",g),e=0;e<a.options.length;e++){g=alib.dom.createElement("div",c);alib.dom.styleSetClass(g,"label");g.innerHTML=a.options[e].caption;g=b.length;b[g]=[a.options[e].name,a.options[e].values[0][0]];for(var d=alib.dom.createElement("select",c),h=0;h<a.options[e].values.length;h++)d[d.length]=
new Option(a.options[e].values[h][1],a.options[e].values[h][0],!1,!1);d.arg=b[g];d.onchange=function(){this.arg[1]=this.value}}e=alib.dom.createElement("div",c);alib.dom.styleSet(e,"margin-top","3px");b=new CButton("Continue",function(a,b,c){var d=new CAjax("json");d.cbData.dlg=a;d.onload=function(){this.cbData.dlg.hide();ALib.statusShowAlert("Action Completed!",3E3,"bottom","right")};d.exec(b.url,c)},[f,a,b],"b2");b.print(e);b=new CButton("Cancel",function(a){a.hide()},[f],AJAX_POST);b.print(e)}else f=
new CAjax("json"),f.cbData.cls=this,f.cbData.act=a,f.onload=function(){ALib.statusShowAlert(a.doneMsg?a.doneMsg:"Action Completed!",3E3,"bottom","right");if(a.refresh){var b=this.cbData.cls;setTimeout(function(){b.refresh()},1E3)}},f.exec(a.url,b)};
AntObjectBrowser.prototype.actionCustomForm=function(a){var b=alib.dom.createElement("div",alib.dom.m_document.body);alib.dom.styleSet(b,"display","none");alib.dom.styleSet(b,"position","absolute");var c=alib.dom.createElement("form",b);c.setAttribute("method","post");c.setAttribute("target","_blank");c.setAttribute("action",a.url);for(var d=!1,e=0;e<this.objectList.length;e++)if(this.objectList[e].selected()){var d=!0,f=alib.dom.createElement("input");f.setAttribute("type","hidden");f.setAttribute("name",
"objects[]");f.setAttribute("value",this.objectList[e].id);c.appendChild(f)}if(!d&&(this.getFormConditions(c),f=alib.dom.createElement("input"),f.setAttribute("type","hidden"),f.setAttribute("name","all_selected"),f.setAttribute("value","1"),c.appendChild(f),!confirm("This apply to all "+this.mainObject.titlePl+" in the current view. Are you sure you want to continue?"))){g.hide();return}if(a.options){var g=new CDialog("Options"),d=alib.dom.createElement("div");g.customDialog(d,300,300);for(var h=
alib.dom.createElement("div",h),e=0;e<a.options.length;e++){f=alib.dom.createElement("div",d);alib.dom.styleSetClass(f,"label");f.innerHTML=a.options[e].caption;f=alib.dom.createElement("input");f.setAttribute("type","hidden");f.setAttribute("name",a.options[e].name);f.setAttribute("value",a.options[e].values[0][0]);c.appendChild(f);for(var h=alib.dom.createElement("select",d),k=0;k<a.options[e].values.length;k++)h[h.length]=new Option(a.options[e].values[k][1],a.options[e].values[k][0],!1,!1);h.hiddenField=
f;h.onchange=function(){this.hiddenField.value=this.value}}a=alib.dom.createElement("div",d);alib.dom.styleSet(a,"margin-top","3px");b=new CButton("Continue",function(a,b,c){b.submit();a.hide();alib.dom.m_document.body.removeChild(c)},[g,c,b],"b2");b.print(a);b=new CButton("Cancel",function(a){a.hide()},[g]);b.print(a)}else c.submit(),alib.dom.m_document.body.removeChild(b)};
AntObjectBrowser.prototype.setFilter=function(a,b,c){var d=this.m_filters.length;this.m_filters[d]={};this.m_filters[d].fieldName=a;this.m_filters[d].value=b;this.m_filters[d].blogic=c&&0<d?c:"and";this.mainObject.setFilter(a,b)};AntObjectBrowser.prototype.removeFilter=function(a,b){for(i=0;i<this.m_filters.length;i++)this.m_filters[i].fieldName==a&&this.m_filters[i].value==b&&this.m_filters.splice(i,1);for(i=0;i<this.m_filters.length;i++);};AntObjectBrowser.prototype.setViewsFilter=function(){};
AntObjectBrowser.prototype.printInlineAddComment=function(a,b){a.innerHTML="";a.cls=this;var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin-top","5px");alib.dom.styleSet(c,"width","99%");if(b){this.comment_users||(this.comment_users=[]);c=alib.dom.createElement("table",c);alib.dom.styleSet(c,"width","100%");c.setAttribute("cellPadding","0");c.setAttribute("cellSpacing","0");var d=alib.dom.createElement("tbody",c),e=alib.dom.createElement("tr",d);e.vAlign="top";var f=alib.dom.createElement("td",
e);alib.dom.styleSet(f,"width","55px");f.innerHTML="<img src='/files/userimages/current/48/48' style='width:48px;' />";var c=alib.dom.createElement("td",e),g=alib.dom.createElement("textarea",c);alib.dom.styleSet(g,"width","100%");alib.dom.styleSet(g,"height","50px");alib.dom.textAreaAutoResizeHeight(g,50);g.focus();e=alib.dom.createElement("tr",d);f=alib.dom.createElement("td",e);f.innerHTML="Notify:";c=alib.dom.createElement("td",e);alib.dom.styleSet(c,"padding-top","5px");var c=alib.dom.createElement("input",
c),c=new CTextBoxList(c,{bitsOptions:{editable:{addKeys:[188,13,186,59],addOnBlur:!0}},plugins:{autocomplete:{placeholder:"Start typing a name for suggestions",minLength:2,queryRemote:!0,remote:{url:"/users/json_autocomplete.php"}}}}),e=alib.dom.createElement("tr",d),f=alib.dom.createElement("td",e),h=alib.dom.createElement("td",e),e=alib.dom.createElement("tr",d),f=alib.dom.createElement("td",e),d=alib.dom.createElement("td",e);alib.dom.styleSet(d,"padding-top","7px");alib.dom.styleSet(d,"padding-bottom",
"10px");alib.dom.styleSet(d,"text-align","right");var k=[],e=alib.dom.createElement("span",d),f=new AntFsUpload("%tmp%");f.cbData.cls=this;f.onRemoveUpload=function(a){for(m in k)m==a&&k.splice(m,1)};f.onQueueComplete=function(){for(file in this.m_uploadedFiles)k.push(this.m_uploadedFiles[file].id)};f.showTmpUpload(e,h,"Add Attachment");h=null;this.parentObject&&"case"==this.parentObject.obj_type&&this.parentObject.getValue("customer_id")&&(h=alib.dom.createElement("input",d),h.type="checkbox",alib.dom.styleSet(h,
"vertical-align","middle"),h.checked=!1,alib.dom.createElement("span",d,"&nbsp;Sent comment to "+this.parentObject.getValueName("customer_id")+"&nbsp;&nbsp;&nbsp;"));h=new CButton("Add Comment",function(a,b,c,d,e,f){a.saveComment(b.value,c,f,d,null!==e?e.checked:!1)},[this,g,c,a,h,k],"b2");h.print(d);this.commentObj={ta_comment:g,t:c,con:a};h=alib.ui.Button("Cancel",{className:"b1 nomargin",tooltip:"Cancel Comment",cls:this,con:a,onclick:function(){this.cls.printInlineAddComment(this.con,!1)}});h.print(d);
if(!a.fNotifyLoaded){a.fNotifyLoaded=!0;if(this.parentObject){g=this.parentObject.getFields();for(d=0;d<g.length;d++){var l=g[d],f=e=h="";"object"==l.type&&"user"==l.subtype&&(h=this.parentObject.getValue(l.name),e=this.parentObject.getValueName(l.name),f=l.subtype);if(h){for(var l=!1,m=0;m<this.comment_users.length;m++)this.comment_users[m].id==f+":"+h&&(l=!0);l||(this.comment_users[this.comment_users.length]={id:f+":"+h,name:e})}}}if(this.comment_users)for(m=0;m<this.comment_users.length;m++)(g_userid&&
this.comment_users[m].id!="user:"+g_userid||!g_userid)&&c.add(this.comment_users[m].id,this.comment_users[m].name)}}else this.commentObj=null,c=alib.dom.createElement("div",c),alib.dom.styleSet(c,"margin-top","5px"),c.con=a,c.innerHTML="<input type='text' class='comment' placeholder='Add Comment' style='width:99%;'>",c.onclick=function(){this.con.cls.printInlineAddComment(this.con,!0)}};
AntObjectBrowser.prototype.addCommentsMember=function(a){if(a){a=getNotifiedParts(a);this.comment_users||(this.comment_users=[]);for(var b=!1,c=0;c<this.comment_users.length;c++)if(this.comment_users[c].id==a.type+":"+a.id||this.comment_users[c].id==a.email)b=!0;b||("email"==a.type&&""!=a.email?this.comment_users[this.comment_users.length]={id:a.email,name:a.name}:"text"!=a.type&&(this.comment_users[this.comment_users.length]={id:a.type+":"+a.id,name:a.name}))}};
AntObjectBrowser.prototype.saveComment=function(a,b,c,d,e){var f=b.getValues();d.innerHTML="<div class='loading'></div>";var g=new CAntObject("comment");g.setValue("comment",a);this.obj_reference&&(g.setValue("obj_reference",this.obj_reference),g.setMultiValue("associations",this.obj_reference));for(var a="",h=0;h<f.length;h++)a&&(a+=","),f[h][0]?a+=f[h][0]:f[h][1]&&(a+=f[h][1]);this.parentObject&&e&&(a&&(a+=","),a+="customer:"+this.parentObject.getValue("customer_id"));a&&g.setValue("notify",a);
for(h in c)g.setMultiValue("attachments",c[h]);g.setValue("owner_id","-3");g.brwsercls=this;g.t_notify=b;g.brwsercon=d;g.onsave=function(){this.onload=function(){var a=this.brwsercls;setTimeout(function(){a.refresh()},1E3);this.brwsercon.fNotifyLoaded=!1;this.brwsercls.printInlineAddComment(this.brwsercon,!1)};this.load()};g.save()};AntObjectBrowser.prototype.setObjectContext=function(a){this.objectContext=a};
function AntObjectBrowser_Item(a,b){this.selectedObjId=this.renderer=null;this.bcls=b;this.allow_open=this.id=null;this.revision=1;this.listCon=this.row=this.tbody=this.objData=this.parentCon=null;this.objData=a;this.seen=!0;this.fIsSelected=!1;this.checkbox=alib.dom.createElement("input");this.checkbox.type="checkbox";this.checkbox.cls=this;this.checkbox.onclick=function(){this.cls.select(this.checked)};if(a&&(this.allow_open=a.security.view,this.id=a.id,this.objData=a,a.revision&&(this.revision=
a.revision),"f"==a.f_seen||!1==a.f_seen))this.seen=!1}
AntObjectBrowser_Item.prototype.print=function(a,b){this.listCon||(this.listCon=a);if(this.row)c=this.row;else{var c=alib.dom.createElement("tr");this.row=c;this.oid=this.id;this.row.cls=this;b?a.insertBefore(c,b.row):a.appendChild(this.row);var d=this.selected()?"aobListRowAct":this.seen?"aobListRow":"aobListRowAlert";alib.dom.styleSetClass(this.row,d)}try{c.innerHTML=""}catch(e){}c.revision=this.revision;if("details"==this.bcls.viewmode)if(c=alib.dom.createElement("td",this.row),this.bcls.mobile&&
"comment"!=this.bcls.obj_type&&"activity"!=this.bcls.obj_type&&"status_update"!=this.bcls.obj_type)this.printObjectMobileRow(c,this.objData);else switch(this.bcls.obj_type){case "comment":this.renderer=new AntObjectBrowser_Item_Comment(this,c,this.objData);break;case "notification":this.renderer=new AntObjectBrowser_Item_Notification(this,c,this.objData);break;case "activity":this.renderer=new AntObjectBrowser_Item_Activity(this,c,this.objData);break;case "status_update":this.renderer=new AntObjectBrowser_Item_StatusUpdate(this,
c,this.objData);break;case "email_thread":this.printObjectEmlThreadRow(c,this.objData);break;case "email_message":this.printObjectEmlMessageRow(c,this.objData);break;case "contact_personal":this.printObjectContactRow(c,this.objData);break;default:this.printObjectGenRow(c,this.objData)}else this.tbody=a,this.objData.isBrowse?this.printTableRowBrowse(c,this.objData):this.printTableRow(c,this.objData);this.openAct=this.objData.security.view?function(a){this.bcls.selectObjectRow(this.id,a);this.seen=
!0;this.onSetSeen()}:function(){ALib.Dlg.messageBox("You do not have permissions to view this object!")}};AntObjectBrowser_Item.prototype.selected=function(){return this.fIsSelected};AntObjectBrowser_Item.prototype.select=function(a){(this.checkbox.checked=a)?(alib.dom.styleSetClass(this.row,"aobListRowAct"),this.fIsSelected=!0):(alib.dom.styleSetClass(this.row,this.seen?"aobListRow":"aobListRowAlert"),this.fIsSelected=!1)};AntObjectBrowser_Item.prototype.onSetSeen=function(){};
AntObjectBrowser_Item.prototype.update=function(a){this.objData=a;this.revision=a.revision;if(this.renderer&&this.renderer.update)this.renderer.update(a);else if(this.listCon)this.print(this.listCon);else throw"Item "+a.id+" has not been printed yet";};
AntObjectBrowser_Item.prototype.move=function(a){if(this.listCon.childNodes.length>a){for(var b=-1,c=0;c<this.bcls.objectList.length;c++)this.bcls.objectList[c].id==this.id&&(b=c);-1!=b&&a!=b&&(this.bcls.objectList.splice(b,1),this.bcls.objectList.splice(a,0,this));if(a!=b){try{var d=this.listCon.removeChild(this.row)}catch(e){}d&&(a>=this.listCon.childNodes.length-1?this.listCon.appendChild(d):this.listCon.insertBefore(d,this.listCon.childNodes[a+1]))}}};
AntObjectBrowser_Item.prototype.remove=function(){if(this.listCon){try{alib.fx.fadeOut(this.row,function(){this.parentNode&&this.parentNode.removeChild(this)},500)}catch(a){alert(a)}for(var b=-1,c=0;c<this.bcls.objectList.length;c++)this.bcls.objectList[c].id==this.id&&(this.bcls.objectList.splice(c,1),b=c);this.bcls.preview&&this.id==this.bcls.curObjLoaded&&(c=null,this.bcls.objectList.length>b&&(c=this.bcls.objectList[b].id),this.bcls.selectObjectRow(c))}};
AntObjectBrowser_Item.prototype.onMouseDownAct=function(){};AntObjectBrowser_Item.prototype.onMouseUpAct=function(){};AntObjectBrowser_Item.prototype.openAct=function(){};AntObjectBrowser_Item.prototype.getName=function(){for(var a in this.objData)switch(a){case "full_name":case "name":case "title":if(this.objData[a])return this.objData[a]}return this.id};
AntObjectBrowser_Item.prototype.printObjectEmlThreadRow=function(a,b){var c=b.id,d=b.senders,e=b.ts_delivered,f=b.subject,g=b.num_messages;g||(g=1);var h=b.num_attachments,k=b.f_flagged;this.seen=!0;if("f"==b.f_seen||!1==b.f_seen)this.seen=!1;if("f"==b.flag_seen||!1==b.flag_seen)this.seen=!1;a.oid=c;a.objid=c;alib.dom.styleSet(a,"cursor","default");alib.dom.styleSet(a,"padding","3px");var l=ALib.m_document.createElement("div");alib.dom.styleSetClass(l,"statusAlert");l.innerHTML="Move Item(s)";l=alib.dom.createElement("table",
a);l.cellPadding=0;l.cellSpacing=0;alib.dom.styleSet(l,"width","100%");alib.dom.styleSet(l,"table-layout","fixed");var m=alib.dom.createElement("tbody",l),l=alib.dom.createElement("tr",m);this.iconCon=alib.dom.createElement("td",l);alib.dom.styleSet(this.iconCon,"width","23px");alib.dom.styleSet(this.iconCon,"text-align","center");this.iconCon.vAlign="middle";this.iconCon.rowSpan=2;this.bcls.hideCheckbox||this.iconCon.appendChild(this.checkbox);var n=alib.dom.createElement("td",l);alib.dom.styleSetClass(n,
"aobjListBold");alib.dom.styleSet(n,"cursor","pointer");alib.dom.styleSet(n,"padding","0 3px 5px 0");alib.dom.styleSet(n,"overflow","hidden");alib.dom.styleSet(n,"white-space","nowrap");alib.dom.styleSet(n,"overflow","hidden");n.m_id=c;n.m_itemcls=this;n.onclick=function(a){this.m_itemcls.openAct(a)};n.innerHTML=d;n=alib.dom.createElement("td",l);alib.dom.styleSet(n,"cursor","pointer");alib.dom.styleSet(n,"text-align","right");alib.dom.styleSet(n,"padding","0 3px 5px 0");alib.dom.styleSet(n,"width",
"10px");n.m_id=c;n.m_itemcls=this;n.onclick=function(a){this.m_itemcls.openAct(a)};n.innerHTML="("+g+")";n=alib.dom.createElement("td",l);alib.dom.styleSetClass(n,"DynDivTopright");alib.dom.styleSet(n,"cursor","pointer");alib.dom.styleSet(n,"text-align","right");alib.dom.styleSet(n,"padding","0 3px 5px 0");alib.dom.styleSet(n,"width","65px");n.m_id=c;n.m_itemcls=this;n.onclick=function(a){this.m_itemcls.openAct(a)};n.innerHTML=emailListFormatTimeDel(e);d=alib.dom.createElement("tr",m);n=alib.dom.createElement("td",
d);alib.dom.styleSet(n,"cursor","pointer");alib.dom.styleSet(n,"overflow","hidden");alib.dom.styleSet(n,"white-space","nowrap");alib.dom.styleSet(n,"overflow","hidden");n.colSpan=3;n.m_id=c;n.m_itemcls=this;n.onclick=function(a){this.m_itemcls.openAct(a)};n.innerHTML=""!=h&&"0"!=h&&null!=h?"<img border='0' style='float:right;' src='/images/icons/clip.gif'>"+f:f;n=alib.dom.createElement("td",l);alib.dom.styleSet(n,"width","12px");n.vAlign="middle";n.rowSpan=2;f=alib.dom.createElement("img",n);alib.dom.styleSet(f,
"cursor","pointer");f.border="0";f.src="/images/icons/flag_"+("t"==k?"on":"off")+"_12.png";f.tid=c;f.flagged="t"==k?!0:!1;f.onclick=function(){var a=this.flagged?"markUnflagged":"markFlag";ajax=new CAjax("json");ajax.img=this;ajax.onload=function(){this.img.flagged?(this.img.flagged=!1,this.img.src="/images/icons/flag_off_12.png"):(this.img.flagged=!0,this.img.src="/images/icons/flag_on_12.png")};ajax.exec("/controller/Email/"+a,[["obj_type","email_thread"],["objects[]",this.tid]])}};
AntObjectBrowser_Item.prototype.printObjectEmlMessageRow=function(a,b){var c=b.id,d=b.send_to,e=b.message_date,f=b.subject,g=b.num_attachments,h=b.flag_flagged,k=!1;if("t"==b.flag_seen||!0==b.flag_seen)k=!0;this.seen=k;alib.dom.styleSetClass(a,outercls);a.oid=c;a.objid=c;alib.dom.styleSet(a,"cursor","default");alib.dom.styleSet(a,"padding","3px");var l=ALib.m_document.createElement("div");alib.dom.styleSetClass(l,"statusAlert");l.innerHTML="Move Item(s)";l=alib.dom.createElement("table",a);l.cellPadding=
0;l.cellSpacing=0;alib.dom.styleSet(l,"width","100%");alib.dom.styleSet(l,"table-layout","fixed");var m=alib.dom.createElement("tbody",l),l=alib.dom.createElement("tr",m);this.iconCon=alib.dom.createElement("td",l);alib.dom.styleSet(this.iconCon,"width","23px");alib.dom.styleSet(this.iconCon,"text-align","center");this.iconCon.innerHTML="<img src='/images/icons/email_16_"+(k?"opened":"unopened")+".png' border=''>";this.iconCon.vAlign="middle";this.iconCon.rowSpan=2;k=alib.dom.createElement("td",l);
alib.dom.styleSetClass(k,"aobjListBold");alib.dom.styleSet(k,"cursor","pointer");alib.dom.styleSet(k,"padding","0 3px 5px 0");alib.dom.styleSet(k,"overflow","hidden");alib.dom.styleSet(k,"white-space","nowrap");alib.dom.styleSet(k,"overflow","hidden");k.m_id=c;k.m_itemcls=this;k.onclick=function(a){this.m_itemcls.openAct(a)};k.innerHTML=d;k=alib.dom.createElement("td",l);alib.dom.styleSetClass(k,"DynDivTopright");alib.dom.styleSet(k,"cursor","pointer");alib.dom.styleSet(k,"text-align","right");alib.dom.styleSet(k,
"padding","0 3px 5px 0");alib.dom.styleSet(k,"width","55px");k.m_id=c;k.m_itemcls=this;k.onclick=function(a){this.m_itemcls.openAct(a)};k.innerHTML=emailListFormatTimeDel(e);d=alib.dom.createElement("tr",m);k=alib.dom.createElement("td",d);alib.dom.styleSet(k,"cursor","pointer");alib.dom.styleSet(k,"overflow","hidden");alib.dom.styleSet(k,"white-space","nowrap");alib.dom.styleSet(k,"overflow","hidden");k.colSpan=2;k.m_id=c;k.m_itemcls=this;k.onclick=function(a){this.m_itemcls.openAct(a)};k.innerHTML=
""!=g&&"0"!=g?"<img border='0' style='float:right;' src='/images/icons/clip.gif'>"+f:f;k=alib.dom.createElement("td",l);alib.dom.styleSet(k,"width","12px");k.vAlign="middle";k.rowSpan=2;f=alib.dom.createElement("img",k);alib.dom.styleSet(f,"cursor","pointer");f.border="0";f.src="/images/icons/flag_"+("t"==h?"on":"off")+"_12.png";f.tid=c;f.flagged="t"==h?!0:!1;f.onclick=function(){var a=this.flagged?"markUnflagged":"markFlag";ajax=new CAjax("json");ajax.img=this;ajax.onload=function(){this.img.flagged?
(this.img.flagged=!1,this.img.src="/images/icons/flag_off_12.png"):(this.img.flagged=!0,this.img.src="/images/icons/flag_on_12.png")};ajax.exec("/controller/Email/"+a,[["obj_type","email_message"],["objects[]",this.tid]])}};
AntObjectBrowser_Item.prototype.printObjectGenRow=function(a,b){var c=b.id,d=this.allow_open?function(a){this.m_browseclass.selectObjectRow(this.m_id,a)}:function(){ALib.Dlg.messageBox("You do not have permissions to view this object!")};a.objid=c;var e=ALib.m_document.createElement("div");alib.dom.styleSetClass(e,"statusAlert");e.innerHTML="Move Item(s)";alib.dom.styleSet(a,"cursor","default");alib.dom.styleSet(a,"padding","3px");e=alib.dom.createElement("table",a);e.cellPadding=0;e.cellSpacing=
0;alib.dom.styleSet(e,"width","100%");alib.dom.styleSet(e,"table-layout","fixed");var e=alib.dom.createElement("tbody",e),f=alib.dom.createElement("tr",e),g=alib.dom.createElement("td",f);alib.dom.styleSet(g,"width","23px");g.vAlign="middle";g.rowSpan=2;g=alib.dom.createElement("td",f);alib.dom.styleSetClass(g,"aobjListBold");alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"padding","0 3px 5px 0");g.m_id=c;g.m_browseclass=this.bcls;g.onmousedown=d;if(this.bcls.view_fields.length){var h=
b[this.bcls.view_fields[0].fieldName],k="";if(h)if(h instanceof Array)for(var k="",l=0;l<h.length;l++)k&&(k+=", "),k+=h[l].value;else k=h;alib.dom.setText(g,k)}g=alib.dom.createElement("td",f);alib.dom.styleSetClass(g,"DynDivTopright");alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"text-align","right");alib.dom.styleSet(g,"padding","0 3px 5px 0");g.m_id=c;g.m_browseclass=this.bcls;g.onclick=d;if(1<this.bcls.view_fields.length){h=b[this.bcls.view_fields[1].fieldName];k="";if(h)if(h instanceof
Array){k="";for(l=0;l<h.length;l++)k&&(k+=", "),k+=h[l].value}else k=h;alib.dom.setText(g,k)}f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"overflow","hidden");alib.dom.styleSet(g,"white-space","nowrap");alib.dom.styleSet(g,"overflow","hidden");g.colSpan=2;g.m_id=c;g.m_browseclass=this.bcls;g.onclick=d;if(2<this.bcls.view_fields.length){h=b[this.bcls.view_fields[2].fieldName];k="";if(h)if(h instanceof Array){k="";for(l=
0;l<h.length;l++)k&&(k+=", "),k+=h[l].value}else k=h;alib.dom.setText(g,k)}};AntObjectBrowser_Item.prototype.printObjectMobileRow=function(a,b){return this.printObjectGenRow(a,b)};
AntObjectBrowser_Item.prototype.printObjectContactRow=function(a,b){var c=b.id,d=b.name,e=b.phone_cell,f=b.phone_home,g=b.phone_work,h=b.email?b.email:b.email2,k=b.image_id.key,e=e?e:g?g:f;a.oid=c;a.objid=c;alib.dom.styleSet(a,"cursor","default");alib.dom.styleSet(a,"padding","3px");f=ALib.m_document.createElement("div");alib.dom.styleSetClass(f,"statusAlert");f.innerHTML="Move Item(s)";f=alib.dom.createElement("table",a);f.cellPadding=0;f.cellSpacing=0;alib.dom.styleSet(f,"width","100%");alib.dom.styleSet(f,
"table-layout","fixed");f=alib.dom.createElement("tbody",f);g=alib.dom.createElement("tr",f);this.iconCon=alib.dom.createElement("td",g);alib.dom.styleSet(this.iconCon,"width","50px");alib.dom.styleSet(this.iconCon,"text-align","center");k&&(this.iconCon.innerHTML="<img src='/files/images/"+k+"/48/33' border=''>");this.iconCon.vAlign="middle";this.iconCon.rowSpan=2;k=alib.dom.createElement("td",g);alib.dom.styleSetClass(k,"aobjListBold");alib.dom.styleSet(k,"cursor","pointer");alib.dom.styleSet(k,
"padding","0 3px 5px 0");alib.dom.styleSet(k,"overflow","hidden");alib.dom.styleSet(k,"white-space","nowrap");alib.dom.styleSet(k,"overflow","hidden");k.m_id=c;k.m_itemcls=this;k.onclick=function(a){this.m_itemcls.openAct(a)};k.innerHTML=unescape(d);k=alib.dom.createElement("td",g);alib.dom.styleSetClass(k,"DynDivTopright");alib.dom.styleSet(k,"cursor","pointer");alib.dom.styleSet(k,"text-align","right");alib.dom.styleSet(k,"padding","0 3px 5px 0");alib.dom.styleSet(k,"width","100px");k.m_id=c;k.m_itemcls=
this;k.onclick=function(a){this.m_itemcls.openAct(a)};k.innerHTML=unescape(e);d=alib.dom.createElement("tr",f);k=alib.dom.createElement("td",d);alib.dom.styleSet(k,"cursor","pointer");alib.dom.styleSet(k,"overflow","hidden");alib.dom.styleSet(k,"white-space","nowrap");alib.dom.styleSet(k,"overflow","hidden");k.colSpan=2;k.m_id=c;k.m_itemcls=this;k.onclick=function(a){this.m_itemcls.openAct(a)};k.innerHTML=unescape(h)};
AntObjectBrowser_Item.prototype.printTableRow=function(a,b){if(!this.bcls.hideCheckbox){var c=alib.dom.createElement("td",a);alib.dom.styleSet(c,"text-align","center");alib.dom.styleSet(c,"padding-right","5px");b.id==this.selectedObjId&&(this.checkbox.checked=!0);c.appendChild(this.checkbox)}for(var d=0;d<this.bcls.view_fields.length;d++){var c=b[this.bcls.view_fields[d].fieldName],e=this.bcls.mainObject.getFieldByName(this.bcls.view_fields[d].fieldName),f="";if(c)if(c instanceof Array){f="";for(e=
0;e<c.length;e++)f&&(f+=", "),f+=c[e].value}else f=c instanceof Object?c.value?c.value:c.key:"bool"==e.type&&(!0===c||"t"==c)?"Yes":"bool"==e.type&&(!1===c||"f"==c)?"No":c;f||(f="&nbsp;");this.bcls.mainObject.nameField==this.bcls.view_fields[d].fieldName&&(b.iconPath&&(f="<img src='"+b.iconPath+"'> "+f),f='<span class="aobjListBold">'+f+"</span>");c=alib.dom.createElement("td",a);c.m_itemcls=this;c.onclick=function(a){this.m_itemcls.openAct(a)};c.innerHTML=f}};
AntObjectBrowser_Item.prototype.printObjectGenRow=function(a,b){var c=b.id,d=this.allow_open?function(a){this.m_browseclass.selectObjectRow(this.m_id,a)}:function(){ALib.Dlg.messageBox("You do not have permissions to view this object!")};a.objid=c;DragAndDrop.registerDragable(a,null,"dzNavbarDrop_"+this.bcls.obj_type);var e=ALib.m_document.createElement("div");alib.dom.styleSetClass(e,"statusAlert");e.innerHTML="Move Item(s)";DragAndDrop.setDragGuiCon(a,e,15,15);alib.dom.styleSet(a,"cursor","default");
alib.dom.styleSet(a,"padding","3px");e=alib.dom.createElement("table",a);e.cellPadding=0;e.cellSpacing=0;alib.dom.styleSet(e,"width","100%");alib.dom.styleSet(e,"table-layout","fixed");var e=alib.dom.createElement("tbody",e),f=alib.dom.createElement("tr",e),g=alib.dom.createElement("td",f);alib.dom.styleSet(g,"width","23px");g.vAlign="middle";g.rowSpan=2;for(var h=null,k=0;k<this.bcls.chkBoxes.length;k++)this.bcls.chkBoxes[k].value==c&&(h=this.bcls.chkBoxes[k]);h||(h=alib.dom.createElement("input"),
h.type="checkbox",h.cls=this.bcls,h.value=c,this.bcls.chkBoxes[this.bcls.chkBoxes.length]=h);a.chkbox=h;this.bcls.hideCheckbox||g.appendChild(h);g=alib.dom.createElement("td",f);alib.dom.styleSetClass(g,"aobjListBold");alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"padding","0 3px 5px 0");g.m_id=c;g.m_browseclass=this.bcls;g.onmousedown=d;if(this.bcls.view_fields.length){h=b[this.bcls.view_fields[0].fieldName];k="";if(h)if(h instanceof Array)for(var k="",l=0;l<h.length;l++)k&&(k+=", "),
k+=h[l].value;else k=h;alib.dom.setText(g,k)}g=alib.dom.createElement("td",f);alib.dom.styleSetClass(g,"DynDivTopright");alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"text-align","right");alib.dom.styleSet(g,"padding","0 3px 5px 0");g.m_id=c;g.m_browseclass=this.bcls;g.onclick=d;if(1<this.bcls.view_fields.length){h=b[this.bcls.view_fields[1].fieldName];k="";if(h)if(h instanceof Array){k="";for(l=0;l<h.length;l++)k&&(k+=", "),k+=h[l].value}else k=h instanceof Object?h.value?h.value:
h.key:!0===h||"t"==h?"Yes":!1===h||"f"==h?"No":h;alib.dom.setText(g,k)}f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"overflow","hidden");alib.dom.styleSet(g,"white-space","nowrap");alib.dom.styleSet(g,"overflow","hidden");g.colSpan=2;g.m_id=c;g.m_browseclass=this.bcls;g.onclick=d;if(2<this.bcls.view_fields.length){h=b[this.bcls.view_fields[2].fieldName];k="";if(h)if(h instanceof Array){k="";for(l=0;l<h.length;l++)k&&
(k+=", "),k+=h[l].value}else k=h instanceof Object?h.value?h.value:h.key:h;alib.dom.setText(g,k)}};
AntObjectBrowser_Item.prototype.printTableRowBrowse=function(a,b){if(!this.bcls.hideCheckbox){var c=alib.dom.createElement("td",a);alib.dom.styleSet(c,"text-align","center");alib.dom.styleSet(c,"padding-right","5px");c.appendChild(this.checkbox)}for(var d=0;d<this.bcls.view_fields.length;d++){var c=b[this.bcls.view_fields[d].fieldName],e=this.bcls.mainObject.getFieldByName(this.bcls.view_fields[d].fieldName),f="";if(c)if(c instanceof Array){f="";for(e=0;e<c.length;e++)f&&(f+=", "),f+=c[e].value}else f=
"fkey"==e.type||"object"==e.type||"alias"==e.type?c.value:c;f||(f="&nbsp;");this.bcls.mainObject.nameField==this.bcls.view_fields[d].fieldName&&(b.iconPath&&(f="<img src='"+b.iconPath+"'> "+f),f='<span class="aobjListBold">'+f+"</span>");c=alib.dom.createElement("td",a);c.m_itemcls=this;c.onclick=function(a){this.m_itemcls.openAct(a)};c.innerHTML=f}};
function AntObjectBrowser_Item_Activity(a,b,c){var d=c.id,e=c.user_id.value,f=c.user_id.key,g=c.name,h=c.verb,k=c.type_id.value,l=c.direction,m=c.notes,n=c.ts_entered,o="";c.obj_reference&&c.obj_reference.key&&(o=c.obj_reference.key);alib.dom.styleSetClass(a.row,"aobListRowNoSelect");alib.dom.styleSetClass(b,"aobListRowActivity");b.objid=d;b=alib.dom.createElement("table",b);alib.dom.styleSet(b,"table-layout","fixed");alib.dom.styleSet(b,"width","100%");b.setAttribute("cellPadding","0");b.setAttribute("cellSpacing",
"0");b=alib.dom.createElement("tbody",b);b=alib.dom.createElement("tr",b);b.vAlign="top";var p=alib.dom.createElement("td",b);p.setAttribute("rowSpan",2);alib.dom.styleSet(p,"width","60px");alib.dom.styleSet(p,"text-align","center");alib.dom.styleSet(p,"cursor","pointer");p.aid=d;p.cls=a.bcls;a.bcls.setUserImage(p,f,"");p=alib.dom.createElement("td",b);n=alib.dom.createElement("div",p,alib.dateTime.format(new Date(n),"ddd, MMMM d, yyyy H:mm a"));alib.dom.styleSetClass(n,"aobjListBold");n=alib.dom.createElement("div",
p);alib.dom.styleSetClass(n,"aobListItal");n.aid=d;n.cls=a.bcls;e=alib.dom.createElement("a",n,e);e.href="javascript:void(0);";(e.traceId=f)&&AntObjectInfobox.attach("user",f,e);f="";null==k&&(k="");e=k+"&nbsp;&nbsp;:&nbsp;&nbsp;";switch(k.toLowerCase()){case "email":f="i"==l?"received an email ":"sent an email ";break;case "phone call":e="i"==l?"logged an innbound call ":"logged an outbound call ",f=g;case "comment":e="commented on ";f=g;break;case "status update":e="added a ";f=k;break;default:switch(f=
g,h){case "create":case "created":e="created a new "+k.toLowerCase()+" ";m="";break;default:e=h+" "}}g=alib.dom.createElement("span",n);o=o.split(":");h=!1;a.bcls.objectContext&&1<o.length&&a.bcls.objectContext.obj_type==o[0]&&a.bcls.objectContext.id==o[1]&&(h=!0);k=null;1<o.length&&!h?(g.innerHTML="&nbsp;"+e,k=alib.dom.createElement("a",n),k.href="javascript:void(0);",k.itemcls=a,k.obj_type=o[0],k.oid=o[1],k.onclick=function(){this.itemcls.bcls.loadObjectForm(this.oid,null,null,this.obj_type)},k.traceId=
o[1],AntObjectInfobox.attach(o[0],o[1],k)):1<o.length&&h?(g.innerHTML="&nbsp;"+e,k=alib.dom.createElement("span",n)):g.innerHTML="&nbsp;"+e+"&nbsp;&nbsp;";k&&(k.innerHTML=f);o=alib.dom.createElement("div",p);alib.dom.styleSet(o,"margin","10px 5px 5px 0px");m=m.replace(/\n/g,"<br />");if(c.attachments&&0<c.attachments.length){p=alib.dom.createElement("div",p);alib.dom.styleSet(p,"margin-top","5px");for(var q in c.attachments)c.attachments[q].key&&(alib.dom.createElement("a",p,c.attachments[q].value?
c.attachments[q].value:c.attachments[q].key).href="/antfs/"+c.attachments[q].key,alib.dom.createElement("span",p,"<br />"))}alib.dom.styleSet(o,"overflow","hidden");alib.dom.styleSet(o,"max-height","500px");alib.dom.styleSet(o,"text-overflow","ellipsis");o.innerHTML=m;c=alib.dom.createElement("td",b);alib.dom.styleSet(c,"width","20px");alib.dom.styleSet(c,"cursor","default");var r=alib.dom.createElement("span",c);alib.dom.styleSet(r,"cursor","pointer");alib.dom.styleSet(r,"display","none");r.oid=
d;r.bcls=a.bcls;r.onclick=function(){this.bcls.deleteObjects(this.oid)};r.innerHTML="<img src='/images/icons/delete_10.png' />";alib.events.listen(b,"mouseover",function(){alib.dom.styleSet(r,"display","inline")});alib.events.listen(b,"mouseout",function(){alib.dom.styleSet(r,"display","none")})}
function AntObjectBrowser_Item_Notification(a,b,c){b.objid=c.id;alib.dom.styleSetClass(a.row,"aobListRowNoSelect");alib.dom.styleSetClass(b,"aobListRowActivity");b=alib.dom.createElement("div",b);alib.dom.createElement("span",b).innerHTML="<img src='"+("/files/userimages/"+c.creator_id.key+"/16/16")+"' style='width:16px;' />&nbsp;";var d=alib.dom.createElement("a",b,c.owner_id.key==c.creator_id.key?"You":c.creator_id.value);d.href="javascript:void(0);";AntObjectInfobox.attach("user",c.creator_id.key,
d);alib.dom.createElement("span",b,"&nbsp;");alib.dom.createElement("span",b,c.name.toLowerCase()+":");alib.dom.createElement("span",b,"&nbsp;");if(c.obj_reference.key&&(d=c.obj_reference.key.split(":"),1<d.length)){var e=alib.dom.createElement("a",b);e.innerHTML=c.obj_reference.value==d[1]?d[0]:c.obj_reference.value;e.href="javascript:void(0);";e.itemcls=a;e.obj_type=d[0];e.oid=d[1];e.onclick=function(){loadObjectForm(this.obj_type,this.oid)}}alib.dom.createElement("span",b,"&nbsp;@ "+c.ts_execute)}
function AntObjectBrowser_Item_StatusUpdate(a,b,c){this.objData=c;this.ele=b;this.item=a;this.noteCon=this.commentsBr=null;this.render()}
AntObjectBrowser_Item_StatusUpdate.prototype.render=function(){var a=this.objData.id,b=this.objData.owner_id.value,c=this.objData.owner_id.key,d=this.objData.comment,e=this.objData.ts_entered,f="";this.objData.obj_reference&&this.objData.obj_reference.key&&(f=this.objData.obj_reference.key);alib.dom.styleSetClass(this.item.row,"aobListRowNoSelect");alib.dom.styleSet(this.ele,"cursor","default");alib.dom.styleSet(this.ele,"padding","10px 0px 10px 0px");this.ele.objid=a;var g=alib.dom.createElement("table",
this.ele);alib.dom.styleSet(g,"table-layout","fixed");alib.dom.styleSet(g,"width","100%");g.setAttribute("cellPadding","0");g.setAttribute("cellSpacing","0");var g=alib.dom.createElement("tbody",g),h=alib.dom.createElement("tr",g);h.vAlign="top";var k=alib.dom.createElement("td",h);k.setAttribute("rowSpan",2);alib.dom.styleSet(k,"width","60px");alib.dom.styleSet(k,"text-align","center");alib.dom.styleSet(k,"cursor","pointer");k.aid=a;k.cls=this.item.bcls;this.item.bcls.setUserImage(k,c,"");k=alib.dom.createElement("td",
h);k.aid=a;k.cls=this.item.bcls;var l=alib.dom.createElement("a",k,b);l.href="javascript:void(0);";alib.dom.styleSetClass(l,"aobjListBold");alib.dom.createElement("span",k,"&nbsp;&nbsp;");(l.traceId=c)&&AntObjectInfobox.attach("user",c,l);f=f.split(":");1<f.length&&"status_update"!=f[0]&&(alib.dom.createElement("span",k,"&nbsp;&nbsp;&#9654;&nbsp;&nbsp;"),l=alib.dom.createElement("a",k),l.innerHTML=this.objData.obj_reference.value,l.href="javascript:void(0);",l.itemcls=this.item,l.obj_type=f[0],l.oid=
f[1],l.onclick=function(){this.itemcls.bcls.loadObjectForm(this.oid,null,null,this.obj_type)},l.traceId=f[1],AntObjectInfobox.attach(f[0],f[1],l));this.noteCon=alib.dom.createElement("div",k);alib.dom.styleSet(this.noteCon,"margin","10px 5px 10px 0px");this.noteCon.innerHTML=d.replace(/\n/g,"<br />");d=alib.dom.createElement("div",k);alib.dom.styleSetClass(d,"aobListItal");d.innerHTML=alib.dateTime.format(new Date(e),"ddd, MMMM d, yyyy H:mm a");e=alib.dom.createElement("td",h);alib.dom.styleSet(e,
"width","20px");alib.dom.styleSet(e,"cursor","default");var m=alib.dom.createElement("span",e);alib.dom.styleSet(m,"cursor","pointer");alib.dom.styleSet(m,"display","none");m.oid=a;m.bcls=this.item.bcls;m.onclick=function(){this.bcls.deleteObjects(this.oid)};m.innerHTML="<img src='/images/icons/delete_10.png' />";alib.events.listen(h,"mouseover",function(){alib.dom.styleSet(m,"display","inline")});alib.events.listen(h,"mouseout",function(){alib.dom.styleSet(m,"display","none")});h=alib.dom.createElement("tr",
g);h.vAlign="top";e=alib.dom.createElement("td",h);this.commentsBr=new AntObjectBrowser("comment");this.commentsBr.limit=8;this.commentsBr.setFilter("obj_reference","status_update:"+a);c&&b&&this.commentsBr.addCommentsMember("user:"+c+"|"+b);this.commentsBr.printComments(e,"status_update:"+a,null,0<this.objData.num_comments?!1:!0)};AntObjectBrowser_Item_StatusUpdate.prototype.update=function(a){this.objData=a;this.noteCon.innerHTML=this.objData.comment.replace(/\n/g,"<br />");this.commentsBr&&this.commentsBr.refresh()};
function AntObjectBrowser_Item_Comment(a,b,c){var d=c.id,e=c.owner_id.value,f=c.owner_id.key,g=c.comment,h=c.notified,k=c.ts_entered,l=c.sent_by.key,m=c.sent_by.value?c.sent_by.value:c.sent_by.key,g=g.replace(RegExp("\n","gi"),"<br />");alib.dom.styleSetClass(b,"aobListRowComment");b.objid=d;b=alib.dom.createElement("table",b);alib.dom.styleSet(b,"table-layout","fixed");alib.dom.styleSet(b,"width","100%");b.setAttribute("cellPadding","0");b.setAttribute("cellSpacing","0");b=alib.dom.createElement("tbody",
b);b=alib.dom.createElement("tr",b);b.vAlign="top";var n=alib.dom.createElement("td",b);alib.dom.styleSet(n,"width","55px");alib.dom.styleSet(n,"text-align","center");n.aid=d;n.cls=a.bcls;f&&("user:"+f==c.sent_by.key||""==c.sent_by.key)?a.bcls.setUserImage(n,f,""):n.innerHTML="<img src='/images/user_default.png' style='width:48px;' />";n=alib.dom.createElement("td",b);n.aid=d;n.cls=a.bcls;m="<span class='aobjListBold'>"+(m?m:e)+"</span>&nbsp;&nbsp;";if(h){for(var m=m+">&nbsp;&nbsp;",h=h.split(","),
o=0;o<h.length;o++){var p=h[o].trim();0<o&&(m+=",&nbsp;");var q=getNotifiedParts(p),m=m+q.name;a.bcls.addCommentsMember(p)}m+="&nbsp;&nbsp;"}m+="<span class='aobListItal'>@ "+alib.dateTime.format(new Date(k),"ddd, MMMM d, yyyy H:mm a")+"</span>";n.innerHTML=m+("<div style='margin-top:3px;width:98%;'>"+g+"</div>");if(c.attachments&&0<c.attachments.length)for(o in g=alib.dom.createElement("div",n),alib.dom.styleSet(g,"margin-top","5px"),c.attachments)c.attachments[o].key&&(c.attachments[o].value&&c.attachments[o].value.match(/(gif|png|jpg|jpeg)$/i)&&
(alib.dom.createElement("div",g).innerHTML="<img src='/antfs/images/"+c.attachments[o].key+"' style='max-width:100%;' />"),alib.dom.createElement("a",g,c.attachments[o].value?c.attachments[o].value:c.attachments[o].key).href="/antfs/"+c.attachments[o].key,alib.dom.createElement("span",g,"<br />"));c=alib.dom.createElement("td",b);alib.dom.styleSet(c,"width","20px");alib.dom.styleSet(c,"text-align","center");alib.dom.styleSet(c,"cursor","default");var r=alib.dom.createElement("span",c);alib.dom.styleSet(r,
"cursor","pointer");alib.dom.styleSet(r,"display","none");r.oid=d;r.bcls=a.bcls;r.onclick=function(){this.bcls.deleteObjects(this.oid)};r.innerHTML="<img src='/images/icons/delete_10.png' />";alib.events.listen(b,"mouseover",function(){alib.dom.styleSet(r,"display","inline")});alib.events.listen(b,"mouseout",function(){alib.dom.styleSet(r,"display","none")});c=alib.dom.createElement("input");c.type="checkbox";c.cls=a.bcls;c.value=d;f&&e?a.bcls.addCommentsMember("user:"+f+"|"+e):l&&a.bcls.addCommentsMember(l)}
AntObjectBrowser.Toolbar=function(a){this.browser=a};AntObjectBrowser.Toolbar.prototype.renderFull=function(){};AntObjectBrowser.Toolbar.prototype.renderPreview=function(){};AntObjectBrowser.Toolbar.prototype.renderMobile=function(){};AntObjectBrowser.Toolbar.EmailThread=function(){};
function AntObjectBrowserView(a){this.id=null;this.name="";this.obj_type=a;this.description="";this.fSystem=!1;this.conditions=[];this.sort_order=[];this.view_fields=[];this.f_default=this.scope=this.team_id=this.reportId=this.filterKey="";this.userid=this.userName=this.fDefault=this.user_id=null}
AntObjectBrowserView.prototype.loadFromXml=function(a){if("view"==a.m_name){this.id=unescape(a.getChildNodeValByName("id"));this.name=unescape(a.getChildNodeValByName("name"));this.description=unescape(a.getChildNodeValByName("description"));this.fSystem="t"==a.getChildNodeValByName("f_system")?!0:!1;this.fDefault="t"==a.getChildNodeValByName("f_default")?!0:!1;var b=a.getChildNodeValByName("filter_key");this.filterKey=b?unescape(b):"";var c=a.getChildNodeByName("view_fields");if(c)for(b=0;b<c.getNumChildren();b++){var d=
c.getChildNode(b),e=this.view_fields.length;this.view_fields[e]={};this.view_fields[e].id=null;this.view_fields[e].fieldName=d.m_text}if(c=a.getChildNodeByName("conditions"))for(b=0;b<c.getNumChildren();b++)d=c.getChildNode(b),e=this.conditions.length,this.conditions[e]={},this.conditions[e].blogic=unescape(d.getChildNodeValByName("blogic")),this.conditions[e].fieldName=unescape(d.getChildNodeValByName("field_name")),this.conditions[e].operator=unescape(d.getChildNodeValByName("operator")),this.conditions[e].condValue=
unescape(d.getChildNodeValByName("value"));if(a=a.getChildNodeByName("sort_order"))for(b=0;b<a.getNumChildren();b++)c=a.getChildNode(b),e=this.sort_order.length,this.sort_order[e]={},this.sort_order[e].fieldName=unescape(c.getChildNodeValByName("field_name")),this.sort_order[e].order=unescape(c.getChildNodeValByName("order"))}};
AntObjectBrowserView.prototype.fromData=function(a){this.id=a.id;this.name=a.name;this.description=a.description;this.fSystem=a.f_system;this.fDefault=a.f_default;a.filter_key&&(this.filterKey=a.filter_key);for(var b in a.view_fields)this.view_fields[this.view_fields.length]={id:null,fieldName:a.view_fields[b]};for(b in a.conditions)this.conditions[this.conditions.length]={blogic:a.conditions[b].blogic,fieldName:a.conditions[b].field_name,operator:a.conditions[b].operator,condValue:a.conditions[b].value};
for(b in a.sort_order)this.sort_order[this.sort_order.length]={fieldName:a.sort_order[b].field_name,order:a.sort_order[b].order}};
AntObjectBrowserView.prototype.save=function(){var a=[];a[a.length]=["obj_type",this.obj_type];a[a.length]=["name",this.name];a[a.length]=["description",this.description];a[a.length]=["filter_key",this.filterKey];a[a.length]=["report_id",this.reportId];a[a.length]=["team_id",this.team_id];a[a.length]=["scope",this.scope];a[a.length]=["f_default",this.f_default];a[a.length]=["user_id",this.user_id];this.id&&(a[a.length]=["vid",this.id]);for(var b=0;b<this.conditions.length;b++){var c=this.conditions[b];
a[a.length]=["conditions[]",b];a[a.length]=["condition_blogic_"+b,c.blogic];a[a.length]=["condition_fieldname_"+b,c.fieldName];a[a.length]=["condition_operator_"+b,c.operator];a[a.length]=["condition_condvalue_"+b,c.condValue]}for(b=0;b<this.sort_order.length;b++)c=this.sort_order[b],a[a.length]=["sort_order[]",b],a[a.length]=["sort_order_fieldname_"+b,c.fieldName],a[a.length]=["sort_order_order_"+b,c.order];for(b=0;b<this.view_fields.length;b++)c=this.view_fields[b],a[a.length]=["view_fields[]",
b],a[a.length]=["view_field_fieldname_"+b,c.fieldName];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){if(a)if(a.error)this.cls.onsaveError();else{if(this.cls.id||(this.cls.id=a),!this.cls.repressOnSave)this.cls.onsave(a)}else this.cls.onsaveError()};ajax.exec("/controller/Object/saveView",a)};AntObjectBrowserView.prototype.reset=function(){this.conditions=[];this.sort_order=[];this.view_fields=[]};
AntObjectBrowserView.prototype.addCondition=function(a,b,c,d){var e=this.conditions.length;this.conditions[e]={};this.conditions[e].blogic=a;this.conditions[e].fieldName=b;this.conditions[e].operator=c;this.conditions[e].condValue=d};AntObjectBrowserView.prototype.addOrderBy=function(a,b){var c=this.sort_order.length;this.sort_order[c]={};this.sort_order[c].fieldName=a;this.sort_order[c].order=b;return this.sort_order};
AntObjectBrowserView.prototype.copyView=function(a){this.reset();for(var b=0;b<a.conditions.length;b++)this.addCondition(a.conditions[b].blogic,a.conditions[b].fieldName,a.conditions[b].operator,a.conditions[b].condValue);for(b=0;b<a.sort_order.length;b++)this.addOrderBy(a.sort_order[b].fieldName,a.sort_order[b].order);for(b=0;b<a.view_fields.length;b++)this.view_fields[this.view_fields.length]=a.view_fields[b]};AntObjectBrowserView.prototype.clearConditions=function(){this.conditions=[]};
AntObjectBrowserView.prototype.onsave=function(){};AntObjectBrowserView.prototype.onsaveError=function(){};var SCOPE_EVERYONE=0,SCOPE_TEAM=1,SCOPE_ME=2,SCOPE_USER=3;function AntObjectViewEditor(a,b){this.mainObject=new CAntObject(a);this.view=b?b:new AntObjectBrowserView(a);this.viewBuf=new AntObjectBrowserView(a);this.cbData={};this.saveCon=this.formCon=this.con=this.dlg=null;this.fEditor=!1;this.viewId=this.user_name=this.user_id=null}AntObjectViewEditor.prototype.close=function(){this.dlg.hide()};
AntObjectViewEditor.prototype.onSave=function(){};AntObjectViewEditor.prototype.onCancel=function(){};AntObjectViewEditor.prototype.onApply=function(){};AntObjectViewEditor.prototype.showDialog=function(a){this.dlg=new CDialog("Advanced Filter");this.dlg.parentDlg=a;this.con=alib.dom.createElement("div");this.dlg.customDialog(this.con,650);this.showViewForm();this.dlg.reposition()};
AntObjectViewEditor.prototype.showViewForm=function(){var a="";this.view.name&&(a=" - "+this.view.name);this.dlg.setTitle("Advanced Search"+a);if(this.viewCon)this.saveCon&&alib.dom.styleSet(this.saveCon,"display","none"),alib.dom.styleSet(this.viewCon,"display","block");else{this.viewCon=alib.dom.createElement("div",this.con);var a=alib.dom.createElement("div",this.viewCon),b=alib.dom.createElement("div",this.viewCon);b.innerHTML="<div class='loading'></div>";alib.dom.styleSet(a,"height","330px");
alib.dom.styleSet(a,"overflow","auto");alib.dom.styleSet(a,"display","none");this.conditionObj=null;this.mainObject.clearConditions();var c={};c.parent_dlg=this.dlg;c.parent_dlg.reposition();var d=alib.dom.createElement("div",a);alib.dom.styleSetClass(d,"strong");d.innerHTML="Search Conditions:";for(cond in this.view.conditions)d=this.view.conditions[cond],"undefined"==typeof d.condValue&&(d.condValue=d.value);this.conditionObj=this.mainObject.buildAdvancedQuery(a,this.view.conditions,c);b.innerHTML=
"";alib.dom.styleSet(a,"display","block");b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"margin-top","8px");d=alib.dom.createElement("div",b);alib.dom.styleSetClass(d,"strong");d.innerHTML="Sort By:";c=alib.dom.createElement("a",a);c.href="javascript:void(0);";c.innerHTML="Add Sort Order";c.cls=this;c.order_div=b;c.onclick=function(){this.cls.addOrderBy(this.order_div)};for(c=0;c<this.view.sort_order.length;c++)this.addOrderBy(b,this.view.sort_order[c].fieldName,this.view.sort_order[c].order);
b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"margin-top","8px");d=alib.dom.createElement("div",b);alib.dom.styleSetClass(d,"strong");d.innerHTML="View Columns:";c=alib.dom.createElement("a",a);c.href="javascript:void(0);";c.innerHTML="Add Field";c.cls=this;c.order_div=b;c.onclick=function(){this.cls.addViewColumn(this.order_div)};for(c=0;c<this.view.view_fields.length;c++)a=this.view.view_fields[c].fieldName,"undefined"==typeof a&&(a=this.view.view_fields[c]),this.addViewColumn(b,a);this.buttonCon=
alib.dom.createElement("div",this.viewCon);this.createButtons()}};
AntObjectViewEditor.prototype.createButtons=function(){this.buttonCon.innerHTML="";var a=alib.dom.createElement("div",this.buttonCon);alib.dom.styleSet(a,"margin-top","8px");if(!this.fEditor){var b=alib.ui.Button("Apply",{className:"b2",tooltip:"Close and view results",cls:this,onclick:function(){this.cls.apply()}});b.print(a)}b=alib.ui.Button("Cancel",{className:"b1",tooltip:"Cancel and close form",cls:this,onclick:function(){this.cls.close();this.cls.onCancel()}});b.print(a);alib.dom.createElement("span",
a).innerHTML="&nbsp;|&nbsp;&nbsp;";this.view.id?(this.view.fSystem||(b=alib.ui.Button("Save Changes",{className:"b1",tooltip:"Save changes to this view",cls:this,onclick:function(){this.cls.showSaveForm()}}),b.print(a)),b=alib.ui.Button("Save As New View",{className:"b1",tooltip:"Create a new view using these settings",cls:this,onclick:function(){this.cls.showSaveForm(!0)}})):b=alib.ui.Button("Save View",{className:"b1",tooltip:"Create a new view using these settings",cls:this,onclick:function(){this.cls.showSaveForm()}});
b.print(a)};AntObjectViewEditor.prototype.setViewFromBuf=function(a){this.viewBuf.clearConditions();for(var b=0;b<this.conditionObj.getNumConditions();b++){var c=this.conditionObj.getCondition(b);this.viewBuf.addCondition(c.blogic,c.fieldName,c.operator,c.condValue)}if("object"==typeof a)a.copyView(this.viewBuf);else if("function"==typeof this.view.copyView)this.view.copyView(this.viewBuf);else return a=new AntObjectBrowserView(this.mainObject.name),this.newView.copyView(this.viewBuf),a};
AntObjectViewEditor.prototype.apply=function(){for(var a=0;a<this.conditionObj.getNumConditions();a++){var b=this.conditionObj.getCondition(a);this.viewBuf.addCondition(b.blogic,b.fieldName,b.operator,b.condValue)}this.close();this.onApply(this.viewBuf)};
AntObjectViewEditor.prototype.addOrderBy=function(a,b,c){var b=b?b:"",d=c?c:"asc";"undefined"==typeof this.orderBySerial?this.orderBySerial=1:this.orderBySerial++;c=alib.dom.createElement("div",a);if(this.viewBuf.sort_order.length){var e=alib.dom.createElement("span",c);e.innerHTML="Then By: "}var f=this.viewBuf.sort_order.length;this.viewBuf.sort_order[f]={};this.viewBuf.sort_order[f].id=this.orderBySerial;this.viewBuf.sort_order[f].fieldName=b;this.viewBuf.sort_order[f].order=d;e=alib.dom.createElement("select",
c);e.orderobj=this.viewBuf.sort_order[f];e.onchange=function(){this.orderobj.fieldName=this.value};for(var g=this.mainObject.getFields(),h=0;h<g.length;h++)"fkey_multi"!=g[h].type&&(e[e.length]=new Option(g[h].title,g[h].name,!1,b==g[h].name?!0:!1));this.viewBuf.sort_order[f].fieldName||(this.viewBuf.sort_order[f].fieldName=e.value);e=alib.dom.createElement("span",c);e.innerHTML=" ";b=alib.dom.createElement("select",c);b.orderobj=this.viewBuf.sort_order[f];b.onchange=function(){this.orderobj.order=
this.value};b[b.length]=new Option("Ascending","asc",!1,"asc"==d?!0:!1);b[b.length]=new Option("Descending","desc",!1,"desc"==d?!0:!1);e=alib.dom.createElement("span",c);e.innerHTML=" ";b="undefined"==typeof Ant?"/images/icons/deleteTask.gif":"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif";d=alib.dom.createElement("a",c);d.innerHTML="<img src='"+b+"' border='0' />";d.href="javascript:void(0)";d.odv=c;d.pdv=a;d.cls=this;d.orderid=this.orderBySerial;d.onclick=function(){for(var a=0;a<this.cls.viewBuf.sort_order.length;a++)this.cls.viewBuf.sort_order[a].id==
this.orderid&&this.cls.viewBuf.sort_order.splice(a,1);this.pdv.removeChild(this.odv)}};
AntObjectViewEditor.prototype.addViewColumn=function(a,b){var c=b?b:"";"undefined"==typeof this.viewCOlSerial?this.viewCOlSerial=1:this.viewCOlSerial++;var d=alib.dom.createElement("div",a),e=this.viewBuf.view_fields.length;this.viewBuf.view_fields[e]={};this.viewBuf.view_fields[e].id=this.viewCOlSerial;this.viewBuf.view_fields[e].fieldName=c;var f=alib.dom.createElement("select",d);f.viewobj=this.viewBuf.view_fields[e];f.onchange=function(){this.viewobj.fieldName=this.value};for(var g=this.mainObject.getFields(),
h=0;h<g.length;h++)f[f.length]=new Option(g[h].title,g[h].name,!1,g[h].name==c?!0:!1);this.viewBuf.view_fields[e].fieldName||(this.viewBuf.view_fields[e].fieldName=f.value);alib.dom.createElement("span",d).innerHTML=" ";c="undefined"==typeof Ant?"/images/icons/deleteTask.gif":"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif";e=alib.dom.createElement("a",d);e.innerHTML="<img src='"+c+"' border='0' />";e.href="javascript:void(0)";e.odv=d;e.pdv=a;e.cls=this;e.viewid=this.viewCOlSerial;e.onclick=
function(){for(var a=0;a<this.cls.viewBuf.view_fields.length;a++)this.cls.viewBuf.view_fields[a].id==this.viewid&&this.cls.viewBuf.view_fields.splice(a,1);this.pdv.removeChild(this.odv)}};
AntObjectViewEditor.prototype.showSaveForm=function(a){this.dlg.setTitle("Save View");alib.dom.styleSet(this.viewCon,"display","none");null==this.saveCon?this.saveCon=alib.dom.createElement("div",this.con):(alib.dom.styleSet(this.saveCon,"display","block"),this.saveCon.innerHTML="");var b=alib.dom.createElement("div",this.saveCon),c={},d=alib.dom.createElement("h4",b);alib.dom.styleSet(d,"margin","5px 0 5px 0");d.innerHTML="Name This View";d=alib.dom.createElement("div",b);c.txtName=alib.dom.createElement("input",
d);alib.dom.styleSet(c.txtName,"width","98%");d=alib.dom.createElement("h4",b);alib.dom.styleSet(d,"margin","5px 0 5px 0");d.innerHTML="Description";d=alib.dom.createElement("div",b);alib.dom.styleSet(d,"margin","5px 0 5px 0");c.txtDescription=alib.dom.createElement("textarea",d);alib.dom.styleSet(c.txtDescription,"width","98%");var e="";this.view.id?(c.txtName.value=this.view.name,c.txtDescription.value=this.view.description,a?c.txtName.value+=" (copy)":e=this.view.id):(c.txtName.value="My Custom View",
c.txtDescription.value="Describe this view here");d=alib.dom.createElement("h4",b);alib.dom.styleSet(d,"margin","5px 0 5px 0");d.innerHTML="Scope - View will be available to:";d=alib.dom.createElement("div",b);alib.dom.styleSet(d,"margin","5px 0 5px 0");c.selectScope=alib.dom.createElement("select",d);alib.dom.styleSet(c.selectScope,"margin-right","10px");c.selectTeam=alib.dom.createElement("select",d);alib.dom.styleSet(c.selectTeam,"display","none");a=alib.dom.createElement("div",d);alib.dom.styleSet(a,
"display","none");this.showUsers(a);c.selectScope.selectTeam=c.selectTeam;c.selectScope.userCon=a;c.selectScope.onchange=function(){alib.dom.styleSet(this.selectTeam,"display","none");alib.dom.styleSet(this.userCon,"display","none");this.value==SCOPE_TEAM?alib.dom.styleSet(this.selectTeam,"display","inline-block"):this.value==SCOPE_USER&&alib.dom.styleSet(this.userCon,"display","inline-block")};a=new CAntObject("user");a.teamId=this.view.teamid;a.teamDropdown=c.selectTeam;a.onteamsloaded=function(a){delete a.teamCount;
this.populateTeam(a,a[0].parentId);this.addSpacedPrefix(a)};a.loadTeam();a=null;switch(this.view.scope){case "User":a=SCOPE_USER;break;case "Team":a=SCOPE_TEAM;break;case "Everyone":a=SCOPE_EVERYONE;break;default:a=SCOPE_ME}buildDropdown(c.selectScope,[[SCOPE_ME,"Me"],[SCOPE_EVERYONE,"Everyone"],[SCOPE_TEAM,"Team"],[SCOPE_USER,"User"]],a);c.selectScope.onchange();d=alib.dom.createElement("h4",b,"Default");alib.dom.styleSet(d,"margin","5px 0 5px 0");d=alib.dom.createElement("div",b);alib.dom.styleSet(d,
"margin","5px 0 5px 0");a=[["type","radio"],["name","defaultChk"],["value","1"]];c.defRadioYes=alib.dom.setElementAttr(alib.dom.createElement("input",d),a);alib.dom.setElementAttr(alib.dom.createElement("span",d),[["innerHTML","Yes"],["margin-right","10px"]]);a=[["type","radio"],["name","defaultChk"],["value","0"]];c.defRadioNo=alib.dom.setElementAttr(alib.dom.createElement("input",d),a);alib.dom.setElementAttr(alib.dom.createElement("span",d),[["innerHTML","No"]]);this.view.fDefault?c.defRadioYes.checked=
!0:c.defRadioNo.checked=!0;d=alib.dom.createElement("span",d,"&nbsp;&nbsp;&nbsp;-Should this view be used as the default for the scope selected?");b=alib.dom.createElement("div",b);c.save_view_id=e;c=alib.ui.Button("Save",{className:"b2",tooltip:"Click to save changes",cls:this,inputData:c,onclick:function(){this.cls.saveView(this.inputData)}});c.print(b);c=alib.ui.Button("Cancel",{className:"b1",tooltip:"Close without saving any changes",cls:this,onclick:function(){this.cls.showViewForm()}});c.print(b)};
AntObjectViewEditor.prototype.saveView=function(a,b,c,d){var e=new CDialog(null,this.m_advancedSearchDlg);e.parentDlg=!0;var f=document.createElement("div");alib.dom.styleSetClass(f,"statusAlert");alib.dom.styleSet(f,"text-align","center");f.innerHTML="Saving, please wait...";e.statusDialog(f,150,100);var g=null;this.searchView||(this.searchView={});this.searchView.conditions=[];this.searchView.sort_order=[];this.searchView.view_fields=[];var b=a.txtName.value,c=a.txtDescription.value,d=a.save_view_id,
h=a.selectTeam.value,k=!1,l=a.selectScope.options[a.selectScope.selectedIndex].text;a.defRadioYes.checked&&(k=!0);(g=d&&!this.viewId?this.mainObject.getViewById(d):new AntObjectBrowserView(this.mainObject.name))?(this.setViewFromBuf(g),this.viewId&&(g.id=this.viewId),g.name=b,g.filterKey=this.viewsFilterKey,g.description=c,g.f_default=k,g.scope=l,a.selectScope.value==SCOPE_TEAM&&(g.team_id=h),a.selectScope.value==SCOPE_USER&&(g.user_id=this.user_id),g.cls=this,g.save_view_id=d?d:null,g.dlg=e,g.onsave=
function(a){e.hide();this.save_view_id||(this.cls.mainObject.views[this.cls.mainObject.views.length]=this);ALib.statusShowAlert("View Saved!",3E3,"bottom","right");this.cls.viewId=a;this.cls.onSave();"function"==typeof this.cls.buildViewsDropdown&&(this.cls.buildViewsDropdown(),this.cls.showAdvancedSearch(),this.cls.runSearch(this));Ant.EntityDefinitionLoader.get(this.cls.mainObject.name).load();this.cls.view.fDefault=k;this.cls.view.userName=this.cls.username;this.cls.view.userid=this.cls.user_id;
this.cls.view.fSystem=!1;this.cls.createButtons();this.cls.view.name=b;this.cls.showViewForm()},g.onsaveError=function(){e.hide();ALib.statusShowAlert("ERROR: Unable to connect to server!",3E3,"bottom","right");this.cls.showViewForm()},g.save()):(f.innerHTML="ERROR: Unable save current view because another user has made some changes. Please click 'Refresh Views' button to view changes!",window.setTimeout(function(){e.hide();ALib.statusShowAlert("ERROR: Unable save current view because another user has made some changes. Please click 'Refresh Views' button to view changes!",
3E3,"bottom","right")},3E3))};
AntObjectViewEditor.prototype.showUsers=function(a){var b=alib.dom.setElementAttr(alib.dom.createElement("span",a),[["innerHTML","None Selected"]]);alib.dom.styleSet(b,"margin-right","10px");this.view.userName&&0<this.view.userName.length&&"User"==this.view.scope&&(b.innerHTML=this.view.userName,this.user_id=this.view.userid,this.username=this.view.userName);var c=new CUserBrowser;c.cls=this;c.userLabel=b;c.onSelect=function(a,b){this.cls.user_id=a;this.cls.username=b;this.userLabel.innerHTML=" "+
b};alib.ui.Button("Select",{className:"b1",tooltip:"Select User for this view",cbUser:c,onclick:function(){this.cbUser.showDialog()}}).print(a)};
function AntCalendarBrowse(a,b){this.toolbarCon=this.outerCon=this.eventView=this.antView=null;this.currentDate=new Date;this.dateLabel=this.monthViewTbody=this.lastDate=null;this.m_appclass=a?a:null;this.m_cid=b?b:null;this.browserHeight=0;this.settings={};this.min_scale=alib.userAgent.ie?1:0.75;this.eventsRangeFrom=calDateAddSubtract(this.currentDate,"day",-31);this.eventsRangeTo=calDateAddSubtract(this.currentDate,"day",31);this.events=[];this.calendars=[];this.refreshInterval=null}
AntCalendarBrowse.prototype.print=function(a){this.outerCon=a;this.outerCon.innerHTML=" Loading...";this.loadSettings()};
AntCalendarBrowse.prototype.loadSettings=function(){this.settings.defaultView="day";ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a){this.cbData.cls.settings.defaultView=a.defaultView;for(var b=0;b<a.calendars.length;b++)this.cbData.cls.calendars[b]=a.calendars[b]}this.cbData.cls.buildInterface();this.cbData.cls.refresh()};ajax.exec("/controller/Calendar/getuserSettings",[["calendar_id",this.m_cid]])};
AntCalendarBrowse.prototype.saveSettings=function(a,b){switch(a){case "default_view":this.settings.defaultView=b;var c=this.m_cid?"calendar/"+this.m_cid+"/default_view":"calendar/default_view";ajax=new CAjax("json");ajax.exec("/controller/Calendar/userSetSetting",[["setting_name",c],["setting_value",b]])}};
AntCalendarBrowse.prototype.buildInterface=function(){this.outerCon.innerHTML="";this.mainCon=alib.dom.createElement("div",this.outerCon);alib.dom.styleSetClass(this.mainObject,"calendarBrowseCon");this.titleCon=alib.dom.createElement("div",this.mainCon);this.toolbarCon=alib.dom.createElement("div",this.mainCon);alib.dom.styleSetClass(this.mainObject,"calendarBrowseToolbar");this.bodyCon=alib.dom.createElement("div",this.mainCon);this.bodyCon.className="objectLoaderBody";this.curTb=new CToolbar;this.viewToggler=
alib.ui.ButtonToggler();var a=alib.ui.Button("Month",{className:"b1 grRight",tooltip:"View calendar in month view",cls:this,onclick:function(){this.cls.renderCal(null,"month")}});this.curTb.AddItem(a.getButton(),"right");this.viewToggler.add(a,"month");a=alib.ui.Button("Week",{className:"b1 grCenter",tooltip:"View calendar in week view",cls:this,onclick:function(){this.cls.renderCal(null,"week")}});this.curTb.AddItem(a.getButton(),"right");this.viewToggler.add(a,"week");a=alib.ui.Button("Day",{className:"b1 grLeft",
tooltip:"View calendar in day view",cls:this,onclick:function(){this.cls.renderCal(null,"day")}});this.curTb.AddItem(a.getButton(),"right");this.viewToggler.add(a,"day");a=alib.ui.Button("Today",{className:"b1",tooltip:"Jump to today",cls:this,onclick:function(){this.cls.gotoToday()}});this.curTb.AddItem(a.getButton());a=alib.ui.Button("<img src='/images/icons/arrow_left_16.png' />",{className:"b1 grLeft",tooltip:"Previous",cls:this,onclick:function(){this.cls.gotoPrev()}});this.curTb.AddItem(a.getButton());
a=alib.ui.Button("<img src='/images/icons/arrow_right_16.png' />",{className:"b1 grRight",tooltip:"Next",cls:this,onclick:function(){this.cls.gotoNext()}});this.curTb.AddItem(a.getButton());a=alib.ui.Button("<img src='/images/icons/refresh_12.png' />",{className:"b1",tooltip:"Refresh Events",cls:this,onclick:function(){this.cls.refresh()}});this.curTb.AddItem(a.getButton());this.dateLabel=alib.dom.createElement("div");alib.dom.styleSetClass(this.dateLabel,"strong");alib.dom.styleSet(this.dateLabel,
"margin","8px 0 0 5px");this.curTb.AddItem(this.dateLabel);this.curTb.print(this.toolbarCon);this.activeView=this.settings.defaultView;this.gotoToday()};AntCalendarBrowse.prototype.gotoToday=function(){return this.renderCal(new Date)};
AntCalendarBrowse.prototype.gotoNext=function(){var a=new Date(this.currentDate);switch(this.activeView){case "day":a.setDate(this.currentDate.getDate()+1);break;case "week":a.setDate(this.currentDate.getDate()+7);break;case "month":a.setMonth(this.currentDate.getMonth()+1)}this.renderCal(a)};
AntCalendarBrowse.prototype.gotoPrev=function(){var a=new Date(this.currentDate);switch(this.activeView){case "day":a.setDate(this.currentDate.getDate()-1);break;case "week":a.setDate(this.currentDate.getDate()-7);break;case "month":a.setMonth(this.currentDate.getMonth()-1)}this.renderCal(a)};
AntCalendarBrowse.prototype.renderCal=function(a,b){var c=b||this.activeView,d=a||new Date;this.currentDate=d;switch(c){case "day":this.renderDay(d.getFullYear(),d.getMonth()+1,d.getDate());break;case "week":this.renderWeek(d.getFullYear(),d.getMonth()+1,d.getDate());break;case "month":this.renderMonth(d.getFullYear(),d.getMonth()+1)}this.getEvents()};
AntCalendarBrowse.prototype.renderDay=function(a,b,c){this.bodyCon.innerHTML="";this.viewToggler.select("day");alib.dom.createElement("div",this.bodyCon);var d=alib.dom.createElement("div",this.bodyCon);this.saveSettings("default_view","day");this.activeView="day";calGetMonthNumDays(a,b);try{this.m_appclass&&this.m_appclass.calNav&&this.m_appclass.calNav(a,b,c,"day")}catch(e){}this.dateLabel.innerHTML=calGetMonthName(b)+" "+c+", "+a;var f=this.min_scale;this.header_dv=this.m_events_allday=alib.dom.createElement("div",
d);alib.dom.styleSet(this.m_events_allday,"margin-left","69px");alib.dom.styleSet(this.m_events_allday,"margin-right",alib.dom.getScrollBarWidth()+"px");alib.dom.styleSetClass(this.m_events_allday,"CalendarDayAllDay");var g=this.scrollTimedEvents=alib.dom.createElement("div",d);alib.dom.styleSet(g,"position","relative");alib.dom.styleSet(g,"overflow","auto");d=alib.dom.createElement("div",g);alib.dom.styleSet(d,"float","left");alib.dom.styleSet(d,"width","70px");this.m_events_day=alib.dom.createElement("div",
g);alib.dom.styleSet(this.m_events_day,"position","relative");alib.dom.styleSet(this.m_events_day,"margin-left","71px");var h=new Date(a,b-1,1);h.od=h.getDay()+1;var k=new Date;a==k.getFullYear()&&b==k.getMonth()+1&&c==k.getDate()&&(h=k.getHours(),k=k.getMinutes(),h=(60*h+k)*f,k=alib.dom.createElement("div",g),alib.dom.styleSet(k,"position","absolute"),alib.dom.styleSet(k,"top",h-6+"px"),alib.dom.styleSet(k,"left","65px"),k.innerHTML="<img src='/images/icons/tilde_alert.png' border='0'>",k=alib.dom.createElement("div",
g),alib.dom.styleSet(k,"height","1px"),alib.dom.styleSet(k,"width",g.scrollWidth-90+"px"),alib.dom.styleSet(k,"background-color","red"),alib.dom.styleSet(k,"position","absolute"),alib.dom.styleSet(k,"top",h+"px"),alib.dom.styleSet(k,"left","70px"));for(g=0;24>g;g++){h=12>g?(0==g?12:g)+" AM":(12==g?g:g-12)+" PM";k=alib.dom.createElement("div",d);alib.dom.styleSet(k,"height",60*f-1+"px");alib.dom.styleSet(k,"font-weight","bold");alib.dom.styleSet(k,"border-top","1px solid #999999");alib.dom.styleSet(k,
"border-right","1px solid #999999");k.innerHTML=h;var l=12>g?(0==g?12:g)+":00 AM":(12==g?g:g-12)+":00 PM",h=12>g?(0==g?12:g)+":30 AM":(12==g?g:g-12)+":30 PM",k=12>g+1?(0==g+1?12:g+1)+":00 AM":(12==g+1?g+1:g+1-12)+":00 PM",m=alib.dom.createElement("div",this.m_events_day);m.times=[l,h];m.date_str=b+"/"+c+"/"+a;m.calid=this.m_cid;m.cls=this;l=alib.userAgent.webkit?30*f:30*f-1;alib.dom.styleSet(m,"height",l+"px");alib.dom.styleSet(m,"border-top","1px solid #999999");m.onmouseover=function(){this.style.backgroundColor=
"#f1f1f1"};m.onmouseout=function(){this.style.backgroundColor=""};m.ondblclick=function(){this.cls.loadEvent(null,[["ts_start",this.date_str+" "+this.times[0]],["ts_end",this.date_str+" "+this.times[1]],["calid",this.calid]])};DragAndDrop.registerDropzone(m,"dzDay");m.m_cls=this;m.date_cur=new Date(a,b-1,c,g,0);m.onDragDrop=function(a){var b=this.m_cls.getEventFromArray(a.eid),c=new Date(b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start),d=new Date(b.date_end.getMonth()+
1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end),c=d.getTime()-c.getTime();b.time_start=calGetClockTime(this.date_cur);b.date_start=new Date(this.date_cur.getMonth()+1+"/"+this.date_cur.getDate()+"/"+this.date_cur.getFullYear());b.start_block=60*this.date_cur.getHours()+this.date_cur.getMinutes();d.setTime(this.date_cur.getTime()+c);b.time_end=calGetClockTime(d);b.date_end=new Date(d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear());b.end_block=60*d.getHours()+d.getMinutes();
this.m_cls.redrawEvents();b=[["ts_start",b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start],["ts_end",b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end]];this.m_cls.updateEvent(a.eid,b)};var n=alib.dom.createElement("div",this.m_events_day);n.times=[h,k];n.date_str=b+"/"+c+"/"+a;n.calid=this.m_cid;n.cls=this;l=alib.userAgent.webkit?l-2:l;alib.dom.styleSet(n,"height",l+"px");alib.dom.styleSet(n,"border-top",
"1px solid #cccccc");n.onmouseover=function(){this.style.backgroundColor="#f1f1f1"};n.onmouseout=function(){this.style.backgroundColor=""};n.ondblclick=function(){this.cls.loadEvent(null,[["ts_start",this.date_str+" "+this.times[0]],["ts_end",this.date_str+" "+this.times[1]],["calid",this.calid]])};DragAndDrop.registerDropzone(m,"dzDay");m.m_cls=this;m.date_cur=new Date(a,b-1,c,g,30);m.onDragDrop=function(a){var b=this.m_cls.getEventFromArray(a.eid),c=new Date(b.date_start.getMonth()+1+"/"+b.date_start.getDate()+
"/"+b.date_start.getFullYear()+" "+b.time_start),d=new Date(b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end),c=d.getTime()-c.getTime();b.time_start=calGetClockTime(this.date_cur);b.date_start=new Date(this.date_cur.getMonth()+1+"/"+this.date_cur.getDate()+"/"+this.date_cur.getFullYear());b.start_block=60*this.date_cur.getHours()+this.date_cur.getMinutes();d.setTime(this.date_cur.getTime()+c);b.time_end=calGetClockTime(d);b.date_end=new Date(d.getMonth()+
1+"/"+d.getDate()+"/"+d.getFullYear());b.end_block=60*d.getHours()+d.getMinutes();this.m_cls.redrawEvents();b=[["ts_start",b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start],["ts_end",b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end]];this.m_cls.updateEvent(a.eid,b)}}this.resize();this.populateDayEvents(a,b,c)};
AntCalendarBrowse.prototype.renderWeek=function(a,b,c){this.bodyCon.innerHTML="";this.viewToggler.select("week");alib.dom.createElement("div",this.bodyCon);var d=alib.dom.createElement("div",this.bodyCon);this.saveSettings("default_view","week");this.activeView="week";calGetMonthNumDays(a,b);var e=new Date,f=calGetWeekStartDate(a,b,c),g=calDateAddSubtract(f,"day",6);try{this.m_appclass&&this.m_appclass.calNav&&this.m_appclass.calNav(a,b,c,"week")}catch(h){}this.dateLabel.innerHTML=calGetMonthName(f.getMonth()+
1)+" "+f.getDate()+", "+f.getFullYear()+" - "+calGetMonthName(g.getMonth()+1)+" "+g.getDate()+", "+g.getFullYear();g=this.min_scale;alib.dom.createElement("div",d);this.m_weekdaycolsad=[];var k="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");this.header_dv=alib.dom.createElement("div",d);alib.dom.styleSet(this.header_dv,"padding-top","3px");alib.dom.styleSet(this.header_dv,"margin-left","70px");alib.dom.styleSet(this.header_dv,"margin-right",alib.dom.getScrollBarWidth()+"px");
var l=new Date,l=f,m=alib.dom.createElement("table",this.header_dv);alib.dom.styleSet(m,"table-layout","fixed");m.cellSpacing=0;m.cellPadding=0;alib.dom.styleSet(m,"width","100%");alib.dom.styleSet(m,"border-bottom","1px solid");var n=alib.dom.createElement("tbody",m),m=alib.dom.createElement("tr",n),n=alib.dom.createElement("tr",n);n.vAlign="top";for(s=0;7>s;s++){var o=alib.dom.createElement("td",m);alib.dom.styleSet(o,"width","14%");var p=e.getFullYear()==l.getFullYear()&&e.getMonth()==l.getMonth()&&
e.getDate()==l.getDate()?1:0;alib.dom.styleSetClass(o,p?"CalendarWeekColHdrToday":"CalendarWeekColHdr");o.innerHTML="<div style='float:right;'>"+l.getDate()+"</div>"+k[s];p=alib.dom.createElement("td",n);this.m_weekdaycolsad[s]=p;alib.dom.styleSetClass(p,"CalendarWeekColAllDay");alib.dom.styleSet(p,"width","14%");p.date_cur=l;p.m_cls=this;DragAndDrop.registerDropzone(p,"dzAllDay");p.onDragDrop=function(a){var b=this.m_cls.getEventFromArray(a.eid),c=calDaysBetweenDates(b.date_start,b.date_end);0<c?
(b.date_start=this.date_cur,b.date_end=calDateAddSubtract(this.date_cur,"day",c)):(b.date_start=this.date_cur,b.date_end=this.date_cur);this.m_cls.redrawEvents();b=[["ts_start",b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start],["ts_end",b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end]];this.m_cls.updateEvent(a.eid,b)};l=calDateAddSubtract(l,"day",1)}l=this.m_events_week=alib.dom.createElement("div",d);
alib.dom.styleSet(l,"height","200px");alib.dom.styleSet(l,"position","relative");alib.dom.styleSet(l,"overflow","auto");d=new Date(a,b-1,1);d.od=d.getDay()+1;if(p=a==e.getFullYear()&&b==e.getMonth()+1&&c==e.getDate()?1:0){a=e.getHours();e=e.getMinutes();e=(60*a+e)*g;a=alib.dom.createElement("div",l);alib.dom.styleSet(a,"position","absolute");alib.dom.styleSet(a,"top",e-6+"px");alib.dom.styleSet(a,"left","65px");a.innerHTML="<img src='/images/icons/tilde_alert.png' border='0'>";try{var q=alib.dom.createElement("div",
l);alib.dom.styleSet(q,"height","1px");alib.dom.styleSet(q,"width",l.scrollWidth-90+"px");alib.dom.styleSet(q,"background-color","red");alib.dom.styleSet(q,"position","absolute");alib.dom.styleSet(q,"top",e+"px");alib.dom.styleSet(q,"left","70px")}catch(r){}}e=alib.dom.createElement("div",l);alib.dom.styleSet(e,"float","left");alib.dom.styleSet(e,"width","70px");for(q=0;24>q;q++)a=12>q?(0==q?12:q)+" AM":(12==q?q:q-12)+" PM",b=alib.dom.createElement("div",e),alib.dom.styleSet(b,"height",60*g-1+"px"),
alib.dom.styleSet(b,"font-weight","bold"),alib.dom.styleSet(b,"border-top","1px solid #999999"),b.innerHTML=a;l=alib.dom.createElement("div",l);alib.dom.styleSet(l,"margin-left","70px");m=alib.dom.createElement("table",l);alib.dom.styleSet(m,"table-layout","fixed");alib.dom.styleSet(m,"width","100%");m.cellPadding="0";m.cellSpacing="0";n=alib.dom.createElement("tbody",m);e=alib.dom.createElement("tr",n);this.m_weekdaycols=[];l=new Date;l=f;for(a=0;7>a;a++){b=alib.dom.createElement("td",e);alib.dom.styleSetClass(b,
"CalendarWeekCol");alib.dom.styleSet(b,"width","14%");this.m_weekdaycols[a]=alib.dom.createElement("div",b);alib.dom.styleSet(this.m_weekdaycols[a],"width","100%");alib.dom.styleSet(this.m_weekdaycols[a],"position","relative");for(q=0;24>q;q++)m=12>q?(0==q?12:q)+":00 AM":(12==q?q:q-12)+":00 PM",c=12>q?(0==q?12:q)+":30 AM":(12==q?q:q-12)+":30 PM",d=12>q+1?(0==q+1?12:q+1)+":00 AM":(12==q+1?q+1:q+1-12)+":00 PM",n=alib.dom.createElement("div",b),k=alib.userAgent.webkit?30*g:30*g-1,alib.dom.styleSet(n,
"height",k+"px"),alib.dom.styleSet(n,"border-top","1px solid #999999"),n.times=[m,c],n.date_str=l.getMonth()+1+"/"+l.getDate()+"/"+l.getFullYear(),n.calid=this.m_cid,n.cls=this,n.onmouseover=function(){this.style.backgroundColor="#f1f1f1"},n.onmouseout=function(){this.style.backgroundColor=""},n.ondblclick=function(){this.cls.loadEvent(null,[["ts_start",this.date_str+" "+this.times[0]],["ts_end",this.date_str+" "+this.times[1]],["calid",this.calid]])},DragAndDrop.registerDropzone(n,"dzDay"),n.m_cls=
this,n.date_cur=new Date(l.getFullYear(),l.getMonth(),l.getDate(),q,0),n.onDragDrop=function(a){var b=this.m_cls.getEventFromArray(a.eid),c=new Date(b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start),d=new Date(b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end),c=d.getTime()-c.getTime();b.time_start=calGetClockTime(this.date_cur);b.date_start=new Date(this.date_cur.getMonth()+1+"/"+this.date_cur.getDate()+
"/"+this.date_cur.getFullYear());b.start_block=60*this.date_cur.getHours()+this.date_cur.getMinutes();d.setTime(this.date_cur.getTime()+c);b.time_end=calGetClockTime(d);b.date_end=new Date(d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear());b.end_block=60*d.getHours()+d.getMinutes();this.m_cls.redrawEvents();b=[["ts_start",b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start],["ts_end",b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+
" "+b.time_end]];this.m_cls.updateEvent(a.eid,b)},m=alib.dom.createElement("div",b),k=alib.userAgent.webkit?k-2:k,alib.dom.styleSet(m,"height",k+"px"),alib.dom.styleSet(m,"border-top","1px solid #cccccc"),m.times=[c,d],m.date_str=l.getMonth()+1+"/"+l.getDate()+"/"+l.getFullYear(),m.calid=this.m_cid,m.cls=this,m.onmouseover=function(){this.style.backgroundColor="#f1f1f1"},m.onmouseout=function(){this.style.backgroundColor=""},m.ondblclick=function(){this.cls.loadEvent(null,[["ts_start",this.date_str+
" "+this.times[0]],["ts_end",this.date_str+" "+this.times[1]],["calid",this.calid]])},DragAndDrop.registerDropzone(m,"dzDay"),m.m_cls=this,m.date_cur=new Date(l.getFullYear(),l.getMonth(),l.getDate(),q,30),m.onDragDrop=function(a){var b=this.m_cls.getEventFromArray(a.eid),c=new Date(b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start),d=new Date(b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end),c=d.getTime()-
c.getTime();b.time_start=calGetClockTime(this.date_cur);b.date_start=new Date(this.date_cur.getMonth()+1+"/"+this.date_cur.getDate()+"/"+this.date_cur.getFullYear());b.start_block=60*this.date_cur.getHours()+this.date_cur.getMinutes();d.setTime(this.date_cur.getTime()+c);b.time_end=calGetClockTime(d);b.date_end=new Date(d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear());b.end_block=60*d.getHours()+d.getMinutes();this.m_cls.redrawEvents();b=[["ts_start",b.date_start.getMonth()+1+"/"+b.date_start.getDate()+
"/"+b.date_start.getFullYear()+" "+b.time_start],["ts_end",b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end]];this.m_cls.updateEvent(a.eid,b)};l=calDateAddSubtract(l,"day",1)}this.resize();this.populateWeekEvents(f.getFullYear(),f.getMonth()+1,f.getDate())};
AntCalendarBrowse.prototype.renderMonth=function(a,b){this.bodyCon.innerHTML="";this.saveSettings("default_view","month");this.viewToggler.select("month");this.activeView="month";var c=calGetMonthNumDays(a,b);this.m_monthdaycells=[];try{this.m_appclass&&this.m_appclass.calNav&&this.m_appclass.calNav(a,b,1,"month")}catch(d){}this.dateLabel.innerHTML=calGetMonthName(this.currentDate.getMonth()+1)+" "+this.currentDate.getFullYear();var e=alib.dom.createElement("div",this.bodyCon);alib.dom.styleSet(e,
"margin-top","3px");var f="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),g=new Date(a,b-1,1);g.od=g.getDay()+1;var h=new Date,h=a==h.getFullYear()&&b==h.getMonth()+1?h.getDate():0,e=alib.dom.createElement("table",e);e.id="CalendarMonthMainTable";alib.dom.styleSet(e,"table-layout","fixed");e.cellPadding=0;e.cellSpacing=0;alib.dom.styleSet(e,"width","100%");alib.dom.styleSetClass(e,"CalendarMonthMainTable");this.monthViewTbody=e=alib.dom.createElement("tbody",e);var k=alib.dom.createElement("tr",
e);for(s=0;7>s;s++){var l=alib.dom.createElement("td",k);alib.dom.styleSetClass(l,"CalendarMonthWeekdayHdr");l.innerHTML=f[s]}f=alib.dom.createElement("tr",e);f.vAlign="top";k=0;for(i=this.m_monthnumrows=1;42>=i;i++){var m=0<=i-g.od&&i-g.od<c?i-g.od+1:"&nbsp;",l=alib.dom.createElement("td",f);alib.dom.styleSetClass(l,"CalendarMonthCell");alib.dom.styleSet(l,"width","14%");alib.dom.styleSet(l,"overflow","auto");var n=alib.dom.createElement("div",l);alib.dom.styleSet(n,"overflow","hidden");if("&nbsp;"!=
m){var o=alib.dom.createElement("a");o.innerHTML="+ add";o.href="javascript:void(0);";alib.dom.styleSet(o,"text-decoration","none");o.mvars=[["ts_start",b+"/"+m+"/"+a],["ts_end",b+"/"+m+"/"+a],["all_day","t"],["calendar",this.m_cid]];o.cls=this;o.onclick=function(){this.cls.loadEvent(null,this.mvars)};this.m_monthdaycells[k]=l;k++;DragAndDrop.registerDropzone(l,"dzDays");l.m_cls=this;l.date_cur=new Date(a,b-1,m);l.onDragEnter=function(){};l.onDragExit=function(){};l.onDragDrop=function(a){var b=this.m_cls.getEventFromArray(a.eid),
c=calDaysBetweenDates(b.date_start,b.date_end);0<c?(b.date_start=this.date_cur,b.date_end=calDateAddSubtract(this.date_cur,"day",c)):(b.date_start=this.date_cur,b.date_end=this.date_cur);this.m_cls.redrawEvents();b=[["ts_start",b.date_start.getMonth()+1+"/"+b.date_start.getDate()+"/"+b.date_start.getFullYear()+" "+b.time_start],["ts_end",b.date_end.getMonth()+1+"/"+b.date_end.getDate()+"/"+b.date_end.getFullYear()+" "+b.time_end]];this.m_cls.updateEvent(a.eid,b)}}else o=null;l=alib.dom.createElement("div",
n);m==h?alib.dom.styleSetClass(l,"CalendarMonthHdrToday"):alib.dom.styleSetClass(l,"CalendarMonthHdr");o&&(n=alib.dom.createElement("div"),alib.dom.styleSet(n,"float","right"),l.appendChild(n),n.appendChild(o));l=alib.dom.createElement("span",l);"&nbsp;"!=m?(l=alib.dom.createElement("a",l),l.innerHTML=m,l.m_cls=this,l.year=a,l.month=b,l.day=m,l.href="javascript:void(0)",l.onclick=function(){this.m_cls.renderDay(this.year,this.month,this.day)}):l.innerHTML=m;if(0==i%7&&k<c)f=alib.dom.createElement("tr",
e),f.vAlign="top",this.m_monthnumrows++;else if(0==i%7&&k>=c)break}this.resize();this.populateMonthEvents(a,b)};AntCalendarBrowse.prototype.resize=function(){if(!this.inline){var a=alib.userAgent.ie?30:0,a=getWorkspaceHeight()-a;this.titleCon&&(a-=this.titleCon.offsetHeight);this.toolbarCon&&(a-=this.toolbarCon.offsetHeight);0<a&&alib.dom.styleSet(this.bodyCon,"height",a-10+"px")}switch(this.activeView){case "day":return this.resizeDay();case "week":return this.resizeWeek();case "month":return this.resizeMonth()}};
AntCalendarBrowse.prototype.resizeMonth=function(){if(this.monthViewTbody)for(var a=alib.dom.getContentHeight(this.bodyCon)-5-this.monthViewTbody.childNodes[0].offsetHeight,b=this.monthViewTbody.childNodes.length-1,c=1;c<this.monthViewTbody.childNodes.length;c++)for(var d in this.monthViewTbody.childNodes[c].childNodes)try{this.monthViewTbody.childNodes[c].childNodes[d]&&alib.dom.styleSet(this.monthViewTbody.childNodes[c].childNodes[d],"height",a/b+"px")}catch(e){}};
AntCalendarBrowse.prototype.resizeWeek=function(){var a=alib.dom.getContentHeight(this.bodyCon)-this.header_dv.offsetHeight;alib.dom.styleSet(this.m_events_week,"height",a+"px");this.m_events_week.scrollTop=this.m_events_week.scrollHeight/2-this.m_events_week.offsetHeight/2};
AntCalendarBrowse.prototype.resizeDay=function(){var a=alib.dom.getContentHeight(this.bodyCon)-this.header_dv.offsetHeight-20;alib.dom.styleSet(this.scrollTimedEvents,"height",a+"px");this.scrollTimedEvents.scrollTop=this.scrollTimedEvents.scrollHeight/2-this.scrollTimedEvents.offsetHeight/2};
AntCalendarBrowse.prototype.populateDayEvents=function(a,b,c,d){a=new Date(a,b-1,c);"undefined"!=typeof d?(b=this.m_weekdaycols[d],c=this.m_weekdaycolsad[d]):(b=this.m_events_day,c=this.m_events_allday);for(var e=0;e<this.events.length;e++){var f=this.events[e],g=!1,h=f.start_block,k=f.end_block;f.date_start.getTime()==f.date_end.getTime()&&f.date_start.getTime()==a.getTime()?g=!0:f.date_start.getTime()<=a.getTime()&&f.date_end.getTime()>=a.getTime()&&(g=!0,f.date_start.getTime()!=a.getTime()&&(h=
0),f.date_end.getTime()!=a.getTime()&&(k=1440));if(g)if(f.allDay)g=alib.dom.createElement("div",c),alib.dom.styleSet(g,"background-color","#"+f.color),alib.dom.styleSet(g,"color","#"+getColorTextForGroup(f.color)),alib.dom.styleSet(g,"padding","3px"),alib.dom.styleSet(g,"margin","2px"),alib.dom.styleSet(g,"overflow","hidden"),alib.dom.styleSet(g,"white-space","nowrap"),alib.dom.styleSet(g,"text-overflow","ellipsis"),alib.dom.styleSet(g,"cursor","pointer"),g.innerHTML=f.name,g.eid=f.eid,g.calid=this.m_cid,
g.cls=this,g.onclick=function(){this.cls.loadEvent(this.eid,[["calid",this.calid]])},DragAndDrop.registerDragable(g,null,"dzAllDay");else{k=this.min_scale*(k-h-1);k<10*this.min_scale?k=14:12>k&&(k=12);var l="<div style='overflow:hidden;height:100%;margin-left:3px;'><div style='font-weight:bold;margin-bottom:5px;'>"+f.name+"</div>";f.loc&&(l+="<div>"+f.loc+"</div>");f.time_start&&(l+="<div>"+f.time_start+" - "+f.time_end+"</div>");f.notes&&(l+="<div>"+f.notes+"</div>");var l=l+"</div>",m=this.getEventWidth(f),
g=alib.dom.createElement("div",b);this.events[e].m_div=g;alib.dom.styleSet(g,"position","absolute");alib.dom.styleSet(g,"top",this.min_scale*h+"px");alib.dom.styleSet(g,"left","0px");alib.dom.styleSet(g,"height",k+"px");alib.dom.styleSet(g,"width",m[0]+"%");m[1]&&alib.dom.styleSet(g,"margin-left",m[1]+"%");alib.dom.styleSet(g,"background-color","#"+f.color);alib.dom.styleSet(g,"color","#"+getColorTextForGroup(f.color));alib.dom.styleSet(g,"cursor","pointer");g.innerHTML=l;g.eid=f.eid;g.calid=this.m_cid;
g.cls=this;g.onclick=function(){this.cls.loadEvent(this.eid,[["calid",this.calid]])};DragAndDrop.registerDragable(g,null,"dzDay")}}"undefined"==typeof d&&this.resizeDay()};AntCalendarBrowse.prototype.populateWeekEvents=function(a,b,c){a=new Date(a,b-1,c);for(s=0;7>s;s++)this.populateDayEvents(a.getFullYear(),a.getMonth()+1,a.getDate(),s),a=calDateAddSubtract(a,"day",1);this.resizeWeek()};
AntCalendarBrowse.prototype.populateMonthEvents=function(a,b){var c=calGetMonthNumDays(a,b);for(s=0;s<c;s++)this.populateMonthDayEvents(a,b,s+1,this.m_monthdaycells[s].childNodes.item(0),3)};
AntCalendarBrowse.prototype.populateMonthDayEvents=function(a,b,c,d,e,f){for(var g=new Date(a,b-1,c),h=0,k=0,l=0;l<this.events.length;l++){var m=this.events[l],n=!1;m.date_start.getTime()==m.date_end.getTime()&&m.date_start.getTime()==g.getTime()?n=!0:m.date_start.getTime()<=g.getTime()&&m.date_end.getTime()>=g.getTime()&&(n=!0);n&&(h<e?(h++,n=alib.dom.createElement("div",d),m.m_div=n,alib.dom.styleSet(n,"padding","2px"),alib.dom.styleSet(n,"overflow","hidden"),alib.dom.styleSet(n,"text-overflow",
"ellipsis"),alib.dom.styleSet(n,"white-space","nowrap"),alib.dom.styleSet(n,"cursor","pointer"),alib.dom.styleSet(n,"border-left","3px solid #"+m.color),n.innerHTML=(!m.allDay?m.time_start+" ":"")+m.name,n.eid=m.eid,n.calid=this.m_cid,n.cls=this,n.onclick=function(){f&&f.hide();this.cls.loadEvent(this.eid,[["calid",this.calid]])},DragAndDrop.registerDragable(n,null,"dzDays")):k++)}0<k&&(n=alib.dom.createElement("div",d),m.m_div=n,alib.dom.styleSet(n,"padding","2px"),alib.dom.styleSet(n,"overflow",
"hidden"),alib.dom.styleSet(n,"text-overflow","ellipsis"),alib.dom.styleSet(n,"white-space","nowrap"),alib.dom.styleSet(n,"cursor","pointer"),n.innerHTML="[Show all events]",n.cls=this,n.onclick=function(){var d=k+e,f=calGetMonthName(b)+" "+c+", "+a+" - "+d+" events",f=new CDialog(f),g=alib.dom.createElement("div");this.cls.populateMonthDayEvents(a,b,c,g,d,f);f.f_close=!0;f.customDialog(g,450)})};
AntCalendarBrowse.prototype.getEventWidth=function(a){for(var b=100,c=1,d=0,e=[],f=0;f<this.events.length;f++){var g=this.events[f];g.ts_start.getTime()<=a.ts_start.getTime()&&g.ts_end.getTime()>a.ts_start.getTime()&&g.eid!=a.eid&&(c+=1,e[e.length]=g)}for(f=0;f<e.length;f++)g=e[f],g.m_div&&(b=100/c,a=g.m_div,alib.dom.styleSet(a,"width",b+"%"),d&&alib.dom.styleSet(a,"margin-left",d+"%"),d+=b);return[b,d]};
AntCalendarBrowse.prototype.redrawEvents=function(){switch(this.activeView){case "day":this.renderDay(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,this.currentDate.getDate());break;case "week":this.renderWeek(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,this.currentDate.getDate());break;case "month":this.renderMonth(this.currentDate.getFullYear(),this.currentDate.getMonth()+1)}};
AntCalendarBrowse.prototype.updateDateRange=function(a,b){if(a.getTime()<this.eventsRangeFrom.getTime()||b.getTime()>this.eventsRangeTo.getTime()){var c=new Date(this.currentDate.getFullYear(),this.activeMonth-1,this.currentDate.getDate());this.eventsRangeFrom=calDateAddSubtract(c,"day",-31);this.eventsRangeTo=calDateAddSubtract(c,"day",31);this.refresh()}};
AntCalendarBrowse.prototype.refresh=function(){var a=this.eventsRangeFrom.getMonth()+1+"/"+this.eventsRangeFrom.getDate()+"/"+this.eventsRangeFrom.getFullYear(),b=this.eventsRangeTo.getMonth()+1+"/"+this.eventsRangeTo.getDate()+"/"+this.eventsRangeTo.getFullYear();this.getEvents(a,b)};AntCalendarBrowse.prototype.setAutoRefresh=function(a){a||(clearTimeout(this.refreshTimer),this.refreshTimer=null);if(!this.refreshTimer&&a){var b=this;this.refreshTimer=setTimeout(function(){b.refresh()},this.refreshInterval)}};
AntCalendarBrowse.prototype.getEvents=function(a,b){this.m_timer&&clearTimeout(this.m_timer);var c=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),-6),a=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),c=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,7),b=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear();ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){if(a){this.cbData.cls.events=[];if(a.objects.length)for(event in a.objects){var b=
a.objects[event],c=b.id,d=b.recur_id,e=b.name,f=b.calendar.key,o=b.location,p=b.notes,q=new Date(b.ts_start),r=new Date(b.ts_end),u=this.cbData.cls.events.length;this.cbData.cls.events[u]={};this.cbData.cls.events[u].date_start=new Date(q.getMonth()+1+"/"+q.getDate()+"/"+q.getFullYear());this.cbData.cls.events[u].date_end=new Date(r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear());this.cbData.cls.events[u].start_block=60*q.getHours()+q.getMinutes();this.cbData.cls.events[u].end_block=60*r.getHours()+
r.getMinutes();this.cbData.cls.events[u].time_start=calGetClockTime(q);this.cbData.cls.events[u].time_end=calGetClockTime(r);this.cbData.cls.events[u].allDay="t"==b.all_day?!0:!1;this.cbData.cls.events[u].name=unescape(e);this.cbData.cls.events[u].loc=unescape(o);this.cbData.cls.events[u].notes=unescape(p);this.cbData.cls.events[u].eid=c;this.cbData.cls.events[u].recud_id=d;this.cbData.cls.events[u].color=this.cbData.cls.getCalendarColor(f);this.cbData.cls.events[u].ts_start=q;this.cbData.cls.events[u].ts_end=
r}this.cbData.cls.redrawEvents()}};var c=[],d=1;c[c.length]=["conditions[]",d];c[c.length]=["condition_blogic_"+d,"and"];c[c.length]=["condition_fieldname_"+d,"ts_start"];c[c.length]=["condition_operator_"+d,"is_greater_or_equal"];c[c.length]=["condition_condvalue_"+d,a];d=2;c[c.length]=["conditions[]",d];c[c.length]=["condition_blogic_"+d,"and"];c[c.length]=["condition_fieldname_"+d,"ts_end"];c[c.length]=["condition_operator_"+d,"is_less_or_equal"];c[c.length]=["condition_condvalue_"+d,b];if(this.m_cid)d++,
c[c.length]=["conditions[]",d],c[c.length]=["condition_blogic_"+d,"and"],c[c.length]=["condition_fieldname_"+d,"calendar"],c[c.length]=["condition_operator_"+d,"is_equal"],c[c.length]=["condition_condvalue_"+d,this.m_cid];else if(this.calendars){var e="and";for(calendar in this.calendars){var f=this.calendars[calendar];d++;c[c.length]=["conditions[]",d];c[c.length]=["condition_blogic_"+d,e];c[c.length]=["condition_fieldname_"+d,"calendar"];c[c.length]=["condition_operator_"+d,"is_equal"];c[c.length]=
["condition_condvalue_"+d,f.id];"and"==e&&(e="or")}}c[c.length]=["obj_type","calendar_event"];c[c.length]=["limit","1000"];ajax.exec("/controller/Calendar/getEvents",c)};AntCalendarBrowse.prototype.getEventFromArray=function(a){for(var b=0;b<this.events.length;b++)if(this.events[b].eid==a)return this.events[b];return!1};
AntCalendarBrowse.prototype.updateEvent=function(a,b){this.settings.defaultView="day";b[b.length]=["eid",a];b[b.length]=["save_type","this_event"];b[b.length]=["only_defined","true"];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a&&ALib.statusShowAlert("Event Updated!",3E3,"bottom","right");var b=this.cls;setTimeout(function(){b.refresh()},1E3)};ajax.exec("/controller/Calendar/saveEvent",b)};
AntCalendarBrowse.prototype.getCalendarColor=function(a){var b="eeeeee";for(calendar in this.calendars){var c=this.calendars[calendar];c.id==a&&c.color&&(b=c.color)}return b};
AntCalendarBrowse.prototype.setAntView=function(a){this.antView=a;this.antView.setViewsSingle(!0);this.antView.options.cal=this;this.antView.onresize=function(){this.options.cal.resize()};this.antView.on("show",function(a){a.cls.setAutoRefresh(6E4)},{cls:this});this.antView.on("hide",function(a){a.cls.setAutoRefresh(null)},{cls:this});a=this.antView.addView("calendar_event:[id]",{});a.options.obj_type="calendar_event";a.options.bwserCls=this;a.options.loadLoaded=null;a.render=function(){};a.onshow=
function(){this.title=this.con.innerHTML="";var a=new AntObjectLoader(this.options.obj_type,this.variable);a.setAntView(this);if(this.options.params)for(var c=0;c<this.options.params.length;c++)a.setValue(this.options.params[c][0],this.options.params[c][1]);a.print(this.con);a.cbData.antView=this;a.cbData.bwserCls=this.options.bwserCls;a.onClose=function(){this.cbData.antView.options.lastLoaded=this.mainObject.id;this.cbData.bwserCls.refresh();this.cbData.antView.goup()};a.onRemove=function(){this.cbData.bwserCls.refresh()};
this.options.lastLoaded=this.variable};this.eventView=a};
AntCalendarBrowse.prototype.loadEvent=function(a,b){if(this.antView)this.eventView&&b&&(this.eventView.options.params=b?b:{}),null==a&&(a=""),this.antView.navigate("calendar_event:"+a);else if(this.outerCon){var c=alib.dom.getScrollPosTop();alib.dom.styleSet(this.mainCon,"display","none");var d=alib.dom.createElement("div",this.outerCon);d.cls=this;d.oldScrollTop=c;d.close=function(){this.style.display="none";alib.dom.styleSet(this.cls.mainCon,"display","block");d.cls.outerCon.removeChild(this);alib.dom.setScrollPosTop(this.oldScrollTop)};
c=new AntObjectLoader("calendar_event",a);if(b)for(var e=0;e<b.length;e++)c.setValue(b[e][0],b[e][1]);c.print(d);c.objfrmCon=d;c.objBrwsrCls=this;c.onClose=function(){this.objfrmCon.close()};this.preview||(c.onSave=function(){this.objBrwsrCls.refresh()});c.onRemove=function(){this.objBrwsrCls.refresh()}}else loadObjectForm("calendar_event",a,null,null,b)};
function AntFsBrowser(a){this.currentPath="undefined"!=typeof a?a:"%userdir%";this.inline=!1;this.objectList=[];this.listTableBody=this.listTable=this.objectListCon=this.objectListConNav=this.toolbarCon=this.bodyCon=this.titleCon=this.browserCon=null}
AntFsBrowser.prototype.print=function(a){this.browserCon=alib.dom.createElement("div",a);this.titleCon=alib.dom.createElement("div",this.browserCon);this.titleCon.className="objectLoaderHeader";this.antView?this.antView.getTitle(this.titleCon):this.setTitle("Browse Files &amp; Documents");this.bodyCon=alib.dom.createElement("div",this.browserCon);this.bodyCon.className="objectLoaderBody";this.toolbarCon=alib.dom.createElement("div",this.bodyCon);var a=new CToolbar,b=alib.ui.Button("<img src='/images/icons/refresh_"+
(this.inline?"10":"12")+".png' />",{className:this.inline?"b1 grCenter medium":"b1 grCenter",tooltip:"Refresh",cls:this,onclick:function(){this.cls.refresh()}});a.AddItem(b.getButton(),"left");a.print(this.toolbarCon);this.objectListConNav=alib.dom.createElement("div",this.bodyCon);this.objectListCon=alib.dom.createElement("div",this.bodyCon);this.loadDirectory()};AntFsBrowser.prototype.printInline=function(){};AntFsBrowser.prototype.displaySelect=function(){};AntFsBrowser.prototype.onselect=function(){};
AntFsBrowser.prototype.setTitle=function(a){this.titleCon&&(this.titleCon.innerHTML=a)};AntFsBrowser.prototype.resize=function(){if(!this.inline){var a=alib.userAgent.ie?30:0,a=getWorkspaceHeight()-a;this.titleCon&&(a-=this.titleCon.offsetHeight);this.toolbarCon&&(a-=this.toolbarCon.offsetHeight);0<a&&this.m_wfresults.setHeight(a-10+"px")}};
AntFsBrowser.prototype.loadDirectory=function(a){"undefined"==typeof a&&(a=0);a=new CAjax("json");a.cbData.cls=this;a.onload=function(a){this.cbData.cls.totalNum=a.totalNum;for(var c=0;c<a.folders.length;c++)this.cbData.cls.populateFolder(a.folders[c]);for(c=0;c<a.files.length;c++)this.cbData.cls.populateFile(a.files[c])};a.exec("/controller/AntFs/readFolder",[["offset",this.offset],["limit",250],["path",this.currentPath]],this.async)};
AntFsBrowser.prototype.loadDirFolders=function(){var a=new AntObjectList("folder");a.cbData.antFsB=this;a.onLoad=function(){this.cbData.antFsB.populateFolders(this)};a.getObjects();a=new AntObjectList("file");a.cbData.antFsB=this;a.onLoad=function(){this.cbData.antFsB.populateFiles(this)};a.getObjects()};
AntFsBrowser.prototype.loadDirFiles=function(a){this.skipLoad?this.skipLoad=!1:("undefined"!=typeof a&&null!=a?(a!=this.lastOffset&&(this.firstLoaded=!1),this.lastOffset=a):a=this.lastOffset=0,a=new AntObjectList("file"),a.cbData.antFsB=this,a.onLoad=function(){this.cbData.antFsB.populateFiles(this)},a.getObjects())};
AntFsBrowser.prototype.populateFolder=function(a){alib.dom.createElement("div",this.objectListCon);this.m_listTable||(this.m_listTable=alib.dom.createElement("table",this.objectListCon),alib.dom.styleSetClass(this.m_listTable,"aobListTable"),this.m_listTable.cellPadding=0,this.m_listTable.cellSpacing=0,this.m_listTableBody=alib.dom.createElement("tbody",this.m_listTable));a.isBrowse=!0;(new AntObjectBrowserItem(a,this)).print(this.m_listTableBody)};
AntFsBrowser.prototype.populateFile=function(a){var b=alib.dom.createElement("div",this.objectListCon);alib.dom.styleSet(b,"border-bottom","1px solid blue");alib.dom.styleSet(b,"margin-bottom","20px");b.innerHTML=a.id+" - "+a.name};var g_AntFsBrLastLoc=null;function AntFsOpen(){this.filterType=null;this.currentPath="%userdir%";this.dirUserId=this.root_folderid=this.currentFolderId=null;this.root_name=this.strTitle="";this.cbData={};g_AntFsBrLastLoc&&(this.currentPath=g_AntFsBrLastLoc)}
AntFsOpen.prototype.showDialog=function(a){this.parentDlg=a?a:null;this.m_dlg=new CDialog(this.strTitle?this.strTitle:"folder"==this.filterType?"Select Folder":"Select File(s)",this.parentDlg);this.m_dlg.f_close=!0;var a=this.m_dlg,b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"margin","3px 0 3px 0");var d=alib.dom.setElementAttr(alib.dom.createElement("div",c),[["innerHTML","Find: "]]),e=alib.dom.createElement("div",c),f=alib.dom.createElement("span",d);this.m_txtSearch=
alib.dom.createElement("input",f);var g=new CButton("Search",function(a){a.loadDirectory()},[this],"b1");g.print(d);alib.dom.styleSet(d,"float","right");alib.dom.styleSet(this.m_txtSearch,"width","150px");alib.dom.styleSet(this.m_txtSearch,"marginRight","5px");alib.dom.styleSet(this.m_txtSearch,"paddingRight","25px");alib.dom.styleSet(e,"cursor","pointer");f.className="clearIcon";g=alib.dom.createElement("span",f);g.className="deleteicon";alib.dom.styleSet(g,"visibility","hidden");alib.dom.styleSet(g,
"right","10px");g.cls=this;g.textSearch=this.m_txtSearch;g.onclick=function(){this.textSearch.value="";this.textSearch.focus();alib.dom.styleSet(this,"visibility","hidden");this.cls.loadDirectory()};this.m_txtSearch.spanIcon=g;this.m_txtSearch.m_cls=this;this.m_txtSearch.onkeyup=function(a){"undefined"==typeof a&&(a=ALib.m_evwnd?ALib.m_evwnd.event:window.event);13==("undefined"!=typeof a.keyCode?a.keyCode:a.which)&&this.m_cls.loadDirectory();0<this.value.length?alib.dom.styleSet(this.spanIcon,"visibility",
"visible"):alib.dom.styleSet(this.spanIcon,"visibility","hidden")};"folder"!=this.filterType&&(g=new CButton("Upload File(s)",function(a){a.uploadFiles()},[this],"b2"),g.print(c));g=new CButton("Create New Folder",function(a){a.createNewFolder()},[this],"b1");g.print(c);this.pathDiv=alib.dom.createElement("div",b);this.pathDiv.innerHTML="&nbsp;";alib.dom.styleSet(this.pathDiv,"border","1px solid");alib.dom.styleSet(this.pathDiv,"padding","3px");this.pag_div=alib.dom.createElement("div",b);alib.dom.styleSet(this.pag_div,
"margin-bottom","3px");alib.dom.styleSet(this.pag_div,"text-align","right");this.pag_div.innerHTML="Page 1 of 1";c=alib.dom.createElement("div",b);g=new CSplitContainer("verticle","100%","350px");g.resizable=!0;this.appNav=g.addPanel("105px");this.m_browsedv=g.addPanel("*");alib.dom.styleSet(this.m_browsedv,"border","1px solid");g.print(c);this.m_browsedv.innerHTML="&nbsp;Loading...";c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"text-align","right");"folder"==this.filterType&&(g=new CButton("Select This Folder",
function(a){a.select(a.currentFolderId,a.currentFolderName,a.currentPath)},[this],"b2"),g.print(c));a.customDialog(b,600);this.loadDirectory();this.buildLeftnav();this.setPath(this.currentPath)};
AntFsOpen.prototype.buildLeftnav=function(){this.m_navbar=new CNavBar;var a=this.m_navbar.addSection("Navigation");a.addItem("My Files","/images/icons/folder.png",function(a){a.setPath("%userdir%");a.loadDirectory()},[this],"favorites_my");a.addItem("Global Files","/images/icons/world_16.png",function(a){a.setPath("/");a.loadDirectory()},[this],"favorites_global");this.m_navbar.print(this.appNav);"%userdir%"==this.currentPath.split("/")[0]?this.m_navbar.itemChangeState("favorites_my","on"):this.m_navbar.itemChangeState("favorites_global",
"on")};AntFsOpen.prototype.select=function(a,b,c){this.m_dlg.hide();this.onSelect(a,b,c)};AntFsOpen.prototype.onSelect=function(){};AntFsOpen.prototype.onCancel=function(){};AntFsOpen.prototype.onSetPath=function(){};
AntFsOpen.prototype.loadDirectory=function(a){a="undefined"!=typeof a?a:0;this.m_browsedv||(this.m_browsedv=alib.dom.createElement("div"));this.pag_div||(this.pag_div=alib.dom.createElement("div"));this.m_browsedv.innerHTML="&nbsp;Loading...";if("undefined"==typeof b)var b=0;b=new CAjax("json");b.cbData.cls=this;b.onload=function(a){this.cbData.cls.m_browsedv.innerHTML="";this.cbData.cls.pag_div.innerHTML="";this.cbData.cls.m_doctbl=new CToolTable("100%");var b=this.cbData.cls.m_doctbl;b.print(this.cbData.cls.m_browsedv);
b.addHeader("&nbsp;","center","20px");b.addHeader("Name");b.addHeader("Size");a.browseByCurId&&(this.cbData.cls.currentFolderId=a.browseByCurId);if(a.browseByObjects&&a.browseByObjects.length){parseInt(a.browseByObjects.length);for(var e=0;e<a.browseByObjects.length;e++){var f=a.browseByObjects[e];f.isBrowse=!0;var g=this.cbData.cls.currentPath;"/"!=this.cbData.cls.currentPath&&(g+="/");var g=g+f.name,h=alib.dom.createElement("a");h.innerHTML=f.name;h.href="javascript:void(0);";h.m_id=f.id;h.m_name=
f.name;h.m_browseclass=this.cbData.cls;h.m_path=g;h.onclick=function(){this.m_browseclass.setPath(this.m_path);this.m_browseclass.loadDirectory()};f=b.addRow();f.addCell("<img src='/images/icons/folder_16.png' border='0'>",!1,"center");f.addCell(h);f.addCell("&nbsp;",!1,"right")}}for(e=0;e<a.objects.length;e++)h=alib.dom.createElement("a"),h.innerHTML=a.objects[e].name,h.href="javascript:void(0);",h.m_id=a.objects[e].id,h.m_name=a.objects[e].name,h.m_browseclass=this.cbData.cls,h.m_path=g,h.onclick=
function(){this.m_browseclass.select(this.m_id,this.m_name,this.m_path)},f=b.addRow(),f.addCell("<img src='/images/icons/generic.gif' border='0'>",!1,"center"),f.addCell(h),f.addCell(a.objects[e].file_size?a.objects[e].file_size:"&nbsp;",!1,"right");if(a.next||a.prev)b=alib.dom.createElement("span",this.cbData.cls.pag_div),b.innerHTML=a.desc,b=alib.dom.createElement("span",this.cbData.cls.pag_div),b.innerHTML=" | ",a.prev&&(b=alib.dom.createElement("span",this.cbData.cls.pag_div),b.innerHTML="&laquo; previous",
alib.dom.styleSet(b,"cursor","pointer"),b.start=a.prev,b.m_browseclass=this.cbData.cls,b.onclick=function(){this.m_browseclass.loadDirectory(this.start)}),a.next&&(b=alib.dom.createElement("span",this.cbData.cls.pag_div),b.innerHTML=" next &raquo;",alib.dom.styleSet(b,"cursor","pointer"),b.start=a.next,b.m_browseclass=this.cbData.cls,b.onclick=function(){this.m_browseclass.loadDirectory(this.start)})};a=[["obj_type","file"],["offset",a],["limit",250],["browsebyfield","folder_id"],["browsebypath",
this.currentPath]];this.m_txtSearch&&this.m_txtSearch.value&&"search here"!=this.m_txtSearch.value&&(a[a.length]=["cond_search",this.m_txtSearch.value]);b.exec("/controller/ObjectList/query",a);g_AntFsBrLastLoc=this.currentPath};
AntFsOpen.prototype.parsePath=function(){this.pathDiv.innerHTML="";for(var a=this.currentPath.split("/"),b="",c=0,d=0;d<a.length;d++){var e=a[d],f=e;0==d&&""==e?(f="Global Files",e="/",c=1):0==d&&"%userdir%"==e&&(f="My Files",c=0);d>c&&(b+="/");b+=e;0<d&&alib.dom.createElement("span",this.pathDiv,"&nbsp;/&nbsp;");e=alib.dom.createElement("a",this.pathDiv);e.innerHTML=f;e.href="javascript:void(0);";e.fullPath=b;e.bcls=this;e.onclick=function(){this.bcls.setPath(this.fullPath);this.bcls.loadDirectory()}}};
AntFsOpen.prototype.setPathById=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){a.error?alert(a.error):(this.cbData.cls.setPath(a),this.cbData.cls.loadDirectory())};ajax.exec("/controller/AntFs/getPathFromId",[["folder_id",a]])};AntFsOpen.prototype.setPath=function(a){this.currentPath=a;this.pathDiv&&this.parsePath();this.onSetPath(a)};AntFsOpen.prototype.setTitle=function(a){this.strTitle=a};
AntFsOpen.prototype.createNewFolder=function(){var a=new CDialog;a.parentDlg=!0;a.promptBox("Name:","New Folder Name","New Folder");a.m_cls=this;a.onPromptOk=function(a){a=[["path",this.m_cls.currentPath],["name",a]];ajax=new CAjax("json");ajax.cbData.cls=this.m_cls;ajax.onload=function(a){a.error?alert(a.error):this.cbData.cls.loadDirectory()};ajax.exec("/controller/AntFs/newFolder",a);g_AntFsBrLastLoc=this.m_cls.currentPath};a.m_input.onblur=function(){checkSpecialCharacters("folder",this.value,
this)}};AntFsOpen.prototype.uploadFiles=function(){var a=new AntFsUpload(this.currentPath,this.m_dlg);a.cbData.m_browseclass=this;a.onUploadFinished=function(){this.cbData.m_browseclass.loadDirectory()};a.showDialog()};var g_AntFsUploadCurrent=null;function ToggleAdd(){null!=g_AntFsUploadCurrent&&g_AntFsUploadCurrent.unload()}function FlUploadComplete(){null!=g_AntFsUploadCurrent&&g_AntFsUploadCurrent.uploadFinished()}
function AntFsUpload(a,b){this.fileId=this.folderId="";this.currentPath=a?a:"%userdir%";this.parentDlg=b?b:null;this.authStr="";this.process_function=null;this.m_uploadedFiles=[];this.cbData={};this.getAuthString()}
AntFsUpload.prototype.showDialog=function(){if(this.authStr){var a=this.m_dlg=new CDialog("Upload File(s)",this.parentDlg);g_AntFsUploadCurrent=this;var b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b);c.style.zIndex=1E3;var d=alib.dom.createElement("div",c),c=alib.dom.createElement("div",c),c=alib.dom.createElement("table",c),c=alib.dom.createElement("tbody",c),e=alib.dom.createElement("tr",c),f=alib.dom.createElement("td",e);f.valign="top";c=alib.dom.createElement("span",f);f=alib.dom.createElement("td",
e);f.valign="top";e=alib.dom.createElement("div",f);alib.dom.styleSet(e,"vartical-align","top");alib.dom.styleSet(e,"font-family","Helvetica, Arial, sans-serif");alib.dom.styleSet(e,"font-size","12px");alib.dom.styleSet(e,"cursor","pointer");alib.dom.styleSet(e,"height","16px");327;alib.dom.styleSet(e,"width","97px");alib.dom.styleSet(e,"background-image","url(/images/buttons/flash_bg_100x18.png)");alib.dom.styleSet(e,"padding","2px 0px 0px 3px");alib.dom.styleSet(e,"margin","-2px 0px 0px 3px");alib.dom.styleSet(e,
"overflow","hidden");e.innerHTML="Cancel";e.m_cls=this;e.onclick=function(){this.m_cls.unload()};a.customDialog(b,460,85);a="/controller/AntFs/upload?auth="+this.authStr;this.process_function&&(a+="&process_function="+this.process_function);a=this.folderId?a+("&folderid="+this.folderId):a+("&path="+escape(this.currentPath));this.fileId&&(a+="&fileid="+this.fileId);try{new SWFUpload({upload_url:a,file_size_limit:"2GB",file_upload_limit:"0",file_queue_error_handler:AntFsUpload_fileQueueError,file_dialog_complete_handler:fileDialogComplete,
upload_progress_handler:AntFsUpload_uploadProgress,upload_error_handler:AntFsUpload_uploadError,upload_success_handler:AntFsUpload_uploadSuccess,upload_complete_handler:AntFsUpload_uploadComplete,swfupload_loaded_handler:AntFsUpload_uploadFlashLoaded,button_image_url:"/images/buttons/flash_bg_100x18.png",button_placeholder:c,button_placeholder_id:"",button_width:100,button_height:18,button_text:'<span class="button">Select Files</span>',button_text_style:".button { font-family: Helvetica, Arial, sans-serif; font-size: 12pt; }",
button_text_top_padding:0,button_text_left_padding:3,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,flash_url:"/lib/SWFUpload/Flash/swfupload.swf",custom_settings:{upload_target:d,isMulti:!1},debug:!1})}catch(g){alert(g)}}else this.getAuthString("showDialog")};
AntFsUpload.prototype.showTmpUpload=function(a,b,c,d){if(this.authStr){if(this.m_resultscon=b,g_AntFsUploadCurrent=this,!("undefined"==typeof a||"undefined"==typeof b)){"undefined"==typeof c&&(c="Upload File(s)");"undefined"==typeof d&&(d="0");var e=alib.dom.createElement("a",document.body);alib.dom.styleSet(e,"display","none");alib.dom.styleSet(e,"position","absolute");e.innerHTML=" ";var f=alib.dom.styleGet(e,"font-family"),g=alib.dom.styleGet(e,"font-size"),h=alib.dom.styleGet(e,"color");alib.dom.styleGet(e,
"text-decoration");document.body.removeChild(e);e="/controller/AntFs/upload?path="+escape("%tmp%")+"&auth="+this.authStr;this.process_function&&(e+="&process_function="+this.process_function);new SWFUpload({upload_url:e,file_size_limit:"2GB",file_upload_limit:d,file_queued_handler:AntFsUpload_fileQueued,file_queue_error_handler:AntFsUpload_fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_start_handler:AntFsUpload_uploadStart,upload_progress_handler:AntFsUpload_uploadProgress,
upload_error_handler:AntFsUpload_uploadError,upload_success_handler:AntFsUpload_uploadSuccess,upload_complete_handler:AntFsUpload_uploadComplete,queue_complete_handler:AntFsUpload_queueComplete,swfupload_loaded_handler:AntFsUpload_uploadFlashLoaded,button_image_url:"/images/buttons/flash_attachments_14x16.png",button_placeholder:a,button_placeholder_id:"",button_width:100,button_height:16,button_text:'<span class="button">'+c+"</span>",button_text_style:".button { font-family: "+f+"; font-size: "+
g+"; color: #"+h+";}",button_text_top_padding:0,button_text_left_padding:17,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,flash_url:"/lib/SWFUpload/Flash/swfupload.swf",custom_settings:{upload_target:b,isMulti:!0},debug:!1})}}else this.m_tmpUpVarsObj={},this.m_tmpUpVarsObj.button_con=a,this.m_tmpUpVarsObj.files_con=b,this.m_tmpUpVarsObj.button_text=c,this.m_tmpUpVarsObj.file_upload_limit=d,this.getAuthString("showTmpUpload")};
AntFsUpload.prototype.getAuthString=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.functionString=a;ajax.onload=function(b){if(b&&b)switch(this.cbData.cls.authStr=b,a){case "showDialog":this.cbData.cls.showDialog();break;case "showTmpUpload":this.cbData.cls.showTmpUpload(this.cbData.cls.m_tmpUpVarsObj.button_con,this.cbData.cls.m_tmpUpVarsObj.files_con,this.cbData.cls.m_tmpUpVarsObj.button_text,this.cbData.cls.m_tmpUpVarsObj.file_up)}};ajax.exec("/controller/User/getAuthString")};
AntFsUpload.prototype.unload=function(){this.m_dlg&&this.m_dlg.hide()};AntFsUpload.prototype.uploadFinished=function(){this.onUploadFinished();this.m_dlg&&this.m_dlg.hide()};AntFsUpload.prototype.clearUploadedFiles=function(){this.m_resultscon&&(this.m_resultscon.innerHTML="");this.m_uploadedFiles&&(this.m_uploadedFiles=[])};AntFsUpload.prototype.getNumUploadedFiles=function(){return this.m_uploadedFiles.length};AntFsUpload.prototype.getUploadedFile=function(a){return this.m_uploadedFiles[a]};
AntFsUpload.prototype.setFolderId=function(a){this.folderId=a};AntFsUpload.prototype.setPath=function(a){this.currentPath=a};AntFsUpload.prototype.setFileId=function(a){this.fileId=a};AntFsUpload.prototype.onFlashLoad=function(){};AntFsUpload.prototype.onUploadStarted=function(){};AntFsUpload.prototype.onUploadFinished=function(){};AntFsUpload.prototype.onCancel=function(){};AntFsUpload.prototype.onUploadSuccess=function(){};AntFsUpload.prototype.onRemoveUpload=function(){};
AntFsUpload.prototype.onQueueComplete=function(){};function AntFsUpload_fileQueued(a){try{var b=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);b.setStatus("Pending...");b.toggleCancel(!0,this)}catch(c){this.debug(c)}}
function AntFsUpload_fileQueueError(a,b,c){try{if(b===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED)alert("You have attempted to queue too many files.\n"+(0===c?"You have reached the upload limit.":"You may select "+(1<c?"up to "+c+" files.":"one file.")));else{var d=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);d.setError();d.toggleRemove(!0);switch(b){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:d.setStatus("File is too big.");this.debug("Error Code: File too big, File name: "+
a.name+", File size: "+a.size+", Message: "+c);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:d.setStatus("Cannot upload Zero Byte files.");this.debug("Error Code: Zero byte file, File name: "+a.name+", File size: "+a.size+", Message: "+c);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:d.setStatus("Invalid File Type.");this.debug("Error Code: Invalid File Type, File name: "+a.name+", File size: "+a.size+", Message: "+c);break;default:null!==a&&d.setStatus("Unhandled Error"),this.debug("Error Code: "+
b+", File name: "+a.name+", File size: "+a.size+", Message: "+c)}}}catch(e){this.debug(e)}}function fileDialogComplete(a,b){try{0<b&&this.startUpload()}catch(c){this.debug(c)}}function AntFsUpload_uploadStart(a){try{var b=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);b.setStatus("Uploading...");b.toggleCancel(!0,this);g_AntFsUploadCurrent.onUploadStarted()}catch(c){}return!0}
function AntFsUpload_uploadProgress(a,b){try{var c=Math.ceil(100*(b/a.size)),d=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);d.setProgress(c);100===c?(d.setStatus("Processing..."),d.toggleCancel(!1,this),d.toggleRemove(!0)):(d.setStatus("Uploading..."),d.toggleCancel(!0,this))}catch(e){this.debug(e)}}
function AntFsUpload_uploadSuccess(a,b){try{var c=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);c.toggleCancel(!1);c.toggleRemove(!0);var d=JSON.parse(b);if(d.error)this.customSettings.isMulti?(c.setStatus("Error - "+d.error),c.setComplete()):alert(d.error);else{this.customSettings.isMulti&&(c.setComplete(),c.setStatus("Complete"));var e=d[0].name,f=d[0].id;f&&(c.antFileId=f,c.setStatus("Complete - <a href='/antfs/"+f+"/"+e+"' target='_blank'>view file</a><input type='hidden' name='uploaded_file[]' value='"+
f+"'>"),g_AntFsUploadCurrent.onUploadSuccess(f,e,""),g_AntFsUploadCurrent.m_uploadedFiles[g_AntFsUploadCurrent.m_uploadedFiles.length]={id:f,name:e})}}catch(g){this.debug(g)}}
function AntFsUpload_uploadComplete(a){try{if(0<this.getStats().files_queued)this.startUpload();else if(!this.customSettings.isMulti){var b=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);b.setComplete();b.setStatus("All files received.");b.toggleCancel(!1);g_AntFsUploadCurrent.uploadFinished()}}catch(c){this.debug(c)}}
function AntFsUpload_uploadError(a,b,c){try{var d=new FileProgress(a,this.customSettings.upload_target,this.customSettings.isMulti);d.setError();d.toggleCancel(!1);d.toggleRemove(!0);switch(b){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:d.setStatus("Upload Error: "+c);this.debug("Error Code: HTTP Error, File name: "+a.name+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:d.setStatus("Upload Failed.");this.debug("Error Code: Upload Failed, File name: "+a.name+", File size: "+a.size+", Message: "+
c);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:d.setStatus("Server (IO) Error");this.debug("Error Code: IO Error, File name: "+a.name+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:d.setStatus("Security Error");this.debug("Error Code: Security Error, File name: "+a.name+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:d.setStatus("Upload limit exceeded.");this.debug("Error Code: Upload Limit Exceeded, File name: "+a.name+", File size: "+a.size+", Message: "+
c);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:d.setStatus("Failed Validation.  Upload skipped.");this.debug("Error Code: File Validation Failed, File name: "+a.name+", File size: "+a.size+", Message: "+c);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:0===this.getStats().files_queued&&(ALib.m_document.getElementById(this.customSettings.cancelButtonId).disabled=!0);d.setStatus("Cancelled");d.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:d.setStatus("Stopped");break;
default:d.setStatus("Unhandled Error: "+b),this.debug("Error Code: "+b+", File name: "+a.name+", File size: "+a.size+", Message: "+c)}}catch(e){this.debug(e)}}function AntFsUpload_uploadFlashLoaded(){g_AntFsUploadCurrent.onFlashLoad()}
function fadeIn(a,b){if(100>b)if(b+=5,100<b&&(b=100),a.filters)try{a.filters.item("DXImageTransform.Microsoft.Alpha").opacity=b}catch(c){a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")"}else a.style.opacity=b/100;100>b&&setTimeout(function(){fadeIn(a,b)},30)}function AntFsUpload_queueComplete(){g_AntFsUploadCurrent.onQueueComplete()}
function FileProgress(a,b,c){c&&(this.isMulti=c);this.fileProgressID=this.isMulti?a.id:"divFileProgress";if(this.fileProgressWrapper=ALib.m_document.getElementById(this.fileProgressID))this.fileProgressElement=this.fileProgressWrapper.firstChild,this.fileProgressElement.childNodes[1].firstChild.nodeValue=a.name;else{this.fileProgressWrapper=ALib.m_document.createElement("div");this.fileProgressWrapper.className="progressWrapper";this.fileProgressWrapper.id=this.fileProgressID;this.fileProgressElement=
ALib.m_document.createElement("div");this.fileProgressElement.className="progressContainer";c=ALib.m_document.createElement("a");c.className="progressCancel";c.href="#";c.style.visibility="hidden";c.innerHTML="cancel";var d=ALib.m_document.createElement("div");d.className="progressName";d.appendChild(ALib.m_document.createTextNode(a.name));a=ALib.m_document.createElement("div");a.className="progressBarInProgress";var e=ALib.m_document.createElement("div");e.className="progressBarStatus";e.innerHTML=
"&nbsp;";this.fileProgressElement.appendChild(c);this.fileProgressElement.appendChild(d);this.fileProgressElement.appendChild(e);this.fileProgressElement.appendChild(a);this.fileProgressWrapper.appendChild(this.fileProgressElement);b.appendChild(this.fileProgressWrapper);fadeIn(this.fileProgressWrapper,0)}this.height=this.fileProgressWrapper.offsetHeight}
FileProgress.prototype.setProgress=function(a){this.fileProgressElement.className="progressContainer green";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width=a+"%"};FileProgress.prototype.setComplete=function(){this.fileProgressElement.className="progressContainer blue";this.fileProgressElement.childNodes[3].className="progressBarComplete";this.fileProgressElement.childNodes[3].style.width=""};
FileProgress.prototype.setError=function(){this.fileProgressElement.className="progressContainer red";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width=""};FileProgress.prototype.setCancelled=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width=""};
FileProgress.prototype.setStatus=function(a){this.fileProgressElement.childNodes[2].innerHTML=a};FileProgress.prototype.toggleCancel=function(a,b){this.fileProgressElement.childNodes[0].style.visibility=a?"visible":"hidden";if(b){var c=this.fileProgressID;this.fileProgressElement.childNodes[0].onclick=function(){b.cancelUpload(c);return!1}}};
FileProgress.prototype.toggleRemove=function(a){this.fileProgressElement.childNodes[0].style.visibility=a?"visible":"hidden";a&&(this.fileProgressElement.childNodes[0].innerHTML="remove",this.fileProgressElement.childNodes[0].progressObj=this,this.fileProgressElement.childNodes[0].onclick=function(){this.progressObj.antFileId?(this.progressObj.setStatus("Removing..."),ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.cbData.wrapper=this.progressObj.fileProgressWrapper,ajax.cbData.fid=this.progressObj.antFileId,
ajax.onload=function(){this.cbData.wrapper.style.display="none";g_AntFsUploadCurrent.onRemoveUpload(this.cbData.fid);for(var a=0;a<g_AntFsUploadCurrent.m_uploadedFiles.length;a++)g_AntFsUploadCurrent.m_uploadedFiles[a].id==this.cbData.fid&&g_AntFsUploadCurrent.m_uploadedFiles.splice(a,1)},ajax.exec("/controller/UserFile/deleteFileId",[["fid",this.progressObj.antFileId]])):(this.progressObj.setStatus("Removed"),this.progressObj.fileProgressWrapper.style.display="none");return!1})};var SWFUpload;
void 0==SWFUpload&&(SWFUpload=function(a){this.initSWFUpload(a)});SWFUpload.prototype.initSWFUpload=function(a){try{this.customSettings={},this.settings=a,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(b){throw delete SWFUpload.instances[this.movieName],b;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";
SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};
SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(a){if("string"!==typeof a||a.match(/^https?:\/\//i)||a.match(/^\//))return a;var b=window.location.pathname.lastIndexOf("/");path=0>=b?"/":window.location.pathname.substr(0,b)+"/";return path+a};
SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(a,b){this.settings[a]=void 0==this.settings[a]?b:this.settings[a]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",!1);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",!1);this.ensureDefault("requeue_on_error",!1);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types",
"*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",!0);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");
this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",!1);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",!1);this.settings.debug_enabled=this.settings.debug;
this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",
null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(0>this.settings.flash_url.indexOf("?")?"?":"&")+"preventswfcaching="+(new Date).getTime());this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=
SWFUpload.completeURL(this.settings.button_image_url));delete this.ensureDefault};
SWFUpload.prototype.loadFlash=function(){var a;if(null!==ALib.m_document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";a=ALib.m_document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(void 0==a)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;a.innerHTML=this.getFlashHTML();this.targetElement=a;void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())};
SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload"><param name="wmode" value="',this.settings.button_window_mode,'" /><param name="movie" value="',this.settings.flash_url,'" /><param name="quality" value="high" /><param name="menu" value="false" /><param name="allowScriptAccess" value="always" />',
'<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};
SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString(),b=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(b),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),
"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),
"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),
"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){void 0==this.movieElement&&(this.movieElement=this.targetElement?this.targetElement.firstChild:ALib.m_document.getElementById(this.movieName));if(null===this.movieElement)throw"Could not find Flash element";return this.movieElement};
SWFUpload.prototype.buildParamString=function(){var a=this.settings.post_params,b=[];if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c.toString())+"="+encodeURIComponent(a[c].toString()));return b.join("&amp;")};
SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var a=null;if((a=this.getMovieElement())&&"unknown"===typeof a.CallFunction){for(var b in a)try{"function"===typeof a[b]&&(a[b]=null)}catch(c){}try{a.parentNode.removeChild(a)}catch(d){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieName=this.eventQueue=this.customSettings=this.settings=this.movieElement=null;return!0}catch(e){return!1}};
SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\nVersion: ",SWFUpload.version,"\nMovie Name: ",this.movieName,"\nSettings:\n\tupload_url:               ",this.settings.upload_url,"\n\tflash_url:                ",this.settings.flash_url,"\n\tuse_query_string:         ",this.settings.use_query_string.toString(),"\n\trequeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n\thttp_success:             ",this.settings.http_success.join(", "),"\n\tassume_success_timeout:   ",
this.settings.assume_success_timeout,"\n\tfile_post_name:           ",this.settings.file_post_name,"\n\tpost_params:              ",this.settings.post_params.toString(),"\n\tfile_types:               ",this.settings.file_types,"\n\tfile_types_description:   ",this.settings.file_types_description,"\n\tfile_size_limit:          ",this.settings.file_size_limit,"\n\tfile_upload_limit:        ",this.settings.file_upload_limit,"\n\tfile_queue_limit:         ",this.settings.file_queue_limit,"\n\tdebug:                    ",
this.settings.debug.toString(),"\n\tprevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n\tbutton_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n\tbutton_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n\tbutton_image_url:         ",this.settings.button_image_url.toString(),"\n\tbutton_width:             ",this.settings.button_width.toString(),"\n\tbutton_height:            ",this.settings.button_height.toString(),"\n\tbutton_text:              ",
this.settings.button_text.toString(),"\n\tbutton_text_style:        ",this.settings.button_text_style.toString(),"\n\tbutton_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n\tbutton_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n\tbutton_action:            ",this.settings.button_action.toString(),"\n\tbutton_disabled:          ",this.settings.button_disabled.toString(),"\n\tcustom_settings:          ",this.settings.custom_settings.toString(),"\nEvent Handlers:\n\tswfupload_loaded_handler assigned:  ",
("function"===typeof this.settings.swfupload_loaded_handler).toString(),"\n\tfile_dialog_start_handler assigned: ",("function"===typeof this.settings.file_dialog_start_handler).toString(),"\n\tfile_queued_handler assigned:       ",("function"===typeof this.settings.file_queued_handler).toString(),"\n\tfile_queue_error_handler assigned:  ",("function"===typeof this.settings.file_queue_error_handler).toString(),"\n\tupload_start_handler assigned:      ",("function"===typeof this.settings.upload_start_handler).toString(),
"\n\tupload_progress_handler assigned:   ",("function"===typeof this.settings.upload_progress_handler).toString(),"\n\tupload_error_handler assigned:      ",("function"===typeof this.settings.upload_error_handler).toString(),"\n\tupload_success_handler assigned:    ",("function"===typeof this.settings.upload_success_handler).toString(),"\n\tupload_complete_handler assigned:   ",("function"===typeof this.settings.upload_complete_handler).toString(),"\n\tdebug_handler assigned:             ",("function"===
typeof this.settings.debug_handler).toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(a,b,c){return void 0==b?this.settings[a]=c:this.settings[a]=b};SWFUpload.prototype.getSetting=function(a){return void 0!=this.settings[a]?this.settings[a]:""};
SWFUpload.prototype.callFlash=function(a,b){var b=b||[],c=this.getMovieElement(),d,e;try{e=c.CallFunction('<invoke name="'+a+'" returntype="javascript">'+__flash__argumentsToXML(b,0)+"</invoke>"),d=eval(e)}catch(f){throw"Call to "+a+" failed";}void 0!=d&&"object"===typeof d.post&&(d=this.unescapeFilePostParams(d));return d};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};
SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelUpload=function(a,b){!1!==b&&(b=!0);this.callFlash("CancelUpload",[a,b])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])};
SWFUpload.prototype.getFile=function(a){return"number"===typeof a?this.callFlash("GetFileByIndex",[a]):this.callFlash("GetFile",[a])};SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])};SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])};SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString();this.callFlash("SetUploadURL",[a])};
SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;this.callFlash("SetPostParams",[a])};SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];this.callFlash("SetPostParams",[this.settings.post_params])};
SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;this.settings.file_types_description=b;this.callFlash("SetFileTypes",[a,b])};SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;this.callFlash("SetFileSizeLimit",[a])};SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;this.callFlash("SetFileUploadLimit",[a])};
SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;this.callFlash("SetFileQueueLimit",[a])};SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;this.callFlash("SetFilePostName",[a])};SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;this.callFlash("SetUseQueryString",[a])};SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;this.callFlash("SetRequeueOnError",[a])};
SWFUpload.prototype.setHTTPSuccess=function(a){"string"===typeof a&&(a=a.replace(" ","").split(","));this.settings.http_success=a;this.callFlash("SetHTTPSuccess",[a])};SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a;this.callFlash("SetAssumeSuccessTimeout",[a])};SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;this.callFlash("SetDebugEnabled",[a])};
SWFUpload.prototype.setButtonImageURL=function(a){void 0==a&&(a="");this.settings.button_image_url=a;this.callFlash("SetButtonImageURL",[a])};SWFUpload.prototype.setButtonDimensions=function(a,b){this.settings.button_width=a;this.settings.button_height=b;var c=this.getMovieElement();void 0!=c&&(c.style.width=a+"px",c.style.height=b+"px");this.callFlash("SetButtonDimensions",[a,b])};SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;this.callFlash("SetButtonText",[a])};
SWFUpload.prototype.setButtonTextPadding=function(a,b){this.settings.button_text_top_padding=b;this.settings.button_text_left_padding=a;this.callFlash("SetButtonTextPadding",[a,b])};SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;this.callFlash("SetButtonTextStyle",[a])};SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;this.callFlash("SetButtonDisabled",[a])};
SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;this.callFlash("SetButtonAction",[a])};SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a;this.callFlash("SetButtonCursor",[a])};
SWFUpload.prototype.queueEvent=function(a,b){void 0==b?b=[]:b instanceof Array||(b=[b]);var c=this;if("function"===typeof this.settings[a])this.eventQueue.push(function(){this.settings[a].apply(this,b)}),setTimeout(function(){c.executeNextEvent()},0);else if(null!==this.settings[a])throw"Event handler "+a+" is unknown or is not a function";};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;"function"===typeof a&&a.apply(this)};
SWFUpload.prototype.unescapeFilePostParams=function(a){var b=/[$]([0-9a-f]{4})/i,c={},d;if(void 0!=a){for(var e in a.post)if(a.post.hasOwnProperty(e)){d=e;for(var f;null!==(f=b.exec(d));)d=d.replace(f[0],String.fromCharCode(parseInt("0x"+f[1],16)));c[d]=a.post[e]}a.post=c}return a};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return!1}};
SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();a?(this.cleanUp(a),this.queueEvent("swfupload_loaded_handler")):this.debug("Flash called back ready but the flash movie can't be found.")};
SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&"unknown"===typeof a.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{"function"===typeof a[b]&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};
SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("file_queued_handler",a)};SWFUpload.prototype.fileQueueError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("file_queue_error_handler",[a,b,c])};SWFUpload.prototype.fileDialogComplete=function(a,b,c){this.queueEvent("file_dialog_complete_handler",[a,b,c])};SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("return_upload_start_handler",a)};
SWFUpload.prototype.returnUploadStart=function(a){var b;if("function"===typeof this.settings.upload_start_handler)a=this.unescapeFilePostParams(a),b=this.settings.upload_start_handler.call(this,a);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===b&&(b=!0);this.callFlash("ReturnUploadStart",[!!b])};SWFUpload.prototype.uploadProgress=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_progress_handler",[a,b,c])};
SWFUpload.prototype.uploadError=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_error_handler",[a,b,c])};SWFUpload.prototype.uploadSuccess=function(a,b,c){a=this.unescapeFilePostParams(a);this.queueEvent("upload_success_handler",[a,b,c])};SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("upload_complete_handler",a)};SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)};
SWFUpload.prototype.debugMessage=function(a){if(this.settings.debug){var b=[];if("object"===typeof a&&"string"===typeof a.name&&"string"===typeof a.message){for(var c in a)a.hasOwnProperty(c)&&b.push(c+": "+a[c]);a=b.join("\n")||"";b=a.split("\n");a="EXCEPTION: "+b.join("\nEXCEPTION: ")}SWFUpload.Console.writeLine(a)}};SWFUpload.Console={};
SWFUpload.Console.writeLine=function(a){var b,c;try{b=ALib.m_document.getElementById("SWFUpload_Console"),b||(c=ALib.m_document.createElement("form"),ALib.m_document.getElementsByTagName("body")[0].appendChild(c),b=ALib.m_document.createElement("textarea"),b.id="SWFUpload_Console",b.style.fontFamily="monospace",b.setAttribute("wrap","off"),b.wrap="off",b.style.overflow="auto",b.style.width="700px",b.style.height="350px",b.style.margin="5px",c.appendChild(b)),b.value+=a+"\n",b.scrollTop=b.scrollHeight-
b.clientHeight}catch(d){alert("Exception: "+d.name+" Message: "+d.message)}};
"function"===typeof SWFUpload&&(SWFUpload.queue={},SWFUpload.prototype.initSettings=function(a){return function(){"function"===typeof a&&a.call(this);this.queueSettings={};this.queueSettings.queue_cancelled_flag=!1;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=
SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null}}(SWFUpload.prototype.initSettings),SWFUpload.prototype.startUpload=function(a){this.queueSettings.queue_cancelled_flag=!1;this.callFlash("StartUpload",[a])},SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=!0;this.stopUpload();for(var a=this.getStats();0<a.files_queued;)this.cancelUpload(),a=this.getStats()},SWFUpload.queue.uploadStartHandler=function(a){var b;
"function"===typeof this.queueSettings.user_upload_start_handler&&(b=this.queueSettings.user_upload_start_handler.call(this,a));b=!1===b?!1:!0;this.queueSettings.queue_cancelled_flag=!b;return b},SWFUpload.queue.uploadCompleteHandler=function(a){var b=this.queueSettings.user_upload_complete_handler;a.filestatus===SWFUpload.FILE_STATUS.COMPLETE&&this.queueSettings.queue_upload_count++;if("function"===typeof b?!1!==b.call(this,a):a.filestatus!==SWFUpload.FILE_STATUS.QUEUED)0<this.getStats().files_queued&&
!1===this.queueSettings.queue_cancelled_flag?this.startUpload():(!1===this.queueSettings.queue_cancelled_flag?this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]):this.queueSettings.queue_cancelled_flag=!1,this.queueSettings.queue_upload_count=0)});function COlapCube(a,b,c){this.dimensions=[];this.measures=c;this.chart_type=this.chartHtml="";this.chart_width=800;this.obj_type=a;this.dataXml=null;this.view=b?b:null;this.customReport=""}
COlapCube.prototype.load=function(a,b,c,d,e){var f=new CAjax;f.m_obj=this;f.onload=function(a){for(var b=0;b<a.getNumChildren();b++){var c=a.getChildNode(b);switch(c.m_name){case "dimensions":for(var d=0;d<c.getNumChildren();d++){for(var e=c.getChildNode(d),f=[],g=0;g<e.getNumChildren();g++){var h=e.getChildNode(g);f[g]={value:unescape(h.getAttribute("value")),label:unescape(h.getAttribute("label")),total:0}}this.m_obj.dimensions[d]={name:unescape(e.getAttribute("name")),label:unescape(e.getAttribute("label")),
entries:f}}break;case "chart":this.m_obj.chartHtml=unescape(c.m_text);break;case "data":this.m_obj.dataXml=c;break;case "query":ALib.m_debug&&ALib.trace("OLAP Query: "+unescape(c.m_text))}}this.m_obj.onload()};var g=[];if(this.view)for(var h=0;h<this.view.conditions.length;h++){var k=this.view.conditions[h];g[g.length]=["conditions[]",h];g[g.length]=["condition_blogic_"+h,k.blogic];g[g.length]=["condition_fieldname_"+h,k.fieldName];g[g.length]=["condition_operator_"+h,k.operator];g[g.length]=["condition_condvalue_"+
h,k.condValue]}for(h=0;h<this.measures.length;h++)g[g.length]=["measures[]",h],g[g.length]=["measure_field_"+h,this.measures[h].field],g[g.length]=["measure_aggregate_"+h,this.measures[h].aggregate];h="/datacenter/xml_get_olap.php?obj_type="+this.obj_type;h=h+("&dim1="+a)+("&dim1_group="+b)+("&dim2="+c)+("&dim2_group="+d)+("&chart_type="+e)+("&chart_width="+this.chart_width);h+="&custom_report="+escape(this.customReport);f.m_method=AJAX_POST;f.exec(h,g)};COlapCube.prototype.onload=function(){};
COlapCube.prototype.printChart=function(a){a.innerHTML=this.chartHtml};
COlapCube.prototype.printTable=function(a){var b=new CToolTable("100%");b.print(a);if(this.dimensions[1]&&this.dimensions[1].entries.length){b.addHeader("&nbsp;","right");for(a=0;a<this.dimensions[1].entries.length;a++)b.addHeader(this.dimensions[1].entries[a].label,"right");b.addHeader("Total","right")}for(var c=0,d=0,e=0;e<this.dimensions[0].entries.length;e++){var f=b.addRow(),g=this.dimensions[0].entries[e].value;f.addCell(this.dimensions[0].entries[e].label,!0);if(this.dimensions[1]&&this.dimensions[1].entries.length){for(var h=
0,a=0;a<this.dimensions[1].entries.length;a++)c=this.getValue(g,this.dimensions[1].entries[a].value,0),f.addCell(""+c,!1,"right"),h+=c,this.dimensions[1].entries[a].total+=c;f.addCell(""+h,!0,"right");d+=h}else c=this.getValue(g,null,0),f.addCell(""+c,!1,"right"),d+=c}if(this.dimensions[1]){f=b.addRow();f.addCell("Total",!0,"right");for(a=0;a<this.dimensions[1].entries.length;a++)c=this.dimensions[1].entries[a].total,f.addCell(""+c,!1,"right")}else f=b.addRow(),f.addCell("Total",!0,"right");f.addCell(""+
d,!0,"right")};COlapCube.prototype.getValue=function(a,b,c){if(!this.dataXml)return"";for(var d=0;d<this.dataXml.getNumChildren();d++){var e=this.dataXml.getChildNode(d);if(unescape(e.getAttribute("value"))==a)if(b)for(var f=0;f<e.getNumChildren();f++){var g=e.getChildNode(f);if(unescape(g.getAttribute("value"))==b)return a=(a=unescape(g.getChildNode(c).m_text))?parseFloat(a):0}else return a=(a=unescape(e.getChildNode(c).m_text))?parseFloat(a):0}return 0};
function OlapCube(a,b,c){this.tmpQueryDimensions=[];this.displayChart=!0;this.chartType=this.chartHtml="";this.chartWidth=800;this.chartHeight=400;this.obj_type=a?a:"";this.customReport=b?b:"";this.datawareCube=c?c:"";this.cubeData=null;this.cbData={}}
OlapCube.prototype.loadData=function(a,b){"undefined"==typeof b&&(b=!1);var c=new CAjax("json");c.cbData.cls=this;c.onload=function(a){this.cbData.cls.cubeData=a;this.cbData.cls.onload(this.cbData.cls.cubeData)};var d=this.getArgParams(a);b&&(d[d.length]=["format","tabular"]);c.exec("/controller/Olap/queryCubeJson",d);this.tmpQueryDimensions=a.dimensions};OlapCube.prototype.loadTabularData=function(a){this.loadData(a,!0)};
OlapCube.prototype.loadOlapGraph=function(a){var b=new CAjax("json");b.cbData.cls=this;b.onload=function(a){a.chart?this.cbData.cls.chartHtml=a.chart:(this.cbData.cls.displayChart=!1,this.cbData.cls.chartHtml=a.message);this.cbData.cls.onload(this.cbData.cls.chartHtml)};a=this.getArgParams(a);a[a.length]=["chart_type",this.chartType];a[a.length]=["chart_width",this.chartWidth];a[a.length]=["chart_height",this.chartHeight];a[a.length]=["display_graph",!0];b.exec("/controller/Olap/processGraphDisplay",
a)};
OlapCube.prototype.getArgParams=function(a){var b=[];b[b.length]=["obj_type",this.obj_type];b[b.length]=["customReport",this.customReport];b[b.length]=["datawareCube",this.datawareCube];for(var c=0;c<a.filters.length;c++){var d=a.filters[c];b[b.length]=["filters[]",c];b[b.length]=["filter_blogic_"+c,d.blogic];b[b.length]=["filter_field_"+c,d.field];b[b.length]=["filter_operator_"+c,d.operator];b[b.length]=["filter_condition_"+c,d.condition]}for(c=0;c<a.measures.length;c++)b[b.length]=["measures[]",c],
b[b.length]=["measure_name_"+c,a.measures[c].name],b[b.length]=["measure_aggregate_"+c,a.measures[c].aggregate];for(c=0;c<a.dimensions.length;c++)b[b.length]=["dimensions[]",c],b[b.length]=["dimension_name_"+c,a.dimensions[c].name],b[b.length]=["dimension_sort_"+c,a.dimensions[c].sort],b[b.length]=["dimension_fun_"+c,a.dimensions[c].fun];return b};OlapCube.prototype.getDimensions=function(){};OlapCube.prototype.getMeasures=function(){};OlapCube.prototype.onload=function(){};
OlapCube.prototype.printChart=function(a){a.innerHTML=this.chartHtml};
OlapCube.prototype.printTable=function(a){var b=new CToolTable("100%");b.print(a);if(this.dimensions[1]&&this.dimensions[1].entries.length){b.addHeader("&nbsp;","right");for(a=0;a<this.dimensions[1].entries.length;a++)b.addHeader(this.dimensions[1].entries[a].label,"right");b.addHeader("Total","right")}for(var c=0,d=0,e=0;e<this.dimensions[0].entries.length;e++){var f=b.addRow(),g=this.dimensions[0].entries[e].value;f.addCell(this.dimensions[0].entries[e].label,!0);if(this.dimensions[1]&&this.dimensions[1].entries.length){for(var h=
0,a=0;a<this.dimensions[1].entries.length;a++)c=this.getValue(g,this.dimensions[1].entries[a].value,0),f.addCell(""+c,!1,"right"),h+=c,this.dimensions[1].entries[a].total+=c;f.addCell(""+h,!0,"right");d+=h}else c=this.getValue(g,null,0),f.addCell(""+c,!1,"right"),d+=c}if(this.dimensions[1]){f=b.addRow();f.addCell("Total",!0,"right");for(a=0;a<this.dimensions[1].entries.length;a++)c=this.dimensions[1].entries[a].total,f.addCell(""+c,!1,"right")}else f=b.addRow(),f.addCell("Total",!0,"right");f.addCell(""+
d,!0,"right")};OlapCube.prototype.getValue=function(a,b,c){if(!this.dataXml)return"";for(var d=0;d<this.dataXml.getNumChildren();d++){var e=this.dataXml.getChildNode(d);if(unescape(e.getAttribute("value"))==a)if(b)for(var f=0;f<e.getNumChildren();f++){var g=e.getChildNode(f);if(unescape(g.getAttribute("value"))==b)return a=(a=unescape(g.getChildNode(c).m_text))?parseFloat(a):0}else return a=(a=unescape(e.getChildNode(c).m_text))?parseFloat(a):0}return 0};
OlapCube.prototype.getDimChildren=function(a){this.dimEachChildren=[];for(var b=-1,c=0;c<this.tmpQueryDimensions.length;c++)a==this.tmpQueryDimensions[c].name&&(b=c);if(-1==b)return!1;this.getDimChildrenBydDepth(this.cubeData,b,0);a=this.dimEachChildren;this.dimEachChildren=null;return a};
OlapCube.prototype.getDimChildrenBydDepth=function(a,b,c){c=c?c:0;if(b==c)for(var d in a){b=!1;for(c=0;c<this.dimEachChildren.length;c++)this.dimEachChildren[c]==d&&(b=!0);b||this.dimEachChildren.push(d)}else for(d in a)this.getDimChildrenBydDepth(a[d],b,c+1)};
OlapCube.prototype.loadDefinition=function(){var a=[];this.obj_type&&(a[a.length]=["obj_type",this.obj_type]);this.datawareCube&&(a[a.length]=["datawareCube",this.datawareCube]);this.customReport&&(a[a.length]=["customReport",this.customReport]);ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onloadDefinition(a.dimensions,a.measures)};ajax.exec("/controller/Olap/getCubeData",a)};OlapCube.prototype.onloadDefinition=function(){};
function OlapCube_Query(){this.measures=[];this.dimensions=[];this.filters=[]}OlapCube_Query.prototype.addMeasure=function(a,b){this.measures[this.measures.length]={name:a,aggregate:b?b:"sum"}};OlapCube_Query.prototype.addDimension=function(a,b,c){this.dimensions[this.dimensions.length]={name:a,sort:b,fun:c}};OlapCube_Query.prototype.addFilter=function(a,b,c,d){this.filters[this.filters.length]={blogic:a,field:b,operator:c,condition:d}};
function OlapCube_Graph(a){this.cube=new OlapCube(a.obj_type,a.customReport,a.datawareCube);this.dimensions=[];this.measures=[];this.filters=[];this.chartWidth=800;this.chartHeight=400;this.chartType=null}
OlapCube_Graph.prototype.print=function(a,b){"undefined"==typeof b&&(b=!1);if(b)this.cube.displayChart&&alib.dom.styleSet(a,"height",this.chartHeight),a.innerHTML=this.cube.chartHtml;else{alib.dom.styleSet(a,"height","50px");this.cube.cbData.graph=this;this.cube.cbData.con=a;this.cube.onload=function(){this.cbData.graph.print(this.cbData.con,!0)};for(var c=new OlapCube_Query,d=0;d<this.measures.length;d++)c.addMeasure(this.measures[d].name,this.measures[d].aggregate);for(d=0;d<this.dimensions.length;d++)c.addDimension(this.dimensions[d].name,
this.dimensions[d].sort,this.dimensions[d].fun);for(d=0;d<this.filters.length;d++)c.addFilter(this.filters[d].blogic,this.filters[d].field,this.filters[d].operator,this.filters[d].condition);this.chartType&&(this.cube.chartWidth=this.chartWidth,this.chartHeight&&(this.cube.chartHeight=this.chartHeight),this.cube.chartType=this.chartType,this.cube.loadOlapGraph(c,a))}};OlapCube_Graph.prototype.addMeasure=function(a,b){this.measures[this.measures.length]={name:a,aggregate:b?b:"sum"}};
OlapCube_Graph.prototype.addDimension=function(a,b,c){this.dimensions[this.dimensions.length]={name:a,sort:b,fun:c}};OlapCube_Graph.prototype.addFilter=function(a,b,c,d){this.filters[this.filters.length]={blogic:a,field:b,operator:c,condition:d}};function OlapCube_Table_Tabular(a){this.cube=new OlapCube(a.obj_type,a.customReport,a.datawareCube);this.columns=[];this.filters=[]}
OlapCube_Table_Tabular.prototype.print=function(a,b){"undefined"==typeof b&&(b=!1);if(b){a.innerHTML="";var c=alib.dom.createElement("table",a),d=alib.dom.createElement("tbody",c);this.tbody=d;for(var e=alib.dom.createElement("tr",d),c=0;c<this.columns.length;c++)alib.dom.createElement("th",e,this.columns[c].name);for(c=0;c<this.cube.cubeData.length;c++)for(var e=alib.dom.createElement("tr",d),f=0;f<this.columns.length;f++)alib.dom.createElement("td",e,this.cube.cubeData[c][this.columns[f].name]?
this.cube.cubeData[c][this.columns[f].name]:"")}else{a.innerHTML="Loading....";this.cube.cbData.sumTable=this;this.cube.cbData.con=a;this.cube.onload=function(){this.cbData.sumTable.print(this.cbData.con,!0)};d=new OlapCube_Query;for(c=0;c<this.columns.length;c++)d.addDimension(this.columns[c].name,this.columns[c].sort,this.columns[c].fun);for(c=0;c<this.filters.length;c++)d.addFilter(this.filters[c].blogic,this.filters[c].field,this.filters[c].operator,this.filters[c].condition);this.cube.loadTabularData(d)}};
OlapCube_Table_Tabular.prototype.addColumn=function(a,b,c){this.columns[this.columns.length]={name:a,sort:b,fun:c}};OlapCube_Table_Tabular.prototype.addFilter=function(a,b,c,d){this.filters[this.filters.length]={blogic:a,field:b,operator:c,condition:d}};function OlapCube_Table_Summary(a){this.cube=new OlapCube(a.obj_type,a.customReport,a.datawareCube);this.showTotalRows=!0;this.tbody=null;this.grandTotals=[];this.measures=[];this.rows=[];this.filters=[]}
OlapCube_Table_Summary.prototype.print=function(a,b){"undefined"==typeof b&&(b=!1);if(b){a.innerHTML="";for(var c=[],d=0;d<this.rows.length;d++)c[c.length]=this.rows[d].name;for(var e=[],d=0;d<this.measures.length;d++)e[e.length]=this.measures[d].name;var f=alib.dom.createElement("table",a);this.tbody=f=alib.dom.createElement("tbody",f);f=alib.dom.createElement("tr",f);if(c.length){var g=alib.dom.createElement("th",f);g.setAttribute("colspan",c.length+1);g.innerHTML="&nbsp;"}for(d=0;d<e.length;d++)g=
alib.dom.createElement("th",f),g.innerHTML=e[d];this.populateTableRows(this.cube.cubeData,c,e,0,!1);if(this.showTotalRows){f=alib.dom.createElement("tr",this.tbody);for(c=1;c<e.length;c++)g=alib.dom.createElement("td",f,"&nbsp;");g=alib.dom.createElement("td",f,"Grand Total:");alib.dom.styleSet(g,"text-align","right");for(var h in this.grandTotals)g=alib.dom.createElement("td",f,""+this.grandTotals[h]),alib.dom.styleSet(g,"text-align","right")}}else{a.innerHTML="Loading....";this.cube.cbData.sumTable=
this;this.cube.cbData.con=a;this.cube.onload=function(){this.cbData.sumTable.print(this.cbData.con,!0)};for(var e=new OlapCube_Query,d=0;d<this.measures.length;d++)e.addMeasure(this.measures[d].name,this.measures[d].aggregate);for(d=0;d<this.rows.length;d++)e.addDimension(this.rows[d].name,this.rows[d].sort,this.rows[d].fun);for(d=0;d<this.filters.length;d++)e.addFilter(this.filters[d].blogic,this.filters[d].field,this.filters[d].operator,this.filters[d].condition);this.cube.loadData(e)}};
OlapCube_Table_Summary.prototype.populateTableRows=function(a,b,c,d,e){var f=d>=b.length-1?!0:!1,g=[],h=0,k;for(k in a){e=e?e:alib.dom.createElement("tr",this.tbody);if(0<h&&0<d)for(var l=0;l<d;l++){var m=alib.dom.createElement("td",e);m.innerHTML="&nbsp;"}alib.dom.createElement("td",e).innerHTML=k;if(f)for(l=0;l<c.length;l++)m=alib.dom.createElement("td",e),alib.dom.styleSet(m,"text-align","right"),m.innerHTML=""+a[k][c[l]],g[c[l]]||(g[c[l]]=0),this.grandTotals[c[l]]||(this.grandTotals[c[l]]=0),
g[c[l]]+=parseFloat(a[k][c[l]]),this.grandTotals[c[l]]+=parseFloat(a[k][c[l]]);else this.populateTableRows(a[k],b,c,d+1,e);h++;e=null}if(f&&this.showTotalRows){e=alib.dom.createElement("tr",this.tbody);for(l=0;l<d;l++)alib.dom.createElement("td",e,"&nbsp;");m=alib.dom.createElement("td",e,"Total:");alib.dom.styleSet(m,"text-align","right");for(k in g)m=alib.dom.createElement("td",e,""+g[k]),alib.dom.styleSet(m,"text-align","right")}};
OlapCube_Table_Summary.prototype.addMeasure=function(a,b){this.measures[this.measures.length]={name:a,aggregate:b?b:"sum"}};OlapCube_Table_Summary.prototype.addRow=function(a,b,c){this.rows[this.rows.length]={name:a,sort:b,fun:c}};OlapCube_Table_Summary.prototype.addFilter=function(a,b,c,d){this.filters[this.filters.length]={blogic:a,field:b,operator:c,condition:d}};
function OlapCube_Table_Matrix(a){this.cube=new OlapCube(a.obj_type,a.customReport,a.datawareCube);this.showSubtotals=!0;this.grandTotalsCols=[];this.grandTotalsRows=[];this.dimColChildren=[];this.measures=[];this.rows=[];this.columns=[];this.filters=[]}
OlapCube_Table_Matrix.prototype.print=function(a,b){"undefined"==typeof b&&(b=!1);if(b){a.innerHTML="";for(var c=[],d=0;d<this.rows.length;d++)c[c.length]=this.rows[d].name;for(var e=[],d=0;d<this.columns.length;d++)e[e.length]=this.columns[d].name;for(var f=[],d=0;d<this.measures.length;d++)f[f.length]=this.measures[d].name;a.innerHTML="";var g=alib.dom.createElement("table",a);this.tbody=g=alib.dom.createElement("tbody",g);g=alib.dom.createElement("tr",g);if(c.length){var h=alib.dom.createElement("th",
g);h.setAttribute("colspan",c.length);h.innerHTML="&nbsp;"}for(d=0;d<e.length;d++){var k=this.cube.getDimChildren(e[d]);this.dimColChildren=k;for(var l=0;l<k.length;l++)h=alib.dom.createElement("th",g),h.innerHTML=k[l]}this.populateTableRows(this.cube.cubeData,c,e,f,0,!1);if(this.grandTotalsCols){g=alib.dom.createElement("tr",this.tbody);for(l=1;l<f.length;l++)h=alib.dom.createElement("td",g,"&nbsp;");h=alib.dom.createElement("td",g,"Grand Total:");alib.dom.styleSet(h,"text-align","right");var c=
0,m;for(m in this.grandTotalsCols)h=alib.dom.createElement("td",g,""+this.grandTotalsCols[m]),alib.dom.styleSet(h,"text-align","right"),c+=this.grandTotalsCols[m];this.grandTotalsRows&&(h=alib.dom.createElement("td",g,""+c),alib.dom.styleSet(h,"text-align","right"))}}else{a.innerHTML="Loading....";this.cube.cbData.matTable=this;this.cube.cbData.con=a;this.cube.onload=function(){this.cbData.matTable.print(this.cbData.con,!0)};m=new OlapCube_Query;for(var d=0;d<this.measures.length;d++)m.addMeasure(this.measures[d].name,
this.measures[d].aggregate);for(d=0;d<this.rows.length;d++)m.addDimension(this.rows[d].name,this.rows[d].sort,this.rows[d].fun);for(d=0;d<this.columns.length;d++)m.addDimension(this.columns[d].name,this.columns[d].sort,this.columns[d].fun);for(d=0;d<this.filters.length;d++)m.addFilter(this.filters[d].blogic,this.filters[d].field,this.filters[d].operator,this.filters[d].condition);this.cube.loadData(m)}};
OlapCube_Table_Matrix.prototype.populateTableRows=function(a,b,c,d,e,f){var g=e>=b.length?!0:!1,h=[],k=0,l;for(l in a){f=f?f:alib.dom.createElement("tr",this.tbody);if(0<k&&0<e&&!g)for(var m=0;m<e;m++){var n=alib.dom.createElement("td",f);n.innerHTML="&nbsp;"}alib.dom.createElement("td",f).innerHTML=l;if(e+1>=b.length){for(var o=0,m=0;m<this.dimColChildren.length;m++){var p=this.dimColChildren[m],q=this.getColMeasure(a[l],p,d),n=alib.dom.createElement("td",f);alib.dom.styleSet(n,"text-align","right");
n.innerHTML=""+q;h[p]||(h[p]=0);h[p]+=parseFloat(q);o+=parseFloat(q);this.grandTotalsCols[p]||(this.grandTotalsCols[p]=0);this.grandTotalsCols[p]+=parseFloat(q)}this.grandTotalsRows&&(n=alib.dom.createElement("td",f),alib.dom.styleSet(n,"text-align","right"),n.innerHTML=""+o)}else this.populateTableRows(a[l],b,c,d,e+1,f);k++;f=null}};OlapCube_Table_Matrix.prototype.getColMeasure=function(a,b,c){ret=0;a[b]&&(ret=a[b][c[0]]);return ret};
OlapCube_Table_Matrix.prototype.populateTableCols=function(a,b,c,d,e,f){var g=e>=b.length?!0:!1,h=[],k=0,l;for(l in a){f=f?f:alib.dom.createElement("tr",this.tbody);if(0<k&&0<e)for(var m=0;m<e;m++){var n=alib.dom.createElement("td",f);n.innerHTML="&nbsp;"}alib.dom.createElement("td",f).innerHTML=l;if(g)for(m=0;m<c.length;m++)n=alib.dom.createElement("td",f),alib.dom.styleSet(n,"text-align","right"),n.innerHTML=""+a[l][d[m]],h[d[m]]||(h[d[m]]=0),h[d[m]]+=parseFloat(a[l][d[m]]),this.grandTotalsCols[d[m]]||
(this.grandTotalsCols[d[m]]=0),this.grandTotalsCols[d[m]]+=parseFloat(a[l][d[m]]);else this.populateTableRows(a[l],b,c,d,e+1,f);k++;f=null}if(g&&this.showTotalRows){f=alib.dom.createElement("tr",this.tbody);for(m=0;m<e;m++)alib.dom.createElement("td",f,"&nbsp;");n=alib.dom.createElement("td",f,"Total:");alib.dom.styleSet(n,"text-align","right");for(l in h)n=alib.dom.createElement("td",f,""+h[l]),alib.dom.styleSet(n,"text-align","right")}};
OlapCube_Table_Matrix.prototype.addMeasure=function(a,b){this.measures[this.measures.length]={name:a,aggregate:b?b:"sum"}};OlapCube_Table_Matrix.prototype.addColumn=function(a,b,c){this.columns[this.columns.length]={name:a,sort:b,fun:c}};OlapCube_Table_Matrix.prototype.addRow=function(a,b,c){this.rows[this.rows.length]={name:a,sort:b,fun:c}};OlapCube_Table_Matrix.prototype.addFilter=function(a,b,c,d){this.filters[this.filters.length]={blogic:a,field:b,operator:c,condition:d}};
function AntObjectLoader_Report_Dialog(a){this.parentObject=a;this.loaderCls=this.parentObject.loaderCls;this.bodyFormCon=this.parentObject.bodyFormCon;this.reportType=this.parentObject.reportType;this.objType=this.parentObject.objType;this.cubePath=this.parentObject.cubePath;this.newReportForm={}}AntObjectLoader_Report_Dialog.prototype.print=function(){this.reportObject=new Report(null);this.reportObject.cls=this;this.buildNewReportType()};
AntObjectLoader_Report_Dialog.prototype.buildNewReportType=function(){this.newReportDlg=new CDialog("New Report Type");this.newReportDlg.f_close=!0;var a=alib.dom.createElement("div");a.innerHTML="<div class='loading'></div>";this.newReportDlg.customDialog(a,460);this.reportObject.onload=function(b){this.cls.objectData=b;this.cls.newReportTypeForm(a)};this.reportObject.getObjects();var b=this.newReportDlg.m_titlecon.firstChild;b.cls=this;b.onclick=function(){this.cls.newReportDlg.hide();this.cls.loaderCls.close()}};
AntObjectLoader_Report_Dialog.prototype.newReportTypeForm=function(a){a.innerHTML="";a=alib.dom.createElement("table",a);a=alib.dom.createElement("tbody",a);this.newReportForm.lblHeader=alib.dom.setElementAttr(alib.dom.createElement("div"));this.newReportForm.lblHeader.innerHTML="What kind of report this will be?";var b=[["id","reportObject"],["type","radio"],["name","reportType"],["checked",!0],["inputLabel","Report on an object (like customer, lead, task)"]];this.newReportForm.reportObject=alib.dom.setElementAttr(alib.dom.createElement("input"),
b);this.newReportForm.objectTypes=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","objectTypes"]]);b=[["id","reportDataware"],["type","radio"],["name","reportType"],["inputLabel","Report using Dataware Cube"]];this.newReportForm.reportDataware=alib.dom.setElementAttr(alib.dom.createElement("input"),b);b=[["innerHTML",'Dataware cubes are predefined sets of aggregated data. To see available cubes go to the "Reports" application and browse under "Data Cubes".']];this.newReportForm.lblDataware=
alib.dom.setElementAttr(alib.dom.createElement("div"),b);this.newReportForm.cubePath=alib.dom.setElementAttr(alib.dom.createElement("input"),[["id","cubePath"],["type","text"],["disabled","disabled"]]);this.newReportForm.createReport=(new CButton("Create Report",function(a){a.createReport()},[this],"b1")).getButton();this.loaderCls.buildFormInput(this.newReportForm,a);a=this.newReportForm.cubePath.parentNode;b=alib.dom.setElementAttr(alib.dom.createElement("label"),[["innerHTML","Cube Path "]]);a.insertBefore(b,
a.firstChild);this.newReportForm.reportObject.cls=this;this.newReportForm.reportObject.onclick=function(){this.cls.newReportForm.cubePath.setAttribute("disabled","disabled");this.cls.newReportForm.objectTypes.removeAttribute("disabled")};this.newReportForm.reportDataware.cls=this;this.newReportForm.reportDataware.onclick=function(){this.cls.newReportForm.objectTypes.setAttribute("disabled","disabled");this.cls.newReportForm.cubePath.removeAttribute("disabled")};alib.dom.styleSet(this.newReportForm.lblHeader,
"fontWeight","bold");alib.dom.styleSet(this.newReportForm.objectTypes,"visibility","visible");alib.dom.styleSet(this.newReportForm.objectTypes,"marginLeft","15px");alib.dom.styleSet(this.newReportForm.lblDataware,"marginLeft","15px");alib.dom.styleSet(this.newReportForm.createReport,"float","right");alib.dom.styleSet(b,"marginLeft","15px");alib.dom.styleSet(b,"fontWeight","bold");for(object in this.objectData)a=this.objectData[object],this.newReportForm.objectTypes[this.newReportForm.objectTypes.length]=
new Option(a.fullTitle,a.name);this.newReportDlg.reposition()};
AntObjectLoader_Report_Dialog.prototype.createReport=function(){this.bodyFormCon.innerHTML="<div class='loading'></div>";this.newReportForm.reportDataware.checked?(this.cubePath=this.newReportForm.cubePath.value,this.reportType=REPORT_TYPE_DATAWARE):this.objType=this.newReportForm.objectTypes.value;var a=showDialog("Creating report...");this.reportObject.onsave=function(b){b?(b.error?ALib.statusShowAlert(b.error,3E3,"bottom","right"):(this.cls.newReportDlg.hide(),this.cls.onsave(b),ALib.statusShowAlert("Report successfully created!",
3E3,"bottom","right")),a.hide()):ALib.statusShowAlert("Error occured when saving the report data.",3E3,"bottom","right")};var b=[];b[b.length]=["objType",this.objType];b[b.length]=["reportType",this.reportType];b[b.length]=["cubePath",this.cubePath];this.reportObject.createReport(b)};AntObjectLoader_Report_Dialog.prototype.onsave=function(){};
function AntObjectLoader_Report_Tabular(a){this.parentObject=a;this.reportDimensionData=this.parentObject.reportDimensionData;this.dimensionData=this.parentObject.dimensionData;this.filterData=this.parentObject.filterData;this.sortData=this.parentObject.sortData;this.loaderCls=this.parentObject.loaderCls;this.tableType=this.parentObject.tableType;this.deleteImage=this.parentObject.deleteImage;this.tabularDimensionData=[];this.tabularCount=0;this.savedDataLoaded=!1}
AntObjectLoader_Report_Tabular.prototype.buildTableTabular=function(a){reportTabularObj={};reportTabularObj.lblDimension=alib.dom.setElementAttr(alib.dom.createElement("label"),[["innerHTML","View Fields:"]]);reportTabularObj.dimension=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_name"]]);reportTabularObj.sort=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_sort"]]);this.loaderCls.buildFormInputDiv(reportTabularObj,a,!1,"10px");alib.dom.divClear(a);
var b=alib.dom.createElement("div",a),c=alib.dom.setElementAttr(alib.dom.createElement("a",b),[["innerHTML","Add Dimension"],["href","javascript: void(0)"]]),a=alib.dom.createElement("div",a);alib.dom.styleSet(b,"marginLeft","75px");alib.dom.styleSet(a,"marginLeft","75px");alib.dom.styleSet(reportTabularObj.lblDimension,"fontSize","12px");alib.dom.styleSet(reportTabularObj.lblDimension.parentNode,"marginTop","2px");c.cls=this;c.reportTabularObj=reportTabularObj;c.divTabularDimension=a;c.onclick=function(){this.cls.buildTabularDimension(this.divTabularDimension,
this.cls.tabularCount);this.cls.setDimensionData({id:null,name:this.reportTabularObj.dimension.value,sort:this.reportTabularObj.sort.value},this.cls.tabularCount);this.cls.buildOlapData();this.cls.tabularCount++};this.loaderCls.buildDropdown(reportTabularObj.sort,this.sortData);for(dimension in this.dimensionData)b=this.dimensionData[dimension],reportTabularObj.dimension[reportTabularObj.dimension.length]=new Option(b.name,b.name);for(b=0;b<this.tabularCount;b++)this.buildTabularDimension(a,b);this.savedDataLoaded||
(this.displaySavedDim(a),this.savedDataLoaded=!0);this.tableType==TABLE_TABULAR&&this.buildOlapData()};
AntObjectLoader_Report_Tabular.prototype.buildTabularDimension=function(a,b){var c=!0,d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"marginTop","5px");this.tabularDimensionData[b]?c=!1:this.tabularDimensionData[b]={};var e=this.tabularDimensionData[b];c&&(e.id=null,e.dimension=alib.dom.setElementAttr(alib.dom.createElement("div"),[["id","dimension_name_"+b]]),e.sort=alib.dom.setElementAttr(alib.dom.createElement("div"),[["id","dimension_sort_"+b]]),e.removeDimension=alib.dom.createElement("img"));
this.loaderCls.buildFormInputDiv(e,d,!1,"10px");alib.dom.divClear(d);e.removeDimension.divTabularDimension=a;e.removeDimension.divDimension=d;e.removeDimension.cls=this;e.removeDimension.currentCount=b;e.removeDimension.onclick=function(){this.divTabularDimension.removeChild(this.divDimension);delete this.cls.tabularDimensionData[b];this.cls.buildOlapData()};e.removeDimension.src=this.deleteImage;alib.dom.styleSet(e.removeDimension,"cursor","pointer");alib.dom.styleSet(e.removeDimension,"marginTop",
"3px")};AntObjectLoader_Report_Tabular.prototype.setDimensionData=function(a,b){var c=this.tabularDimensionData[b];c.id=a.id;c.dimension.innerHTML=a.name;c.sort.innerHTML=a.sort};AntObjectLoader_Report_Tabular.prototype.displaySavedDim=function(a){if(this.reportDimensionData.length)for(dimension in this.reportDimensionData){var b=this.reportDimensionData[dimension];b.table_type==TABLE_TABULAR&&(this.buildTabularDimension(a,this.tabularCount),this.setDimensionData(b,this.tabularCount),this.tabularCount++)}};
AntObjectLoader_Report_Tabular.prototype.buildOlapData=function(){var a=this.parentObject.tableResultCon,b=this.parentObject.filterData;if(this.parentObject.finishBuilding){var c=new OlapCube_Table_Tabular(this.parentObject.cube);this.args=[];for(dimension in this.tabularDimensionData){var d=this.tabularDimensionData[dimension];this.args[this.args.length]=["dimensions[]",dimension];this.args[this.args.length]=["dimension_id_"+dimension,d.id];this.args[this.args.length]=["f_column_"+dimension,!1];
this.args[this.args.length]=["f_row_"+dimension,!1];this.args[this.args.length]=["dimension_name_"+dimension,d.dimension.innerHTML];this.args[this.args.length]=["dimension_sort_"+dimension,d.sort.innerHTML];c.addColumn(d.dimension.innerHTML,d.sort.innerHTML)}for(filter in b)d=b[filter],c.addFilter(d.blogic,d.fieldName,d.operator,d.condValue);0<this.args.length&&c.print(a)}};AntObjectLoader_Report_Tabular.prototype.getTableOptions=function(){return this.args};
function AntObjectLoader_Report_Summary(a){this.parentObject=a;this.reportDimensionData=this.parentObject.reportDimensionData;this.reportMeasureData=this.parentObject.reportMeasureData;this.dimensionData=this.parentObject.dimensionData;this.measureData=this.parentObject.measureData;this.aggregateData=this.parentObject.aggregateData;this.sortData=this.parentObject.sortData;this.formatData=this.parentObject.formatData;this.dimTypeData=this.parentObject.dimTypeData;this.loaderCls=this.parentObject.loaderCls;
this.deleteImage=this.parentObject.deleteImage;this.tableType=this.parentObject.tableType;this.reportForm={};this.reportForm.summaryGroup=[];this.reportForm.summarySumm=[];this.summarySummCount=this.summaryGroupCount=0;this.savedDataLoaded=!1}
AntObjectLoader_Report_Summary.prototype.buildTableSummary=function(a){var b={};b.groupBy=alib.dom.setElementAttr(alib.dom.createElement("div"),[["label","Group By:"]]);b.summarizeBy=alib.dom.setElementAttr(alib.dom.createElement("div"),[["label","Summarize By:"]]);this.loaderCls.buildFormInput(b,a);var a=b.groupBy.parentNode,c=b.summarizeBy.parentNode,d=alib.dom.setElementAttr(alib.dom.createElement("a",a),[["href","javascript: void(0);"],["innerHTML","Add Dimension"]]);d.cls=this;d.groupBy=b.groupBy;
d.onclick=function(){this.cls.buildSummaryGroup(this.groupBy,this.cls.summaryGroupCount++);this.cls.buildOlapData()};var e=alib.dom.setElementAttr(alib.dom.createElement("a",c),[["href","javascript: void(0);"],["innerHTML","Add Measure"]]);e.cls=this;e.summarizeBy=b.summarizeBy;e.onclick=function(){this.cls.buildSummarySumm(this.summarizeBy,this.cls.summarySummCount++);this.cls.buildOlapData()};alib.dom.styleSet(d,"fontSize","11px");alib.dom.styleSet(a.previousSibling,"verticalAlign","top");alib.dom.styleSet(a.previousSibling,
"paddingTop","5px");alib.dom.styleSet(e,"fontSize","11px");alib.dom.styleSet(c.previousSibling,"verticalAlign","top");alib.dom.styleSet(c.previousSibling,"paddingTop","5px");for(a=0;a<this.summaryGroupCount;a++)this.buildSummaryGroup(b.groupBy,a);for(a=0;a<this.summarySummCount;a++)this.buildSummarySumm(b.summarizeBy,a);this.savedDataLoaded||(this.displaySavedGroup(b.groupBy),this.displaySavedSummarize(b.summarizeBy),this.savedDataLoaded=!0);this.tableType==TABLE_SUMMARY&&this.buildOlapData()};
AntObjectLoader_Report_Summary.prototype.displaySavedGroup=function(a){if(this.reportDimensionData.length)for(dimension in this.reportDimensionData){var b=this.reportDimensionData[dimension];if(b.table_type==TABLE_SUMMARY){this.buildSummaryGroup(a,this.summaryGroupCount);var c=this.reportForm.summaryGroup[this.summaryGroupCount],d=this.dimTypeData[b.name];this.parentObject.displayFormat(d,c.lblRow,c.format);c.id=b.id;c.dimension.value=b.name;c.dimension.dimType=d;c.sort.value=b.sort;c.format.value=
b.format;this.summaryGroupCount++}}};
AntObjectLoader_Report_Summary.prototype.buildSummaryGroup=function(a,b){var c=!0,d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"marginTop","5px");this.reportForm.summaryGroup[b]?c=!1:this.reportForm.summaryGroup[b]={};var e=this.reportForm.summaryGroup[b];c&&(e.id=null,e.dimension=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_name_"+b]]),e.sort=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_sort_"+b]]),e.lblGroup=alib.dom.setElementAttr(alib.dom.createElement("label"),
[["innerHTML","By"]]),e.format=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_format_"+b]]),e.removeDimension=alib.dom.createElement("img"));this.loaderCls.buildFormInputDiv(e,d,!1,"10px");alib.dom.divClear(d);e.removeDimension.divSummaryGroup=a;e.removeDimension.divSummary=d;e.removeDimension.cls=this;e.removeDimension.currentCount=b;e.removeDimension.onclick=function(){this.divSummaryGroup.removeChild(this.divSummary);delete this.cls.reportForm.summaryGroup[this.currentCount];
this.cls.buildOlapData()};e.dimension.cls=this;e.dimension.lblGroup=e.lblGroup;e.dimension.currentSummaryGroup=e;e.dimension.onchange=function(){this.dimType=this.cls.dimTypeData[this.value];this.cls.parentObject.displayFormat(this.dimType,this.lblGroup,this.currentSummaryGroup.format);this.cls.buildOlapData()};e.sort.cls=this;e.sort.onchange=function(){this.cls.buildOlapData()};e.format.cls=this;e.format.onchange=function(){this.cls.buildOlapData()};e.removeDimension.src=this.deleteImage;alib.dom.styleSet(e.removeDimension,
"cursor","pointer");alib.dom.styleSet(e.removeDimension,"marginTop","3px");if(c){this.loaderCls.buildDropdown(e.sort,this.sortData);this.loaderCls.buildDropdown(e.format,this.formatData);c=null;for(dimension in this.dimensionData){var d=this.dimensionData[dimension],f=e.dimension.length;e.dimension[f]=new Option(d.name,d.name);e.dimension[f].dimType=d.type;null==c&&(c=d.type)}this.parentObject.displayFormat(c,e.lblGroup,e.format)}};
AntObjectLoader_Report_Summary.prototype.displaySavedSummarize=function(a){if(this.reportMeasureData.length)for(measure in this.reportMeasureData){var b=this.reportMeasureData[measure];if(b.table_type==TABLE_SUMMARY){this.buildSummarySumm(a,this.summarySummCount);var c=this.reportForm.summarySumm[this.summarySummCount];c.id=b.id;c.measure.value=b.name;0<b.aggregate.length&&c.aggregate&&(c.aggregate.value=b.aggregate);this.summarySummCount++}}else this.buildSummarySumm(a,this.summarySummCount),this.summarySummCount++};
AntObjectLoader_Report_Summary.prototype.buildSummarySumm=function(a,b){var c=!0,d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"marginTop","5px");this.reportForm.summarySumm[b]?c=!1:this.reportForm.summarySumm[b]={};var e=this.reportForm.summarySumm[b];c&&(e.id=null,e.measure=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","measure_name_"+b]]),0<b&&(e.aggregate=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","measure_aggregate_"+b]]),e.removeMeasure=alib.dom.createElement("img")));
this.loaderCls.buildFormInputDiv(e,d,!1,"10px");alib.dom.divClear(d);e.measure.cls=this;e.measure.onchange=function(){this.cls.buildOlapData()};if(0<b){if(e.aggregate.cls=this,e.aggregate.onchange=function(){this.cls.buildOlapData()},e.removeMeasure.divSummarySumm=a,e.removeMeasure.divSummary=d,e.removeMeasure.cls=this,e.removeMeasure.currentCount=b,e.removeMeasure.onclick=function(){this.divSummarySumm.removeChild(this.divSummary);delete this.cls.reportForm.summarySumm[this.currentCount];this.cls.buildOlapData()},
e.removeMeasure.src=this.deleteImage,alib.dom.styleSet(e.removeMeasure,"cursor","pointer"),alib.dom.styleSet(e.removeMeasure,"marginTop","3px"),c)for(measure in this.loaderCls.buildDropdown(e.aggregate,this.aggregateData),this.measureData)c=this.measureData[measure],e.measure[e.measure.length]=new Option(c.name,c.name)}else c&&this.loaderCls.buildDropdown(e.measure,[MEASURE_COUNT])};
AntObjectLoader_Report_Summary.prototype.buildOlapData=function(){var a=this.parentObject.tableResultCon,b=this.parentObject.filterData;if(this.parentObject.finishBuilding){var c=new OlapCube_Table_Summary(this.parentObject.cube);this.args=[];for(group in this.reportForm.summaryGroup)if(group){var d=this.reportForm.summaryGroup[group];this.args[this.args.length]=["dimensions[]",group];this.args[this.args.length]=["dimension_id_"+group,d.id];this.args[this.args.length]=["f_column_"+group,!1];this.args[this.args.length]=
["f_row_"+group,!1];this.args[this.args.length]=[d.dimension.id,d.dimension.value];this.args[this.args.length]=[d.sort.id,d.sort.value];switch(d.dimension.dimType){case "timestamp":case "date":case "time":c.addRow(d.dimension.value,d.sort.value,d.format.value);this.args[this.args.length]=[d.format.id,d.format.value];break;default:c.addRow(d.dimension.value,d.sort.value)}}for(summarize in this.reportForm.summarySumm)if(summarize){d=this.reportForm.summarySumm[summarize];this.args[this.args.length]=
["measures[]",summarize];this.args[this.args.length]=["measure_id_"+summarize,d.id];this.args[this.args.length]=[d.measure.id,d.measure.value];var e="";d.measure.value!==MEASURE_COUNT&&(e=d.aggregate.value,this.args[this.args.length]=[d.aggregate.id,e]);c.addMeasure(d.measure.value,e)}for(filter in b)d=b[filter],c.addFilter(d.blogic,d.fieldName,d.operator,d.condValue);0<this.args.length&&c.print(a)}};AntObjectLoader_Report_Summary.prototype.getTableOptions=function(){return this.args};
var DIMENSION_COLUMN=0,DIMENSION_ROW=1;
function AntObjectLoader_Report_PivotMatrix(a){this.parentObject=a;this.reportData=this.parentObject.reportData;this.reportDimensionData=this.parentObject.reportDimensionData;this.reportMeasureData=this.parentObject.reportMeasureData;this.dimensionData=this.parentObject.dimensionData;this.measureData=this.parentObject.measureData;this.aggregateData=this.parentObject.aggregateData;this.sortData=this.parentObject.sortData;this.formatData=this.parentObject.formatData;this.dimTypeData=this.parentObject.dimTypeData;
this.loaderCls=this.parentObject.loaderCls;this.deleteImage=this.parentObject.deleteImage;this.tableType=this.parentObject.tableType;this.measureHasCount=this.parentObject.measureHasCount;this.reportForm={};this.reportForm.pivotData={};this.reportForm.pivotColumn=[];this.reportForm.pivotRow=[];this.pivotRowCount=this.pivotColumnCount=0;this.savedDataLoaded=!1}
AntObjectLoader_Report_PivotMatrix.prototype.buildTablePivot=function(a){var b=null,c=null,d=null;0<this.reportMeasureData.length&&this.reportMeasureData[0].table_type==TABLE_PIVOT&&(b=this.reportMeasureData[0].id,c=this.reportMeasureData[0].name,d=this.reportMeasureData[0].aggregate);this.reportForm.pivotData.id=b;this.reportForm.pivotData.showTotal=alib.dom.setElementAttr(alib.dom.createElement("div"),[["label","Show Totals: &nbsp;"]]);this.reportForm.pivotData.column=alib.dom.setElementAttr(alib.dom.createElement("div"),
[["label","Columns:"]]);this.reportForm.pivotData.row=alib.dom.setElementAttr(alib.dom.createElement("div"),[["label","Rows:"]]);this.reportForm.pivotData.measure=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","measure_name_"],["label","Data:"]]);this.loaderCls.buildFormInput(this.reportForm.pivotData,a);a=this.reportForm.pivotData.column.parentNode;b=this.reportForm.pivotData.row.parentNode;this.reportForm.pivotTotals={};var e=[["type","checkbox"],["id","f_row_totals"],["label",
"Row Totals"],["checked","f"==this.reportData.f_row_totals?!1:!0]];this.reportForm.pivotTotals.row=alib.dom.setElementAttr(alib.dom.createElement("input"),e);e=[["type","checkbox"],["id","f_column_totals"],["label","Column Totals"],["checked","f"==this.reportData.f_column_totals?!1:!0]];this.reportForm.pivotTotals.column=alib.dom.setElementAttr(alib.dom.createElement("input"),e);e=[["type","checkbox"],["id","f_sub_totals"],["label","Subtotals"],["checked","f"==this.reportData.f_sub_totals?!1:!0]];
this.reportForm.pivotTotals.sub=alib.dom.setElementAttr(alib.dom.createElement("input"),e);this.loaderCls.buildFormInputDiv(this.reportForm.pivotTotals,this.reportForm.pivotData.showTotal,!1,"15px");var e=alib.dom.setElementAttr(alib.dom.createElement("a",a),[["href","javascript: void(0);"],["innerHTML","Add Column Dimension"]]),f=alib.dom.setElementAttr(alib.dom.createElement("a",b),[["href","javascript: void(0);"],["innerHTML","Add Row Dimension"]]);this.reportForm.pivotData.aggregate=alib.dom.setElementAttr(alib.dom.createElement("select",
this.reportForm.pivotData.measure.parentNode),[["id","measure_aggregate_"]]);this.reportForm.pivotTotals.sub.cls=this;this.reportForm.pivotTotals.sub.onchange=function(){this.cls.buildOlapData()};e.cls=this;e.column=this.reportForm.pivotData.column;e.onclick=function(){this.cls.buildPivotColumn(this.column,this.cls.pivotColumnCount++);this.cls.buildOlapData()};f.cls=this;f.row=this.reportForm.pivotData.row;f.onclick=function(){this.cls.buildPivotRow(this.row,this.cls.pivotRowCount++);this.cls.buildOlapData()};
this.reportForm.pivotData.measure.cls=this;this.reportForm.pivotData.measure.onchange=function(){"count"==this.value?alib.dom.styleSet(this.cls.reportForm.pivotData.aggregate,"display","none"):alib.dom.styleSet(this.cls.reportForm.pivotData.aggregate,"display","inline-block");this.cls.buildOlapData()};this.reportForm.pivotData.aggregate.cls=this;this.reportForm.pivotData.aggregate.onchange=function(){this.cls.buildOlapData()};this.measureHasCount||this.loaderCls.buildDropdown(this.reportForm.pivotData.measure,
[MEASURE_COUNT],c);this.loaderCls.buildDropdown(this.reportForm.pivotData.aggregate,this.aggregateData,d);for(measure in this.measureData){var d=this.measureData[measure],g=this.reportForm.pivotData.measure.length,h=!1;c==d.name&&(h=!0);this.reportForm.pivotData.measure[g]=new Option(d.name,d.name,!1,h)}alib.dom.styleSet(this.reportForm.pivotData.showTotal,"marginTop","2px");alib.dom.styleSet(this.reportForm.pivotData.aggregate,"marginLeft","10px");alib.dom.styleSet(e,"fontSize","11px");alib.dom.styleSet(a.previousSibling,
"verticalAlign","top");alib.dom.styleSet(a.previousSibling,"paddingTop","5px");alib.dom.styleSet(f,"fontSize","11px");alib.dom.styleSet(b.previousSibling,"verticalAlign","top");alib.dom.styleSet(b.previousSibling,"paddingTop","5px");(c==MEASURE_COUNT||null==c)&&alib.dom.styleSet(this.reportForm.pivotData.aggregate,"display","none");for(c=0;c<this.pivotColumnCount;c++)this.buildPivotColumn(this.reportForm.pivotData.column,c);for(c=0;c<this.pivotRowCount;c++)this.buildPivotRow(this.reportForm.pivotData.row,
c);this.savedDataLoaded||(this.displaySavedDims(),this.savedDataLoaded=!0);this.tableType==TABLE_PIVOT&&this.buildOlapData()};
AntObjectLoader_Report_PivotMatrix.prototype.displaySavedDims=function(){if(this.reportDimensionData.length)for(dimension in this.reportDimensionData){var a=this.reportDimensionData[dimension];a.table_type==TABLE_PIVOT&&("t"==a.f_column?(this.buildPivotColumn(this.reportForm.pivotData.column,this.pivotColumnCount),this.setDimValues(this.reportForm.pivotColumn[this.pivotColumnCount],a),this.pivotColumnCount++):"t"==a.f_row&&(this.buildPivotRow(this.reportForm.pivotData.row,this.pivotRowCount),this.setDimValues(this.reportForm.pivotRow[this.pivotRowCount],
a),this.pivotRowCount++))}};AntObjectLoader_Report_PivotMatrix.prototype.setDimValues=function(a,b){var c=this.dimTypeData[b.name];this.parentObject.displayFormat(c,a.lblRow,a.format);a.id=b.id;a.dimension.value=b.name;a.dimension.dimType=c;a.sort.value=b.sort;a.format.value=b.format};
AntObjectLoader_Report_PivotMatrix.prototype.buildPivotColumn=function(a,b){var c=!0,d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"marginTop","5px");this.reportForm.pivotColumn[b]?c=!1:this.reportForm.pivotColumn[b]={};var e=this.reportForm.pivotColumn[b];c&&(e.id=null,e.dimension=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_name_"+b+DIMENSION_COLUMN]]),e.sort=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_sort_"+b+DIMENSION_COLUMN]]),
e.lblColumn=alib.dom.setElementAttr(alib.dom.createElement("label"),[["innerHTML","By"]]),e.format=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_format_"+b+DIMENSION_COLUMN]]),e.removeColumn=alib.dom.createElement("img"));this.loaderCls.buildFormInputDiv(e,d,!1,"10px");alib.dom.divClear(d);e.removeColumn.divPivotColumn=a;e.removeColumn.divPivot=d;e.removeColumn.cls=this;e.removeColumn.currentCount=b;e.removeColumn.onclick=function(){this.divPivotColumn.removeChild(this.divPivot);
delete this.cls.reportForm.pivotColumn[this.currentCount];this.cls.buildOlapData()};e.dimension.cls=this;e.dimension.lblColumn=e.lblColumn;e.dimension.currentPivotColumn=e;e.dimension.onchange=function(){this.dimType=this.cls.dimTypeData[this.value];this.cls.parentObject.displayFormat(this.dimType,this.lblColumn,this.currentPivotColumn.format);this.cls.buildOlapData()};e.sort.cls=this;e.sort.onchange=function(){this.cls.buildOlapData()};e.format.cls=this;e.format.onchange=function(){this.cls.buildOlapData()};
e.removeColumn.src=this.deleteImage;alib.dom.styleSet(e.removeColumn,"cursor","pointer");alib.dom.styleSet(e.removeColumn,"marginTop","3px");if(c){this.loaderCls.buildDropdown(e.sort,this.sortData);this.loaderCls.buildDropdown(e.format,this.formatData);c=null;for(dimension in this.dimensionData){var d=this.dimensionData[dimension],f=e.dimension.length;switch(d.type){default:e.dimension[f]=new Option(d.name,d.name),e.dimension[f].dimType=d.type,null==c&&(c=d.type)}}this.parentObject.displayFormat(c,
e.lblColumn,e.format);b++}};
AntObjectLoader_Report_PivotMatrix.prototype.buildPivotRow=function(a,b){var c=!0,d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"marginTop","5px");this.reportForm.pivotRow[b]?c=!1:this.reportForm.pivotRow[b]={};var e=this.reportForm.pivotRow[b];c&&(e.id=null,e.dimension=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_name_"+b+DIMENSION_ROW]]),e.sort=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_sort_"+b+DIMENSION_ROW]]),e.lblRow=alib.dom.setElementAttr(alib.dom.createElement("label"),
[["innerHTML","By"]]),e.format=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","dimension_format_"+b+DIMENSION_ROW]]),e.removeRow=alib.dom.createElement("img"));this.loaderCls.buildFormInputDiv(e,d,!1,"10px");alib.dom.divClear(d);e.removeRow.divPivotRow=a;e.removeRow.divPivot=d;e.removeRow.cls=this;e.removeRow.pivotRowCount=b;e.removeRow.onclick=function(){this.divPivotRow.removeChild(this.divPivot);delete this.cls.reportForm.pivotRow[this.currentCount];this.cls.buildOlapData()};e.dimension.cls=
this;e.dimension.lblRow=e.lblRow;e.dimension.currentPivotRow=e;e.dimension.onchange=function(){this.dimType=this.cls.dimTypeData[this.value];this.cls.parentObject.displayFormat(this.dimType,this.lblRow,this.currentPivotRow.format);this.cls.buildOlapData()};e.sort.cls=this;e.sort.onchange=function(){this.cls.buildOlapData()};e.format.cls=this;e.format.onchange=function(){this.cls.buildOlapData()};e.removeRow.src=this.deleteImage;alib.dom.styleSet(e.removeRow,"cursor","pointer");alib.dom.styleSet(e.removeRow,
"marginTop","3px");if(c){this.loaderCls.buildDropdown(e.sort,this.sortData);this.loaderCls.buildDropdown(e.format,this.formatData);c=null;for(dimension in this.dimensionData){var d=this.dimensionData[dimension],f=e.dimension.length;switch(d.type){default:e.dimension[f]=new Option(d.name,d.name),e.dimension[f].dimType=d.type,null==c&&(c=d.type)}}this.parentObject.displayFormat(c,e.lblRow,e.format);b++}};
AntObjectLoader_Report_PivotMatrix.prototype.buildOlapData=function(){var a=this.parentObject.tableResultCon,b=this.parentObject.filterData;if(this.parentObject.finishBuilding){var c=new OlapCube_Table_Matrix(this.parentObject.cube);c.showSubtotals=this.reportForm.pivotTotals.sub.checked;this.args=[];for(column in this.reportForm.pivotColumn)if(column){var d=this.reportForm.pivotColumn[column];this.buildDimensionArg(column,d,DIMENSION_COLUMN);switch(d.dimension.dimType){case "timestamp":case "date":case "time":c.addColumn(d.dimension.value,
d.sort.value,d.format.value);this.args[this.args.length]=[d.format.id,d.format.value];break;default:c.addColumn(d.dimension.value,d.sort.value)}}for(row in this.reportForm.pivotRow)if(row)switch(d=this.reportForm.pivotRow[row],this.buildDimensionArg(row,d,DIMENSION_ROW),d.dimension.dimType){case "timestamp":case "date":case "time":c.addRow(d.dimension.value,d.sort.value,d.format.value);this.args[this.args.length]=[d.format.id,d.format.value];break;default:c.addRow(d.dimension.value,d.sort.value)}d=
this.reportForm.pivotData.aggregate.value;this.reportForm.pivotData.measure.value==MEASURE_COUNT&&(d="");c.addMeasure(this.reportForm.pivotData.measure.value,d);this.args[this.args.length]=["measures[]",0];this.args[this.args.length]=["measure_id_0",this.reportForm.pivotData.id];this.args[this.args.length]=[this.reportForm.pivotData.measure.id+0,this.reportForm.pivotData.measure.value];this.args[this.args.length]=[this.reportForm.pivotData.aggregate.id+0,d];for(filter in b)d=b[filter],c.addFilter(d.blogic,
d.fieldName,d.operator,d.condValue);0<this.args.length&&c.print(a)}};
AntObjectLoader_Report_PivotMatrix.prototype.buildDimensionArg=function(a,b,c){this.args[this.args.length]=["dimensions[]",a+c];this.args[this.args.length]=["dimension_id_"+a+c,b.id];this.args[this.args.length]=[b.dimension.id,b.dimension.value];this.args[this.args.length]=[b.sort.id,b.sort.value];this.args[this.args.length]=["f_column_"+a+c,c==DIMENSION_COLUMN?!0:!1];this.args[this.args.length]=["f_row_"+a+c,c==DIMENSION_ROW?!0:!1]};AntObjectLoader_Report_PivotMatrix.prototype.getReportForm=function(){return this.reportForm};
AntObjectLoader_Report_PivotMatrix.prototype.getTableOptions=function(){return this.args};
function CAntObject_User(a){a.userId=a.id;a.teamId=null;a.teamDropdown=null;a.onteamsloaded=function(){};a.loadTeam=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onteamsloaded(a)};ajax.exec("/controller/User/getTeams")};a.populateTeam=function(a,c){if(null==c){var d=a[0].id;if(0<d)this.addTeamOption(d,a[0]),delete a[0],this.populateTeam(a,d);else return}for(team in a){var e=a[team];e.parentId==c&&(d=e.id,this.addTeamOption(d,e),delete a[d],this.populateTeam(a,
d))}};a.addTeamOption=function(a,c){if(0<a){var d=!1;a==this.teamId&&(d=!0);var e=this.teamDropdown.length;this.teamDropdown[e]=new Option(c.name,a,!1,d);this.teamDropdown[e].parentId=c.parentId}};a.addSpacedPrefix=function(){var a=[],c=0;for(option in this.teamDropdown)if(0<option){var d=this.teamDropdown[option];if(null!==d.parentId){var e=0;if(a[d.parentId]){var f=this.teamDropdown[option-1],e=a[d.parentId];f.parentId!==d.parentId&&(c-=1)}else c+=1,a[d.parentId]=e=c;for(var f="",g=0;g<e;g++)f+=
"\u00a0\u00a0\u00a0";d.text=f+d.text}}}}function AntApp(a){this.name=a;this.shortTitle=this.title="Untitled";this.currentDashBoard=this.currentObjectBrowser=this.calendarBrowser=this.defaultViewName=this.xmlDef=this.view=null;this.clientMode="desktop";this.refObjects=[];this.refCalendars=[];this.hidenav="f";this.myCalendarView=null;this.isNewWin=!1;this.runningProcesses=[];this.navBar=null;this.navBarSections=[];this.cbData={};this.tour=this.settings=""}
AntApp.prototype.main=function(a){this.view=a;this.loadAppDef()};AntApp.prototype.setLoading=function(a){for(var b=!1,c=0;c<this.runningProcesses.length;c++)this.runningProcesses[c]==a&&(b=!0);b||(this.runningProcesses[this.runningProcesses.length]=a)};AntApp.prototype.setFinishedLoading=function(a){for(var b=0;b<this.runningProcesses.length;b++)this.runningProcesses[b]==a&&this.runningProcesses.splice(b,1);0==this.runningProcesses.length&&this.loaded()};
AntApp.prototype.loaded=function(a){if(!1==("undefined"!=typeof a?a:!1))"desktop"==this.clientMode&&this.defaultViewName&&this.view.setDefaultView(this.defaultViewName),this.view.setViewsLoaded(),this.resize();this.onload();"undefined"!=typeof Ant&&Ant.updateAppTitle()};AntApp.prototype.onload=function(){};
AntApp.prototype.loadAppDef=function(a){var b="undefined"!=typeof a?a:!1;this.view.con.innerHTML="<div class='loading'></div>";a=new CAjax;a.appObj=this;a.cbData.noint=b;a.onload=function(a){this.appObj.view.con.innerHTML="";this.appObj.xmlDef=a;this.appObj.title=unescape(a.getAttribute("title"));this.appObj.shortTitle=unescape(a.getAttribute("short_title"));this.appObj.name=unescape(a.getAttribute("name"));this.appObj.scope=unescape(a.getAttribute("scope"));this.appObj.isSystem=unescape(a.getAttribute("isSystem"));
this.appObj.userId=unescape(a.getAttribute("userId"));this.appObj.teamId=unescape(a.getAttribute("teamId"));this.appObj.settings=unescape(a.getAttribute("settings"));this.appObj.tour=unescape(a.getAttribute("tour"));var d=a.getChildNodeByName("navigation");d&&(this.appObj.defaultViewName=unescape(d.getAttribute("default")));this.appObj.hidenav=unescape(d.getAttribute("hidenav"));var e=a.getChildNodeByName("objects");if(e)for(d=0;d<e.getNumChildren();d++){var f=e.getChildNode(d);this.appObj.refObjects[this.appObj.refObjects.length]=
{name:unescape(f.getAttribute("name")),title:unescape(f.getAttribute("title")),fSystem:"t"==f.getAttribute("system")?!0:!1}}if(a=a.getChildNodeByName("calendars"))for(d=0;d<a.getNumChildren();d++)e=a.getChildNode(d),this.appObj.refCalendars[this.appObj.refCalendars.length]={id:e.getAttribute("id"),name:unescape(e.getAttribute("name"))};this.cbData.noint?this.appObj.loaded(b):this.appObj.buildInterface()};a.exec("/applications/xml_getappdef.php?app="+this.name)};AntApp.prototype.onload=function(){};
AntApp.prototype.buildInterface=function(){this.view.title=this.shortTitle;switch(this.clientMode){case "mobile":this.buildInterfaceMobile();break;default:this.buildInterfaceDesktop()}};
AntApp.prototype.buildInterfaceMobile=function(){this.setLoading("main_mobile_navigation");this.view.bindOnViewLoad(function(a,c){a.cls.setMobileApplicationTitle(c)},{cls:this});this.view.setViewsToggle(!0);this.appOuter=this.view.con;this.appTitle=null;this.appNav=alib.dom.createElement("div",this.appOuter);this.appMain=null;var a=this.xmlDef.getChildNodeByName("navigation");a&&this.buildMobileNavigation(a);this.setFinishedLoading("main_mobile_navigation")};
AntApp.prototype.buildMobileNavigation=function(a,b){for(var c=0;c<a.getNumChildren();c++){var d=a.getChildNode(c);switch(d.m_name){case "section":var e=alib.dom.createElement("article",this.appNav);alib.dom.styleSetClass(e,"nav");e.innerHTML="<a><h2 class='navSecTitle'>"+d.getAttribute("title")+"</h2></a>";this.buildMobileNavigation(d,this.appNav);break;case "item":this.addNavMobileItem(b,d)}}};
AntApp.prototype.buildInterfaceDesktop=function(){this.setLoading("main_desktop_navigation");this.view.setViewsToggle(!0);this.titleCon=alib.dom.createElement("div",this.view.con);alib.dom.styleSetClass(this.titleCon,"apptitle");this.view.bindOnViewLoad(function(a,b){a.cls.setDesktopeApplicationTitle(b);a.cls.setDesktopNavPathSate(b)},{cls:this});var a=alib.dom.createElement("div",this.titleCon);alib.dom.styleSet(a,"float","right");alib.dom.createElement("h1",this.titleCon).innerHTML=this.title;this.view.onchange=
function(){};var b=alib.dom.createElement("div",this.view.con);alib.dom.styleSetClass(b,"appInstNav");this.appMain=alib.dom.createElement("div",this.view.con);alib.dom.styleSetClass(this.appMain,"appInstBody");"t"==this.hidenav?alib.dom.styleSet(b,"display","none"):alib.dom.styleAddClass(this.appMain,"appInstBodyFloat");var c=new CNavBar,d=this.xmlDef.getChildNodeByName("navigation");d.getChildNodeByName("section").getChildNodeByName("item");c.print(b);(d=this.xmlDef.getChildNodeByName("navigation"))&&
this.buildDesktopNavigation(d,c);this.setFinishedLoading("main_desktop_navigation");this.navBar=c;c=this.view.addView("settings",{},this.appMain);c.options.app=this;c.options.settings=this.settings;c.render=function(){this.con.innerHTML="";if(this.options.settings)this.options.settings&&(this.con.innerHTML="",this.options.app.loadPlugin(this.options.settings,this));else{var a=new AntAppSettings(this.options.app);a.cbData.antView=this;a.onclose=function(){this.cbData.antView.goup()};a.print(this.con)}};
c=alib.ui.Button("<img src='/images/icons/settings_16.png' />",{className:"b1",tooltip:"View settings for this application",view:this.view,onclick:function(){this.view.navigate("settings")}});"none"!=this.settings&&c.print(a);this.isNewWin||(c=alib.ui.Button("<img src='/images/icons/new_window_16.png' />",{className:"b1",tooltip:"Open this application to new window",onclick:function(){var a=document.location.hash,b=a.split("/");window.open("http://"+window.location.host+"/app.php?app="+b[0].substring(1)+
a)}}),c.print(a));this.tour&&(a=alib.dom.createElement("div",b,"<div data-tour='"+this.tour+"' data-tour-type='dialog'></div>"),alib.dom.styleSet(a,"display","none"),Ant.HelpTour.loadTours(a))};
AntApp.prototype.buildDesktopNavigation=function(a,b,c){for(var d=0;d<a.getNumChildren();d++){var e=a.getChildNode(d);switch(e.m_name){case "section":c=b.addSection(unescape(e.getAttribute("title")));this.buildDesktopNavigation(e,b,c);this.navBarSections[this.navBarSections.length]=c;break;case "item":this.addNavDesktopItem(c,e,b)}}};
AntApp.prototype.addNavDesktopItem=function(a,b,c){var d=unescape(b.getAttribute("name")),e=unescape(b.getAttribute("icon")),f=unescape(b.getAttribute("title")),g=unescape(b.getAttribute("type"));f||(f=d);if(!d)return!1;switch(g){case "dashboard":a=a.addItem(f,e,function(a,b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c},this.appMain);c.options.dashboard=this.name+"."+d;c.render=function(){var a=new CAjax("json");a.cbData.con=this.con;a.cbData.view=this;a.onload=function(a){a=new AntObjectLoader("dashboard",
a);a.fEnableClose=!1;a.setAntView(this.cbData.view);a.print(this.cbData.con)};a.exec("/controller/Dashboard/loadAppDashForUser",[["dashboard_name",this.options.dashboard]])};break;case "dashboards":c=new CAjax("json");c.cbData.sec=a;c.cbData.view=this.view;c.cbData.name=d;c.cbData.appCls=this;c.onload=function(a){for(i in a)this.cbData.sec.addItem(a[i].name,"/images/icons/objects/dashboard_16.png",function(a,b){a.navigate(b)},[this.cbData.view,a[i].uname],a[i].uname),this.cbData.view.addView(a[i].uname,
{dbid:a[i].id},this.cbData.appCls.appMain).render=function(){var a=new AntObjectLoader("dashboard",this.options.dbid);a.setAntView(this);a.fEnableClose=!1;a.print(this.con)}};c.exec("/controller/Dashboard/loadDashboards");break;case "link":c=unescape(b.getAttribute("url"));a.addItem(f,e,function(a){window.open(a)},[c,d],-1);break;case "browse":a=a.addItem(f,e,function(a,b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c},this.appMain);c.options.type=b.getAttribute("obj_type");c.options.preview=
b.getAttribute("preview");c.options.childNode=b;c.options.appCls=this;c.render=function(){var a=new AntObjectBrowser(this.options.type);a.setAntView(this);"t"==this.options.preview&&(a.preview=!0);var b=this.options.childNode.getChildNodeByName("filter");if(b)for(var c=0;c<b.getNumChildren();c++){var d=b.getChildNode(c);d.getAttribute("blogic");var e=d.getAttribute("field");d.getAttribute("operator");d=d.getAttribute("value");a.setFilter(e,d)}if("activity"==this.options.type)for(c=0;c<this.options.appCls.refObjects.length;c++)a.addCondition(0<
c?"or":"and","type_id","is_equal",this.options.appCls.refObjects[c].title);a.print(this.con);this.options.browser=a};c.onshow=function(){this.options.appCls.currentObjectBrowser=this.options.browser};c.onhide=function(){this.options.appCls.currentObjectBrowser=null};if(d=b.getAttribute("browseby"))b=new alib.ui.PopupMenu,e=new alib.ui.MenuItem("Add New Subgroup",{icon:"<img src='/images/icons/add_10.png' />"}),e.cbData.cls=this,e.cbData.obj_type=c.options.type,e.cbData.filterField=d,e.cbData.secItem=
a,e.onclick=function(){this.cbData.cls.addGrouping(this.cbData.obj_type,this.cbData.filterField,"",this.cbData.secItem,!0)},b.addItem(e),e=a.getOptionCon(),e=alib.dom.createElement("img",e),e.src="/images/icons/rightclick_off.gif",b.attach(e),b={},b.obj_type=c.options.type,this.getGroupings(b,d,a);break;case "folder":a=a.addItem(f,e,function(a,b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c},this.appMain);c.options.path=b.getAttribute("path");c.render=function(){this.con.innerHTML=
"";var a=new AntObjectBrowser("file");a.setBrowseBy("folder_id",this.options.path);a.setAntView(this);a.print(this.con)};break;case "object_newwin":a.addItem(f,e,function(a){loadObjectForm(a)},[b.getAttribute("obj_type")],-1);break;case "object":a.addItem(f,e,function(a,b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c,appcls:this},this.appMain);c.options.type=b.getAttribute("obj_type");c.render=function(){};c.onshow=function(){this.con.innerHTML="";var a=new AntObjectLoader(this.options.type);
a.setAntView(this);a.print(this.con);a.cbData.antView=this;a.cbData.appcls=this.options.appcls;a.onClose=function(){this.cbData.antView.goup()};a.onRemove=function(){};a.onSave=function(){alib.events.triggerEvent(this.cbData.appcls,"objectsaved",{oid:this.oid,objType:this.objType,name:this.mainObject.getName()})}};break;case "settings":a.addItem(f,e,function(a,b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c},this.appMain);c.options.app=this;c.render=function(){this.con.innerHTML="";
var a=new AntAppSettings(this.options.app);a.cbData.antView=this;a.onclose=function(){this.cbData.antView.goup()};a.print(this.con)};c.onshow=function(){};break;case "plugin":a.addItem(f,e,function(a,b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c},this.appMain);c.options.app=this;c.options.plugin=b.getAttribute("class");c.render=function(){this.con.innerHTML="";this.options.app.loadPlugin(this.options.plugin,this)};c.onshow=function(){};break;case "calendar":a.addItem(f,e,function(a,
b){a.navigate(b)},[this.view,d],d);c=this.view.addView(d,{nb:c},this.appMain);c.options.app=this;c.options.calendar_id=b.getAttribute("id");c.render=function(){this.con.innerHTML="";var a=alib.dom.createElement("div",this.con);this.options.cls.calendarBrowser=new AntCalendarBrowse(this.options.cls);this.options.cls.calendarBrowse.setAntView(a);this.options.cls.calendarBrowse.print(this)};c.onshow=function(){};break;case "myminical":null==this.myCalendarView&&(this.myCalendarView=this.view.addView("mycalendar",
{},this.appMain),this.myCalendarView.options.cls=this,this.myCalendarView.options.nav=c,this.myCalendarView.render=function(){this.con.innerHTML="";var a=alib.dom.createElement("div",this.con);this.options.cls.calendarBrowser=new AntCalendarBrowse(this.options.cls);this.options.cls.calendarBrowser.setAntView(this);this.options.cls.calendarBrowser.print(a)},this.myCalendarView.onshow=function(){});this.cal_con=a.addCon();this.calNav();break;case "mycalendars":c=new CAjax("json");c.cls=this;c.sec=a;
c.onload=function(a){for(calendar in a.myCalendars)this.cls.insertCalendar(this.sec,a.myCalendars[calendar]);this.cls.resize()};c.exec("/controller/Calendar/getCalendars");alib.events.listen(this,"objectsaved",function(a){"calendar"==a.data.objType&&a.data.appcls.insertCalendar(a.data.nbsection,{id:a.data.oid,name:a.data.name,f_view:"t"})},{appcls:this,nbsection:a});break;case "myothercals":c=new CAjax("json");c.cls=this;c.sec=a;c.onload=function(a){for(calendar in a.otherCalendars)this.cls.insertCalendar(this.sec,
a.otherCalendars[calendar]);this.cls.resize()};c.exec("/controller/Calendar/getCalendars");break;case "myminiprofile":"undefined"!=typeof Ant&&(d=alib.dom.createElement("div",a.addCon()),alib.dom.styleSet(d,"margin","10px 0px 0px 3px"),a=alib.dom.createElement("div",d),alib.dom.styleSet(a,"width","48px"),alib.dom.styleSet(a,"height","48px"),alib.dom.styleSet(a,"float","left"),a.innerHTML="<img src='/files/userimages/current/48/48' style='width:48px;' />",d=alib.dom.createElement("div",d),alib.dom.styleSet(d,
"margin-left","58px"),alib.dom.styleSet(d,"padding-top","15px"),alib.dom.styleSet(d,"height","33px"),d.innerHTML="<a href='#settings' class='boldLink'>"+Ant.user.fullName+"</a>");break;case "recentobjects":c=new CAjax("json");c.cbData.sec=a;c.onload=function(a){for(i in a)this.cbData.sec.addItem(a[i].name,a[i].icon?a[i].icon:"/images/icons/objects/generic_16.png",function(a,b){loadObjectForm(a,b)},[a[i].obj_type,a[i].id],-1)};c.exec("/controller/Object/getRecent");break;case "wizard":a.addItem(f,
e,function(a){(new AntWizard(a)).show()},[b.getAttribute("wiz_type")],-1);break;default:a.addItem(f,"/images/icons/plus.png",function(){},[],-1)}};
AntApp.prototype.addNavMobileItem=function(a,b){var c=b.getAttribute("name"),d=b.getAttribute("icon"),e=unescape(b.getAttribute("title")),f=b.getAttribute("type");e||(e=c);if(!c)return!1;var g=alib.dom.createElement("article",a);alib.dom.styleSetClass(g,"nav");switch(f){case "link":c=b.getAttribute("url");g.innerHTML="<a target='_blank' href=\""+c+"\"><span class='icon'><img src='"+d+"' /></span><h2><span class='more'></span>"+e+"</h2></a>";break;case "browse":g.innerHTML="<a behavior='selectable' href=\"#"+
this.view.getPath()+"/"+c+"\" onclick=\"alib.dom.styleAddClass(this, 'selected');\"><span class='icon'><img src='"+d+"' /></span><h2><span class='more'></span>"+e+"</h2></a>";g.view=this.view;g.name=c;d=this.view.addView(c,{});d.options.type=b.getAttribute("obj_type");d.options.childNode=b;d.options.appCls=this;d.render=function(){var a=new AntObjectBrowser(this.options.type);a.mobile=!0;a.setAntView(this);var b=this.options.childNode.getChildNodeByName("filter");if(b)for(var c=0;c<b.getNumChildren();c++){var d=
b.getChildNode(c);d.getAttribute("blogic");var e=d.getAttribute("field");d.getAttribute("operator");d=d.getAttribute("value");a.setFilter(e,d)}a.print(this.con)};d.onshow=function(){this.options.appCls.currentObjectBrowser=this.options.browser};d.onhide=function(){this.options.appCls.currentObjectBrowser=null};if(e=b.getAttribute("browseby"))g={},g.obj_type=d.options.type,this.getGroupings(g,e,null,a);break;case "object":g.innerHTML="<a behavior='selectable' href=\"#"+this.view.getPath()+"/"+c+"\" onclick=\"alib.dom.styleAddClass(this, 'selected');\"><span class='icon'><img src='"+
d+"' /></span><h2><span class='more'></span>"+e+"</h2></a>";d=this.view.addView(c,{});d.options.type=b.getAttribute("obj_type");d.render=function(){};d.onshow=function(){this.con.innerHTML="";var a=new AntObjectLoader(this.options.type);a.print(this.con);a.curView=this;a.onClose=function(){};a.onRemove=function(){}};break;case "folder":g.innerHTML="<a behavior='selectable' href=\"#"+this.view.getPath()+"/"+c+"\" onclick=\"alib.dom.styleAddClass(this, 'selected');\"><span class='icon'><img src='"+
d+"' /></span><h2><span class='more'></span>"+e+"</h2></a>",d=this.view.addView(c,{}),d.options.path=b.getAttribute("path"),d.render=function(){},d.onshow=function(){this.con.innerHTML="";var a=new AntObjectBrowser("file");a.optForceFullRefresh=!0;a.setBrowseBy("folder_id",this.options.path);a.setAntView(this);a.print(this.con)}}};
AntApp.prototype.getGroupings=function(a,b,c,d){this.setLoading("get_grouping__"+a.obj_type+"_"+b);ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.parentNavItem=c?c:null;ajax.cbData.secDiv=d?d:null;ajax.cbData.grpdata=a;ajax.cbData.field_name=b;ajax.onload=function(a){a.length&&("mobile"==this.cbData.cls.clientMode?this.cbData.cls.addGroupingsMobile(this.cbData.grpdata.obj_type,this.cbData.field_name,a,this.cbData.secDiv):(this.cbData.cls.addGroupings(this.cbData.grpdata.obj_type,this.cbData.field_name,
a,this.cbData.parentNavItem),this.cbData.parentNavItem.expand()));this.cbData.cls.setFinishedLoading("get_grouping__"+this.cbData.grpdata.obj_type+"_"+this.cbData.field_name)};ajax.exec("/controller/Object/getGroupings",[["obj_type",a.obj_type],["field",b]])};
AntApp.prototype.addGroupings=function(a,b,c,d,e,f){e||(e=0);for(var g=0;g<c.length;g++){var h=c[g],k=h.id,l=h.title,m=h.color,n=h.system,o=h.viewname;if(!n){var p=alib.dom.createElement("div");alib.dom.styleSet(p,"width","14px");alib.dom.styleSet(p,"height","10px");alib.dom.styleSet(p,"margin-top","3px");alib.dom.styleSet(p,"background-color","#"+(m?m:G_GROUP_COLORS[0][1]));ALib.Effect.round(p,2);m=this.view.addView(o,{type:a,field_name:b,filter_id:k,f_system:n,title:l,appCls:this},this.appMain);
m.render=function(){this.con.innerHTML="";var a=new AntObjectBrowser(this.options.type);a.cbData.groupingId=this.options.filter_id;a.setAntView(this);this.options.f_system&&("Trash"==this.options.title||"Deleted Items"==this.options.title)?a.addCondition("and","f_deleted","is_equal","t"):a.setFilter(this.options.field_name,this.options.filter_id);a.print(this.con);this.options.browser=a};m.onshow=function(){this.options.appCls.currentObjectBrowser=this.options.browser};m.onhide=function(){this.options.appCls.currentObjectBrowser=
null};for(var o=d.addItem(l,p,function(a,b){a.navigate(b)},[this.view,o],o),q=o.getLabelCon(),r=o.getOptionCon(),m=new alib.ui.PopupMenu,u=new alib.ui.SubMenu("Change Color"),x=0;x<G_GROUP_COLORS.length;x++){var t=new alib.ui.MenuItem(G_GROUP_COLORS[x][0],{icon:"<div style='width:10px;height:10px;background-color:#"+G_GROUP_COLORS[x][1]+"'></div>"});t.cbData.cls=this;t.cbData.obj_type=a;t.cbData.filterField=b;t.cbData.clrdv=p;t.cbData.clr=G_GROUP_COLORS[x][1];t.cbData.gid=k;t.onclick=function(){this.cbData.cls.changeGroupingColor(this.cbData.obj_type,
this.cbData.field_name,this.cbData.clrdv,this.cbData.clr,this.cbData.gid)};u.addItem(t)}m.addItem(u);t=new alib.ui.MenuItem("Add New Subgroup",{icon:"<img src='/images/icons/add_10.png' />"});t.cbData.cls=this;t.cbData.obj_type=a;t.cbData.filterField=b;t.cbData.secItem=o;t.cbData.gid=k;t.onclick=function(){this.cbData.cls.addGrouping(this.cbData.obj_type,this.cbData.filterField,this.cbData.gid,this.cbData.secItem,!0)};m.addItem(t);n||(t=new alib.ui.MenuItem("Rename",{icon:"<img src='/images/icons/edit_10.png' />"}),
t.cbData.cls=this,t.cbData.obj_type=a,t.cbData.field_name=b,t.cbData.gid=k,t.cbData.title=l,t.cbData.lblcon=q,t.onclick=function(){this.cbData.cls.renameGrouping(this.cbData.obj_type,this.cbData.field_name,this.cbData.gid,this.cbData.title,this.cbData.lblcon)},m.addItem(t),t=new alib.ui.MenuItem("Delete",{icon:"<img src='/images/icons/delete_10.png' />"}),t.cbData.cls=this,t.cbData.obj_type=a,t.cbData.field_name=b,t.cbData.gid=k,t.cbData.title=l,t.cbData.entry=o,t.onclick=function(){this.cbData.cls.deleteGrouping(this.cbData.obj_type,
this.cbData.field_name,this.cbData.gid,this.cbData.title,this.cbData.entry)},m.addItem(t));n=alib.dom.createElement("img",r);n.src="/images/icons/rightclick_off.gif";m.attach(n);o.appCls=this;o.viewTitle=l;o.groupingField=b;o.objectType=a;o.groupingToId=k;o.registerDropzone("dzNavbarDrop_"+a);o.onDragEnter=function(){};o.onDragExit=function(){};o.onDragDrop=function(){this.appCls.currentObjectBrowser&&this.appCls.currentObjectBrowser.cbData.groupingId&&this.appCls.currentObjectBrowser.actionCustom({url:"/controller/Object/moveByGrouping",
args:[["obj_type",this.objectType],["field_name",this.groupingField],["move_from",this.appCls.currentObjectBrowser.cbData.groupingId],["move_to",this.groupingToId]],refresh:!0,doneMsg:"Moved to "+this.viewTitle,flush:!0})};h.children&&h.children.length&&this.addGroupings(a,b,h.children,o,++e);e&&o.collapse();f&&d.expand()}}};
AntApp.prototype.addGroupingsMobile=function(a,b,c,d,e){e||(e=0);for(var f=0;f<c.length;f++){var g=c[f],h=g.title,k=g.viewname,l=this.view.addView(k,{type:a,field_name:b,filter_id:g.id,appCls:this});l.render=function(){this.con.innerHTML="";var a=new AntObjectBrowser(this.options.type);a.mobile=!0;a.setAntView(this);a.setFilter(this.options.field_name,this.options.filter_id);a.print(this.con);this.options.browser=a};l.onshow=function(){this.options.appCls.currentObjectBrowser=this.options.browser};
l.onhide=function(){this.options.appCls.currentObjectBrowser=null};l=alib.dom.createElement("article",d);alib.dom.styleSetClass(l,"nav");for(var m="",n=0;n<e;n++)m+="&nbsp;";l.innerHTML="<a behavior='selectable' href=\"#"+this.view.getPath()+"/"+k+"\" onclick=\"alib.dom.styleAddClass(this, 'selected');\"><span class='icon'></span><h2><span class='more'></span>"+m+h+"</h2></a>";g.children&&g.children.length&&this.addGroupingsMobile(a,b,g.children,d,++e)}};
AntApp.prototype.resize=function(){if(this.navBarSections.length){for(var a=0,b=getWorkspaceHeight(),c=0;c<this.navBarSections.length-1;c++)a+=this.navBarSections[c].getHeight();this.navBarSections[this.navBarSections.length-1].setMaxHeight(b-a)}this.view.resize(!0)};
AntApp.prototype.changeGroupingColor=function(a,b,c,d,e){ajax=new CAjax("json");ajax.cbData.clrdv=c;ajax.cbData.clr=d;ajax.onload=function(a){a&&(alib.dom.styleSet(this.cbData.clrdv,"background-color","#"+this.cbData.clr),ALib.Effect.round(this.cbData.clrdv,2))};ajax.exec("/controller/Object/setGroupingColor",[["obj_type",a],["field",b],["color",d],["gid",e]])};
AntApp.prototype.addGrouping=function(a,b,c,d,e){var f=prompt("Enter a name for new subgroup","New Group");f&&(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.cbData.pnode=d,ajax.cbData.obj_type=a,ajax.cbData.field_name=b,ajax.cbData.new_group=e,ajax.onload=function(a){a&&a.id&&this.cbData.cls.addGroupings(this.cbData.obj_type,this.cbData.field_name,Array(a),this.cbData.pnode,null,this.cbData.new_group)},ajax.exec("/controller/Object/createGrouping",[["obj_type",a],["field",b],["parent_id",c],["title",
f]]))};AntApp.prototype.renameGrouping=function(a,b,c,d,e){e="undefined"!=typeof e?e:null;if(d=prompt("Enter a name for this group",d))ajax=new CAjax("json"),ajax.cbData.lbldv=e,ajax.cbData.title=d,ajax.onload=function(a){a&&this.cbData.lbldv&&(this.cbData.lbldv.innerHTML=this.cbData.title)},ajax.exec("/controller/Object/renameGrouping",[["obj_type",a],["field",b],["title",d],["gid",c]])};
AntApp.prototype.deleteGrouping=function(a,b,c,d,e){ALib.Dlg.confirmBox("Are you sure you want to delete "+d+"?","Delete Group",[a,b,c,e]);ALib.Dlg.onConfirmOk=function(a,b,c,d){ajax=new CAjax("json");ajax.cbData.gitem=d;ajax.onload=function(a){a&&this.cbData.gitem.deleteItem()};ajax.exec("/controller/Object/deleteGrouping",[["obj_type",a],["field",b],["title",name],["gid",c]])}};
AntApp.prototype.setMobileApplicationTitle=function(a,b){var c=b?b:this.view;c.conAppTitle&&(c.conAppTitle.innerHTML="<h1>"+this.title+"</h1>",alib.dom.styleSetClass(c.conAppTitle,"apptitle"));if(c.viewManager)for(var d=0;d<c.viewManager.views.length;d++)this.setMobileApplicationTitle(a,c.viewManager.views[d])};AntApp.prototype.setDesktopeApplicationTitle=function(){};AntApp.prototype.setDesktopNavPathSate=function(a){a&&(a=a.split("/")[0],this.navBar&&this.navBar.itemChangeState(a,"on"))};
AntApp.prototype.calNav=function(a,b,c,d){var e=new Date,a=a?a:e.getFullYear(),b=b?b:e.getMonth()+1,c=c?c:e.getDate(),d=d?d:"";this.cal_con.innerHTML="";var f="S,M,T,W,T,F,S".split(","),g=new Date(a,b-1,1);g.od=g.getDay()+1;var e=a==e.getFullYear()&&b==e.getMonth()+1?e.getDate():0,h=calGetMonthNumDays(a,b),k=alib.dom.createElement("table",this.cal_con);alib.dom.styleSet(k,"width","100%");alib.dom.styleSet(k,"font-size","12px");var k=alib.dom.createElement("tbody",k),l=alib.dom.createElement("tr",
k),m=alib.dom.createElement("td",l);alib.dom.styleSet(m,"width","10px");m.innerHTML="&lt;";alib.dom.styleSet(m,"cursor","pointer");m.month=b;m.year=a;m.m_cls=this;m.onclick=function(){1==this.month?(this.year-=1,this.month=12):this.month-=1;this.m_cls.calNav(this.year,this.month)};m=alib.dom.createElement("td",l);alib.dom.styleSet(m,"text-align","center");m.innerHTML=calGetMonthName(b)+", "+a;m=alib.dom.createElement("td",l);alib.dom.styleSet(m,"width","10px");m.innerHTML="&gt;";alib.dom.styleSet(m,
"cursor","pointer");m.month=b;m.year=a;m.m_cls=this;m.onclick=function(){12==this.month?(this.year+=1,this.month=1):this.month+=1;this.m_cls.calNav(this.year,this.month)};k=alib.dom.createElement("table",this.cal_con);alib.dom.styleSet(k,"width","100%");k.cellSpacing=0;k.cellPadding=0;k=alib.dom.createElement("tbody",k);l=alib.dom.createElement("tr",k);for(s=0;7>s;s++)m=alib.dom.createElement("td",l),alib.dom.styleSet(m,"text-align","center"),alib.dom.styleSet(m,"font-weight","bold"),m.innerHTML=
f[s];f=new Date(a,b-1,1);0<f.getDay()&&(f=calDateAddSubtract(f,"day",-1*f.getDay()));l=alib.dom.createElement("tr",k);l.vAlign="top";for(i=this.m_monthnumrows=1;42>=i;i++){var n=0<=i-g.od&&i-g.od<h?i-g.od+1:"&nbsp;",m=alib.dom.createElement("td",l);alib.dom.styleSet(m,"width","14%");alib.dom.styleSet(m,"text-align","center");alib.dom.styleSet(m,"padding","3px");alib.dom.styleSet(m,"cursor","pointer");n==e&&alib.dom.styleSet(m,"font-weight","bold");switch(d){case "month":f.getMonth()+1==b&&alib.dom.styleSet(m,
"background-color","#e3e3e3");break;case "week":var o=new Date(a,b-1,c),n=0<o.getDay()?calDateAddSubtract(o,"day",-1*o.getDay()):o,o=6>o.getDay()?calDateAddSubtract(o,"day",6-o.getDay()):o;f.getTime()>=n.getTime()&&f.getTime()<=o.getTime()&&alib.dom.styleSet(m,"background-color","#e3e3e3");break;case "day":o=new Date(a,b-1,c),f.getTime()==o.getTime()&&alib.dom.styleSet(m,"background-color","#e3e3e3")}m.innerHTML=f.getDate();m.m_cls=this;m.m_year=f.getFullYear();m.m_month=f.getMonth()+1;m.m_day=f.getDate();
m.onclick=function(){try{if(this.m_cls.calendarBrowser)switch(this.m_cls.view.navigate("mycalendar"),this.m_cls.myCalendarView.options.nav.itemClearOnStates(),this.m_cls.calendarBrowser.activeView){case "day":this.m_cls.calendarBrowser.renderDay(this.m_year,this.m_month,this.m_day);break;case "week":this.m_cls.calendarBrowser.renderWeek(this.m_year,this.m_month,this.m_day);break;case "month":this.m_cls.calendarBrowser.renderMonth(this.m_year,this.m_month)}else this.m_cls.view.navigate("mycalendar"),
this.m_cls.myCalendarView.options.nav.itemClearOnStates()}catch(a){}};f=calDateAddSubtract(f,"day",1);if(0==i%7&&0<h)l=alib.dom.createElement("tr",k),l.vAlign="top",this.m_monthnumrows++;else if(0==i%7&&0>=h)break}};
AntApp.prototype.insertCalendar=function(a,b){var c=b.share_id?b.share_id:null,d={share_id:c,calendar_id:b.id},e=alib.dom.createElement("input");alib.dom.styleSet(e,"cursor","pointer");e.type="checkbox";"t"==b.f_view&&(e.checked=!0);var f=a.addItem("",e,function(a,b,c){c.checked=c.checked?!1:!0;c.onchange()},[this,d,e],c?"share_"+c:"cal_"+b.id,!1);e.cal_event=d;e.cls=this;e.calendar=b;e.onchange=function(){var a=this.checked?"t":"f",b=this.calendar.id,c="calendar_id";this.cal_event.share_id&&(b=this.cal_event.share_id,
c="share_id");ajax=new CAjax("json");ajax.cbData.f_view=a;ajax.cbData.calendar=this.calendar;ajax.cbData.cls=this.cls;ajax.onload=function(){this.cbData.cls.processCalendar(this.cbData.calendar,this.cbData.f_view)};ajax.exec("/controller/Calendar/setFView",[["f_view",a],[c,b]])};var e=f.getLabelCon(),f=f.getOptionCon(),g=b.color,d=alib.dom.createElement("div",e);alib.dom.styleSet(d,"float","left");alib.dom.styleSet(d,"width","14px");alib.dom.styleSet(d,"height","10px");alib.dom.styleSet(d,"margin-top",
"3px");alib.dom.styleSet(d,"background-color","#"+g);ALib.Effect.round(d,2);e=alib.dom.createElement("div",e);alib.dom.styleSet(e,"margin-left","18px");e.innerHTML=unescape(b.name);for(var e=new alib.ui.PopupMenu,g=new alib.ui.SubMenu("Change Color"),h=0;h<G_GROUP_COLORS.length;h++){var k=new alib.ui.MenuItem(G_GROUP_COLORS[h][0],{icon:"<div style='width:9px;height:9px;background-color:#"+G_GROUP_COLORS[h][1]+"'></div>"});k.cbData.cls=this;k.cbData.cid=b.id;k.cbData.share_id=c;k.cbData.color=G_GROUP_COLORS[h][1];
k.cbData.clrDiv=d;k.onclick=function(){this.cbData.cls.changeCalColor(this.cbData.cid,this.cbData.share_id,this.cbData.color,this.cbData.clrDiv)};g.addItem(k)}e.addItem(g);k=new alib.ui.MenuItem(c?"Remove Share":"Delete Calendar",{icon:"<img src='/images/icons/delete_10.png' />"});k.cbData.cls=this;k.cbData.cid=b.id;k.cbData.share_id=c;k.cbData.name=unescape(b.name);k.onclick=function(){this.cbData.share_id?this.cbData.cls.removeShare(this.cbData.share_id,this.cbData.name):this.cbData.cls.deleteCalendar(this.cbData.cid,
this.cbData.name)};e.addItem(k);c||(k=new alib.ui.MenuItem("Share Calendar",{icon:"<img src='/images/icons/share_16.png' />"}),k.cbData.cls=this,k.cbData.cid=b.id,k.onclick=function(){var a=new AntObjectBrowser("user");a.cbData.clsRef=this.cbData.cls;a.cbData.cid=this.cbData.cid;a.onSelect=function(a,b){var c=new CAjax("json");c.onload=function(){alib.statusShowAlert("Share invitation sent to "+b,3E3,"bottom","right")};c.exec("/controller/Calendar/addSharedCalendar",[["calendar_id",this.cbData.cid],
["user_id",a]])};a.displaySelect()},e.addItem(k),k=new alib.ui.MenuItem("Permissions",{icon:"<img src='/images/icons/permissions_16.png' />"}),k.cbData.cls=this,k.cbData.cid=b.id,k.onclick=function(){loadDacl(null,"calendars/"+this.cbData.cid)},e.addItem(k));c=alib.dom.createElement("img",f);c.src="/images/icons/rightclick_off.gif";e.attach(c)};
AntApp.prototype.processCalendar=function(a,b){for(cb in this.calendarBrowser.calendars)if(this.calendarBrowser.calendars[cb].id==a.id){delete this.calendarBrowser.calendars[cb];break}"t"==b&&(this.calendarBrowser.calendars[this.calendarBrowser.calendars.length]=a);this.calendarBrowser.getEvents()};
AntApp.prototype.changeCalColor=function(a,b,c,d){a=b?[["color",c],["share_id",b]]:[["color",c],["calendar_id",a]];ajax=new CAjax("json");ajax.cls=this;ajax.clrdv=d;ajax.onload=function(a){this.clrdv.style.backgroundColor="#"+a;ALib.Effect.round(this.clrdv,2);this.cls.calendarBrowser.refresh()};ajax.exec("/controller/Calendar/calSetColor",a)};
AntApp.prototype.deleteCalendar=function(a,b){var c=new CDialog;c.confirmBox("Are you sure you want to delete "+unescape(b)+" and all it's events?","Delete Calendar",[this,a]);c.onConfirmOk=function(a,b){ajax=new CAjax("json");ajax.cls=a;ajax.id=b;ajax.onload=function(a){a&&(ALib.statusShowAlert("Calendar Deleted!",3E3,"bottom","right"),this.cls.navBar.deleteItem("cal_"+this.id))};ajax.exec("/controller/Calendar/deleteCalendar",[["id",b]])}};
AntApp.prototype.removeShare=function(a,b){var c=new CDialog;c.confirmBox("Are you sure you want to remove "+unescape(b)+"?","Remove Shared Calendar",[this,a]);c.onConfirmOk=function(a,b){ajax=new CAjax("json");ajax.cls=a;ajax.id=b;ajax.onload=function(a){a&&(ALib.statusShowAlert("Calendar Share Removed!",3E3,"bottom","right"),this.cls.navBar.deleteItem("share_"+this.id))};ajax.exec("/controller/Calendar/deleteShare",[["id",b]])}};
AntApp.prototype.loadPlugin=function(a,b){var c=a.split("_");if(3==c.length)var d=c[1],e=c[2];2==c.length&&(d="",e=c[1]);b.onresize=function(){alib.dom.styleSet(this.con,"max-height",getWorkspaceHeight()+"px");alib.dom.styleSet(this.con,"overflow","auto")};c="/applications/plugins";d&&(c+="/"+d);c+="/"+e+".js";document.getElementById("js_app_"+this.name+"_pl"+a)?(d=eval("new "+a+"()"),d.print&&d.print(b)):(d=document.createElement("script"),d.pluginClassName=a,d.antView=b,alib.userAgent.ie?d.onreadystatechange=
function(){if("complete"==this.readyState||"loaded"==this.readyState){var a=eval("new "+this.pluginClassName+"()");a.print&&a.print(this.antView)}}:d.onload=function(){var a=eval("new "+this.pluginClassName+"()");a.print&&a.print(this.antView)},d.type="text/javascript",d.id="js_app_"+this.name+"_pl"+a,d.src=c,document.getElementsByTagName("head")[0].appendChild(d))};AntApp.prototype.getAppHeaderHeight=function(){return 0};
function AntAppSettings(a){this.app=a?a:null;this.default_type=this.nav_xml="";this.navigation_items=[];this.antView=this.workflowCon=this.mainCon=this.objTypes=null;this.cbData={}}AntAppSettings.prototype.loadAndPrint=function(a,b){this.antView=b;this.app=new AntApp(a);this.app.appName=a;this.app.view=b;this.app.cbData.applet=this;this.app.cbData.con=b.con;this.app.onload=function(){this.cbData.applet.print(this.cbData.con)};this.app.loadAppDef(!0)};
AntAppSettings.prototype.print=function(a){this.mainCon=a;this.titleCon=alib.dom.createElement("div",this.mainCon);this.titleCon.className="objectLoaderHeader";this.titleCon.innerHTML=this.app.title+" Settings";this.innerCon=alib.dom.createElement("div",this.mainCon);this.innerCon.className="objectLoaderBody";a=new CTabs;a.print(this.innerCon);ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.objTypes=a};ajax.exec("/controller/Object/getObjects");var b=a.addTab("General");
this.buildGeneral(b);this.workflowCon=a.addTab("Workflow");this.buildWorkflow(this.workflowCon);b=a.addTab("Navigation");this.buildLayout(b)};
AntAppSettings.prototype.buildGeneral=function(a){var b={},c=alib.dom.createElement("div",a),d=new CToolbar;if(this.onclose){var e=alib.ui.Button("Close",{className:"b1",tooltip:"Close Settings",cls:this,onclick:function(){this.cls.onclose()}});d.AddItem(e.getButton(),"left")}e=new CButton("Save Settings",function(a,b){var c=b.cbScope.value,d=[["app",a.app.name],["title",b.txtTitle.value],["short_title",b.txtShortTitle.value],["scope",c]];switch(c){case "user":a.userDetails&&(d[d.length]=["userId",
a.userDetails.id]);break;case "team":a.teamDropdown&&(d[d.length]=["teamId",a.teamDropdown.value])}ajax=new CAjax("json");ajax.onload=function(a){a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):ALib.statusShowAlert("Settings Saved!",3E3,"bottom","right")};ajax.exec("/controller/Application/saveGeneral",d)},[this,b],"b2");d.AddItem(e.getButton(),"left");d.print(c);c=alib.dom.createElement("div",a);c=alib.dom.createElement("table",c);c.setAttribute("cellpadding",0);c.setAttribute("cellspacing",
0);alib.dom.styleSet(c,"width","90%");d=alib.dom.createElement("tbody",c);e=alib.dom.createElement("tr",d);c=alib.dom.createElement("td",e);alib.dom.styleSetClass(c,"formLabel");c.innerHTML="Title";c=alib.dom.createElement("td",e);alib.dom.styleSetClass(c,"formValue");b.txtTitle=alib.dom.createElement("input");b.txtTitle.type="text";b.txtTitle.value=this.app.title;alib.dom.styleSet(b.txtTitle,"width","300px");c.appendChild(b.txtTitle);c=alib.dom.createElement("td",e);c.colSpan=2;c.innerHTML="<img src='/images/icons/permissions_16.png' />&nbsp;&nbsp;<a href='javascript:void(0);' onclick=\"loadDacl(null, 'applications/"+
this.app.name+"');\">Edit Application Permissions</a>";e=alib.dom.createElement("tr",d);c=alib.dom.createElement("td",e);alib.dom.styleSetClass(c,"formLabel");c.innerHTML="Short Title";c=alib.dom.createElement("td",e);alib.dom.styleSetClass(c,"formValue");b.txtShortTitle=alib.dom.createElement("input");b.txtShortTitle.type="text";b.txtShortTitle.value=this.app.shortTitle;alib.dom.styleSet(b.txtShortTitle,"width","300px");c.appendChild(b.txtShortTitle);c=alib.dom.createElement("td",e);alib.dom.styleSetClass(c,
"formLabel");alib.dom.styleSet(c,"verticalAlign","top");c.innerHTML="Publish to: ";c=alib.dom.createElement("td",e);alib.dom.styleSetClass(c,"formValue");d=alib.dom.createElement("div");alib.dom.styleSet(d,"width","300px");e=alib.dom.createElement("div",d);alib.dom.styleSet(e,"float","left");b.cbScope=alib.dom.createElement("select",e);buildDropdown(b.cbScope,[["system","Everyone"],["user","Specific User"],["team","A Team"],["draft","Nobody - Unpublish"]],this.app.scope);c.appendChild(d);this.divScopeUser=
alib.dom.createElement("div",d);alib.dom.styleSet(this.divScopeUser,"float","left");alib.dom.styleSet(this.divScopeUser,"marginLeft","10px");this.divScopeUser.innerHTML="<div class='loading'></div>";this.loadCurrentUser();this.divScopeTeam=alib.dom.createElement("div",d);alib.dom.styleSet(this.divScopeTeam,"float","left");alib.dom.styleSet(this.divScopeTeam,"marginLeft","10px");this.divScopeTeam.innerHTML="<div class='loading'></div>";this.teamDropdown();alib.dom.divClear(d);b.cbScope.cls=this;b.cbScope.onchange=
function(){this.cls.toggleScope(this.value)};this.toggleScope(this.app.scope);b=new CWindowFrame("Referenced Objects");d=b.getCon();b.print(a);c=alib.dom.createElement("element",d);d=alib.dom.createElement("element",d);b=new CToolTable("100%");b.print(c);b.addHeader("Name");b.addHeader("&nbsp;","center","100px");b.addHeader("&nbsp;","center","100px");b.addHeader("Delete","center","50px");this.antObject=new CAntObjects;this.antObject.objCls=this;this.antObject.appName=this.app.name;this.antObject.tblObject=
b;this.antObject.fObjectReference=!0;this.antObject.loadObjects(c);this.antObject.onLoadObjects=function(){this.mapObject(this.objCls.app.refObjects)};d=alib.dom.createElement("div",d);alib.dom.styleSet(d,"padding","5px");e=alib.dom.createElement("a",d);e.href="javascript:void(0);";e.innerHTML="Create New Object";e.cls=this;e.tbl=b;e.onclick=function(){this.cls.antObject.addNewObject()};e=alib.dom.createElement("span",d);e.innerHTML=" | ";e=alib.dom.createElement("a",d);e.href="javascript:void(0);";
e.innerHTML="Reference Existing Object";e.cls=this;e.tbl=b;e.onclick=function(){var a=new CDialog("Reference Existing Object"),b=alib.dom.createElement("div");a.cls=this.cls;a.tbl=this.tbl;var c=alib.dom.createElement("table",b),d=alib.dom.createElement("tbody",c),e=alib.dom.createElement("tr",d),m=alib.dom.createElement("td",e),n=alib.dom.createElement("div",m);n.innerHTML="<strong>Select an object: </strong>";n.style.padding="3px";m.appendChild(n);var m=alib.dom.createElement("td",e),n=alib.dom.createElement("div",
m),o=alib.dom.createElement("select");o[o.length]=new Option("Select","");o.cls=a.cls;o.tbl=a.tbl;o.onchange=function(){if(""!=this.value)if(this.cls.checkObjectReference(this.value))a.hide(),ALib.Dlg.messageBox("ERROR: Object Reference already exists!");else{var b=[["app",this.cls.app.name],["obj_type",this.value]];ajax=new CAjax("json");ajax.cls=this.cls;ajax.tbl=this.tbl;ajax.obj_type=this.value;ajax.onload=function(b){b.error?(a.hide(),ALib.Dlg.messageBox("ERROR: Could not add object reference. Please try again.")):
(a.hide(),b={},b.name=this.obj_type,this.cls.antObject.listObject(b))};ajax.exec("/controller/Application/addObjectReference",b)}};e.appendChild(m);c.appendChild(d);ajax=new CAjax("json");ajax.con=o;ajax.onload=function(a){for(object in a)this.con[this.con.length]=new Option(a[object].title,a[object].name)};ajax.exec("/controller/Object/getObjects");c=alib.dom.createElement("div");alib.dom.styleSet(c,"float","right");d=new CButton("Cancel",function(){a.hide()},null,"b1");c.appendChild(d.getButton());
b.appendChild(c);a.customDialog(b,260,60);n.appendChild(o)};e=alib.dom.createElement("span",d);e.innerHTML=" | ";e=alib.dom.createElement("a",d);e.href="javascript:void(0);";e.innerHTML="Refresh";e.cls=this;e.tableCon=c;e.onclick=function(){this.cls.antObject.loadObjects(this.tableCon);this.cls.antObject.onLoadObjects=function(){this.mapObject(this.objCls.app.refObjects)}};b=new CWindowFrame("Application Calendars");c=b.getCon();b.print(a);b=new CToolTable("100%");b.print(c);b.addHeader("Name");b.addHeader("Delete",
"center","50px");for(a=0;a<this.app.refCalendars.length;a++)d=b.addRow(),d.addCell(this.app.refCalendars[a].name),e=alib.dom.createElement("div"),e.m_rw=d,e.cls=this,e.calid=this.app.refCalendars[a].id,e.onclick=function(){this.cls.removeCalendar(this.calid,this.m_rw)},e.innerHTML="<img border='0' src='/images/icons/delete_10.png' />",alib.dom.styleSet(e,"cursor","pointer"),d.addCell(e,!1,"center");d=alib.dom.createElement("div",c);alib.dom.styleSet(d,"padding","5px");e=alib.dom.createElement("a",
d);e.href="javascript:void(0);";e.tbl=b;e.cls=this;e.onclick=function(){var a=new CDialog;a.cls=this.cls;a.tbl=this.tbl;a.promptBox("Enter A Name For This Calendar","Calendar Name:","Application Calendar");a.onPromptOk=function(a){ajax=new CAjax("json");ajax.cls=this.cls;ajax.name=a;ajax.tbl=this.tbl;ajax.onload=function(a){if(!a.error){var b=this.tbl.addRow();b.addCell(this.name);var c=alib.dom.createElement("div");c.m_rw=b;c.cls=this.cls;c.calid=a;c.onclick=function(){this.cls.removeCalendar(this.calid,
this.m_rw)};c.innerHTML="<img border='0' src='/images/icons/delete_10.png' />";alib.dom.styleSet(c,"cursor","pointer");b.addCell(c,!1,"center")}};ajax.exec("/controller/Application/createCalendar",[["cal_name",a],["app",this.cls.app.name]])}};e.innerHTML="Create Application Calendar"};
AntAppSettings.prototype.removeCalendar=function(a,b){var c=new CDialog;c.cls=this;c.row=b;c.cal_id=a;c.confirmBox("Are you sure you want to delete this calendar?","Delete Calendar");c.onConfirmOk=function(){var a=[["app",this.cls.app.name],["cal_id",this.cal_id]];ajax=new CAjax("json");ajax.row=this.row;ajax.onload=function(a){a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):(ALib.statusShowAlert("Calendar Deleted!",3E3,"bottom","right"),this.row.deleteRow())};ajax.exec("/controller/Application/deleteCalendar",
a)}};
AntAppSettings.prototype.addReferencedObject=function(a,b,c){var d=this.app.refObjects.length;this.app.refObjects[d]=c?{name:"co_"+b,title:b,fSystem:!1}:{name:b,title:b,fSystem:!1};a=a.addRow();a.addCell(this.app.refObjects[d].title,!1);c=alib.dom.createElement("a");c.innerHTML="[import data]";c.href="javascript:void(0);";c.obj_type=this.app.refObjects[d].name;c.onclick=function(){(new AntWizard("EntityImport",{obj_type:this.obj_type})).show()};a.addCell(c,!1,"center");c=alib.dom.createElement("a");c.innerHTML=
"[edit permissions]";c.href="javascript:void(0);";c.obj_type=this.app.refObjects[d].name;c.onclick=function(){loadDacl(null,"/objects/"+this.obj_type)};a.addCell(c,!1,"center");c=alib.dom.createElement("a");c.innerHTML="[edit object]";c.href="javascript:void(0);";c.obj_type=this.app.refObjects[d].name;c.onclick=function(){(new Ant.EntityDefinitionEdit(this.obj_type)).showDialog()};a.addCell(c,!1,"center");this.app.refObjects[d].fSystem?c="&nbsp;":(c=alib.dom.createElement("div"),c.cls=this,c.row=
a,c.obj_type=b,c.innerHTML="<img src='/images/icons/delete_10.png' />",c.onclick=function(){this.cls.deleteReferencedObject(this.row,this.cls.app.refObjects[d].name)});a.addCell(c,!1,"center")};
AntAppSettings.prototype.deleteReferencedObject=function(a,b){var c=new CDialog;c.cls=this;c.row=a;c.obj_type=b;c.confirmBox("Are you sure you want to delete this referenced object?","Delete Referenced Object");c.onConfirmOk=function(){var a=[["app",this.cls.app.name],["obj_type",this.obj_type]];ajax=new CAjax("json");ajax.row=this.row;ajax.onload=function(a){a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):(ALib.statusShowAlert("Object Deleted!",3E3,"bottom","right"),this.row.deleteRow())};
ajax.exec("/controller/Application/deleteObjectReference",a)}};AntAppSettings.prototype.checkObjectReference=function(a){for(var b=!1,c=0;c<this.app.refObjects.length;c++)this.app.refObjects[c].name==a&&(b=!0);return b};
AntAppSettings.prototype.buildWorkflow=function(a){a.innerHTML="";var b=new CToolTable("100%");b.addHeader("Name");b.addHeader("Object Type","center","60px");b.addHeader("Active","center","30px");b.addHeader("","center","30px");b.addHeader("Delete","center","50px");var c=new CToolbar;if(this.onclose){var d=alib.ui.Button("Close",{className:"b1",tooltip:"Close Settings",cls:this,onclick:function(){this.cls.onclose()}});c.AddItem(d.getButton(),"left")}d=new CButton("Create Workflow",function(a){a.openWorkflow()},
[this],"b2");c.AddItem(d.getButton());d=new CButton("Refresh",function(a,b){a.buildWorkflow(b)},[this,a]);c.AddItem(d.getButton());c.print(a);c=alib.dom.createElement("p",a);alib.dom.styleSetClass(c,"notice");c.innerHTML='Use workflows to automate tasks based on any object. To get started, click "Create Workflow" above and select the object type you would like to automate tasks for.';c=new CWindowFrame("Automated Workflows");c.print(a);c=c.getCon();c.innerHTML="<div class='loading'></div>";a=new CAjax("json");
a.m_tbl=b;a.m_app=this;a.m_wfDiv=c;a.onload=function(a){this.m_wfDiv.innerHTML="";this.m_tbl.print(this.m_wfDiv);if(a.length)for(workflow in a){var b=a[workflow],c="",d="",k="",l="";b.name&&(c=b.name);b.f_active&&(k="t"==b.f_active?"yes":"no");b.object_type&&(l=b.object_type);0<b.id&&(d=b.id,this.m_app.addWorkflowToList(d,c,k,l,this.m_tbl))}};b="activity:comment";for(c=0;c<this.app.refObjects.length;c++)b+=":"+this.app.refObjects[c].name;c=[];c[c.length]=["otypes",b];a.exec("/controller/WorkFlow/getWorkflow",
c)};AntAppSettings.prototype.openWorkflow=function(a,b){var c=a&&b?new WorkflowWizard(b,a):new WorkflowWizard;c.g_objTypes=this.objTypes;c.showDialog();c.cls=this;c.onsave=function(){this.cls.buildWorkflow(this.cls.workflowCon)}};
AntAppSettings.prototype.addWorkflowToList=function(a,b,c,d,e){var e=e.addRow(),f=alib.dom.createElement("div");f.m_rw=e;f.m_app=this;f.m_wfid=a;f.onclick=function(){this.m_app.deleteWorkflow(this.m_wfid,this.m_rw)};f.innerHTML="<img border='0' src='/images/icons/delete_10.png' />";alib.dom.styleSet(f,"cursor","pointer");e.addCell(b);e.addCell(d);e.addCell(c);btn=new CButton("open",function(a,b,c){a.openWorkflow(b,c)},[this,a,d],"b2");e.addCell(btn.getButton());e.addCell(f,!0,"center")};
AntAppSettings.prototype.deleteWorkflow=function(a,b){var c=new CDialog("Remove Workflow");c.rw=b;c.wfid=a;c.confirmBox("Are you sure you want to delete this workflow?","Remove Workflow");c.onConfirmOk=function(){ajax=new CAjax("json");ajax.cbData.rw=this.rw;ajax.onload=function(){this.cbData.rw.deleteRow()};ajax.exec("/controller/WorkFlow/deleteWorkflow",[["wid",this.wfid]])}};
AntAppSettings.prototype.buildLayout=function(a){var b=alib.dom.createElement("div",a),c=new CToolbar,a=alib.dom.createElement("div",a),d=new CSplitContainer;left_div=d.addPanel("330px");right_div=d.addPanel("*");if(this.onclose){var e=alib.ui.Button("Close",{className:"b1",tooltip:"Close Settings",cls:this,onclick:function(){this.cls.onclose()}});c.AddItem(e.getButton(),"left")}e=new CButton("Save Navigation",function(a,b){a.nav_xml="";a.saveLayout(b)},[this,left_div],"b2");c.AddItem(e.getButton(),
"left");e=new CButton("Select Default Item",function(a){var b=new CDialog("Default Navigation Item"),c=alib.dom.createElement("div"),d=alib.dom.createElement("table",c),e=alib.dom.createElement("tbody",d),m=alib.dom.createElement("tr",e),n=alib.dom.createElement("td",m),o=alib.dom.createElement("div",n);o.innerHTML="<strong>Select a default item: </strong>";o.style.padding="3px";n.appendChild(o);var n=alib.dom.createElement("td",m),o=alib.dom.createElement("div",n),p=alib.dom.createElement("select");
p.cls=a;p[p.length]=new Option("Select","");p[p.length]=new Option("Null","");p.onchange=function(){b.hide();this.cls.default_type=this.value};m.appendChild(n);d.appendChild(e);a.addNavigationItems(p);a=alib.dom.createElement("div");alib.dom.styleSet(a,"float","right");d=new CButton("Cancel",function(){b.hide()},null,"b1");a.appendChild(d.getButton());c.appendChild(a);b.customDialog(c,260,60);o.appendChild(p)},[this,left_div],"b1");c.AddItem(e.getButton(),"left");e=new CButton("Reset to default",
function(a,b){ajax=new CAjax("json");ajax.cbData.cls=a;ajax.onload=function(c){c||ALib.statusShowAlert("Error Occured!",3E3,"bottom","right");c.error&&ALib.statusShowAlert(c.error,3E3,"bottom","right");c&&(c=new CSplitContainer,left_div=c.addPanel("330px"),right_div=c.addPanel("*"),a.buildLeftLayout(left_div,right_div),a.buildRightLayout(right_div),b.innerHTML="",c.print(b),alib.dom.styleSet(this.cbData.cls.resetDefault,"display","none"),ALib.statusShowAlert(this.cbData.cls.app.appName.capitalize()+
" navigation is reset to default!",3E3,"bottom","right"))};var c=[];c[c.length]=["name",a.app.appName];c[c.length]=["layout_xml",null];ajax.exec("/controller/Application/saveLayout",c)},[this,a],"b1");this.resetDefault=e.getButton();c.AddItem(this.resetDefault,"left");alib.dom.styleSet(this.resetDefault,"display","none");c.print(b);d.print(a);left_div.style.height=document.body.offsetHeight+"px";left_div.id="nav_root";this.buildLeftLayout(left_div,right_div);this.buildRightLayout(right_div);this.checkDefault()};
AntAppSettings.prototype.buildLeftLayout=function(a,b){alib.dom.createElement("h2",a).innerHTML="Navigation";var c=alib.dom.createElement("div",a);DragAndDrop.registerDropzone(c,"main_dz");DragAndDrop.registerSortable(c);c.id="left_div";var d=this.app.xmlDef.getChildNodeByName("navigation");this.buildNavigation(c,b,d);d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"text-align","center");c=new CButton("+ Add Section",this.addSection,[this,c,b],"b1");d.appendChild(c.getButton());d.id="end_nav"};
AntAppSettings.prototype.buildRightLayout=function(a){a=alib.dom.createElement("div",a);a.id="right_div";a=alib.dom.createElement("p",a);alib.dom.styleSet(a,"margin","0 0 0 5px");alib.dom.styleSetClass(a,"notice");a.innerHTML="Select an item to the left to edit properties or click Add item to create a new item"};
AntAppSettings.prototype.buildNavigation=function(a,b,c){for(var d=0;d<c.getNumChildren();d++){var e=c.getChildNode(d);switch(e.m_name){case "section":var f=alib.dom.createElement("div",a);DragAndDrop.registerDragableChild(null,f,null,"main_dz");alib.dom.styleSet(f,"margin","5px 3px 5px 3px");f.style.border="1px solid black";f.style.cursor="move";f.title=unescape(e.getAttribute("title"));f.nav_type="section";var g=alib.dom.createElement("div",f);alib.dom.styleSet(g,"margin","3px 3px 3px 3px");var h=
alib.dom.createElement("div");alib.dom.styleSet(h,"margin","0 100px 0 0");h.innerHTML="<strong>"+f.title+"</strong>";var k=alib.dom.createElement("div");alib.dom.styleSet(k,"margin","0 3px 0 0");alib.dom.styleSet(k,"float","right");var l=new CButton("Rename",this.renameSection,[h],"b1",null,null,null,"link");k.appendChild(l.getButton());var m=alib.dom.createElement("div");alib.dom.styleSet(m,"float","right");l=new CButton("X",this.deleteItem,[f,b],"b3",null,null,null,"link");m.appendChild(l.getButton());
g.appendChild(m);g.appendChild(k);g.appendChild(h);g=alib.dom.createElement("div",f);g.style.height="5px";g=alib.dom.createElement("div",f);DragAndDrop.registerDropzone(g,"section_dz");DragAndDrop.registerSortable(g);this.buildNavigation(g,b,e);e=alib.dom.createElement("a",f);e.href="javascript:void(0);";e.innerHTML="<center>Add item/link to section</center>";e.items=g;e.ref=this;e.onclick=function(){alib.dom.styleSet(this.ref.resetDefault,"display","block");this.ref.addItem(this.items,b)};break;
case "item":f=alib.dom.createElement("div",a);DragAndDrop.registerDragableChild(a.parentNode,f,null,"section_dz");alib.dom.styleSet(f,"margin","5px 3px 5px 3px");f.style.border="1px solid black";f.style.cursor="move";f.nav_type="item";f.name=e.getAttribute("name");f.type=e.getAttribute("type");f.title=""!=e.getAttribute("title")?unescape(e.getAttribute("title")):unescape(e.getAttribute("name"));"calendar"==f.type&&(f.calendar_id=e.getAttribute("id"));""!=e.getAttribute("icon")&&(f.icon=unescape(e.getAttribute("icon")));
""!=e.getAttribute("tooltip")&&(f.tooltip=unescape(e.getAttribute("tooltip")));if("object"==f.type||"browse"==f.type)f.obj_type=e.getAttribute("obj_type");"browse"==f.type&&""!=e.getAttribute("browseby")&&(f.browseby=e.getAttribute("browseby"));"browse"==f.type&&""!=e.getAttribute("folder_id")&&(f.folder_id=e.getAttribute("folder_id"));"link"==f.type&&""!=e.getAttribute("url")&&(f.url=unescape(e.getAttribute("url")));g=alib.dom.createElement("div",f);alib.dom.styleSet(g,"margin","3px 3px 3px 3px");
h=alib.dom.createElement("div");alib.dom.styleSet(h,"margin","0 100px 0 0");h.innerHTML=f.title;k=alib.dom.createElement("div");alib.dom.styleSet(k,"margin","0 3px 0 0");alib.dom.styleSet(k,"float","right");l=new CButton("Options",this.buildItemDetails,[this,b,f],"b1",null,null,null,"link");k.appendChild(l.getButton());m=alib.dom.createElement("div");alib.dom.styleSet(m,"float","right");l=new CButton("X",function(a,b,c){a.deleteItem(b,c);a.deleteNavigationItem(b.name,b.type)},[this,f,b],"b3",null,
null,null,"link");m.appendChild(l.getButton());g.appendChild(m);g.appendChild(k);g.appendChild(h);g=alib.dom.createElement("div",f);g.style.height="5px";this.navigation_items[this.navigation_items.length]={title:f.title,name:f.name,type:f.type};this.buildNavigation(f,b,e);break;case "filter":g=alib.dom.createElement("div",a);g.style.display="none";g.nav_type="filter";g.conditions=[];this.buildNavigation(g,b,e);break;case "condition":g=alib.dom.createElement("div",a),g.style.display="none",g.nav_type=
"condition",l={},l.blogic=e.getAttribute("blogic"),l.field=e.getAttribute("field"),l.operator=e.getAttribute("operator"),l.value=e.getAttribute("value"),a.conditions[a.conditions.length]=l,this.buildNavigation(g,b,e)}}};
AntAppSettings.prototype.buildItemDetails=function(a,b,c){if(a.objTypes){b.innerHTML="";alib.dom.createElement("h2",b).innerHTML="Navigation Item Details";var d=alib.dom.createElement("table",b),e=alib.dom.createElement("tbody",d),f=alib.dom.createElement("tr",e),g=alib.dom.createElement("td",f),h=alib.dom.createElement("div",b);h.innerHTML="<strong>Title/Label </strong>";h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",f),k=alib.dom.createElement("input",g);k.setAttribute("maxLength",
128);k.type="text";k.style.width="160px";k.value=c.title;k.onchange=function(){if(""!=k.value){var b=c.name;c.title=k.value;c.childNodes[0].childNodes[2].innerHTML=k.value;var d=k.value.toLowerCase(),d=d.replace(/ /g,"_"),d=d.replace(/[^a-zA-Z0-9_]+/g,"");c.name=d;l.innerHTML=d;a.updateNavigationItemName(b,c.name,c.title)}};g.appendChild(k);f.appendChild(g);f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);h=alib.dom.createElement("div",b);h.innerHTML="<strong>System Name </strong>";
h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",f),l=alib.dom.createElement("div",g);l.innerHTML=c.name;g.appendChild(l);f.appendChild(g);f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);h=alib.dom.createElement("div",b);h.innerHTML="<strong>Icon </strong>";h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",f),m=alib.dom.createElement("input",g);m.setAttribute("maxLength",128);m.type="text";m.style.width="160px";m.value=null!=c.icon&&
""!=c.icon?c.icon:"";m.onchange=function(){c.icon=m.value};g.appendChild(m);f.appendChild(g);f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);h=alib.dom.createElement("div",b);h.innerHTML="<strong>Tooltip </strong>";h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",f),n=alib.dom.createElement("input",g);n.setAttribute("maxLength",128);n.type="text";n.style.width="160px";n.value=null!=c.tooltip&&""!=c.tooltip?c.tooltip:"";n.onchange=function(){c.tooltip=n.value};
g.appendChild(n);f.appendChild(g);f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);h=alib.dom.createElement("div",b);h.innerHTML="<strong>Type </strong>";h.style.padding="3px";g.appendChild(h);g=alib.dom.createElement("td",f);h=alib.dom.createElement("select",g);h.onchange=function(){a.updateNavigationItemType(c.name,c.type,this.value);c.type=this.value;a.buildItemDetails(a,right_div,c)};h[h.length]=new Option("Browse","browse");h[h.length]=new Option("Calendar","calendar");h[h.length]=
new Option("Folder","folder");h[h.length]=new Option("Link","link");h[h.length]=new Option("My Mini Calendar","myminical");h[h.length]=new Option("My Calendars","mycalendars");h[h.length]=new Option("My Other Calendars","myothercals");h[h.length]=new Option("Object","object");h[h.length]=new Option("Settings","settings");h.value=c.type;g.appendChild(h);f.appendChild(g);if("browse"==c.type||"object"==c.type){var h=alib.dom.createElement("div",b),f=alib.dom.createElement("tr",e),g=alib.dom.createElement("td",
f),o=alib.dom.createElement("div",h);o.innerHTML="<strong>Object Type </strong>";o.style.padding="3px";g.appendChild(o);var g=alib.dom.createElement("td",f),p=alib.dom.createElement("select",g);p.onchange=function(){c.obj_type=this.value;a.buildItemDetails(a,right_div,c)};a.objTypes?a.addObjectTypes(p,c.obj_type):(ajax=new CAjax("json"),ajax.onload=function(b){b&&(a.objTypes=b,a.addObjectTypes(p,c.obj_type),p.value=c.obj_type)},ajax.exec("/controller/Object/getObjects"));g.appendChild(p);f.appendChild(g);
if("browse"==c.type){var o=new CAntObject(c.obj_type,null),f=alib.dom.createElement("tr",e),g=alib.dom.createElement("td",f),q=alib.dom.createElement("div",h);q.innerHTML="<strong>Browse By Field </strong>";q.style.padding="3px";g.appendChild(q);var g=alib.dom.createElement("td",f),r=alib.dom.createElement("select",g);r[r.length]=new Option("Select Field","");for(q=0;q<o.fields.length;q++){var u=o.fields[q],x=!1;u.name==c.browseby&&(x=!0);if("fkey"==u.type||"fkey_multi"==u.type)r[r.length]=new Option(u.title,
u.name,x,x)}r.onchange=function(){""!=r.value&&(c.browseby=r.value)};null!=c.browseby&&(r.value=c.browseby);g.appendChild(r);f.appendChild(g);f=alib.dom.createElement("div",h);alib.dom.styleSet(f,"margin","5px 5px 5px 5px");f.innerHTML="<strong>Filter Browse Results</strong>";f=alib.dom.createElement("div",h);alib.dom.styleSet(f,"margin","5px 5px 5px 5px");g=new CAntObject(c.obj_type,null);c.conditions=g.buildAdvancedQuery(f)}}if("link"==c.type){alib.dom.createElement("div",b);f=alib.dom.createElement("tr",
e);g=alib.dom.createElement("td",f);h=alib.dom.createElement("div",b);h.innerHTML="<strong>Link </strong>";h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",f),t=alib.dom.createElement("input",g);t.setAttribute("maxLength",128);t.type="text";t.style.width="160px";t.value=null!=c.url&&""!=c.url?c.url:"http://";t.onchange=function(){if(""!=t.value||"http://"!=t.value)c.url=t.value};g.appendChild(t);f.appendChild(g)}"folder"==c.type&&(alib.dom.createElement("div",b),f=alib.dom.createElement("tr",
e),g=alib.dom.createElement("td",f),h=alib.dom.createElement("div",b),h.innerHTML="<strong>Folder </strong>",h.style.padding="3px",g.appendChild(h),g=alib.dom.createElement("td",f),h=new CButton("Select Folder",a.selectFolder,[c],"b1"),g.appendChild(h.getButton()),f.appendChild(g));if("calendar"==c.type){f=alib.dom.createElement("tr",e);g=alib.dom.createElement("td",f);h=alib.dom.createElement("div");h.innerHTML="<strong>Calendar </strong>";h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",
f),v=alib.dom.createElement("select",g);v.app=a.app;v[v.length]=new Option("Select Calendar","");for(q=0;q<a.app.refCalendars.length;q++)v[v.length]=new Option(v.app.refCalendars[q].name,v.app.refCalendars[q].id);v.onchange=function(){""!=v.value&&(c.calendar_id=v.value)};null!=c.calendar_id&&(v.value=c.calendar_id);g.appendChild(v);f.appendChild(g)}d.appendChild(e)}else b.innerHTML="<div class='loading'></div>",window.setTimeout(function(){a.buildItemDetails(a,b,c)},1E3)};
AntAppSettings.prototype.addNavigationItems=function(a){for(var b=0;b<this.navigation_items.length;b++){var c=this.navigation_items[b].type;a[a.length]=new Option(this.navigation_items[b].title,"myminical"==c||"mycalendars"==c||"myothercals"==c?"mycalendar":this.navigation_items[b].name)}};
AntAppSettings.prototype.deleteNavigationItem=function(a,b){for(var c=0;c<this.navigation_items.length;c++)if(this.navigation_items[c].name==a&&this.navigation_items[c].type==b){this.navigation_items.splice(c,1);break}};AntAppSettings.prototype.updateNavigationItemName=function(a,b,c){for(var d=0;d<this.navigation_items.length;d++)if(this.navigation_items[d].name==a){this.navigation_items[d].name=b;this.navigation_items[d].title=c;break}};
AntAppSettings.prototype.updateNavigationItemType=function(a,b,c){for(var d=0;d<this.navigation_items.length;d++)if(this.navigation_items[d].name==a&&this.navigation_items[d].type==b){this.navigation_items[d].type=c;break}};
AntAppSettings.prototype.addSection=function(a,b,c){var d=new CDialog("New Section"),e=alib.dom.createElement("div"),f=alib.dom.createElement("table",e),g=alib.dom.createElement("tbody",f),h=alib.dom.createElement("tr",g),k=alib.dom.createElement("td",h),l=alib.dom.createElement("div",e);l.innerHTML="<strong>Title: </strong>";l.style.padding="3px";k.appendChild(l);var k=alib.dom.createElement("td",h),m=alib.dom.createElement("input",k);m.setAttribute("maxLength",128);m.type="text";m.style.width="160px";
m.value="";k.appendChild(m);h.appendChild(k);f.appendChild(g);f=alib.dom.createElement("div");alib.dom.styleSet(f,"float","right");a=new CButton("Ok",function(a){""!=m.value&&a.appendSection(m.value,b,c);d.hide()},[a],"b1");f.appendChild(a.getButton());a=new CButton("Cancel",function(){d.hide()},null,"b1");f.appendChild(a.getButton());e.appendChild(f);d.customDialog(e,238,48)};
AntAppSettings.prototype.appendSection=function(a,b,c){b=alib.dom.createElement("div",b);DragAndDrop.registerDragableChild(null,b,null,"main_dz");alib.dom.styleSet(b,"margin","5px 3px 5px 3px");b.style.border="1px solid black";b.style.cursor="move";b.title=a;b.nav_type="section";var d=alib.dom.createElement("div",b);alib.dom.styleSet(d,"margin","3px 3px 3px 3px");var e=alib.dom.createElement("div");e.title=a;alib.dom.styleSet(e,"margin","0 100px 0 0");e.innerHTML="<strong>"+a+"</strong>";a=alib.dom.createElement("div");
alib.dom.styleSet(a,"margin","0 3px 0 0");alib.dom.styleSet(a,"float","right");var f=new CButton("Rename",this.renameSection,[e],"b1",null,null,null,"link");a.appendChild(f.getButton());var g=alib.dom.createElement("div");alib.dom.styleSet(g,"float","right");f=new CButton("X",this.deleteItem,[b,c],"b3",null,null,null,"link");g.appendChild(f.getButton());d.appendChild(g);d.appendChild(a);d.appendChild(e);alib.dom.createElement("div",b).style.height="5px";d=alib.dom.createElement("div",b);DragAndDrop.registerDropzone(d,
"section_dz");DragAndDrop.registerSortable(d);b=alib.dom.createElement("a",b);b.href="javascript:void(0);";b.innerHTML="<center>Add item/link to section</center>";b.items=d;b.ref=this;b.onclick=function(){alib.dom.styleSet(this.ref.resetDefault,"display","block");this.ref.addItem(this.items,c)}};
AntAppSettings.prototype.renameSection=function(a){var b=new CDialog("Rename Section"),c=alib.dom.createElement("div"),d=alib.dom.createElement("table",c),e=alib.dom.createElement("tbody",d),f=alib.dom.createElement("tr",e),g=alib.dom.createElement("td",f),h=alib.dom.createElement("div",c);h.innerHTML="<strong>Title: </strong>";h.style.padding="3px";g.appendChild(h);var g=alib.dom.createElement("td",f),k=alib.dom.createElement("input",g);k.setAttribute("maxLength",128);k.type="text";k.style.width=
"160px";k.value=a.parentNode.parentNode.title;g.appendChild(k);f.appendChild(g);d.appendChild(e);d=alib.dom.createElement("div");alib.dom.styleSet(d,"float","right");e=new CButton("Ok",function(){""!=k.value&&(a.parentNode.parentNode.title=k.value,a.innerHTML="<strong>"+k.value+"</strong>");b.hide()},null,"b1");d.appendChild(e.getButton());e=new CButton("Cancel",function(){b.hide()},null,"b1");d.appendChild(e.getButton());c.appendChild(d);b.customDialog(c,238,48)};
AntAppSettings.prototype.addObjectTypes=function(a,b){for(type in this.objTypes){var c=this.objTypes[type],d=!1;c.name==b&&(d=!0);a[a.length]=new Option(c.fullTitle,c.name,d)}};
AntAppSettings.prototype.addItem=function(a,b){this.navigation_items[this.navigation_items.length]={title:"New Item",name:"new_item",type:"link"};var c=alib.dom.createElement("div",a);DragAndDrop.registerDragableChild(a.parentNode,c,null,"section_dz");alib.dom.styleSet(c,"margin","5px 3px 5px 3px");c.style.border="1px solid black";c.style.cursor="move";c.nav_type="item";c.name="new_item";c.type="link";c.title="New Item";c.url="http://www.aereus.com";var d=alib.dom.createElement("div",c);alib.dom.styleSet(d,
"margin","3px 3px 3px 3px");var e=alib.dom.createElement("div");alib.dom.styleSet(e,"margin","0 100px 0 0");e.innerHTML=c.title;var f=alib.dom.createElement("div");alib.dom.styleSet(f,"margin","0 3px 0 0");alib.dom.styleSet(f,"float","right");var g=new CButton("Options",this.buildItemDetails,[this,b,c],"b1",null,null,null,"link");f.appendChild(g.getButton());var h=alib.dom.createElement("div");alib.dom.styleSet(h,"float","right");g=new CButton("X",function(a,b,c){a.deleteItem(b,c);a.deleteNavigationItem(b.name,
b.type)},[this,c,b],"b3",null,null,null,"link");h.appendChild(g.getButton());d.appendChild(h);d.appendChild(f);d.appendChild(e);alib.dom.createElement("div",c).style.height="5px"};AntAppSettings.prototype.deleteItem=function(a,b){a.style.display="none";a.conState=!1;b.innerHTML="";var c=alib.dom.createElement("p",b);alib.dom.styleSet(c,"margin","0 0 0 5px");alib.dom.styleSetClass(c,"notice");c.innerHTML="Select an item to the left to edit properties or click Add item to create a new item"};
AntAppSettings.prototype.selectFolder=function(a){var b=new AntFsOpen;b.filterType="folder";b.onSelect=function(b){a.folder_id=b};b.showDialog()};
AntAppSettings.prototype.saveLayout=function(a){for(var b=0;b<a.childNodes.length;b++)if(a.childNodes[b].nav_type)switch(a.childNodes[b].nav_type){case "section":if(!1!=a.childNodes[b].conState){var c=escape(a.childNodes[b].title);this.nav_xml+="<section title='"+c+"'>";this.saveLayout(a.childNodes[b]);this.nav_xml+="</section>"}break;case "item":if(!1!=a.childNodes[b].conState){var d=" name='"+escape(a.childNodes[b].name)+"'",e=" type='"+a.childNodes[b].type+"'",f="",g="",h="",k="",l="",m=c="",n=
"";if("object"==a.childNodes[b].type||"browse"==a.childNodes[b].type)null!=a.childNodes[b].obj_type&&(f=" obj_type='"+a.childNodes[b].obj_type+"'"),"browse"==a.childNodes[b].type&&null!=a.childNodes[b].browseby&&(g=" browseby='"+a.childNodes[b].browseby+"'");"calendar"==a.childNodes[b].type&&null!=a.childNodes[b].calendar_id&&(h=" id='"+a.childNodes[b].calendar_id+"'");"folder"==a.childNodes[b].type&&null!=a.childNodes[b].folder_id&&(k=" folder_id='"+a.childNodes[b].folder_id+"'");null!=a.childNodes[b].title&&
(c=" title='"+escape(a.childNodes[b].title)+"'");null!=a.childNodes[b].icon&&(m=" icon='"+escape(a.childNodes[b].icon)+"'");null!=a.childNodes[b].tooltip&&(l=" tooltip='"+escape(a.childNodes[b].tooltip)+"'");"link"==a.childNodes[b].type&&null!=a.childNodes[b].url&&(n=" url='"+escape(a.childNodes[b].url)+"'");if("browse"==a.childNodes[b].type&&a.childNodes[b].childNodes[2]||"browse"==a.childNodes[b].type&&null!=a.childNodes[b].conditions)if(null!=a.childNodes[b].conditions&&0<a.childNodes[b].conditions.getNumConditions()){this.nav_xml+=
"<item"+e+d+c+f+m+n+g+h+k+l+">";this.nav_xml+="<filter>";for(c=0;c<a.childNodes[b].conditions.getNumConditions();c++)g=a.childNodes[b].conditions.getCondition(c),d=" blogic='"+g.blogic+"'",e=" field='"+g.fieldName+"'",f=" operator='"+g.operator+"'",g=" value='"+g.condValue+"'",this.nav_xml+="<condition"+d+e+f+g+" />";this.nav_xml+="</filter>";this.nav_xml+="</item>";this.saveLayout(a.childNodes[b])}else this.nav_xml+="<item"+e+d+c+f+m+n+g+h+k+l+">",this.saveLayout(a.childNodes[b]),this.nav_xml+="</item>";
else this.nav_xml+="<item"+e+d+c+f+m+n+g+h+k+l+" />",this.saveLayout(a.childNodes[b])}break;case "filter":this.saveLayout(a.childNodes[b]);break;case "condition":if(null!=a.childNodes[b].parentNode.parentNode.conditions){if(0==a.childNodes[b].parentNode.parentNode.conditions.getNumConditions()&&null!=a.childNodes[b].parentNode.conditions&&"browse"==a.childNodes[b].parentNode.parentNode.type){this.nav_xml+="<filter>";for(c=0;c<a.childNodes[b].parentNode.conditions.length;c++)g=a.childNodes[b].parentNode.conditions[c],
d=" blogic='"+g.blogic+"'",e=" field='"+g.field+"'",f=" operator='"+g.operator+"'",g=" value='"+g.value+"'",g=d+e+f+g,this.nav_xml+="<condition"+g+" />";this.nav_xml+="</filter>"}}else if(null!=a.childNodes[b].parentNode.conditions){this.nav_xml+="<filter>";for(c=0;c<a.childNodes[b].parentNode.conditions.length;c++)g=a.childNodes[b].parentNode.conditions[c],d=" blogic='"+g.blogic+"'",e=" field='"+g.field+"'",f=" operator='"+g.operator+"'",g=" value='"+g.value+"'",g=d+e+f+g,this.nav_xml+="<condition"+
g+" />";this.nav_xml+="</filter>"}}else null!=a.childNodes[b].childNodes&&this.saveLayout(a.childNodes[b]),"end_nav"==a.childNodes[b].id&&this.saveLayoutXml(""!=this.default_type?"<navigation default='"+this.default_type+"'>"+this.nav_xml+"</navigation>":"<navigation>"+this.nav_xml+"</navigation>")};
AntAppSettings.prototype.saveLayoutXml=function(a){var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Saving, please wait...";b.statusDialog(c,150,100);a=[["name",this.app.name],["title",this.app.title],["layout_xml",a]];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a.error?(b.hide(),ALib.statusShowAlert(a.error,3E3,"bottom","right")):(b.hide(),this.cls.checkDefault(),ALib.statusShowAlert(this.cls.app.title+
" Saved!",3E3,"bottom","right"))};ajax.exec("/controller/Application/saveLayout",a)};AntAppSettings.prototype.loadCurrentUser=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.userDetails=a;this.cbData.cls.selectUser(a)};var a=[];this.app.userId&&(a[a.length]=["userId",this.app.userId]);ajax.exec("/controller/User/getUserDetails",a)};
AntAppSettings.prototype.selectUser=function(){if(this.userDetails){this.divScopeUser.innerHTML="";var a=alib.dom.setElementAttr(alib.dom.createElement("input",this.divScopeUser),[["type","button"],["value","Select User"]]),b=alib.dom.setElementAttr(alib.dom.createElement("label",this.divScopeUser),[["innerHTML",this.userDetails.name]]);alib.dom.styleSet(b,"fontWeight","bold");alib.dom.styleSet(b,"fontSize","12px");alib.dom.styleSet(b,"margin","0 5px");a.userDetails=this.userDetails;a.onclick=function(){var a=
new CUserBrowser;a.cls=this;a.userDetails=this.userDetails;a.onSelect=function(a,b){this.userDetails.id=a;this.userDetails.name=b;this.cls.parentNode.childNodes[1].innerHTML=" "+b};a.showDialog()}}};
AntAppSettings.prototype.teamDropdown=function(){var a=new CAntObject("user");a.teamId=this.app.teamId;a.cls=this;a.onteamsloaded=function(a){this.cls.divScopeTeam.innerHTML="";this.cls.teamDropdown=alib.dom.createElement("select",this.cls.divScopeTeam);buildDropdown(this.cls.teamDropdown,[["","Select Team"]]);this.teamDropdown=this.cls.teamDropdown;delete a.teamCount;this.populateTeam(a,a[0].parentId);this.addSpacedPrefix(a)};a.loadTeam()};
AntAppSettings.prototype.toggleScope=function(a){alib.dom.styleSet(this.divScopeUser,"display","none");alib.dom.styleSet(this.divScopeTeam,"display","none");switch(a){case "user":alib.dom.styleSet(this.divScopeUser,"display","inline-block");break;case "team":alib.dom.styleSet(this.divScopeTeam,"display","inline-block")}};
AntAppSettings.prototype.checkDefault=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){a.error&&ALib.statusShowAlert(a.error,3E3,"bottom","right");a&&alib.dom.styleSet(this.cbData.cls.resetDefault,"display","block")};var a=[];a[a.length]=["app",this.app.appName];ajax.exec("/controller/Application/checkNav",a)};
function AntAppDash(a){this.mainCon=a;this.m_processid=this.m_document=null;this.m_container=alib.dom.createElement("div",a);this.dbDropdownCon=this.appNavname=null}AntAppDash.prototype.main=function(){this.m_widgets=[];this.m_cols=[];this.m_menus=[];this.loadWidgets(this.m_container);this.mainCon.id="appDashMainCon";this.m_container.id="appDashCon";this.resize()};AntAppDash.prototype.resize=function(){alib.dom.styleSet(this.mainCon,"height",getWorkspaceHeight()-10+"px")};
AntAppDash.prototype.exit=function(){for(var a=0;a<this.m_menus.length;a++)this.m_menus[a].destroyMenu();this.unloadAllWidgets();this.m_container.innerHTML="";this.m_widgets=this.m_menus=this.m_cols=null};AntAppDash.prototype.onload=function(){};
AntAppDash.prototype.loadWidgets=function(a){a.innerHTML="<div class='loading'></div>";var b=new CAjax;b.m_con=a;b.m_dashclass=this;b.onload=function(a){var b=a.getAttribute("width"),e=new CSplitContainer("verticle",b);this.m_con.innerHTML="";this.m_dashclass.addWidgetSettings(this.m_con,b);e.m_dashclass=this.m_dashclass;e.onPanelResizeStart=function(){this.m_dashclass.onColResizeStart()};e.onPanelResize=function(){this.m_dashclass.onColResize()};e.resizable=!0;e.print(this.m_con);b=a.getNumChildren();
for(i=0;i<b;i++){var f=a.getChildNode(i);if("column"==f.m_name){var g=f.getAttribute("width"),h=e.addPanel(g);this.m_dashclass.m_cols||(this.m_dashclass.m_cols=[]);this.m_dashclass.m_cols[this.m_dashclass.m_cols.length]=h;var k=new CWidgetBox("dz_home","100px");k.m_cls=this.m_dashclass;k.onMoved=function(){this.m_cls.saveLayout()};k.onBeforeMove=function(){};k.print(h);k=f.getNumChildren();for(w=0;w<k;w++){var l=f.getChildNode(w);if("widget"==l.m_name){var m="",n="",o="",p="",q="",r=l.getNumChildren();
for(j=0;j<r;j++){var u=l.getChildNode(j);switch(u.m_name){case "class":m=u.m_text?unescape(u.m_text):"";break;case "title":n=u.m_text?unescape(u.m_text):"";break;case "id":o=u.m_text?unescape(u.m_text):"";break;case "removable":p=u.m_text?unescape(u.m_text):"";break;case "data":q=u.m_text?unescape(u.m_text):""}}this.m_dashclass.addWidget(h,o,n,m,p,!1,q,g)}}}}e.addPanel("*");this.m_dashclass.loadAllWidgets()};b.exec("/applications/xml_getwidgets.awp?appNavname="+this.appNavname)};
AntAppDash.prototype.loadWidget=function(a,b){var c=new CAjax;c.m_col=this.m_cols[b];c.m_dashclass=this;c.onload=function(a){var b=a.getNumChildren();for(i=0;i<b;i++){var c=a.getChildNode(i);if("column"==c.m_name){var g=c.getAttribute("width"),h=c.getNumChildren();for(w=0;w<h;w++){var k=c.getChildNode(w);if("widget"==k.m_name){var l="",m="",n="",o="",p="",q=k.getNumChildren();for(j=0;j<q;j++){var r=k.getChildNode(j);switch(r.m_name){case "class":l=r.m_text?unescape(r.m_text):"";break;case "title":m=
r.m_text?unescape(r.m_text):"";break;case "id":n=r.m_text?unescape(r.m_text):"";break;case "removable":o=r.m_text?unescape(r.m_text):"";break;case "data":p=r.m_text?unescape(r.m_text):""}}this.m_dashclass.addWidget(this.m_col,n,m,l,o,!0,p,g)}}}}};c.exec("/applications/xml_getwidgets.awp?eid="+a+"&appNavname="+this.appNavname)};
AntAppDash.prototype.addWidgetNew=function(a,b,c,d,e,f,g,h){var f=a.childNodes[a.childNodes.length-1],k=this.m_widgets.length,l=new CWidgetBox("dz_home");l.m_cls=this;l.m_wind=k;l.onMoved=function(){this.m_cls.saveLayout();this.m_cls.m_widgets[this.m_wind].main()};l.onBeforeMove=function(){this.m_cls.m_widgets[this.m_wind].exit()};k=l.getCon();k.m_id=b;l.printBefore(a,f);a=alib.dom.createElement("div",k);alib.dom.styleSetClass(a,"dbWidget");l=alib.dom.createElement("div",a);alib.dom.styleSetClass(l,
"dbWidgetHeader");f=alib.dom.createElement("div",l);alib.dom.styleSetClass(f,"dbWidgetOpt");l=alib.dom.createElement("div",l);alib.dom.styleSetClass(l,"dbWidgetTitle");k=alib.dom.createElement("div",a);alib.dom.styleSetClass(k,"dbWidgetBody");l.innerHTML=c;c=eval("new "+d+"()");d="CWidReport";c.widgetWidth=h.replace("px","");"undefined"!=typeof g&&(c.m_data=g);d=new CDropdownMenu;d.handleDuplicates=!0;"t"==e&&d.addEntry("Remove Widget",function(a,b){a.unloadWidget(b)},null,null,[this,b]);f.appendChild(d.createImageMenu("/images/icons/gear_16.png",
"/images/icons/gear_16.png","/images/icons/gear_16.png"));DragAndDrop.registerDragable(l,a,"dz_home");b=ALib.m_document.createElement("div");b.innerHTML="Move: "+l.innerHTML;DragAndDrop.setDragGuiCon(l,b,15,15)};
AntAppDash.prototype.addWidget=function(a,b,c,d,e,f,g,h){var k=a.childNodes[a.childNodes.length-1],l=this.m_widgets.length,m=new CWidgetBox("dz_home");m.m_cls=this;m.m_wind=l;m.onMoved=function(){this.m_cls.saveLayout();this.m_cls.m_widgets[this.m_wind].main()};m.onBeforeMove=function(){this.m_cls.m_widgets[this.m_wind].exit()};var n=m.getCon();n.m_id=b;m.printBefore(a,k);a=alib.dom.createElement("div",n);alib.dom.styleSetClass(a,"dbWidget");var o=alib.dom.createElement("div",a);alib.dom.styleSetClass(o,
"dbWidgetHeader");k=alib.dom.createElement("div",o);alib.dom.styleSetClass(k,"dbWidgetOpt");o=alib.dom.createElement("div",o);alib.dom.styleSetClass(o,"dbWidgetTitle");var p=alib.dom.createElement("div",a);alib.dom.styleSetClass(p,"dbWidgetBody");o.innerHTML=c;n.m_con=p;c=eval("new "+d+"()");c.m_wbox=m;c.m_dashclass=this;c.m_container=p;c.m_widTitle=o;c.m_id=b;c.appNavname=this.appNavname;d="CWidReport";c.widgetWidth=h.replace("px","");"undefined"!=typeof g&&(c.m_data=g);d=new CDropdownMenu;d.handleDuplicates=
!0;this.m_menus.push(d);c.m_dm=d;"t"==e&&d.addEntry("Remove Widget",function(a,b){a.unloadWidget(b)},null,null,[this,b]);k.appendChild(d.createImageMenu("/images/icons/gear_16.png","/images/icons/gear_16.png","/images/icons/gear_16.png"));DragAndDrop.registerDragable(o,a,"dz_home");b=ALib.m_document.createElement("div");b.innerHTML="Move: "+o.innerHTML;DragAndDrop.setDragGuiCon(o,b,15,15);("undefined"==typeof f||!0==f)&&c.main();this.m_widgets[l]=c};
AntAppDash.prototype.loadAllWidgets=function(){for(var a=0;a<this.m_widgets.length;a++)this.m_widgets[a].main()};AntAppDash.prototype.unloadAllWidgets=function(){for(var a=0;a<this.m_widgets.length;a++)this.m_widgets[a].exit(),this.m_widgets[a].m_dm&&this.m_widgets[a].m_dm.destroyMenu()};
AntAppDash.prototype.onColResize=function(){this.loadAllWidgets();var a=[];a[0]=["num_cols",this.m_cols.length];a[1]=["appNavname",this.appNavname];for(var b=0;b<this.m_cols.length;b++)a[a.length]=["col_"+b,this.m_cols[b].offsetWidth+"px"];ajax=new CAjax("json");ajax.exec("/controller/Application/dashboardSaveLayoutResize",a)};
AntAppDash.prototype.onColResizeStart=function(){this.unloadAllWidgets();for(var a=0;a<this.m_cols.length;a++)for(var b=0;b<this.m_cols[a].childNodes.length;b++)this.m_cols[a].childNodes[b].m_id&&(this.m_cols[a].childNodes[b].m_con.innerHTML="")};
AntAppDash.prototype.saveLayout=function(){var a=[];a[0]=["num_cols",this.m_cols.length];a[1]=["appNavname",this.appNavname];for(var b=0;b<this.m_cols.length;b++){for(var c="",d=0;d<this.m_cols[b].childNodes.length;d++)this.m_cols[b].childNodes[d].m_id&&(c+=c?":":"",c+=this.m_cols[b].childNodes[d].m_id);a[a.length]=["col_"+b,c]}ajax=new CAjax("json");ajax.exec("/controller/Application/dashboardSaveLayout",a)};
AntAppDash.prototype.unloadWidget=function(a){var b=[];b[0]=["eid",a];b[1]=["appNavname",this.appNavname];for(var c=0;c<this.m_widgets.length;c++)if(this.m_widgets[c].m_id==a){ajax=new CAjax("json");ajax.cls=this;ajax.wid=this.m_widgets[c];ajax.onload=function(a){this.cls.unloadWidgetCb(a,this.wid)};ajax.exec("/controller/Application/dashboardDelWidget",b);break}};AntAppDash.prototype.unloadWidgetCb=function(a,b){b.m_wbox.getCon().parentNode.removeChild(b.m_wbox.getCon());b.exit();delete b};
AntAppDash.prototype.addWidgetSettings=function(a){var b=ALib.m_document.createElement("table"),c=ALib.m_document.createElement("tbody");b.style.cssFloat="right";b.style.marginRight="20px";b.style.width="total_width";b.appendChild(c);var d=ALib.m_document.createElement("tr");c.appendChild(d);c=ALib.m_document.createElement("td");d.appendChild(c);this.dbDropdownCon=ALib.m_document.createElement("td");d.appendChild(this.dbDropdownCon);c=ALib.m_document.createElement("td");d.appendChild(c);var e=ALib.m_document.createElement("a");
e.href="javascript: void(0)";e.innerHTML="+Add Widget";e.cls=this;e.onclick=function(){var a=new CWidgetBrowser;a.appNavname=this.cls.appNavname;a.m_cls=this.cls;a.onSelect=function(a){var b=this.m_cls,c=[];c[0]=["wid",a];c[1]=["appNavname",b.appNavname];ajax=new CAjax("json");ajax.cls=b;ajax.onload=function(a){this.cls.loadWidget(a,0)};ajax.exec("/controller/Application/addWidget",c)};a.showDialog()};c.appendChild(e);c=ALib.m_document.createElement("td");d.appendChild(c);a.appendChild(b);b=ALib.m_document.createElement("div");
b.style.clear="both";a.appendChild(b);this.onload()};function NotificationMan(){this.notifications=[];this.antView=this.popup=this.listCon=this.outerCon=this.iconCon=this.refreshTimer=null;this.getNotifications()}NotificationMan.prototype.renderView=function(a){this.antView=a;this.listCon=a.con;this.renderList()};
NotificationMan.prototype.anchorToEl=function(a){this.iconCon=alib.dom.createElement("a",a,"<img src='/images/icons/notification_24_off.png' style='vertical-align:middle;'>");this.iconCon.href="javascript:void(0);";this.outerCon=alib.dom.createElement("div",document.body);alib.dom.styleSet(this.outerCon,"position","absolute");alib.dom.styleSet(this.outerCon,"display","none");alib.dom.styleSetClass(this.outerCon,"chatMessenger");var b=alib.dom.createElement("div",this.outerCon);alib.dom.styleSetClass(b,
"chatMessengerTitle");b.innerHTML="Notifications";this.listCon=alib.dom.createElement("div",this.outerCon);alib.dom.styleSetClass(this.listCon,"chatMessengerList");var c=new alib.ui.Popup(this.outerCon);c.anchorToEl(this.iconCon,"down");a.onclick=function(){c.setVisible()};this.popup=c;alib.events.listen(c,"onShow",{context:this,method:"renderList"})};
NotificationMan.prototype.renderList=function(){if(null!=this.listCon){this.listCon.innerHTML="";0==this.notifications.length&&(this.listCon.innerHTML="There are no notifications at this time");for(var a in this.notifications){var b=this.notifications[a],c=alib.dom.createElement("div",this.listCon);alib.dom.styleSetClass(c,"actListRow");!1===b.getValue("f_seen")&&alib.dom.styleAddClass(c,"unread");c.not=b;c.cls=this;c.onclick=function(){if(this.not.getValue("obj_reference")){var a=this.not.getValue("obj_reference").split(":");
2==a.length&&this.cls.loadObject(a[0],a[1])}else this.cls.showPopup(this.not);this.cls.popup&&this.cls.popup.setVisible();this.not.setValue("f_seen",!0);this.not.save()};var d="";if(b.getValue("owner_id")!=b.getValue("creator_id")&&b.getValue("creator_id"))var e="/files/userimages/"+b.getValue("creator_id"),e=e+"/48/48",d=d+("<div class='mainImage'><img src='"+e+"' style='width:48px;' /></div>");d+=b.getValue("description")+"<br />";d+=b.getValue("ts_execute");d+="<div style='clear:both;'></div>";
c.innerHTML=d;alib.events.listen(c,"click",function(a){!1==a.data.objNot.getValue("f_seen")&&a.data.cls.setRefresh(2E3)},{objNot:b,row:c,cls:this})}}};
NotificationMan.prototype.getNotifications=function(a){a||(this.notifications=[]);var b=new AntObjectList("notification");b.addCondition("and","owner_id","is_equal",-3);b.addCondition("and","ts_execute","is_less_or_equal","now");b.cbData.cls=this;b.cbData.updateMode=a||!1;b.addSortOrder("ts_execute","desc");b.onLoad=function(){for(var a=0;a<this.getNumObjects();a++)this.cbData.cls.addNotification(this.getObject(a),this.cbData.updateMode);this.cbData.cls.antView&&this.cbData.cls.antView.isActive&&
this.cbData.cls.renderList();this.cbData.cls.updateDisplays()};b.getObjects(0,25);this.setRefresh()};NotificationMan.prototype.addNotification=function(a,b){for(var c in this.notifications){var d=this.notifications[c];if(d.id==a.id){d.getValue("f_seen")!=a.getValue("f_seen")&&(this.notifications[c]=a);return}}b?this.notifications.unshift(a):this.notifications.push(a);!0==a.getValue("f_popup")&&!1==a.getValue("f_seen")&&this.showPopup(a)};
NotificationMan.prototype.showPopup=function(a){var b=new CDialog("Notificaiton"),c=alib.dom.createElement("div");alib.dom.createElement("h2",c).innerHTML=a.getValue("name");var d=alib.dom.createElement("p",c),e=a.getValue("description");d.innerHTML=e.replace(/\n/g,"<br />");if(d=a.getValue("obj_reference"))d=d.split(":"),2==d.length&&(e=alib.dom.createElement("p",c),e=alib.dom.createElement("a",e),e.href="javascript:void(0);",e.dlg=b,e.objType=d[0],e.oid=d[1],e.cls=this,e.notification=a,e.onclick=
function(){loadObjectForm(this.objType,this.oid);this.cls.dismiss(this.notification);this.dlg.hide()},e.innerHTML="Click for more information");d=alib.dom.createElement("div",c);alib.ui.Button("Dismiss",{className:"b1",tooltip:"Dismiss this notice",dlg:b,cls:this,notification:a,onclick:function(){this.dlg.hide();this.cls.dismiss(this.notification)}}).print(d);b.customDialog(c,500)};NotificationMan.prototype.dismiss=function(a){a.setValue("f_seen",!0);a.save()};
NotificationMan.prototype.setRefresh=function(a){if(this.refreshTimer)if(a)window.clearTimeout(this.refreshTimer);else return;var b=this;this.refreshTimer=window.setTimeout(function(){b.refreshTimer=null;b.getNotifications(!0)},a||1E4)};
NotificationMan.prototype.updateDisplays=function(){var a=0,b;for(b in this.notifications)!0!=this.notifications[b].getValue("f_seen")&&a++;a?this.iconCon&&(this.iconCon.innerHTML="<img src='/images/icons/notification_24_on.png' style='vertical-align:middle;'> ("+a+")"):this.iconCon&&(this.iconCon.innerHTML="<img src='/images/icons/notification_24_off.png' style='vertical-align:middle;'>");"undefined"!=typeof Ant&&Ant.updateAppTitle(a,"notifications")};
NotificationMan.prototype.loadObject=function(a,b){if(this.antView){if(!this.antView.getView(a+":"+b)){var c=this.antView.addView(a+":[id]",{obj_type:a});c.render=function(){};c.onshow=function(){if(this.options.lastLoaded==this.variable)return!0;this.title=this.con.innerHTML="";var a=new AntObjectLoader(this.options.obj_type,this.variable);a.setAntView(this);a.print(this.con);a.cbData.antView=this;a.onClose=function(){this.cbData.antView.goup()};a.onRemove=function(){};this.options.lastLoaded=this.variable}}this.antView.navigate(a+
":"+b)}else loadObjectForm(a,b)};Ant.Searcher=function(){this.xhr=this.popup=this.button=this.inpt=null};
Ant.Searcher.prototype.render=function(a){this.inpt=alib.dom.createElement("input",a);this.inpt.placeholder="Search";this.button=alib.dom.createElement("button",a,"Go");this.resultsCon=alib.dom.createElement("div",a);alib.dom.styleSetClass(this.resultsCon,"searcherPopup");this.popup=new alib.ui.Popup(this.resultsCon);this.popup.anchorToEl(this.inpt,"down","left");alib.events.listen(this.inpt,"keyup",function(a){a.data.cls.showResults()},{cls:this});alib.events.listen(this.inpt,"focus",function(a){a.data.cls.showResults()},
{cls:this})};Ant.Searcher.prototype.showResults=function(){this.inpt.value?(alib.dom.styleSet(this.resultsCon,"width",alib.dom.getElementWidth(this.inpt)-10+"px"),this.popup.setVisible(!0),this.inpt.value!=this.lastQuery&&(this.resultsCon.innerHTML="Searching...",this.getResults())):this.popup.setVisible(!1)};
Ant.Searcher.prototype.getResults=function(){this.inpt.value!=this.lastQuery&&(null!=this.xhr&&this.xhr.isInProgress()&&this.xhr.abort(),this.xhr=new alib.net.Xhr,alib.events.listen(this.xhr,"load",function(a){a.data.searchCls.resultsCon.innerHTML="";var b=this.getResponse(),c;for(c in b){var d=b[c];if(0<d.length){var e=alib.dom.createElement("div",a.data.searchCls.resultsCon,c);alib.dom.styleSetClass(e,"searcherGroupHeader")}for(var f in d){var g=d[f],e=alib.dom.createElement("div",a.data.searchCls.resultsCon);
alib.dom.styleSetClass(e,"searcherItemRow");e.innerHTML="<img src='/images/icons/objects/"+g.iconName+"_16.png' /> "+g.title;e.oid=g.id;e.objType=g.objType;e.onclick=function(){loadObjectForm(this.objType,this.oid);a.data.searchCls.popup.setVisible(!1)}}}},{searchCls:this}),alib.events.listen(this.xhr,"error",function(){},{searchCls:this}),this.xhr.send("/controller/Search/query","GET",{q:this.inpt.value}),this.lastQuery=this.inpt.value)};
function AntChatMessenger(){this.conFriendAdd=this.conTeamListLoading=this.conFriendListLoading=this.conTeamList=this.conFriendList=this.conChatList=this.bodyCon=this.headerCon=this.mainCon=this.outerCon=null;this.icon_online="<img src='/images/icons/available.png' border='0' />";this.icon_offline="<img src='/images/icons/offline.png' border='0' />";this.chatCloseState=!1;this.chatFloatType="right";this.chatFloatMargin="0px";this.chatHeight="300";this.friendLoaded=this.chatPopup=this.chatPopup=!1;
this.teamId=this.teamName=null;this.onlineCount=0;this.g_chatTimer=[];this.g_timerCount=[];this.g_friendList=[];this.userLoggedIn=!0;this.linkCon=this.chatsCon=this.popup=null;this.lastSoundPlayed=0;this.audio=null;this.clientSessions=[];this.antView=null}AntChatMessenger.prototype.renderView=function(a){this.antView=a;this.print(a.con)};
AntChatMessenger.prototype.print=function(a){this.linkCon=a;this.outerCon=this.antView?alib.dom.createElement("div",a):alib.dom.createElement("div",document.body);this.outerCon.setAttribute("id","antChatCon");this.antView||(alib.dom.styleSet(this.outerCon,"position","absolute"),alib.dom.styleSet(this.outerCon,"display","none"),alib.dom.styleSet(this.outerCon,"z-index","10000"));var b=alib.dom.getClientWidth()-260;this.chatsCon=alib.dom.createElement("div",this.outerCon);this.antView||(alib.dom.styleSet(this.chatsCon,
"position","absolute"),alib.dom.styleSet(this.chatsCon,"left","-"+b+"px"),alib.dom.styleSet(this.chatsCon,"width",b+"px"),alib.dom.styleSet(this.chatsCon,"margin-right","260px"),alib.dom.styleSet(this.chatsCon,"height","1px"));if(!this.antView){var c=new alib.ui.Popup(this.outerCon);c.anchorToEl(a,"down");a.onclick=function(){c.setVisible()};this.popup=c;alib.events.listen(this.popup,"onHide",function(a){for(var b in a.data.msngr.clientSessions)a.data.msngr.clientSessions[b].isVisible=!1},{msngr:this});
alib.events.listen(this.popup,"onShow",function(a){for(var b in a.data.msngr.clientSessions)a.data.msngr.clientSessions[b].isRendered&&(a.data.msngr.clientSessions[b].isVisible=!0)},{msngr:this})}this.mainCon=alib.dom.createElement("div");this.mainCon.setAttribute("id","chatMessengerCon");this.antView||(alib.dom.styleSet(this.mainCon,"float",this.chatFloatType),alib.dom.styleSet(this.mainCon,"margin"+this.chatFloatType.capitalize(),this.chatFloatMargin),alib.dom.styleSetClass(this.mainCon,"chatMessenger"));
this.bodyCon=alib.dom.createElement("div",this.mainCon);this.bodyCon.setAttribute("id","chatMessengerBody");this.antView||alib.dom.styleSet(this.bodyCon,"width","250px");!this.chatPopup&&!this.antView&&this.buildHeader();this.conChatList=alib.dom.createElement("div",this.bodyCon);this.conChatList.setAttribute("id","chatMessengerList");this.antView||(alib.dom.styleSet(this.conChatList,"height",this.chatHeight+"px"),alib.dom.styleSet(this.conChatList,"margin","5px"),alib.dom.styleSet(this.conChatList,
"overflow-y","scroll"));this.conFriendList=alib.dom.createElement("div",this.conChatList);this.conFriendList.setAttribute("id","chatMessengerFriendList");this.conTeamList=alib.dom.createElement("div",this.conChatList);this.conTeamList.setAttribute("id","chatMessengerTeamList");alib.dom.styleSet(this.conTeamList,"marginBottom","15px");this.conFriendListLoading=alib.dom.createElement("div",this.conFriendList);this.conFriendListLoading.setAttribute("id","chatMessengerFriendLoading");this.conFriendListLoading.innerHTML=
" <div class='loading'></div>";this.conFriendAdd=alib.dom.createElement("div",this.bodyCon);alib.dom.styleSet(this.conFriendAdd,"margin","5px");this.audio=alib.dom.createElement("audio",this.outerCon);this.audio.innerHTML='<source src="/media/audio/ding.mp3" type="audio/mpeg"><source src="/media/audio/ding.wav" type="audio/wav">';ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){"-1"!=a.retVal&&(this.cls.teamName=a.team_name,this.cls.teamId=a.team_id,this.cls.buildInterface())};ajax.exec("/controller/Chat/getUserDetails")};
AntChatMessenger.prototype.buildInterface=function(){if(0<this.teamId){var a=alib.dom.createElement("div",this.conTeamList);alib.dom.styleSet(a,"marginTop","5px");alib.dom.styleSet(a,"fontWeight","bold");a.innerHTML=this.teamName;this.conTeamListLoading=alib.dom.createElement("div",this.conTeamList);this.conTeamListLoading.setAttribute("id","chatMessengerTeamLoading");this.conTeamListLoading.innerHTML=" <div class='loading'></div>"}this.updateFriends();this.getNewMessages();this.checkTimeout();this.setStatus(!0);
this.outerCon.insertBefore(this.mainCon,this.outerCon.firstChild)};
AntChatMessenger.prototype.buildHeader=function(){this.headerCon=alib.dom.createElement("div",this.bodyCon);alib.dom.styleSetClass(this.headerCon,"chatMessengerTitle");var a=alib.dom.createElement("div",this.headerCon);alib.dom.styleSet(a,"float","left");alib.dom.styleSet(a,"width","150px");a.innerHTML="Netric Chat";a=alib.dom.createElement("div",this.headerCon);alib.dom.styleSet(a,"float","right");var b=alib.dom.createElement("img",a);alib.dom.styleSet(b,"cursor","pointer");b.setAttribute("src",
"/images/icons/new_window_16.png");alib.dom.styleSet(b,"marginRight","2px");b.m_cls=this;b.onclick=function(){this.m_cls.popup.setVisible(!1);this.m_cls.popupMessenger()};a=alib.dom.createElement("img",a);alib.dom.styleSet(a,"cursor","pointer");a.setAttribute("src","/images/icons/close_16.png");a.m_cls=this;a.onclick=function(){this.m_cls.popup.setVisible(!1)};this.divClear(this.bodyCon)};
AntChatMessenger.prototype.closeWindow=function(){for(var a=0;a<this.g_chatTimer;a++)clearTimeout(this.g_chatTimer[a]);this.outerCon.removeChild(this.mainCon);this.chatCloseState=!0;this.setStatus(!1)};AntChatMessenger.prototype.submitAddFriend=function(a){for(var b=a.getValues(),c=0;c<b.length;c++)(b[c][0]||b[c][1])&&this.addFriend(b[c][1].split(" ")[0]);a.clear()};
AntChatMessenger.prototype.addFriend=function(a){a=[["friendName",a],["teamId",this.teamId]];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){"-1"!=a.retVal?this.cls.updateFriends():alert(a.retError)};ajax.exec("/controller/Chat/addFriend",a)};
AntChatMessenger.prototype.updateFriends=function(){var a=new CAjax("json");a.cls=this;a.onload=function(a){this.cls.updateFriendsTimer();this.cls.friendLoaded||(this.cls.conTeamListLoading&&(this.cls.conTeamListLoading.innerHTML=""),this.cls.conFriendListLoading.innerHTML="",this.cls.friendLoaded=!0);if(a&&a){var c=0;for(i=0;i<a.length;i++){var d=a[i];this.cls.buildFriendList(d);c+=d.online}this.cls.antView||(this.cls.linkCon.innerHTML="<img src='/images/icons/"+(0<c?"chat_24_on.png":"chat_24_off.png")+
"'  style='vertical-align:middle;'>")}};a.exec("/controller/Chat/getFriendList",[["teamId",this.teamId]])};
AntChatMessenger.prototype.buildFriendList=function(a){var b=a.id,c=a.teamId,d=a.friend_name,e=a.friendServer,f=a.fullName,g=a.image,h=a.online,k=this.buildFriendStatus(a);this.g_friendList[d]=a;if(ALib.m_document.getElementById("divFriend_"+b))ALib.m_document.getElementById("divRowFriendStatus_"+b).innerHTML=1==h?this.icon_online:this.icon_offline,ALib.m_document.getElementById("divRowFriendStatusText_"+b).innerHTML="",ALib.m_document.getElementById("divRowFriendStatusText_"+b).appendChild(k);else{var l;
l=c==this.teamId?alib.dom.createElement("div",this.conTeamList):alib.dom.createElement("div",this.conFriendList);alib.dom.styleSet(l,"marginTop","10px");l.setAttribute("id","divFriend_"+b);var m=alib.dom.createElement("div",l);alib.dom.styleSet(m,"width","45px");alib.dom.styleSet(m,"marginRight","5px");alib.dom.styleSet(m,"float","left");m.innerHTML="&nbsp;";m=alib.dom.createElement("img",m);m.setAttribute("id","imgFriend_"+b);alib.dom.styleSet(m,"width","40px");m.setAttribute("src",g);g=alib.dom.createElement("div",
l);alib.dom.styleSet(g,"width","135px");alib.dom.styleSet(g,"float","left");m=alib.dom.createElement("div",g);m.setAttribute("id","friendServer_"+b);alib.dom.styleSet(m,"display","none");m.innerHTML=e;e=alib.dom.createElement("div",g);e.setAttribute("id","friendName_"+b);e.setAttribute("title",d);d=alib.dom.createElement("a",e);alib.dom.styleSet(d,"cursor","pointer");d.innerHTML=f;d.m_cls=this;d.m_friend=a;d.onclick=function(){var a=this.m_friend.friend_name,b=document.getElementById("chatClient_"+
a),a=document.getElementById("divChatInfo_"+a);this.m_cls.chatPopup?this.m_cls.chatFriendPopup(this.m_friend):a||(this.m_cls.antView?this.m_cls.chatFriendView(this.m_friend):b?alib.dom.styleSet(b,"display","block"):this.m_cls.chatFriend(this.m_friend,!0))};a=alib.dom.createElement("div",g);a.setAttribute("id","divRowFriendStatusText_"+b);a.innerHTML="";a.appendChild(k);k=alib.dom.createElement("div",l);alib.dom.styleSet(k,"float","left");k.setAttribute("id","divRowFriendStatus_"+b);k.innerHTML=1==
h?this.icon_online:this.icon_offline;if(c!=this.teamId||0==this.teamId)c=alib.dom.createElement("div",l),alib.dom.styleSet(c,"float","left"),c=alib.dom.createElement("img",c),alib.dom.styleSet(c,"cursor","pointer"),alib.dom.styleSet(c,"marginTop","2px"),c.setAttribute("src","/images/themes/softblue/icons/deleteTask.gif"),c.m_friendRow=l,c.m_friendId=b,c.m_cls=this,c.onclick=function(){this.m_cls.removeFriend(this.m_friendId,this.m_friendRow)};this.divClear(l)}};
AntChatMessenger.prototype.buildFriendStatus=function(a){var b=a.id,c=a.friend_name,d=a.statusText,a=a.inviteStatus,e=alib.dom.createElement("div");alib.dom.styleSet(e,"width","160px");var f=alib.dom.setElementAttr(alib.dom.createElement("a"),[["innerHTML","[Cancel]"]]);alib.dom.styleSet(f,"cursor","pointer");alib.dom.styleSet(f,"color","#0000FF");var g=alib.dom.setElementAttr(alib.dom.createElement("a"),[["innerHTML","[Accept]"]]);alib.dom.styleSet(g,"cursor","pointer");alib.dom.styleSet(g,"color",
"#0000FF");var h=alib.dom.setElementAttr(alib.dom.createElement("span"),[["innerHTML"," | "]]);f.cls=this;f.friendId=b;f.friendName=c;f.onclick=function(){this.cls.processStatus(this.friendId,this.friendName,0)};g.cls=this;g.friendId=b;g.friendName=c;g.statusCon=e;g.onclick=function(){this.cls.processStatus(this.friendId,this.friendName,1,e)};switch(a){case "1":e.innerHTML="Pending Request ";e.appendChild(f);break;case "2":f.innerHTML="[Decline]";e.innerHTML="Friend Invite ";e.appendChild(g);e.appendChild(h);
e.appendChild(f);break;default:e.innerHTML=d}return e};
AntChatMessenger.prototype.processStatus=function(a,b,c,d){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.friendId=a;ajax.cbData.status=c;ajax.cbData.statusCon=d;ajax.onload=function(){if(0==this.cbData.status){var a=document.getElementById("divFriend_"+this.cbData.friendId);a.parentNode.removeChild(a)}else this.cbData.statusCon.innerHTML="Friend successfully added.",this.cbData.cls.updateFriends()};a=[];a[a.length]=["friendName",b];a[a.length]=["status",c];ajax.exec("/controller/Chat/processStatus",
a)};
AntChatMessenger.prototype.getNewMessages=function(){Ant.getUpdateStream().listen("chat",function(a){if(a.data.friendName){var b=a.data.friendName,c=new Date;if((!1==alib.dom.windowVisible||!1==alib.dom.userActive)&&a.data.messenger.lastSoundPlayed<c.getTime()-1E3)a.data.messenger.audio.play(),a.data.messenger.lastSoundPlayed=c;var c=a.data.messenger.g_friendList[b],d=document.getElementById("chatClient_"+b);document.getElementById("divChatInfo_"+b)||(d?a.data.messenger.popup.setVisible(!0):c&&null!=
a.data.messenger.popup&&(a.data.messenger.popup.setVisible(!0),a.data.messenger.chatFriend(c,!1)));a.data.messenger.updateNewMessage(b,"")}},{messenger:this})};AntChatMessenger.prototype.updateNewMessage=function(a,b){this.ajaxClear||(this.ajaxClear=new CAjax("json"),this.ajaxClear.cbData.cls=this,this.ajaxClear.onload=function(){this.cbData.cls.ajaxClear=null},this.ajaxClear.exec("/controller/Chat/clearChatSession",[["type","isNewMessage"],["value",0],["friendName",a],["friendServer",b]]))};
AntChatMessenger.prototype.chatFriend=function(a,b){var c=a.friend_name,d=a.friendServer,e=a.fullName,f=a.image,g=alib.dom.createElement("div",this.chatsCon);g.setAttribute("id","chatClient_"+c);alib.dom.styleSet(g,"float",this.chatFloatType);alib.dom.styleSet(g,"width","275px");alib.dom.styleSet(g,"margin"+this.chatFloatType.capitalize(),"2px");var h=new AntChatClient;h.chatFriendName=c;h.chatFriendFullName=e;h.chatFriendServer=d;h.chatFriendImage=f;h.chatFocus=b;h.print(g);this.clientSessions[c]=
h};
AntChatMessenger.prototype.chatFriendPopup=function(a){var b=a.friend_name,c=a.friendServer,d=a.fullName,a=a.image,e="divChatInfo_"+b,f=document.getElementById(e);f&&document.body.removeChild(f);f=alib.dom.createElement("div");f.setAttribute("id",e);alib.dom.styleSet(f,"display","none");e=alib.dom.createElement("form",f);e.setAttribute("method","post");e.setAttribute("target","formChatInfo_"+b);var g=alib.dom.createElement("input",e);g.setAttribute("name","chatFriendName");g.setAttribute("value",b);
g=alib.dom.createElement("input",e);g.setAttribute("name","chatFriendFullName");g.setAttribute("value",d);g=alib.dom.createElement("input",e);g.setAttribute("name","chatFriendServer");g.setAttribute("value",c);g=alib.dom.createElement("input",e);g.setAttribute("name","chatFriendImage");g.setAttribute("value",a);this.chatPopup&&(document.body.appendChild(f),e.setAttribute("action","/chatloader/client"),window.open("/chatloader/client","popupClient","width=285,height=360,toolbar=no,menubar=no,scrollbars=no,location=no,directories=no,status=no,resizable=yes"),
e.submit())};AntChatMessenger.prototype.chatFriendView=function(a){var b=a.friend_name,c=a.friendServer,d=a.fullName,e=a.image,a=this.antView.getView(b);a||(a=this.antView.addView(b,{cls:this}),a.render=function(){var a=new AntChatClient;a.chatFriendName=b;a.chatFriendFullName=d;a.chatFriendServer=c;a.chatFriendImage=e;a.antView=this;a.print(this.con);this.options.cls.clientSessions[b]=a});this.antView.navigate(b)};
AntChatMessenger.prototype.setStatus=function(a){a=[["type","isOnline"],["value",a],["friendName","[all]"]];ajax=new CAjax("json");ajax.exec("/controller/Chat/saveChatSession",a)};AntChatMessenger.prototype.removeFriend=function(a,b){if(confirm("Are you sure you want to permanantly remove this friend?")){var c=[["friendId",a]];ajax=new CAjax("json");ajax.cell=b;ajax.onload=function(a){"-1"!=a.retVal&&this.cell.parentNode.removeChild(b)};ajax.exec("/controller/Chat/deleteFriend",c)}};
AntChatMessenger.prototype.popupMessenger=function(){var a="width=270,height="+(parseInt(this.chatHeight)+90)+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no,status=no,resizable=no";window.open("/chatloader/messenger","popupMessenger",a)};AntChatMessenger.prototype.divClear=function(a){a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"clear","both")};
AntChatMessenger.prototype.checkTimeout=function(){this.g_chatTimer&&(null==this.g_chatTimer.getNewMessages&&(clearTimeout(this.g_chatTimer.getNewMessages),clearTimeout(this.g_chatTimer.updateFriends),this.updateFriendsTimer(),this.newMessageTimer()),this.g_chatTimer.getNewMessages=null);var a=this;clearTimeout(this.g_chatTimer.checkTimeout);this.g_chatTimer.checkTimeout=window.setTimeout(function(){a.checkTimeout()},6E4)};
AntChatMessenger.prototype.updateFriendsTimer=function(){var a=this;this.g_chatTimer.updateFriends=window.setTimeout(function(){a.updateFriends()},5E4)};AntChatMessenger.prototype.newMessageTimer=function(){var a=this;this.g_chatTimer.getNewMessages=window.setTimeout(function(){a.getNewMessages()},3E3)};
function AntChatClient(){this.conChatSound=this.conChatNotification=this.conChatMessage=this.conChatConv=this.contPrevChat=this.bodyCon=this.headerCon=this.mainCon=this.outerCon=null;this.userImage="/images/icons/objects/user_48.png";this.chatSound=null;this.userIsTyping=!1;this.chatFriendServer=this.chatFriendFullName=this.chatFriendName=null;this.chatFriendImage="/images/icons/objects/user_48.png";this.chatFriendIsTyping=!1;this.chatFriendList=null;this.chatPopup=!1;this.chatLastMessage=this.chatDivLastMessageId=
this.chatDivInfoId=this.chatDivConId=this.chatPopupClient=null;this.chatCurrentDay=this.chatFirstMessageTs=this.chatLastMessageTs=this.chatLastMessageCount=0;this.chatClientHeight="250";this.messageLimit=10;this.g_chatClientTimer=[];this.g_timerCount=[];this.prevChatChecked=!1;this.firstLoad=!0;this.ajaxGetMessages=this.isRendered=this.isVisible=this.chatFocus=!1;this.antView=null}
AntChatClient.prototype.print=function(a){this.outerCon=a;this.mainCon=alib.dom.createElement("div",this.outerCon);alib.dom.styleSetClass(this.mainCon,"chatClient");this.conChatSound=alib.dom.createElement("div",this.mainCon);alib.dom.styleSet(this.conChatSound,"display","none");this.bodyCon=alib.dom.createElement("div",this.mainCon);!this.chatPopup&&!this.antView&&this.buildHeader();this.chatDivInfoId="divChatInfo_"+this.chatFriendName;this.chatDivConId="divChatCon_"+this.chatFriendName;this.conTopTools=
alib.dom.createElement("div",this.bodyCon);this.conPrevChat=alib.dom.createElement("span",this.conTopTools);alib.dom.createElement("span",this.conTopTools,"&nbsp;");this.conClearChat=alib.dom.createElement("span",this.conTopTools);a=alib.dom.createElement("a",this.conClearChat,"Clear Messages");a.href="javascript: void(0);";a.cls=this;a.onclick=function(){this.cls.clearMessages()};this.conChatConv=alib.dom.createElement("div",this.bodyCon);this.conChatConv.setAttribute("id",this.chatDivConId);alib.dom.styleSet(this.conChatConv,
"height",this.chatClientHeight+"px");alib.dom.styleSet(this.conChatConv,"overflow-y","scroll");alib.dom.styleSet(this.conChatConv,"margin","5px");this.conChatConv.innerHTML="<div class='loading'></div>";this.conChatNotification=alib.dom.createElement("div",this.bodyCon);alib.dom.styleSet(this.conChatNotification,"height","15px");alib.dom.styleSet(this.conChatNotification,"marginLeft","5px");this.conChatMessage=alib.dom.createElement("div",this.bodyCon);alib.dom.styleSet(this.conChatMessage,"margin",
"5px");ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){"-1"!=a.retVal&&(this.cls.userImage=a.userImage,this.cls.chatSound=a.chatSound,this.cls.buildInterface())};ajax.exec("/controller/Chat/getUserDetails")};
AntChatClient.prototype.buildInterface=function(){this.getMessage();this.getIsTyping();this.saveIsTyping(0);var a=alib.dom.createElement("textarea",this.conChatMessage);alib.dom.styleSet(a,"width","97%");alib.dom.styleSet(a,"height","50px");a.m_cls=this;a.onblur=function(){this.m_cls.chatFocus=!1};a.onfocus=function(){this.m_cls.chatFocus=!0};a.onclick=function(){this.m_cls.chatFocus=!0};a.onkeypress=function(a){this.m_cls.chatFocus=!0;a=a||window.event;this.m_cls.checkIsTyping(!1);if(a.shiftKey&&
13==a.keyCode)a=document.createTextNode("line break"),"Microsoft Internet Explorer"==navigator.appName?this.innerHTML+=a.outerHTML:this.appendChild(a);else switch(a.keyCode){case 13:var c=this.value;/\S/.test(c)&&(c=c.replace(/(\r\n|\r|\n)/g,"<br />"),this.m_cls.saveMessage(c),this.value="",this.m_cls.saveIsTyping(0));a.preventDefault?a.preventDefault():a.returnValue=!1}};this.lastMessageCheck();this.isRendered=this.isVisible=!0;this.messageTimer()};
AntChatClient.prototype.buildHeader=function(){this.headerCon=alib.dom.createElement("div",this.bodyCon);alib.dom.styleSetClass(this.headerCon,"chatClientTitle");var a=alib.dom.createElement("div",this.headerCon);alib.dom.styleSet(a,"float","left");alib.dom.styleSet(a,"width","150px");a.innerHTML=this.chatFriendFullName;a=alib.dom.createElement("div",this.headerCon);alib.dom.styleSet(a,"float","right");var b=alib.dom.createElement("img",a);alib.dom.styleSet(b,"cursor","pointer");b.setAttribute("src",
"/images/icons/new_window_16.png");alib.dom.styleSet(b,"marginRight","2px");b.m_cls=this;b.onclick=function(){this.m_cls.savePopupState(!0);this.m_cls.popupChatClient();alib.dom.styleSet(this.m_cls.outerCon,"display","none")};a=alib.dom.createElement("img",a);alib.dom.styleSet(a,"cursor","pointer");a.setAttribute("src","/images/icons/close_16.png");a.m_cls=this;a.onclick=function(){this.m_cls.closeWindow();this.m_cls.outerCon.parentNode.removeChild(this.m_cls.outerCon)};this.divClear(this.conFriendAdd)};
AntChatClient.prototype.closeWindow=function(){for(var a in this.g_chatClientTimer)clearTimeout(this.g_chatClientTimer[a]);this.isRendered=this.isVisible=!1};
AntChatClient.prototype.saveMessage=function(a){a=[["message",a],["friendName",this.chatFriendName],["friendServer",this.chatFriendServer]];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){if("-1"!=a.retVal){this.cls.chatLastMessage=a.timestamp;this.cls.chatDivLastMessageId="divLastMessage_"+a.messageTimestamp;a.inline=!0;var c=!1;0<this.cls.chatCurrentDay&&this.cls.chatCurrentDay!==a.day&&(c=!0);this.cls.chatCurrentDay=a.day;this.cls.buildChatInterface(a,!0,this.cls.conChatConv,c);if(this.cls.chatPopup){var d=
window.opener.document.getElementById(this.cls.chatDivConId);d&&("Microsoft Internet Explorer"==navigator.appName?(d={},d.userImage=this.cls.userImage,d.chatFriendName=this.cls.chatFriendName,window.opener.clientLib.buildChatInterface(a,d,c)):(a.inline=!1,this.cls.buildChatInterface(a,!0,d,c)))}}};ajax.exec("/controller/Chat/saveMessage",a)};
AntChatClient.prototype.getPrevChat=function(){0!=this.chatFirstMessageTs&&(ajax=new CAjax("json"),ajax.cls=this,ajax.onload=function(a){0<a.prevChatNum&&(this.cls.conPrevChat.innerHTML="",a=alib.dom.createElement("element",this.cls.conPrevChat),alib.dom.styleSet(a,"margin","5px"),a=alib.dom.createElement("a",a),a.setAttribute("href","javascript: void(0);"),a.innerHTML="Show Previous Message",a.cls=this.cls,a.onclick=function(){this.cls.conPrevChat.innerHTML="";this.cls.conChatConv.innerHTML="<div class='loading'></div>";
this.cls.chatLastMessageTs=0;this.cls.chatFirstMessageTs=0;this.cls.firstLoad=!0;this.cls.getMessage(0)})},ajax.exec("/controller/Chat/getPrevChat",[["chatFirstMessageTs",this.chatFirstMessageTs],["friendName",this.chatFriendName],["friendServer",this.chatFriendServer]]),this.prevChatChecked=!0)};
AntChatClient.prototype.getMessage=function(a){if(!0!=this.ajaxGetMessages){var b=this.chatPopup&&!this.g_chatClientTimer.getMessage?this.chatFirstMessageTs:this.chatLastMessageTs,c=new CAjax("json");c.cls=this;c.onload=function(a){this.cls.ajaxGetMessages=!1;this.cls.firstLoad&&(this.cls.conChatConv.innerHTML="",this.cls.firstLoad=!1);if(a&&"-1"!=a.retVal){if(1!=a.retVal)for(i=a.length;0<i;i--){var b=a[i-1];if(b.messageTimestamp>this.cls.chatLastMessageTs){this.cls.buildChatSound();0==this.cls.chatFirstMessageTs&&
(this.cls.chatFirstMessageTs=b.messageTimestamp);this.cls.chatLastMessage=b.timestamp;this.cls.chatLastMessageTs=b.messageTimestamp;this.cls.chatDivLastMessageId="divLastMessage_"+b.messageTimestamp;var c="t"==b.friend_message?!1:!0;b.inline=!0;var g=!1;this.cls.chatCurrentDay!==b.day&&(g=!0);this.cls.chatCurrentDay=b.day;this.cls.buildChatInterface(b,c,this.cls.conChatConv,g)}}this.cls.prevChatChecked||this.cls.getPrevChat()}};"undefined"==typeof a&&(a=this.messageLimit);c.exec("/controller/Chat/getMessage",
[["limit",a],["lastMessageTs",b],["friendName",this.chatFriendName],["friendServer",this.chatFriendServer]])}};
AntChatClient.prototype.lastMessageCheck=function(){this.g_chatClientTimer.lastMessageTimestamp&&(clearTimeout(this.g_chatClientTimer.lastMessageTimestamp),this.g_chatClientTimer.lastMessageTimestamp=null);this.chatLastMessageCount++;if(6<=this.chatLastMessageCount&&this.chatLastMessage){this.lastMessageNotification(this.conChatConv);if(this.chatPopup){var a=window.opener.document.getElementById(this.chatDivConId);!window.opener.document.getElementById(this.chatDivLastMessageId)&&a&&("Microsoft Internet Explorer"==
navigator.appName?(a={},a.chatDivLastMessageId=this.chatDivLastMessageId,a.chatLastMessage=this.chatLastMessage,a.chatFriendName=this.chatFriendName,window.opener.clientLib.lastMessageNotification(a)):this.lastMessageNotification(a))}this.chatLastMessageCount=0;this.chatLastMessage=null}var b=this;this.g_chatClientTimer.lastMessageTimestamp=window.setTimeout(function(){b.lastMessageCheck()},5E3)};
AntChatClient.prototype.lastMessageNotification=function(a){if("undefined"!=typeof a&&!document.getElementById(this.chatDivLastMessageId)){var b=alib.dom.createElement("div",a);b.setAttribute("id",this.chatDivLastMessageId);alib.dom.styleSet(b,"textAlign","center");alib.dom.styleSet(b,"width","200px");alib.dom.styleSet(b,"marginBottom","10px");alib.dom.styleSet(b,"padding","5px");alib.dom.styleSet(b,"fontStyle","italic");b.innerHTML=this.chatLastMessage;a.scrollTop=a.scrollHeight}};
AntChatClient.prototype.buildChatInterface=function(a,b,c,d){if("undefined"!=typeof c){if(b)var e="left",f="right",b=this.userImage,g="0px",h="5px",k="5px",l="myMessage_"+a.messageTimestamp;else e="right",f="left",b=this.chatFriendImage,g="5px",k=h="0px",l="friendMessage_"+a.messageTimestamp;var m=a.inline?document.getElementById(l):window.opener.document.getElementById(l);m||(d&&(m="dateId_"+a.currentTimestamp,d=document.getElementById(l),d||(d=alib.dom.createElement("div",c),d.id=m,alib.dom.styleSet(d,
"margin","10px 0"),alib.dom.styleSet(d,"padding","5px 0"),alib.dom.styleSet(d,"borderTop","solid 1px"),alib.dom.styleSet(d,"borderBottom","solid 1px"),alib.dom.styleSet(d,"fontWeight","bold"),d.innerHTML=a.date)),m=alib.dom.createElement("div",c),m.setAttribute("id",l),alib.dom.styleSet(m,"width","240px"),alib.dom.styleSet(m,"marginBottom","10px"),l=alib.dom.createElement("div",m),alib.dom.styleSetClass(l,"chatClientMessage"),alib.dom.styleSet(l,"float",e),alib.dom.styleSet(l,"marginRight",g),l.innerHTML=
this.processMessage(a.message),e=alib.dom.createElement("div",m),alib.dom.styleSet(e,"float",f),alib.dom.styleSet(e,"width","40px"),alib.dom.styleSet(e,"marginLeft",h),alib.dom.styleSet(e,"marginRight",k),f=alib.dom.createElement("img",e),alib.dom.styleSet(f,"width","40px"),f.setAttribute("src",b),f.setAttribute("title",a.timestamp),c.scrollTop=c.scrollHeight,this.divClear(m),this.conChatNotification.innerHTML="",this.chatLastMessageCount=0,a=document.getElementById(this.chatDivInfoId),!this.chatPopup&&
!a&&(alib.dom.styleSet(this.outerCon,"display","block"),alib.dom.styleSet(this.outerCon.parentNode,"opacity","100"),alib.dom.styleSet(this.outerCon.parentNode,"visibility","visible")))}};
AntChatClient.prototype.checkIsTyping=function(a){if(a)this.userIsTyping=!1,this.saveIsTyping(0),clearTimeout(this.g_typingTimer);else if(!this.userIsTyping){this.userIsTyping=!0;this.saveIsTyping(1);var b=this,a=function(){b.checkIsTyping(!0)};clearTimeout(this.g_chatClientTimer.checkIsTyping);this.isVisible&&(this.g_chatClientTimer.checkIsTyping=window.setTimeout(a,15E3))}};
AntChatClient.prototype.saveIsTyping=function(a){ajax=new CAjax("json");ajax.exec("/controller/Chat/saveChatSession",[["type","isTyping"],["value",a],["friendName",this.chatFriendName],["friendServer",this.chatFriendServer]])};
AntChatClient.prototype.getIsTyping=function(){if(this.isVisible)ajax=new CAjax("json"),ajax.cls=this,ajax.onload=function(a){clearTimeout(this.cls.g_chatClientTimer.getIsTyping);var c=this.cls;this.cls.isVisible&&(this.cls.g_chatClientTimer.getIsTyping=window.setTimeout(function(){c.getIsTyping()},3E3));a&&(this.cls.conChatNotification.innerHTML=1==a.isTyping?this.cls.chatFriendName+" is typing...":"")},ajax.exec("/controller/Chat/getChatSession",[["friendName",this.chatFriendName],["friendServer",
this.chatFriendServer],["calledFrom","antChatClient"]]);else{var a=this;this.g_chatClientTimer.getIsTyping=window.setTimeout(function(){a.getIsTyping()},3E3)}};
AntChatClient.prototype.popupChatClient=function(){if(this.chatPopup){var a=window.opener.document.getElementById(this.chatDivInfoId);a&&window.opener.document.body.removeChild(a);a=alib.dom.createElement("div",window.opener.document.body)}else(a=document.getElementById(this.chatDivInfoId))&&document.body.removeChild(a),a=alib.dom.createElement("div",document.body);a.setAttribute("id",this.chatDivInfoId);alib.dom.styleSet(a,"display","none");a=alib.dom.createElement("form",a);a.setAttribute("method",
"post");a.setAttribute("target","popupClient");var b=alib.dom.createElement("input",a);b.setAttribute("name","chatFriendName");b.setAttribute("value",this.chatFriendName);b=alib.dom.createElement("input",a);b.setAttribute("name","chatFriendFullName");b.setAttribute("value",this.chatFriendFullName);b=alib.dom.createElement("input",a);b.setAttribute("name","chatFriendServer");b.setAttribute("value",this.chatFriendServer);b=alib.dom.createElement("input",a);b.setAttribute("name","chatFriendImage");b.setAttribute("value",
this.chatFriendImage);b=alib.dom.createElement("input",a);b.setAttribute("name","chatFirstMessageTs");b.setAttribute("value",this.chatFirstMessageTs);this.chatPopup||(a.setAttribute("action","/chatloader/client"),b="width=285,height="+(parseInt(this.chatClientHeight)+110)+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no,status=no,resizable=yes",this.chatPopupClient=window.open("/chatloader/client","popupClient",b),a.submit())};
AntChatClient.prototype.savePopupState=function(a){ajax=new CAjax("json");ajax.exec("/controller/Chat/saveChatSession",[["type","isPopup"],["value",a],["friendName",this.chatFriendName],["friendServer",this.chatFriendServer]])};AntChatClient.prototype.divClear=function(a){a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"clear","both")};AntChatClient.prototype.buildDayDiv=function(a,b){var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin","10px");c.innerHTML=b};
AntChatClient.prototype.buildChatSound=function(){};AntChatClient.prototype.checkTimeout=function(){this.g_chatClientTimer&&(null==this.g_chatClientTimer.getMessage&&(clearTimeout(this.g_chatClientTimer.getMessage),this.messageTimer()),this.g_chatClientTimer.getMessage=null);var a=this;clearTimeout(this.g_chatClientTimer.checkTimeout);this.g_chatClientTimer.checkTimeout=window.setTimeout(function(){a.checkTimeout()},6E4)};
AntChatClient.prototype.messageTimer=function(){Ant.getUpdateStream().listen("chat",function(a){a.data.friendName&&a.data.friendName==a.data.messenger.chatFriendName&&a.data.messenger.getMessage()},{messenger:this})};AntChatClient.prototype.clearMessages=function(){(new alib.net.Xhr).send("/controller/Chat/removeOldMessage?friend_name="+this.chatFriendName);this.conChatConv.innerHTML=""};
AntChatClient.prototype.processMessage=function(a){var b=[{text:":)",image:"smile.png"},{text:":-)",image:"smile.png"},{text:":D",image:"smile_big.png"},{text:":$",image:"blush.png"},{text:":*",image:"kiss.png"},{text:":(",image:"sad.png"},{text:";(",image:"cry.png"},{text:";)",image:"wink.png"},{text:"<3",image:"heart.png"},{text:"</3",image:"heartbreak.png"},{text:":O",image:"surprise.png"},{text:":o",image:"surprise.png"},{text:":P",image:"tongue.png"}],c;for(c in b)var d=b[c].text.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
"\\$&"),a=a.replace(RegExp(d,"g"),"<img src='/images/icons/emoticons/"+b[c].image+"' />");b=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;a=a.replace(b,'<a href="$1" target="_blank">$1</a>');b=/(^|[^\/])(www\.[\S]+(\b|$))/gim;a=a.replace(b,'$1<a href="http://$2" target="_blank">$2</a>');b=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;return a=a.replace(b,'<a href="mailto:$1">$1</a>')};
var clientLib={buildChatInterface:function(a,b,c){var d=b.userImage,b=b.chatFriendName,e="myMessage_"+a.messageTimestamp,f=document.getElementById(e),b=document.getElementById("divChatCon_"+b);!f&&b&&(c&&(f="dateId_"+a.currentTimestamp,c=document.getElementById(e),c||(c=alib.dom.createElement("div",b),c.id=f,alib.dom.styleSet(c,"margin","10px"),c.innerHTML=a.date)),f=alib.dom.createElement("div",b),f.setAttribute("id",e),alib.dom.styleSet(f,"width","240px"),alib.dom.styleSet(f,"marginBottom","10px"),
e=alib.dom.createElement("div",f),alib.dom.styleSetClass(e,"chatClientMessage"),alib.dom.styleSet(e,"float","left"),alib.dom.styleSet(e,"margin-right","0px"),e.innerHTML=a.message,e=alib.dom.createElement("div",f),alib.dom.styleSet(e,"float","right"),alib.dom.styleSet(e,"width","40px"),alib.dom.styleSet(e,"marginLeft","5px"),alib.dom.styleSet(e,"marginRight","5px"),e=alib.dom.createElement("img",e),alib.dom.styleSet(e,"width","40px"),e.setAttribute("src",d),e.setAttribute("title",a.timestamp),b.scrollTop=
b.scrollHeight,a=alib.dom.createElement("div",f),alib.dom.styleSet(a,"clear","both"))},lastMessageNotification:function(a){var b=a.chatDivLastMessageId,c=a.chatLastMessage,a=a.chatFriendName;if(!document.getElementById(b)){var a=document.getElementById("divChatCon_"+a),d=alib.dom.createElement("div",a);d.setAttribute("id",b);alib.dom.styleSet(d,"textAlign","center");alib.dom.styleSet(d,"width","200px");alib.dom.styleSet(d,"marginBottom","10px");alib.dom.styleSet(d,"padding","5px");alib.dom.styleSet(d,
"fontStyle","italic");d.innerHTML=c;a.scrollTop=a.scrollHeight}},buildDivInfo:function(a){var b=a.chatFriendName,c=a.chatFriendServer,d=a.chatFriendFullName,a=a.chatFriendImage,e="divChatInfo_"+b,f=document.getElementById(e);f&&document.body.removeChild(f);f=alib.dom.createElement("div",document.body);f.setAttribute("id",e);alib.dom.styleSet(f,"display","none");e=alib.dom.createElement("form",f);e.setAttribute("method","post");e.setAttribute("target","popupClient");f=alib.dom.createElement("input",
e);f.setAttribute("name","chatFriendName");f.setAttribute("value",b);f=alib.dom.createElement("input",e);f.setAttribute("name","chatFriendFullName");f.setAttribute("value",d);f=alib.dom.createElement("input",e);f.setAttribute("name","chatFriendServer");f.setAttribute("value",c);f=alib.dom.createElement("input",e);f.setAttribute("name","chatFriendImage");f.setAttribute("value",a)}};Ant.HelpTour={};Ant.HelpTour.itemQueue_=[];Ant.HelpTour.itemsDisplayed_=[];
Ant.HelpTour.loadTours=function(a,b){var c=[],b=b||!1;alib.dom.query("[data-tour]",a).each(function(){var a=this.getAttribute("data-tour");b&&a.substring(0,b.length)!=b||Ant.HelpTour.isInQueue(a)||c.push(a)});0<c.length&&this.getTourItemsData(c)};
Ant.HelpTour.getTourItemsData=function(a){var b=new alib.net.Xhr;alib.events.listen(b,"load",function(){var a=this.getResponse(),b;for(b in a)Ant.HelpTour.itemQueue_.push(a[b]);Ant.HelpTour.displayQueue()});alib.events.listen(b,"error",function(){},{helpClass:this});b.send("/controller/Help/getTourItems","POST",{tourIds:a})};Ant.HelpTour.isInQueue=function(a){for(var b in this.itemQueue_)if(this.itemQueue_[b].id==a)return!0;return!1};
Ant.HelpTour.wasDisplayed=function(a){for(var b in this.itemsDisplayed_)if(this.itemsDisplayed_[b]==a)return!0;return!1};Ant.HelpTour.displayQueue=function(){var a=this.itemQueue_.shift();if(a){var b=!1;Ant.HelpTour.wasDisplayed(a.id)||(b=this.display(a));b?this.itemsDisplayed_.push(a.id):this.displayQueue()}};
Ant.HelpTour.display=function(a){var b=alib.dom.query("[data-tour='"+a.id+"']");if(b){b=b[0];switch(b.getAttribute("data-tour-type")?b.getAttribute("data-tour-type"):"popup"){case "inline":this.displayInline(a);break;case "dialog":this.displayDialog(a);break;default:this.displayPopup(a)}return!0}return!1};
Ant.HelpTour.displayPopup=function(a){var b=alib.dom.createElement("div",document.body,a.html);alib.dom.styleSetClass(b,"helpTourCon");alib.dom.styleAddClass(b,"popup");var c=new alib.ui.Popup(b,{autoClose:!1}),b=alib.dom.createElement("div",b);alib.dom.styleSetClass(b,"helpTourConButtons");alib.ui.Button("Okay, got it!",{className:"b1",popup:c,tourId:a.id,onclick:function(){this.popup.setVisible(!1);Ant.HelpTour.dismiss(this.tourId)}}).print(b);return(a=alib.dom.query("[data-tour='"+a.id+"']"))?
(a=a[0],c.anchorToEl(a,"down"),c.setVisible(),!0):!1};Ant.HelpTour.displayInline=function(a){var b=alib.dom.query("[data-tour='"+a.id+"']");if(b){b=b[0];alib.dom.styleSet(b,"display","none");b.innerHTML=a.html;alib.fx.slideDown(b);var c=alib.dom.createElement("div",b),c=alib.dom.createElement("a",c,"hide");c.href="javascript:void(0);";c.ele=b;c.tourId=a.id;c.onclick=function(){alib.fx.slideUp(this.ele);Ant.HelpTour.dismiss(this.tourId)};return!0}return!1};
Ant.HelpTour.displayDialog=function(a){var b=new CDialog(""),c=alib.dom.createElement("div");alib.dom.styleSetClass(c,"helpTourCon");alib.dom.styleAddClass(c,"dialog");c.innerHTML=a.html;var d=alib.dom.createElement("div",c);alib.dom.styleSetClass(d,"helpTourConButtons");var e=alib.dom.createElement("input");e.type="checkbox";e.checked=!0;alib.ui.Button("Okay, got it!",{className:"b1",dlg:b,tourId:a.id,noShowAgain:e,onclick:function(){this.dlg.hide();Ant.HelpTour.dismiss(this.tourId,this.noShowAgain.checked)}}).print(d);
d.appendChild(e);alib.dom.createElement("span",d," Do not show me this again");b.customDialog(c,500);return!0};Ant.HelpTour.dismiss=function(a,b){this.displayQueue();("undefined"!=typeof b?b:1)&&(new alib.net.Xhr).send("/controller/Help/setTourItemDismissed","POST",{tour_id:a})};
function AntObjectLoader(a,b){this.mainObject=new CAntObject(a,b);this.oid=b;this.objType=a;this.cloneObject=!1;this.tabs=this.formCon=this.noticeCon=this.toolbarCon=this.titleCon=this.mainCon=this.outerCon=null;this.plugins=[];this.inline=!1;this.fEnableClose=!0;this.antView=null;this.isMobile="undefined"!=typeof Ant&&Ant.isMobile?!0:!1;this.newWindowArgs=this.subLoader=null;this.emailArgs=[];this.subLoaderParams={};this.cbData={};this.pluginToolbarEntries=[];this.formScope=this.isMobile?"mobile":
"default";this.hideToolbar=!1}
AntObjectLoader.prototype.print=function(a,b,c){c&&(this.formScope=c);this.isPopup=b?!0:!1;this.outerCon=a;this.mainCon=alib.dom.createElement("div",a);this.mainCon.className="objectLoader";this.titleCon=alib.dom.createElement("div",this.mainCon);this.inline?alib.dom.styleSet(this.titleCon,"display","none"):(this.titleCon.className="objectLoaderHeader",this.setTitle("Loading"));this.toolbarCon=alib.dom.createElement("div",this.mainCon);this.hideToolbar&&alib.dom.styleSet(this.toolbarCon,"display",
"none");this.noticeCon=alib.dom.createElement("div",this.mainCon);this.formCon=alib.dom.createElement("div",this.mainCon);this.formCon.className="objectLoaderBody";this.formCon.innerHTML=" <div class='loading'></div>";this.oid?(this.mainObject.frmCls=this,this.mainObject.newWindowArgs=this.newWindowArgs,this.mainObject.onload=function(){this.frmCls.onObjectLoaded();this.frmCls.loadPlugins();this.frmCls.showNotices()},this.mainObject.load()):(this.loadNewWindowValues(),this.loadPlugins())};
AntObjectLoader.prototype.printInline=function(a,b,c){this.inline=!0;this.print(a,b,c)};AntObjectLoader.prototype.resize=function(){!this.inline&&!this.isMobile&&(this.setHeight(getWorkspaceHeight()),this.subLoader&&this.subLoader.resize&&this.subLoader.resize())};
AntObjectLoader.prototype.setHeight=function(a){if(this.subLoader&&this.subLoader.setHeight)return this.subLoader.setHeight();a-=alib.dom.getContentHeight(this.titleCon);a-=alib.dom.getContentHeight(this.toolbarCon);a-=alib.dom.getContentHeight(this.noticeCon);a-=10;this.tabs?(this.tabs.setHeight(a),alib.dom.styleSet(this.formCon,"height","auto")):(alib.dom.styleSet(this.formCon,"height",a+"px"),alib.dom.styleSet(this.formCon,"overflow","auto"))};
AntObjectLoader.prototype.setTitle=function(a){this.titleCon.innerHTML="";this.isPopup?document.title=a:this.titleCon&&(this.antView&&this.setTitleParentPath(),a=alib.dom.createElement("div",this.titleCon,a),this.antView&&this.antView.getTitle(a))};
AntObjectLoader.prototype.setTitleParentPath=function(){var a=alib.dom.createElement("div",this.titleCon);alib.dom.styleSetClass(a,"breadCrumbs");var b=[];if(this.antView.getParentView())for(var c=this.antView.getParentView();c;)b.push(c),c=c.getParentView();for(c=b.length-2;0<=c;c--){var d=b[c],e=alib.dom.createElement("a",a);e.href="#"+d.getPath();d.getTitle(e);alib.dom.createElement("span",a).innerHTML=" / "}};
AntObjectLoader.prototype.printCollapsed=function(a,b,c){this.isPopup=b?!0:!1;b=this.getSubloader();b.printCollapsed&&b.printCollapsed(a,this.isPopup,c)};
AntObjectLoader.prototype.getSubloader=function(){if(this.subLoader)return this.subLoader;switch(this.mainObject.obj_type){case "email_message":this.subLoader=new AntObjectLoader_EmailMessage(this.mainObject,this);this.subLoader.emailArgs=this.emailArgs;break;case "email_thread":this.subLoader=new AntObjectLoader_EmailThread(this.mainObject,this);break;case "report":this.subLoader=new AntObjectLoader_Report(this.mainObject,this);break;default:this.subLoader=new AntObjectLoader_Form(this.mainObject,
this)}this.inline&&"user"==this.objType&&(this.subLoader=new AntObjectLoader_Form(this.mainObject,this));this.subLoader.onNameChange=function(a){this.loaderCls.antView&&this.loaderCls.antView.setTitle(a);this.loaderCls.setTitle(a)};this.mainObject.loaderCls=this;this.mainObject.onValueChange=function(a,b,c){this.loaderCls.onValueChange(a,b);if(this.loaderCls.subLoader)this.loaderCls.subLoader.onValueChange(a,b);for(var d=0;d<this.loaderCls.plugins.length;d++)if("undefined"!=typeof this.loaderCls.plugins[d].onMainObjectValueChange)this.loaderCls.plugins[d].onMainObjectValueChange(a,
b,c)};this.mainObject.loaderCls=this;this.mainObject.onToggleEdit=function(a){for(var b=0;b<this.loaderCls.plugins.length;b++)if("undefined"!=typeof this.loaderCls.plugins[b].onMainObjectToggleEdit)this.loaderCls.plugins[b].onMainObjectToggleEdit(a)};return this.subLoader};
AntObjectLoader.prototype.showNotices=function(){if(this.mainObject.getValue("f_deleted")){var a=alib.dom.createElement("div",this.noticeCon);alib.dom.styleSetClass(a,"error");a.innerHTML="This "+this.mainObject.title+" has been deleted. ";var b=alib.dom.createElement("a",a);b.href="javascript:void(0)";b.onclick=function(){};b.innerHTML="[undelete]";b.oid=this.mainObject.id;b.cls=this;b.onclick=function(){this.cls.undeleteObject(this.oid,a)}}};
AntObjectLoader.prototype.loadPlugins=function(){ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){if(!a.error)try{for(plugin in a)this.cls.plugins[this.cls.plugins.length]=eval("("+unescape(a[plugin])+")")}catch(b){alert("Error loading plugin: "+b+" - "+JSON.stringify(a))}this.cls.loadForm()};ajax.exec("/controller/Object/getPlugins",[["obj_type",this.mainObject.name]])};
AntObjectLoader.prototype.loadForm=function(){AntObjectForms.loadForm(this.objType,{context:this,method:"buildInterface"},null,this.formScope)};
AntObjectLoader.prototype.buildInterface=function(){this.oid?this.setTitle("Edit "+this.mainObject.title):this.setTitle("New "+this.mainObject.title);var a=this.getSubloader();this.formCon.innerHTML="";a.print(this.formCon,this.plugins);this.newWindowArgs?a.toggleEdit(this.newWindowArgs.editMode[0]):this.cloneObject?(a.toggleEdit(!0),this.setTitle("Copied "+this.mainObject.title)):a.toggleEdit(this.oid?!1:!0);this.subLoader=a;this.resize();this.markSeen()};
AntObjectLoader.prototype.openInNewWindow=function(){var a=alib.dom.createElement("div");alib.dom.styleSet(a,"display","none");var b=alib.dom.createElement("form",a);b.setAttribute("method","post");b.setAttribute("target",this.mainObject.obj_type+this.oid);for(var c=this.mainObject.getFields(),d=0;d<c.length;d++){var e=c[d],f=e.type,g=e.name,h=this.mainObject.getValue(g);if(g){switch(f){case "fkey":case "object":h=this.mainObject.getValueStr(g);e=alib.dom.createElement("input",b);e.setAttribute("name",
g+"Fkey");e.setAttribute("value",h);e=alib.dom.createElement("input",b);e.setAttribute("name",g+"FkeyType");e.setAttribute("value",f+"_reference");e=alib.dom.createElement("input",b);e.setAttribute("name",g);e.setAttribute("value",rawurlencode(h));break;case "object_multi":case "fkey_multi":for(var h=this.mainObject.getMultiValues(g),k=h.toString().split(","),l="",m=0;m<k.length;m++)for(var n=0;n<e.optional_vals.length;n++)if(e.optional_vals[n][0]==k[m]){l.length&&(l+=",");l+=e.optional_vals[n][1];
break}e=alib.dom.createElement("input",b);e.setAttribute("name",g+"Multi");e.setAttribute("value",rawurlencode(l));e=alib.dom.createElement("input",b);e.setAttribute("name",g+"MultiType");e.setAttribute("value",f+"_reference");e=alib.dom.createElement("input",b);e.setAttribute("name",g);e.setAttribute("value",h);break;default:e=alib.dom.createElement("input",b),e.setAttribute("name",g),e.setAttribute("value",h)}e=alib.dom.createElement("input",b);e.setAttribute("name",g+"Type");e.setAttribute("value",
f)}}e=alib.dom.createElement("input",b);e.setAttribute("name","fromInlineForm");e.setAttribute("value","true");e=alib.dom.createElement("input",b);e.setAttribute("name","fromInlineFormType");e.setAttribute("value","bool");e=alib.dom.createElement("input",b);e.setAttribute("name","editMode");e.setAttribute("value",this.subLoader.editMode);e=alib.dom.createElement("input",b);e.setAttribute("name","editModeType");e.setAttribute("value","bool");c=this.oid?"/obj/"+this.mainObject.name+"/"+this.oid:"/obj/"+
this.mainObject.name;b.setAttribute("action",c);document.body.appendChild(a);window.open(c,this.mainObject.obj_type+this.oid,"width=1024,height=768,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes");b.submit()};AntObjectLoader.prototype.pluginAddToolbarEntry=function(a,b,c,d){c=c||{};"undefined"==typeof d&&(d="last");this.pluginToolbarEntries.push({label:a,callback:b,cbData:c,pos:d})};
AntObjectLoader.prototype.saveObject=function(a,b){a="undefined"!=typeof a?a:!1;if(null!=this.mainObject.recurrencePattern&&this.mainObject.recurrencePattern.id&&!b){var c=new CDialog("Save Recurring Series"),d=alib.dom.createElement("div"),e=alib.dom.createElement("div",d);e.innerHTML="Would you like to save changes to this "+this.mainObject.title+" only or this and future "+this.mainObject.titlePl+"?";alib.dom.styleSet(e,"padding-bottom","5px");var e=alib.dom.createElement("div",d),f=new CButton("This "+
this.mainObject.title+" Only",function(a,b,c){a.hide();c.saveObject(b,"exception")},[c,a,this],"b1");f.print(e);f=new CButton("This &amp; Future "+this.mainObject.titlePl,function(a,b,c){a.hide();c.saveObject(b,"all")},[c,a,this],"b2");f.print(e);f=new CButton("Cancel",function(a){a.hide()},[c],"b3");f.print(e);alib.dom.styleSet(alib.dom.createElement("div",d),"clear","both");c.customDialog(d,400,50)}else{b&&this.mainObject.recurrencePattern&&(this.mainObject.recurrencePattern.save_type=b);for(c=
0;c<this.plugins.length;c++)"undefined"!=typeof this.plugins[c].beforesaved&&this.plugins[c].beforesaved();if(this.subLoader.objectBrowsers)for(c=0;c<this.subLoader.objectBrowsers.length;c++)this.subLoader.objectBrowsers[c].commentObj&&this.subLoader.objectBrowsers[c].commentObj.ta_comment.value&&(d=this.subLoader.objectBrowsers[c].commentObj,this.subLoader.objectBrowsers[c].saveComment(d.ta_comment.value,d.t,d.con));c=new CDialog;d=alib.dom.createElement("div");alib.dom.styleSetClass(d,"statusAlert");
alib.dom.styleSet(d,"text-align","center");d.innerHTML="Saving, please wait...";c.statusDialog(d,150,100);this.plugin_saved_processed=0;this.mainObject.m_dlg=c;this.mainObject.m_close=a;this.mainObject.olCls=this;this.mainObject.onsave=function(){this.onload=function(){};this.load();if(this.olCls.plugins.length)for(var a=0;a<this.olCls.plugins.length;a++)this.olCls.plugins[a].frmLoaded?(this.olCls.plugins[a].statusDlg=this.m_dlg,this.olCls.plugins[a].frmClose=this.m_close,this.olCls.plugins[a].olCls=
this.olCls,this.olCls.plugins[a].onsave=function(){this.olCls.pluginSaved(this.statusDlg,this.frmClose)},this.olCls.plugins[a].save()):this.olCls.pluginSaved(this.m_dlg,this.m_close);else this.olCls.saveDone(this.m_dlg,this.m_close);this.olCls.oid=this.id;this.olCls.cloneObject&&((new CAjax("json")).exec("controller/Object/cloneObjectReferences",[["obj_type",this.obj_type],["oid",this.id],["from_id",this.olCls.cloneObject]]),this.olCls.cloneObject=!1)};this.mainObject.onsaveError=function(a){this.m_dlg.hide();
a?alert(a):ALib.statusShowAlert("ERROR SAVING CHANGES!",3E3,"bottom","right")};this.cloneObject&&(this.mainObject.id=null,this.mainObject.setValue("id",""));this.mainObject.save();this.setTitle(this.mainObject.getValue("name"))}};AntObjectLoader.prototype.pluginSaved=function(a,b){this.plugin_saved_processed++;this.plugin_saved_processed==this.plugins.length&&this.saveDone(a,b)};
AntObjectLoader.prototype.deleteObject=function(a){if(null!=this.mainObject.recurrencePattern&&this.mainObject.recurrencePattern.id&&!a){var a=new CDialog("Recurring Series"),b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b);c.innerHTML="Would you like to delete this "+this.mainObject.title+" only or this and future "+this.mainObject.titlePl+"?";alib.dom.styleSet(c,"padding-bottom","5px");var c=alib.dom.createElement("div",b),d=new CButton("This "+this.mainObject.title+" Only",function(a,
b,c){a.hide();c.deleteObject("exception")},[a,close,this],"b1");d.print(c);d=new CButton("This &amp; Future "+this.mainObject.titlePl,function(a,b,c){a.hide();c.deleteObject("all")},[a,close,this],"b2");d.print(c);d=new CButton("Cancel",function(a){a.hide()},[a],"b3");d.print(c);alib.dom.styleSet(alib.dom.createElement("div",b),"clear","both");a.customDialog(b,400,50)}else a&&this.mainObject.recurrencePattern?(this.mainObject.recurrencePattern.save_type=a,this.deleteObjectDo()):(ALib.Dlg.confirmBox("Are you sure you want to delete this "+
this.mainObject.title+"?","Delete "+this.mainObject.title,[this]),ALib.Dlg.onConfirmOk=function(a){a.deleteObjectDo()})};
AntObjectLoader.prototype.deleteObjectDo=function(){var a="undefined"!=typeof a?a:!1,b=new CDialog,c=alib.dom.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Deleting, please wait...";b.statusDialog(c,150,100);this.plugin_delete_processed=0;this.mainObject.m_dlg=b;this.mainObject.m_close=a;this.mainObject.olCls=this;this.mainObject.onremove=function(){if(this.olCls.plugins.length)for(var a=0;a<this.olCls.plugins.length;a++)this.olCls.plugins[a].remove?
(this.olCls.plugins[a].statusDlg=this.m_dlg,this.olCls.plugins[a].olCls=this.olCls,this.olCls.plugins[a].onremove=function(){this.olCls.pluginDeleted(this.statusDlg)},this.olCls.plugins[a].remove()):this.olCls.pluginDeleted(this.m_dlg);else this.olCls.deleteDone(this.m_dlg)};this.mainObject.onremoveError=function(){this.m_dlg.hide();ALib.statusShowAlert("ERROR DELETING OBJECT!",3E3,"bottom","right")};this.mainObject.remove()};
AntObjectLoader.prototype.pluginDeleted=function(a){this.plugin_delete_processed++;this.plugin_delete_processed==this.plugins.length&&this.deleteDone(a)};AntObjectLoader.prototype.deleteDone=function(a){a.hide();this.close();this.onRemove();alib.events.triggerEvent(this,"remove")};
AntObjectLoader.prototype.undeleteObject=function(a,b){ajax=new CAjax("json");ajax.cbData.con=this.noticeCon;ajax.onload=function(){ALib.statusShowAlert("Item has been restored!",3E3,"bottom","right");this.cbData.con.removeChild(b)};ajax.exec("/controller/Object/undeleteObject",[["obj_type",this.mainObject.obj_type],["oid",a]])};AntObjectLoader.prototype.hide=function(){this.mainCon.style.display="none"};AntObjectLoader.prototype.show=function(){this.mainCon.style.display="block"};
AntObjectLoader.prototype.close=function(){if(this.subLoader)for(var a in this.subLoader.objectBrowsers)this.subLoader.objectBrowsers[a].setAutoRefresh(0);alib.events.triggerEvent(this,"close");this.onClose()};AntObjectLoader.prototype.onClose=function(){this.isPopup&&window.close()};AntObjectLoader.prototype.onSave=function(){};AntObjectLoader.prototype.onRemove=function(){};
AntObjectLoader.prototype.saveDone=function(a,b){b="undefined"!=typeof b?b:!1;a.hide();ALib.statusShowAlert(this.mainObject.title+" Saved!",3E3,"bottom","right");this.oid||(this.oid=this.mainObject.id);if(b)this.close();else{var c=this.getSubloader();c&&c.toggleEdit(!1)}alib.events.triggerEvent(this,"save");this.onSave()};
AntObjectLoader.prototype.onValueChange=function(a){var b=this.mainObject.getFieldByName(a);if(!this.mainObject.id&&"text"==b.type){this.noticeCon.innerHTML="";a=alib.dom.createElement("div",this.noticeCon);a.style.display="none";var c=!1,d=new AntObjectBrowser(this.mainObject.name);d.limit=3;d.cbData.antobjloaderDupDiv=a;d.onLoad=function(a){this.cbData.antobjloaderDupDiv.style.display=a?"block":"none"};for(var e=this.mainObject.getFields(),f=0;f<e.length;f++){var b=e[f],g=this.mainObject.getValue(b.name);
g&&"Untitled"!=g&&"New Contact"!=g&&"text"==b.type&&b.system&&"address_default"!=b.name?(d.addCondition("and",b.name,"contains",g),c=!0):g&&"timestamp"==b.type&&!b.readonly&&d.addCondition("and",b.name,"is_equal",g)}c&&(d.printInline(a,!0,"Possible Duplicates"),d.loaderCls=this.loaderCls,b=alib.dom.createElement("div",a),alib.dom.styleSet(b,"text-align","center"),alib.dom.styleSet(b,"margin-bottom","5px"),b=alib.dom.createElement("a",b),b.href="javascript:void(0)",b.dupdiv=a,b.onclick=function(){this.dupdiv.style.display=
"none"},b.innerHTML="close")}};AntObjectLoader.prototype.setValue=function(a,b){var c=this.mainObject.getFieldByName(a);if(c&&"bool"==c.type)switch(b){case "false":case "f":case "0":case "no":b=!1;break;case "true":case "t":case "1":case "yes":b=!0}this.oid&&!this.mainObject.loaded?(this.queueValues||(this.queueValues=[]),this.queueValues[this.queueValues.length]={field:a,value:b}):(this.mainObject.setValue(a,b),this.subLoader&&this.subLoader.toggleEdit(this.subLoader.editMode))};
AntObjectLoader.prototype.getValue=function(a){this.mainObject.getFieldByName(a);if(this.oid&&!this.mainObject.loaded){this.queueValues||(this.queueValues=[]);for(var b in this.queueValues)if(this.queueValues[b].field==a)return this.queueValues[b].value}else return this.mainObject.getValue(a);return null};AntObjectLoader.prototype.refreshReferences=function(){};AntObjectLoader.prototype.refreshField=function(){};
AntObjectLoader.prototype.onObjectLoaded=function(){console.log(this.mainObject.getValue("groups"));if(this.queueValues&&this.queueValues.length){for(var a=0;a<this.queueValues.length;a++)console.log(this.queueValues[a].field),this.mainObject.setValue(this.queueValues[a].field,this.queueValues[a].value);this.subLoader&&this.form.toggleEdit(this.subLoader.editMode)}};AntObjectLoader.prototype.refresh=function(){this.subLoader&&this.form.toggleEdit(this.subLoader.editMode)};
AntObjectLoader.prototype.setAntView=function(a){this.antView=a;this.antView.options.ldrcls=this;this.antView.onresize=function(){this.options.ldrcls.resize()};this.antView.fromClone=!1;"undefined"!=typeof this.antView.options.cloneId&&null!=this.antView.options.cloneId&&""==this.oid&&(this.oid=this.antView.options.cloneId,this.mainObject=new CAntObject(this.objType,this.oid),this.cloneObject=this.antView.options.cloneId,this.antView.options.cloneId=null,this.antView.fromClone=!0)};
AntObjectLoader.prototype.loadNewWindowValues=function(){if(this.newWindowArgs)for(fieldName in this.mainObject.newWindowArgs=this.newWindowArgs,this.newWindowArgs){var a=!1;switch(fieldName){case "fromInlineForm":case "editMode":a=!0}if(a)break;a=this.newWindowArgs[fieldName][0];switch(this.newWindowArgs[fieldName][1]){case "fkey_reference":case "object_reference":case "object_multi_reference":case "fkey_multi_reference":break;case "fkey":case "obj":this.mainObject.setValue(fieldName,this.newWindowArgs[fieldName][0],
unescape_utf8(this.newWindowArgs[fieldName+"Fkey"][0]));break;case "fkey_multi":case "object_multi":for(var a=unescape_utf8(this.newWindowArgs[fieldName][0]).split(","),b=unescape_utf8(this.newWindowArgs[fieldName+"Multi"][0]).split(","),c=0;c<a.length;c++)a[c]&&this.mainObject.setMultiValue(fieldName,a[c],b[c]);break;case "bool":"t"==a?a=!0:"f"==a&&(a=!1);this.mainObject.setValue(fieldName,a);break;default:this.mainObject.setValue(fieldName,unescape(a))}}};
AntObjectLoader.prototype.buildFormInput=function(a,b){for(formData in a){var c=a[formData];if(c){var d=alib.dom.buildTdLabel(b,c.label,c.labelWidth);switch(c.type){case "checkbox":var e=d.firstChild;e.innerHTML="";e.setAttribute("colspan",2);alib.dom.styleSetClass(e,"formValue");e.appendChild(c);if(c.label){var f=alib.dom.createElement("label",e);f.innerHTML=c.label}break;case "hidden":alib.dom.styleSet(d,"display","none");e=d.firstChild;e.setAttribute("colspan",2);e.appendChild(c);break;default:e=
alib.dom.createElement("td",d);alib.dom.styleSetClass(e,"formValue");try{e.appendChild(c)}catch(g){continue}}c.inputLabel&&(f=alib.dom.createElement("label",e),f.innerHTML=c.inputLabel,alib.dom.styleSet(f,"fontSize","11px"))}}return d};
AntObjectLoader.prototype.buildFormInputDiv=function(a,b,c,d){"undefined"==typeof d&&(d="3px");b.innerHTML="";for(formData in a){var e=a[formData];if(e){switch(e.type){default:var f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"float","left");alib.dom.styleSet(f,"marginRight",d);try{f.appendChild(e)}catch(g){continue}if(e.label){var h=alib.dom.createElement("label",f);alib.dom.styleSet(h,"fontSize","11px");h.innerHTML=e.label;e.floatDir?alib.dom.styleSet(h,"float",e.floatDir):alib.dom.styleSet(h,
"float","right");e.labelWidth&&alib.dom.styleSet(h,"width",e.labelWidth)}}c&&(alib.dom.styleSet(f,"marginBottom","5px"),alib.dom.divClear(b))}}return f};AntObjectLoader.prototype.buildDropdown=function(a,b,c){for(data in b){var d=b[data],e=a.length,f=!1;if("object"==typeof d)var g=d[0],d=d[1];else g=d;c==g&&(f=!0);a[e]=new Option(d,g,!1,f)}};
AntObjectLoader.prototype.loadObjectForm=function(a,b,c){var c=c?c:[],d=new CDialog(""),e=b?b:"",b=alib.dom.createElement("div",this.outerCon);alib.dom.styleSet(b,"height","100%");alib.dom.styleSet(b,"overflow","auto");b.cls=this;b.dlg=d;b.close=function(){this.dlg.hide()};a=new AntObjectLoader(a,e);for(e=0;e<c.length;e++)"associations"==c[e][0]?a.mainObject.setMultiValue("associations",c[e][1]):a.setValue(c[e][0],c[e][1]);a.print(b,this.isPopup);a.objfrmCon=b;a.objBrwsrCls=this;a.onClose=function(){this.objfrmCon.close()};
a.onSave=function(){};a.onRemove=function(){};d.customDialog(b,900,getWorkspaceHeight())};AntObjectLoader.prototype.markSeen=function(){this.mainObject.id&&(new CAjax("json")).exec("/controller/Object/markSeen",[["obj_type",this.mainObject.name],["oid",this.mainObject.id]])};
function AntObjectLoader_Form(a,b){this.inputs=[];this.editMode=a.id?!1:!0;this.mainObject=a;this.curFieldTbl=null;this.loaderCls=b?b:null;this.tabs=null;this.loadReports=[];this.toolbar=this.attachmentObject=this.membersObject=null;this.xmlFormLayout=AntObjectForms.getFormXml(a.name,b.formScope);this.plugins=[];this.watchChanges=[];this.cbData={};this.objectBrowsers=[];this.objectsRef=[]}AntObjectLoader_Form.prototype.refresh=function(){this.toggleEdit(this.editMode)};
AntObjectLoader_Form.prototype.resize=function(){var a=alib.dom.getElementHeight(this.loaderCls.formCon),b=alib.dom.getElementHeight(this.formCon);if(0!=a-b&&this.editMode)for(var c=0;c<this.inputs.length;c++){var d=this.inputs[c];if("undefined"!=typeof d.inp&&"text"==d.ftype&&(!0==d.options.rich||!0==d.options.multiLine)){var e=alib.dom.getElementHeight(d.dv_inp);if(d.inp.setHeight(e+(a-b)-10+"px"))return!0}}};
AntObjectLoader_Form.prototype.toggleEdit=function(a){this.editMode="undefined"!=typeof a?a:this.editMode?!1:!0;alib.events.triggerEvent(this,"changemode");(a=this.mainObject.getLabel())||(a="New "+this.mainObject.title);this.onNameChange(a);this.loaderCls.antView&&this.loaderCls.antView.setTitle(a);this.buildToolbar();for(a=0;a<this.inputs.length;a++)this.editMode?(this.inputs[a].fieldRow&&this.inputs[a].fieldRow.setAttribute("style",""),this.inputs[a].dv_text.style.display="none",this.inputs[a].dv_inp.style.display=
"block",this.inputs[a].dv_inp.inpRef&&"input"==this.inputs[a].dv_inp.inptType&&(this.inputs[a].dv_inp.inpRef.skiponchange=!0,this.inputs[a].dv_inp.inpRef.value=this.inputs[a].dv_inp.inpRef.part?this.mainObject.getInputPartValue(this.inputs[a].fname,this.mainObject.getValue(this.inputs[a].fname),this.inputs[a].dv_inp.inpRef.part):this.mainObject.getValue(this.inputs[a].fname),this.inputs[a].dv_inp.inpRef.skiponchange=!1),this.inputs[a].fieldSet&&this.inputs[a].fieldSet.show()):(this.inputs[a].dv_inp.style.display=
"none",this.inputs[a].dv_text.style.display="block",this.setFieldTextDisplay(this.inputs[a].fname,null,this.inputs[a].fieldRow));this.mainObject.toggleEdit(this.editMode);for(a=0;a<this.objectBrowsers.length;a++)this.objectBrowsers[a].refresh()};
AntObjectLoader_Form.prototype.print=function(a,b){b&&(this.plugins=b);a.innerHTML="";this.pageTitle=alib.dom.createElement("div",this.loaderCls.toolbarCon);this.formCon=alib.dom.createElement("div",a);this.buildToolbar();this.onNameChange=function(a){this.loaderCls&&this.loaderCls.ctbl&&this.loaderCls.ctbl.setTitle(a)};this.objectBrowsers=[];var c=this.mainObject.getLabel();c||(c="New "+this.mainObject.title);this.onNameChange(c);this.loaderCls.antView&&this.loaderCls.antView.setTitle(c);if("*"==
this.xmlFormLayout.m_text){c=alib.dom.createElement("table",this.formCon);alib.dom.styleSet(c,"width","100%");for(var c=alib.dom.createElement("tbody",c),d=this.mainObject.getFields(),e=0;e<d.length;e++){var f=d[e],g=alib.dom.createElement("tr",c);g.vAlign="top";"account_id"!=f.name&&this.printField(f,g)}}else{this.formHasTabs(this.xmlFormLayout)&&this.tabs.print(this.formCon);try{this.buildForm(this.formCon,this.xmlFormLayout),this.formLoaded()}catch(h){alert(h.message+"\nLine: "+h.lineNumber)}}this.mainObject.setViewed()};
AntObjectLoader_Form.prototype.buildToolbar=function(){this.loaderCls.toolbarCon.innerHTML="";var a=new CToolbar;this.toolbar=a;if(this.loaderCls.pluginToolbarEntries.length)for(var b=0;b<this.loaderCls.pluginToolbarEntries.length;b++){var c=this.loaderCls.pluginToolbarEntries[b];"first"==c.pos&&(c=alib.ui.Button(c.label,{className:"b1",tooltip:c.label,callback:c.callback,cbData:c.cbData,onclick:function(){this.callback&&this.callback(this.cbData)}}),a.AddItem(c.getButton(),"left"))}b=alib.ui.Button("<img src='/images/icons/return_16.png' />",
{className:"b1",tooltip:"Go back and close this "+this.mainObject.title.toLowerCase(),ldr:this.loaderCls,obj:this.mainObject,onclick:function(){var a=!0;this.obj.isDirty()&&(a=confirm("Close without saving changes?"));a&&this.ldr.close()}});this.loaderCls.fEnableClose&&!this.loaderCls.isMobile&&a.AddItem(b.getButton(),"left");this.mainObject.security.edit&&this.editMode&&(b=new CButton("Save &amp; Close",function(a,b){a.saveObject(b)},[this.loaderCls,!0],"b1 grLeft"),this.loaderCls.fEnableClose&&
!this.loaderCls.isMobile&&a.AddItem(b.getButton(),"left"),b=new CButton("Save Changes",function(a){a.saveObject(!1)},[this.loaderCls],!this.loaderCls.fEnableClose||this.loaderCls.isMobile?"b2":"b1 grRight"),a.AddItem(b.getButton(),"left"),this.mainObject.id&&(this.btnEdit=new CButton("Cancel Edit",function(a){a.toggleEdit()},[this],"b1"),a.AddItem(this.btnEdit.getButton(),"left")));this.mainObject.security.edit&&!this.editMode&&(this.btnEdit=new CButton("Edit",function(a){a.toggleEdit()},[this],"b2"),
a.AddItem(this.btnEdit.getButton(),"left"));this.mainObject.id&&this.mainObject.security.del&&this.editMode&&(b=new CButton("Delete",function(a){a.deleteObject()},[this.loaderCls,this.mainObject.id],"b3"),a.AddItem(b.getButton(),"left"));b=alib.ui.Button("<img src='/images/icons/print_16.png' />",{className:"b1",tooltip:"Print this "+this.mainObject.title,mObject:this.mainObject,onclick:function(){this.mObject.id?window.open("/print/engine.php?obj_type="+this.mObject.obj_type+"&objects[]="+this.mObject.id):
alert("Please save changes before printing")}});!this.loaderCls.isMobile&&"dashboard"!=this.mainObject.name&&this.mainObject.id&&a.AddItem(b.getButton());if(this.mainObject.security.edit&&this.editMode&&!this.mainObject.def.isPrivate){this.ddPermissions=new CDropdownMenu;this.ddPermissions.addEntry("Edit Permissions for all "+this.mainObject.titlePl,function(a){loadDacl(null,"/objects/"+a.mainObject.name)},"/images/icons/permissions_16.png",null,[this.loaderCls,this]);this.mainObject.id&&this.ddPermissions.addEntry("Edit Permissions for this "+
this.mainObject.title,function(a){loadDacl(null,"/objects/"+a.mainObject.name+"/"+a.mainObject.id,"/objects/"+a.mainObject.name)},"/images/icons/permissions_16.png",null,[this.loaderCls,this]);for(b=0;b<this.mainObject.security.childObjects.length;b++)this.ddPermissions.addEntry("Edit "+(new CAntObject(this.mainObject.security.childObjects[b])).title+" Permissions",function(a,b,c){loadDacl(null,"/objects/"+a.mainObject.name+"/"+a.mainObject.id+"/"+c,"/objects/"+c)},"/images/icons/permissions_16.png",
null,[this.loaderCls,this,this.mainObject.security.childObjects[b]]);this.loaderCls.isMobile||a.AddItem(this.ddPermissions.createButtonMenu("Permissions"),"left");this.loaderCls.antView&&0<this.mainObject.id&&(b=alib.ui.Button("<img src='/images/icons/merge_10.png' /> Clone",{className:"b1",tooltip:"Clone this "+this.mainObject.title,callback:this.loaderCls,mObject:this.mainObject,onclick:function(){this.callback.antView.options.cloneId=this.mObject.id;document.location.hash="#"+this.callback.cbData.parentPath+
"/"+this.mObject.name+":"}}),a.AddItem(b.getButton()))}b=alib.dom.createElement("div");a.AddItem(b,"right");this.displayObjectArrows(b);if(!this.loaderCls.isMobile&&!this.loaderCls.isPopup&&(b=new CButton("",function(a){a.openInNewWindow()},[this.loaderCls],"b1"),b=alib.ui.Button("<img src='/images/icons/new_window_16.png' />",{className:"b1",tooltip:"Click to open this in a new window",callback:this.loaderCls,onclick:function(){this.callback.openInNewWindow();this.callback.close()}}),a.AddItem(b.getButton(),
"right"),this.mainObject.objectList&&0<this.mainObject.objectList.length))for(object in this.mainObject.objectList);if(this.loaderCls.pluginToolbarEntries.length)for(b=0;b<this.loaderCls.pluginToolbarEntries.length;b++)c=this.loaderCls.pluginToolbarEntries[b],"last"==c.pos&&(c=alib.ui.Button(c.label,{className:"b1",tooltip:c.label,callback:c.callback,cbData:c.cbData,onclick:function(){this.callback&&this.callback(this.cbData)}}),a.AddItem(c.getButton(),"left"));a.print(this.loaderCls.toolbarCon)};
AntObjectLoader_Form.prototype.displayObjectArrows=function(a){if(!("undefined"==typeof this.loaderCls.cbData.bwserCls||"undefined"==typeof this.mainObject.id||null==this.mainObject.id||""==this.mainObject.id)){var b=this.loaderCls.cbData.bwserCls.objectList,c=this.loaderCls.cbData.parentPath,d=null,e=null;if(b&&0<b.length)for(obj in b){var f=b[obj];if(e){e=f.id;break}this.mainObject.id==f.id?e=!0:d=f.id}if(d||e)b=alib.ui.Button("<img src='/images/icons/arrow_left_16.png' />",{className:"b1 grLeft",
tooltip:"Load previous object",cls:this,poid:d,otype:this.mainObject.name,pPath:c,onclick:function(){this.poid&&(document.location.hash="#"+this.pPath+"/"+this.otype+":"+this.poid)}}),b.print(a),d||b.disable(),b=alib.ui.Button("<img src='/images/icons/arrow_right_16.png' />",{className:"b1 grRight",tooltip:"Load next object",cls:this,noid:e,otype:this.mainObject.name,pPath:c,onclick:function(){this.noid&&(document.location.hash="#"+this.pPath+"/"+this.otype+":"+this.noid)}}),b.print(a),e||b.disable()}};
AntObjectLoader_Form.prototype.formHasTabs=function(a){for(var b=!1,c=0;c<a.getNumChildren();c++)"tab"==a.getChildNode(c).m_name&&(b=!0);b&&null==this.tabs&&(this.tabs=new CTabs,this.loaderCls.tabs=this.tabs);return b};
AntObjectLoader_Form.prototype.onValueChange=function(a,b){for(var c=0;c<this.watchChanges.length;c++)if(this.watchChanges[c].field==a)try{this.watchChanges[c].onchange(b)}catch(d){}if("id"==a&&b)for(c=0;c<this.plugins.length;c++)try{this.plugins[c].objectsaved&&this.plugins[c].objectsaved()}catch(e){alert("Problem calling objectsaved for "+this.plugins[c].name)}c=this.mainObject.getFieldByName(a);if(!c)return!1;if("zipcode"==c.subtype){var c="",f=a.split("_");2==f.length&&(c=f[0]);this.loadAddressCityStateFromZip(b,
c)}};AntObjectLoader_Form.prototype.loadAddressCityStateFromZip=function(a,b){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.pre=b;ajax.onload=function(a){a.error||(a.state&&this.cbData.cls.loaderCls.setValue(this.cbData.pre?this.cbData.pre+"_state":"state",a.state),a.city&&this.cbData.cls.loaderCls.setValue(this.cbData.pre?this.cbData.pre+"_city":"city",a.city))};ajax.exec("/controller/Customer/custGetZipData",[["zipcode",a]])};
AntObjectLoader_Form.prototype.buildForm=function(a,b){var c=alib.dom.createElement("table",a);alib.dom.styleSet(c,"width","100%");c.cellSpacing=0;for(var c=alib.dom.createElement("tbody",c),d=null,e=0,f=0;f<b.getNumChildren();f++){var g=b.getChildNode(f);"column"==g.m_name&&e++}e||(e=1);for(f=e=0;f<b.getNumChildren();f++){var g=b.getChildNode(f),h=unescape(g.getAttribute("showif")),k=!0,l=null;if(h&&(h=h.split("="),2==h.length)){l=this.mainObject.getFieldByName(h[0]);"bool"==l.type&&(h[1]="t"==h[1]?
!0:!1);var l=this.mainObject.getValue(h[0]),m=this.mainObject.getValueName(h[0]);if("*"==h[1]&&!l||l!=h[1]&&m!=h[1]&&"*"!=h[1])k=!1;l={};l.field=h[0];l.condval=h[1];this.watchChanges[this.watchChanges.length]=l}switch(g.m_name){case "tab":this.buildForm(this.tabs.addTab(unescape(g.getAttribute("name")),function(a){a.refresh()},[this]),g);break;case "plugin":this.loadPlugin(unescape(g.getAttribute("name")),a);break;case "helptour":l=g.getAttribute("type");if(g=g.getAttribute("id"))k=alib.dom.createElement("div",
a),k.setAttribute("data-tour",g),l&&k.setAttribute("data-tour-type",l);break;case "recurrence":k={};k.hidelabel="t"==unescape(g.getAttribute("hidelabel"))?!0:!1;this.loadRecurrence(a,k);break;case "members":l=new AntObjectLoader_FormMem;this.plugins[this.plugins.length]=l;l.field=unescape(g.getAttribute("field"));this.loadPlugin("members",a);break;case "reminders":l=new AntObjectLoader_Reminders;this.plugins[this.plugins.length]=l;l.fieldName=g.getAttribute("field_name");l.addDefault="t"==g.getAttribute("add_default")?
!0:!1;this.loadPlugin("reminders",a);break;case "attachments":g=new AntObjectLoader_FormAttachments;g.mainObject=this.mainObject;this.plugins[this.plugins.length]=g;this.loadPlugin("attachments",a);break;case "status_update":g=new AntObjectLoader_StatusUpdate;g.mainObject=this.mainObject;this.plugins[this.plugins.length]=g;this.loadPlugin("status_update",a);break;case "icon":var l=alib.dom.createElement("span",a),n=g.getAttribute("width")?g.getAttribute("width"):48;if(g=this.mainObject.getIcon(48))l.innerHTML=
'<img src="'+g+"\" style='width:"+n+"px;' />";break;case "uname":g=new AntObjectLoader_Uname;g.mainObject=this.mainObject;this.plugins[this.plugins.length]=g;this.loadPlugin("uname",a);break;case "report":k=unescape(g.getAttribute("id"));g=unescape(g.getAttribute("filterby"));this.mainObject.id?this.loadReports[this.loadReports.length]={rid:k,filterby:g,con:a}:(a.innerHTML="",l={},this.watchChanges[this.watchChanges.length]=l,l.field="id",l.condval=null,l.cls=this,l.rid=k,l.filterby=g,l.con=a,l.onchange=
function(a){a&&this.cls.loadReport(this.rid,this.filterby,this.con)});break;case "fieldset":l=alib.dom.setElementAttr(alib.dom.createElement("div"),[["innerHTML",unescape(g.getAttribute("name"))]]);g&&g.getAttribute("tooltip")&&(k=unescape(g.getAttribute("tooltip")),h=alib.dom.setElementAttr(alib.dom.createElement("img",l),[["src","/images/icons/help_12.png"]]),alib.dom.styleSet(h,"marginLeft","10px"),alib.dom.styleSet(h,"cursor","help"),alib.ui.Tooltip(h,k));l=new CWindowFrame(l);k=l.getCon();l.print(a);
k.fieldsetRef=l;this.buildForm(k,g);break;case "objectsref":k=unescape(g.getAttribute("obj_type"));n=unescape(g.getAttribute("ref_field"));l=unescape(g.getAttribute("ref_this"));(h=unescape(g.getAttribute("name")))||(h="View "+k);if(k)if(this.objectsRef.push({objType:k,refField:n}),this.mainObject.id&&!this.loaderCls.cloneObject){m=null;m=new AntObjectBrowser(k);m.setObjectContext(this.mainObject);this.objectBrowsers[this.objectBrowsers.length]=m;this.loaderCls.antView&&m.setAntView(this.loaderCls.antView);
n?(m.setViewsFilter(this.mainObject.name),l?m.setFilter(n,this.mainObject.getValue(l)):m.setFilter(n,this.mainObject.id)):m.setFilter("associations",this.mainObject.name+":"+this.mainObject.id);if(g=g.getChildNodeByName("filter"))for(f=0;f<g.getNumChildren();f++){var o=g.getChildNode(f),n=o.getAttribute("blogic"),l=o.getAttribute("field"),p=o.getAttribute("operator"),o=o.getAttribute("value");m.addCondition(n,l,p,o)}m.obj_reference=this.mainObject.name+":"+this.mainObject.id;m.loaderCls=this.loaderCls;
this.loaderCls.isMobile&&this.loaderCls.antView?(g=this.loaderCls.antView.addView("ref-"+k,{ob:m}),g.render=function(){this.con.innerHTML="";this.options.ob.setAntView(this);this.options.ob.print(this.con)},g.onshow=function(){},g=alib.dom.createElement("article",a),alib.dom.styleSetClass(g,"nav"),g=alib.dom.createElement("a",g),g.setAttribute("behavior","selectable"),g.href="#"+this.loaderCls.antView.getPath()+"/ref-"+k,g.innerHTML="<span class='icon'></span><h2><span class='more'></span>"+h+"</h2>"):
m.printInline(a)}else this.loaderCls.subLoaderParams.fromFormLoader,this.loaderCls.isMobile||(a.innerHTML="Please save changes to view more details"),l={},this.watchChanges[this.watchChanges.length]=l,l.field="id",l.condval=null,l.cls=this,l.obj_type=k,l.ref_field=n,l.con=a,l.onchange=function(b){b&&(a.innerHTML="",this.ref_field?(b=new AntObjectBrowser(this.obj_type),this.cls.objectBrowsers[this.cls.objectBrowsers.length]=b,this.cls.loaderCls.antView&&b.setAntView(this.cls.loaderCls.antView),b.setFilter(this.ref_field,
this.cls.mainObject.id),b.setViewsFilter(this.cls.mainObject.name)):(b=new AntObjectBrowser(this.obj_type),this.cls.objectBrowsers[this.cls.objectBrowsers.length]=b,this.cls.loaderCls.antView&&b.setAntView(this.cls.loaderCls.antView),b.setFilter("associations",this.cls.mainObject.name+":"+this.cls.mainObject.id)),b.obj_reference=this.cls.mainObject.name+":"+this.cls.mainObject.id,b.loaderCls=this.cls.loaderCls,b.printInline(this.con))};break;case "spacer":h=alib.dom.createElement("div",a);alib.dom.styleSet(h,
"height","5px");break;case "row":h=alib.dom.createElement("div",a);(n=unescape(g.getAttribute("width")))&&alib.dom.styleSet(h,"width",n);k||alib.dom.styleSet(h,"display","none");l&&(l.con=h,l.onchange=function(a){this.con.style.display=a==this.condval?"block":"none"});"t"==unescape(g.getAttribute("editmodeonly"))&&(!1==this.editMode&&alib.dom.styleSet(h,"display","none"),alib.events.listen(this,"changemode",function(a){a.data.rowCon.style.display=a.data.cls.editMode?"block":"none"},{rowCon:h,cls:this}));
this.buildForm(h,g);break;case "column":d||(d=alib.dom.createElement("tr",c),d.vAlign="top");e++;m=alib.dom.createElement("td",d);(n=unescape(g.getAttribute("width")))&&alib.dom.styleSet(m,"width",n);1<e&&((h=unescape(g.getAttribute("padding")))?alib.dom.styleSet(m,"padding-left",h):alib.dom.styleSet(m,"padding-left","20px"));k||alib.dom.styleSet(m,"display","none");l&&(l.con=m,l.onchange=function(a){this.con.style.display=a==this.condval?"table-cell":"none"});if(l=unescape(g.getAttribute("style")))for(cStyle in l=
l.split(";"),l)h=l[cStyle].split(":"),alib.dom.styleSet(m,h[0],h[1]);this.buildForm(m,g);break;case "label":h=alib.dom.createElement("tr",c);h.vAlign="top";k=alib.dom.createElement("td",h);alib.dom.styleSetClass(k,"formLabel");(l=g.getAttribute("field"))?(alib.events.listen(this.mainObject,"fieldchange",function(a){a.data.fieldName==a.data.lblFieldName&&(a.data.labelCon.innerHTML=a.data.valueName?a.data.valueName:a.data.value)},{labelCon:k,lblFieldName:l}),k.innerHTML=this.mainObject.getValueName(l)):
k.innerHTML=g.text();break;case "header":k=alib.dom.createElement("div",a);alib.dom.styleSetClass(k,"headerLabel");(l=g.getAttribute("field"))?(alib.events.listen(this.mainObject,"fieldchange",function(a){a.data.fieldName==a.data.lblFieldName&&(a.data.labelCon.innerHTML=a.data.valueName?a.data.valueName:a.data.value)},{labelCon:k,lblFieldName:l}),k.innerHTML=this.mainObject.getValueName(l)):k.innerHTML=g.text();break;case "text":h=alib.dom.createElement("span",a);alib.dom.styleSet(h,"marginBottom",
"5px");g.getAttribute("class")&&alib.dom.styleSetClass(h,g.getAttribute("class"));k||alib.dom.styleSet(h,"display","none");(l=g.getAttribute("field"))?(alib.events.listen(this.mainObject,"fieldchange",function(a){a.data.fieldName==a.data.lblFieldName&&(a.data.labelCon.innerHTML=a.data.valueName?a.data.valueName:a.data.value)},{labelCon:h,lblFieldName:l}),h.innerHTML=this.mainObject.getValueName(l)):h.innerHTML=g.text();break;case "field":if("uname"==unescape(g.getAttribute("name"))){g=new AntObjectLoader_Uname;
g.mainObject=this.mainObject;this.plugins[this.plugins.length]=g;this.loadPlugin("uname",a);break}h=alib.dom.createElement("tr",c);alib.dom.styleSetClass(h,"formRow");h.vAlign="top";l=this.mainObject.getFieldByName(unescape(g.getAttribute("name")));k={};k.className=g.getAttribute("class");k.hidelabel="t"==unescape(g.getAttribute("hidelabel"))?!0:!1;k.multiLine="t"==unescape(g.getAttribute("multiline"))?!0:!1;k.rich="t"==unescape(g.getAttribute("rich"))?!0:!1;k.profileImage="t"==unescape(g.getAttribute("profile_image"))?
!0:!1;k.mode="form";k.icon=g.getAttribute("icon");k.editmodeonly="t"==g.getAttribute("editmodeonly")?!0:!1;k.plugins=g.getAttribute("plugins");k.refField=g.getAttribute("ref_field");k.refThis=g.getAttribute("ref_this");k.refValue=g.getAttribute("ref_value");k.refRequired="t"==g.getAttribute("ref_required")?!0:!1;if(m=unescape(g.getAttribute("label")))l.title=m;g.getAttribute("validator")&&(k.validator=g.getAttribute("validator"));g.getAttribute("part")&&(k.part=unescape(g.getAttribute("part")));g.getAttribute("view")&&
(k.viewId=unescape(g.getAttribute("view_id")));if(l){m=a.fieldsetRef?a.fieldsetRef:null;try{this.printField(l,h,k,g,m)}catch(q){alert("There was a problem loading "+l.name+"\n\n"+q)}}break;case "all_additional":g=this.mainObject.getFields();k=!1;for(f=0;f<g.length;f++)l=g[f],l.system||(h=alib.dom.createElement("tr",c),h.vAlign="top",this.printField(l,h,{},null,a.fieldsetRef?a.fieldsetRef:null),k=!0);a.fieldsetRef&&!1==k&&a.fieldsetRef.hide()}}};
AntObjectLoader_Form.prototype.printField=function(a,b,c,d,e){var f=null,c=c?c:{},g=d?unescape(d.getAttribute("default")):null;g||(g=a.default_value);!this.mainObject.id&&g&&!this.mainObject.getValue(a.name)&&("timestamp"==a.type&&"now"==g&&(g=new Date,g=g.getMonth()+1+"/"+g.getDate()+"/"+g.getFullYear()+" "+calGetClockTime(g)),"date"==a.type&&"now"==g&&(g=new Date,g=g.getMonth()+1+"/"+g.getDate()+"/"+g.getFullYear()),this.loaderCls.newWindowArgs&&(g=unescape_utf8(this.loaderCls.newWindowArgs[a.name][0])),
this.mainObject.setValue(a.name,g));"object"==a.type&&"user"==a.subtype&&d&&(a.showimage="t"==unescape(d.getAttribute("showimage"))?!0:!1);"object_multi"==a.type&&!c.hidelabel&&(c.hidelabel=!0);g=!1;if("object"==a.type&&"folder"==a.subtype){var h=alib.dom.createElement("td",b);alib.dom.styleSetClass(h,"formLabel");"t"==c.hidelabel||!0==c.hidelabel?(h.innerHTML="",alib.dom.styleSet(h,"width","0px")):h.innerHTML=a.title;d=alib.dom.createElement("td",b);val_con=alib.dom.createElement("div",d);alib.dom.styleSetClass(val_con,
"formValue");f={};f.dv_inp=alib.dom.createElement("div",val_con);alib.dom.styleSet(f.dv_inp,"display",this.editMode?"block":"none");f.dv_text=alib.dom.createElement("input",val_con);f.dv_text.type="hidden";var k=alib.dom.createElement("a",f.dv_inp),l=alib.dom.createElement("span",f.dv_inp),m=alib.dom.createElement("div",val_con);alib.dom.styleSet(l,"margin-left","3px");d=new AntFsOpen;d.filterType="folder";d.cbData.field_name=a.name;d.cbData.frmcls=this;d.cbData.folderCon=m;d.cbData.folderPathCon=
l;d.onSelect=function(a,b,c){this.cbData.frmcls.displayInlineFolder(this.cbData.field_name,a,this.cbData.folderCon);this.cbData.frmcls.mainObject.setValue(this.cbData.field_name,a);this.cbData.folderPathCon.innerHTML="Current Folder: "+c};this.mainObject.getValue(a.name)&&(d.setPathById(this.mainObject.getValue(a.name)),d.onSetPath=function(a){this.cbData.folderPathCon.innerHTML="Current Folder: "+a});k.innerHTML="[set path]";k.href="javascript:void(0);";k.cbrowser=d;k.onclick=function(){this.cbrowser.showDialog()}}else c.hidelabel||
(h=alib.dom.createElement("td",b),alib.dom.styleSetClass(h,"formLabel"),c.className&&alib.dom.styleAddClass(h,c.className),g=alib.dom.createElement("div",h),h=a.title,c.icon&&(h="<img src='"+c.icon+"' />&nbsp;"+h),g.innerHTML=h,a.required&&(h=alib.dom.createElement("a",g),alib.dom.styleSet(h,"color","red"),alib.dom.styleSet(h,"font-size","16px"),alib.dom.styleSet(h,"text-decoration","none"),h.title="This is a required field",h.innerHTML="*"),d&&"field"==d.m_name&&d.getAttribute("tooltip")&&(d=unescape(d.getAttribute("tooltip")),
g=alib.dom.setElementAttr(alib.dom.createElement("img",g),[["src","/images/icons/help_12.png"]]),alib.dom.styleSet(g,"marginLeft","5px"),alib.dom.styleSet(g,"cursor","help"),alib.ui.Tooltip(g,d))),d=alib.dom.createElement("td",b),val_con=alib.dom.createElement("div",d),alib.dom.styleSetClass(val_con,"formValue"),c.className&&alib.dom.styleAddClass(val_con,c.className),g=!0;g&&(f={},f.options=c,f.dv_label=alib.dom.createElement("div",val_con),alib.dom.styleSet(f.dv_label,"display","none"),f.dv_text=
alib.dom.createElement("div",val_con),alib.dom.styleSet(f.dv_text,"display",this.editMode?"none":"block"),f.dv_inp=alib.dom.createElement("div",val_con),alib.dom.styleSet(f.dv_inp,"display",this.editMode?"block":"none"),divClear(val_con));f&&(f.fname=a.name,f.ftype=a.type,f.fstype=a.subtype,f.options=c,f.fieldSet=e?e:null,this.inputs[this.inputs.length]=f);a.readonly||a.auto?f&&(f.dv_inp.innerHTML=this.mainObject.getValueName(a.name),f.dv_text.innerHTML="",this.setFieldTextDisplay(a.name,null,b)):
"object_multi"==a.type?this.mainObject.id&&!this.loaderCls.cloneObject?(val_con.innerHTML="",this.printFieldObjectMulti(a.name,val_con,c)):(this.loaderCls.isMobile||(val_con.innerHTML="Please save changes to view more details"),onchangeobj={},this.watchChanges[this.watchChanges.length]=onchangeobj,onchangeobj.field="id",onchangeobj.condval=null,onchangeobj.cls=this,onchangeobj.val_con=val_con,onchangeobj.ref_field_name=a.name,onchangeobj.opts=c,onchangeobj.onchange=function(a){val_con.innerHTML="";
a&&(this.val_con.innerHTML="",this.cls.mainObject.id=a,this.cls.printFieldObjectMulti(this.ref_field_name,this.val_con,this.opts))}):"object"==a.type&&"folder"==a.subtype?this.mainObject.id?this.mainObject.getValue(a.name)?this.displayInlineFolder(a.name,this.mainObject.getValue(a.name),m):(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.cbData.field_name=name,ajax.cbData.val_con=val_con,ajax.onload=function(a){a.error||(this.cbData.cls.displayInlineFolder(this.cbData.field_name,a,this.cbData.val_con),
this.cbData.cls.mainObject.setValue(this.cbData.field_name,a))},ajax.exec("/controller/Object/getFolderId",[["obj_type",this.mainObject.name],["field",a.name],["oid",this.mainObject.id]])):(k.innerHTML="",l.innerHTML="Please save changes before editing files",onchangeobj={},this.watchChanges[this.watchChanges.length]=onchangeobj,onchangeobj.field="id",onchangeobj.condval=null,onchangeobj.cls=this,onchangeobj.fname=a.name,onchangeobj.folderCon=m,onchangeobj.setPathLink=k,onchangeobj.folderPathCon=
l,onchangeobj.onchange=function(a){a&&(this.folderPathCon.innerHTML="",this.cls.editMode&&(this.setPathLink.innerHTML="[set path]"),ajax=new CAjax("json"),ajax.cbData.cls=this.cls,ajax.cbData.fname=this.fname,ajax.cbData.folderCon=this.folderCon,ajax.onload=function(a){a.error||(this.cbData.cls.displayInlineFolder(this.cbData.field_name,a,this.cbData.folderCon),this.cbData.cls.mainObject.setValue(this.cbData.field_name,a))},ajax.exec("/controller/Object/getFolderId",[["obj_type",this.cls.mainObject.name],
["field",this.fname],["oid",a]]))}):"fkey"==a.type&&"user_files"==a.subtype?((b=this.mainObject.getValue(a.name))?(f.dv_label.innerHTML=c.profileImage?'<img src="/files/images/'+b+"/48\" border='0' />":'<a href="/files/'+b+'">'+this.mainObject.getValueName(a.name)+"</a>&nbsp;",a.required||(b=alib.dom.createElement("a",f.dv_inp),b.href="javascript:void(0);",b.mainObject=this.mainObject,b.fname=a.name,b.lbl=f.dv_label,b.onclick=function(){this.lbl.innerHTML="None Selected&nbsp;&nbsp;&nbsp;";this.mainObject.setValue(this.fname,
"")},b.innerHTML="<img src='/images/icons/delete_10.png' />",alib.dom.createElement("span",f.dv_inp).innerHTML="&nbsp;&nbsp;&nbsp;")):f.dv_label.innerHTML="None Selected&nbsp;&nbsp;&nbsp;",(new CButton("Select File",function(b,c,d,e){var f=new AntFsOpen;f.cbData.field=a;f.cbData.field_name=b;f.cbData.frmcls=c;f.cbData.opts=d;f.cbData.lbl=e;b=c.lookForFolderRoot();-1!=b&&f.setPathById(b);f.onSelect=function(a,b){this.cbData.frmcls.mainObject.setValue(this.cbData.field_name,a);var c=this.cbData.lbl;
c.innerHTML=this.cbData.opts.profileImage?'<img src="/files/images/'+a+"/48\" border='0' />":'<a href="/files/'+a+'">'+b+"</a>";if(!this.cbData.field.required){var d=alib.dom.createElement("span",this.cbData.lbl);d.innerHTML="&nbsp;";d=alib.dom.createElement("a",this.cbData.lbl);d.href="javascript:void(0);";d.mainObject=this.cbData.frmcls.mainObject;d.fname=this.cbData.field.name;d.lbl=this.cbData.lbl;d.onclick=function(){this.lbl.innerHTML="None Selected&nbsp;&nbsp;&nbsp;";this.mainObject.setValue(this.fname,
"")};d.innerHTML="<img src='/images/icons/delete_10.png' />"}d=alib.dom.createElement("span",c);d.innerHTML="&nbsp;&nbsp;&nbsp;"};f.showDialog()},[a.name,this,c,f.dv_label],"b1")).print(f.dv_inp),c.profileImage&&alib.dom.styleSet(val_con,"text-align","center"),alib.dom.styleSet(f.dv_label,"display","block"),alib.dom.styleSet(f.dv_label,"float","left"),alib.dom.styleSet(f.dv_text,"float","left"),alib.dom.styleSet(f.dv_inp,"float","left"),alib.dom.styleSet(f.dv_inp,"width","90%px"),alib.dom.styleSet(f.dv_inp,
"margin-top","-5px")):("object"==a.type&&"file"==a.subtype&&(c.folderRoot=this.lookForFolderRoot()),e=new AntObject_FieldInput(this.mainObject,a.name),e.render(f.dv_inp,c),f.inp=e,this.setFieldTextDisplay(a.name,c,b))};
AntObjectLoader_Form.prototype.printFieldObjectMulti=function(a,b){var c=this.mainObject.getFieldByName(a);if(!c)return!1;if(c.subtype){var d=new AntObjectBrowser(c.subtype);d.setObjectContext(this.mainObject);this.objectBrowsers[this.objectBrowsers.length]=d;this.loaderCls.antView?d.setAntView(this.loaderCls.antView):d.setAutoRefresh(1E4);d.loaderCls=this.loaderCls;d.obj_reference=this.mainObject.name+":"+this.mainObject.id;if("comment"==c.subtype||"activity"==c.subtype)d.limit=50,d.setViewsFilter(this.mainObject.name),
"comment"==c.subtype?d.setFilter("obj_reference",this.mainObject.name+":"+this.mainObject.id):d.setFilter("associations",this.mainObject.name+":"+this.mainObject.id),d.printComments(b,this.mainObject.name+":"+this.mainObject.id,this.mainObject);else{d.addToolbarAction(function(a,b,c){c.cls.objectMultiAddExisting(a,b,c)},[{cls:this,fname:c.name,subtype:c.subtype}]);d.addToolbarAction(function(a,b,c){c.cls.objectMultiRemove(a,b,c)},[{cls:this,fname:c.name,subtype:c.subtype}]);d.optCreateNew=!1;d.optDelete=
!1;d.optActions=!1;c=this.mainObject.getMultiValues(a);if(c.length)for(i=0;i<c.length;i++)d.setFilter("id",c[i],i?"or":"and");else d.skipLoad=!0;d.printInline(b)}}};
AntObjectLoader_Form.prototype.objectMultiAddExisting=function(a,b,c){b=new CButton("Add Existing",function(a,b,c){var g=new AntObjectBrowser(c.subtype);g.options.field_name=c.fname;g.options.obj_type=c.subtype;g.options.frmcls=a;g.options.browsercls=b;g.onSelect=function(a){this.options.frmcls.mainObject.setMultiValue(this.options.field_name,a);this.options.browsercls.setFilter("id",a,"or");this.options.browsercls.refresh()};g.displaySelect()},[this,b,c],"b2");a.AddItem(b.getButton())};
AntObjectLoader_Form.prototype.objectMultiRemove=function(a,b,c){b=new CButton("Remove",function(a,b,c){var g=new AntObjectBrowser(c.subtype);g.options.field_name=c.fname;g.options.obj_type=c.subtype;g.options.frmcls=a;g.options.browsercls=b;g.onSelect=function(a){this.options.frmcls.mainObject.delMultiValue(this.options.field_name,a);this.options.browsercls.removeFilter("id",a);this.options.browsercls.refresh()};g.displaySelect()},[this,b,c],"b3");a.AddItem(b.getButton())};
AntObjectLoader_Form.prototype.setFieldTextDisplay=function(a,b,c){var b=null,d=this.mainObject.getFieldByName(a);if(d)for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].fname==a){b=this.inputs[e];c&&(b.fieldRow=c);if("object"==d.type&&"file"==d.subtype){b.dv_text.innerHTML="";b.dv_text.id="myfiletextdiv";var f=this.mainObject.getValue(a),g=this.mainObject.getValueName(a);b.dv_text.innerHTML=f?b.options.profileImage?"<img src='/antfs/images/"+f+"/48' />":"<a href='/files/"+f+"'>"+g+"</a>":b.options.profileImage?
"<img src='/images/icons/objects/files/image_48.png' />":"Not Set"}else if("fkey"==d.type||"object"==d.type){b.dv_text.innerHTML="";if("user"==d.subtype&&d.showimage){var h=alib.dom.createElement("span",b.dv_text);if(f=this.mainObject.getValue(d.name))ajax=new CAjax("json"),ajax.cbData.imgCon=h,ajax.onload=function(a){a.error||(this.cbData.con.innerHTML="<img src='/antfs/images/"+a+"/48' align='left' />&nbsp;")},ajax.exec("/controller/User/userGetImage",[["uid",f]])}f=alib.dom.createElement("span",
b.dv_text);if("object"==d.type){h=this.mainObject.getValue(d.name);g="";if(d.subtype)g=d.subtype;else{var k=h.split(":");2==k.length&&(g=k[0],h=k[1])}k="";h&&g?(d.subtype||(k=new CAntObject(g),k=k.getIcon(16,16)?"<img src='"+k.getIcon(16,16)+"'> ":k.title+": "),k+='<a href="javascript:void(0);" onclick="loadObjectForm(\''+g+"', '"+h+"');\">"+this.mainObject.getValueName(d.name)+"</a>",AntObjectInfobox.attach(g,h,f)):k="None Selected";f.innerHTML=k}else h=this.mainObject.getValueName(d.name),f.innerHTML=
h}else if("fkey_multi"==d.type)b.dv_text.innerHTML=this.mainObject.getMultiValueStr(d.name);else if("alias"==d.type){k="";if(f=this.mainObject.getValue(d.name))if(f=this.mainObject.getFieldByName(f))k=f.title;b.dv_text.innerHTML=k}else if("bool"==d.type||"boolean"==d.type)k=(f=this.mainObject.getValue(d.name))?"Yes":"No",b.dv_text.innerHTML=k;else{f=this.mainObject.getValueStr(d.name);"string"==typeof f&&"html"!=d.subtype&&!b.options.rich&&(f=f.replace(RegExp("\n","gi"),"<br />"));"string"==typeof f&&
("html"==d.subtype||b.options.rich)&&alib.dom.styleAddClass(b.dv_text,"formHtmlBody");switch(b.options.part){case "time":"timestamp"==d.type&&(f=this.mainObject.getInputPartValue(d.name,f,"time"));break;case "date":"timestamp"==d.type&&(f=this.mainObject.getInputPartValue(d.name,f,"date"))}"infocenter_document"==this.mainObject.obj_type&&"text"==d.type&&(f=this.textActiveWikiLink(f));f=this.textActivateLinks(f);b.dv_text.innerHTML=f}b.fieldRow&&"object_multi"!=d.type?!this.editMode&&(0==b.dv_text.innerHTML.length||
"fkey"==d.type&&0==h.length||b.options.editmodeonly)?alib.dom.styleSet(b.fieldRow,"display","none"):(b.fieldRow.setAttribute("style",""),b.fieldSet&&(b.fieldSet.valuesPresent=!0)):"object_multi"==d.type&&b.fieldSet&&(b.fieldSet.valuesPresent=!0);b.fieldSet&&("undefined"==typeof b.fieldSet.valuesPresent||!1==b.fieldSet.valuesPresent?b.fieldSet.hide():b.fieldSet.show())}};
AntObjectLoader_Form.prototype.textActiveWikiLink=function(a){if(!a||"string"!=typeof a)return a;var b=/\[\[([^|\]]*)?\|(.*?)\]\]/gi,a=a.replace(b,'<a href="/obj/infocenter_document/$1" target="_blank">$2</a>'),b=/\[\[([0-9]+)]\]/gi,a=a.replace(b,'<a href="/obj/infocenter_document/$1$1" target="_blank">$1</a>'),b=/\[\[([a-zA-Z0-9_-]+)]\]/gi;return a=a.replace(b,'<a href="/obj/infocenter_document/uname:$1" target="_blank">$1</a>')};
AntObjectLoader_Form.prototype.textActivateLinks=function(a){if(!a||"string"!=typeof a)return a;var b=/(^|>|\s)(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,a=a.replace(/<a\s+href=/gi,'<a target="_blank" href='),b=/(^|>|\s)(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,a=a.replace(b,'<a href="$2" target="_blank">$2</a>'),b=/(^|[^\/])(www\.[\S]+(\b|$))/gim,a=a.replace(b,'$1<a href="http://$2" target="_blank">$2</a>'),b=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;
return a=a.replace(b,"<a href=\"javascript:Ant.Emailer.compose('$1', {obj_type:'"+this.mainObject.obj_type+"', oid:'"+this.mainObject.id+"'});\">$1</a>")};AntObjectLoader_Form.prototype.formLoaded=function(){for(var a=0;a<this.loadReports.length;a++)this.loadReport(this.loadReports[a].rid,this.loadReports[a].filterby,this.loadReports[a].con);this.loaderCls.resize();Ant.HelpTour.loadTours(this.formCon)};
AntObjectLoader_Form.prototype.lookForFolderRoot=function(){for(var a=this.mainObject.getFields(),b=0;b<a.length;b++){var c=a[b];if("object"==c.type&&"folder"==c.subtype&&(c=this.mainObject.getValue(c.name)))return c}return-1};
AntObjectLoader_Form.prototype.loadPlugin=function(a,b){for(var c=null,d=0;d<this.plugins.length;d++)this.plugins[d].name==a&&(c=this.plugins[d]);if(c){c.formObj=this;c.mainObject=this.mainObject;if(c.olCls=this.loaderCls)c.toolbar=this.toolbar;c.main(b);c.frmLoaded=!0}else b.innerHTML="Plugin not found: "+a};
AntObjectLoader_Form.prototype.loadRecurrence=function(a,b){if(!b.hidelabel){var c=alib.dom.createElement("div",a);alib.dom.styleSetClass(c,"formLabel");alib.dom.styleSet(c,"width","100px");alib.dom.styleSet(c,"display","inline-block");c.innerHTML="Repeats"}c=alib.dom.createElement("a",a);c.href="javascript:void(0);";if(this.mainObject.getRecurrencePattern(!1))c.innerHTML=this.mainObject.recurrencePattern.getHumanDesc();else{var d={};this.watchChanges[this.watchChanges.length]=d;d.link=c;d.onchange=
function(){this.mainObject.getRecurrencePattern(!1)&&(this.link.innerHTML=this.mainObject.recurrencePattern.getHumanDesc())};c.innerHTML="Does not repeat"}c.obj=this.mainObject;c.descDiv=c;c.onclick=function(){var a=this.obj.getRecurrencePattern(!0);a.descDiv=this;if(a.fieldDateStart&&""==a.dateStart&&this.obj.getFieldByName(a.fieldDateStart)){var b=this.obj.getValue(a.fieldDateStart);a.dateStart=this.obj.getInputPartValue(a.fieldDateStart,b,"date")}a.onchange=function(){this.descDiv.innerHTML=this.getHumanDesc()};
a.showDialog()}};
AntObjectLoader_Form.prototype.loadReport=function(a,b,c){a=new Report(a);a.cls=this;a.displayReportName=!1;a.cbData.con=c;a.cbData.filterby=b;a.chartWidth=800>c.offsetWidth?c.offsetWidth:800;a.chartHeight=3*(a.chartWidth/4);a.onload=function(){if(this.cbData.filterby){this.filterData||(this.filterData=[]);var a=this.filterData.length;this.filterData[a]={};a=this.filterData[a];a.blogic="and";a.fieldName=b;a.operator="is_equal";a.condValue=this.cls.mainObject.id}this.print(alib.dom.createElement("div",this.cbData.con))};
a.loadReport()};AntObjectLoader_Form.prototype.displayInlineFolder=function(a,b,c){b&&c&&(c.innerHTML="",a=new AntObjectBrowser("file"),a.setBrowseBy("folder_id",".",b),a.printInline(c),this.objectBrowsers[this.objectBrowsers.length]=a)};AntObjectLoader_Form.prototype.onNameChange=function(){};
function AntObjectLoader_FormMem(){this.data={};this.name="members";this.title="Members";this.mainObject=null;this.newinvitations=!1;this.members=[];this.field="";this.saveParentObject=!1;this.awaitingTable=this.awaitingCon=this.declinedTable=this.declinedCon=this.confirmedTable=this.confirmedCon=null}AntObjectLoader_FormMem.prototype.main=function(a){this.buildInterface(a)};
AntObjectLoader_FormMem.prototype.save=function(){for(var a=0;a<this.members.length;a++)this.members[a].processed=!1;if(1>this.members.length)this.onsave();else this.saveMembers()};
AntObjectLoader_FormMem.prototype.saveMembers=function(){for(var a=null,b=0;b<this.members.length;b++)if(!this.members[b].processed&&(this.members[b].obj.id&&this.members[b].obj.dirty||!this.members[b].obj.id)){a=this.members[b];break}a?(a.obj.cbProps.memCls=this,a.obj.cbProps.memObj=a,a.wasnew=a.obj.id?!1:!0,"delete"==a.action?(a.obj.onremove=function(){this.cbProps.memObj.processed=!0;this.cbProps.memCls.mainObject.delMultiValue(this.cbProps.memCls.field,this.id);this.cbProps.memCls.saveParentObject=
!0;this.cbProps.memCls.saveMembers()},a.obj.remove()):(a.obj.setValue("obj_reference",this.mainObject.name+":"+this.mainObject.id),a.obj.onsave=function(){this.cbProps.memObj.processed=!0;this.cbProps.memObj.wasnew&&(this.cbProps.memCls.mainObject.setMultiValue(this.cbProps.memCls.field,this.id),this.cbProps.memCls.saveParentObject=!0);this.cbProps.memCls.saveMembers()},a.obj.onsaveError=function(){this.cbProps.memObj.processed=!0;this.cbProps.memCls.saveMembers()},a.obj.save())):(this.saveParentObject&&
this.mainObject.save({repressOnSave:!0}),this.checkSendNotifications())};AntObjectLoader_FormMem.prototype.onsave=function(){};
AntObjectLoader_FormMem.prototype.checkSendNotifications=function(){if(0<this.members.length){var a=new CDialog("Send Updates &amp; Invitations"),b=alib.dom.createElement("div"),c=alib.dom.createElement("div",b);c.innerHTML="Would you like to send updates and/or invitations?";alib.dom.styleSet(c,"padding-bottom","5px");var c=alib.dom.createElement("div",b),d=new CButton("Yes, Send",function(a,b){a.hide();b.sendNotifications()},[a,this],"b2");d.print(c);d=new CButton("Yes, Only Send New Invites",function(a,
b){a.hide();b.sendNotifications(!0)},[a,this],"b1");d.print(c);d=new CButton("No, Don't Send",function(a,b){a.hide();b.onsave()},[a,this],"b1");d.print(c);alib.dom.styleSet(alib.dom.createElement("div",b),"clear","both");a.customDialog(b,400)}else this.onsave()};
AntObjectLoader_FormMem.prototype.sendNotifications=function(a){var b=new alib.net.Xhr;alib.events.listen(b,"load",function(a){var b=this.getResponse();console.log(b);a.data.defCls.onsave()},{defCls:this});alib.events.listen(b,"error",function(a){a.data.defCls.onsave()},{defCls:this});b.send("/controller/Object/sendInvitations","POST",{obj_type:this.mainObject.obj_type,oid:this.mainObject.id,field:this.field,onlynew:a?"t":"f"})};
AntObjectLoader_FormMem.prototype.buildInterface=function(a){var b=alib.dom.createElement("div",a),c=alib.dom.createElement("div",b),b=alib.dom.createElement("div",b),d=alib.dom.createElement("input",b),d=new CTextBoxList(d,{bitsOptions:{editable:{addKeys:[188,13,186,59],addOnBlur:!0}},plugins:{autocomplete:{placeholder:!1,minLength:2,queryRemote:!0,remote:{url:"/users/json_autocomplete.php"}}}}),d=new alib.ui.Button("Add",{className:"b1 grRight",tooltip:"Add",cls:this,t:d,onclick:function(){this.cls.submitAddAttendee(this.t)}});
d.print(c);alib.dom.styleSet(b,"margin-right",d.getWidth()+"px");alib.dom.styleSet(c,"float","right");c=alib.dom.createElement("div",a);c.style.display="none";b=alib.dom.createElement("h3",c);b.innerHTML="Confirmed";this.confirmedCon=c;c=alib.dom.createElement("div",a);c.style.display="none";b=alib.dom.createElement("h3",c);b.innerHTML="Awaiting Reply";this.awaitingCon=c;c=alib.dom.createElement("div",a);c.style.display="none";b=alib.dom.createElement("h3",c);b.innerHTML="Declined";this.declinedCon=
c;if(this.field){a=this.mainObject.getMultiValues(this.field);for(c=0;c<a.length;c++)a[c]&&0!=a[c]&&(b={},b.id=a[c],b.obj=new CAntObject("member",a[c]),b.action="save",b.obj.cbProps.cls=this,b.obj.onload=function(){this.cbProps.cls.addAttendee(this.id,this.getValue("name"),this.getValue("role"),this.getValue("f_accepted"))},b.obj.load(a[c]),this.members[this.members.length]=b)}};
AntObjectLoader_FormMem.prototype.submitAddAttendee=function(a){for(var b=a.getValues(),c=0;c<b.length;c++)if(b[c][0]||b[c][1]){var d=b[c][0]?b[c][0]:b[c][1],e={};e.id="new"+this.members.length;e.obj=new CAntObject("member");e.action="save";e.obj.setValue("name",b[c][2]?b[c][2]:d);b[c][0]&&1<b[c][0].split(":").length&&e.obj.setValue("obj_member",b[c][0]);this.members[this.members.length]=e;this.addAttendee(e.id,e.obj.getValue("name"),e.obj.getValue("role"),"");this.newinvitations=!0}a.clear()};
AntObjectLoader_FormMem.prototype.addAttendee=function(a,b,c,d){var e=!1;null==c&&(c="");switch(d){case "t":this.confirmedTable||(this.confirmedTable=new CToolTable("100%"),e=!0);var d=this.confirmedTable,f=this.confirmedCon;break;case "f":this.declinedTable||(this.declinedTable=new CToolTable("100%"),e=!0);d=this.declinedTable;f=this.declinedCon;break;default:this.awaitingTable||(this.awaitingTable=new CToolTable("100%"),e=!0),d=this.awaitingTable,f=this.awaitingCon}e&&(d.addHeader("User/Email"),
d.addHeader("Role/Position"),d.addHeader("Delete","center","50px"),d.print(f),f.style.display="block");e=alib.dom.createElement("input");alib.dom.styleSet(e,"width","96%");e.aid=a;e.value=c;e.cls=this;e.onchange=function(){for(var a=0;a<this.cls.members.length;a++)this.cls.members[a].id==this.aid&&this.cls.members[a].obj.setValue("role",this.value)};c=d.addRow();c.addCell(b,null,null,"30%");c.addCell(e);b=alib.dom.createElement("div");c.addCell(b,!0,"center");b.innerHTML="<img border='0' src='/images/icons/delete_16.png' />";
alib.dom.styleSet(b,"cursor","pointer");b.m_rw=c;b.m_id=a;b.cls=this;b.onclick=function(){ALib.Dlg.confirmBox("Are you sure you want to remove this attendee?","Remove Attendee",[this.m_rw,this.cls]);ALib.Dlg.onConfirmOk=function(b,c){b.deleteRow();for(var d=0;d<c.members.length;d++)c.members[d].id==a&&(c.members[d].obj.id?c.members[d].action="delete":c.members.splice(d,1))}}};
function AntObjectLoader_FormAttachments(){this.data={};this.name="attachments";this.title="Attachments";this.formObj=this.mainObject=null;this.attachedFiles=[];this.loaded=this.attachmentUploading=this.saveParentObject=!1;this.filesCon=this.resultCon=this.uploadCon=this.mainCon=null}AntObjectLoader_FormAttachments.prototype.main=function(a){this.mainCon=a;this.uploadCon=alib.dom.createElement("div",this.mainCon);this.filesCon=alib.dom.createElement("div",this.mainCon);this.buildInterface()};
AntObjectLoader_FormAttachments.prototype.buildInterface=function(){if(!this.loaded){this.uploadCon.innerHTML="";var a=alib.dom.createElement("div",this.uploadCon),b=alib.dom.createElement("div",a);this.resultCon=alib.dom.createElement("div",a);a=new AntFsUpload("%tmp%");a.cbData.cls=this;a.onRemoveUpload=function(a){this.cbData.cls.attachedFiles=[];for(file in this.m_uploadedFiles){var b=this.cls.attachedFiles.length,e=this.m_uploadedFiles[file].id;e!==a&&(this.cbData.cls.attachedFiles[b]=e)}};a.onUploadStarted=
function(){this.cls.attachmentUploading=!0};a.onQueueComplete=function(){this.cbData.cls.attachmentUploading=!1;this.cbData.cls.attachedFiles=[];for(file in this.m_uploadedFiles)this.cbData.cls.attachedFiles[this.cbData.cls.attachedFiles.length]=this.m_uploadedFiles[file].id;this.cbData.cls.formObj.toggleEdit(!0)};a.showTmpUpload(b,this.resultCon,"Add Attachment");this.loaded=!0}this.loadSavedFiles()};
AntObjectLoader_FormAttachments.prototype.save=function(){this.attachmentUploading&&alert("There are still file(s) being uploaded. Only the files that have been finished are saved.");var a=[];a[a.length]=["attachedFiles",this.attachedFiles];a[a.length]=["id",this.mainObject.id];a[a.length]=["typeName",this.mainObject.obj_type];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(){this.cls.attachedFiles=[];this.cls.resultCon.innerHTML="";this.cls.loadSavedFiles()};ajax.exec("/controller/AntFs/saveAttachment",
a);this.onsave()};AntObjectLoader_FormAttachments.prototype.onsave=function(){};AntObjectLoader_FormAttachments.prototype.loadSavedFiles=function(){this.filesCon.innerHTML="<div class='loading'></div>";var a=[];a[a.length]=["id",this.mainObject.id];a[a.length]=["typeName",this.mainObject.obj_type];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){this.cls.filesCon.innerHTML="";a&&(a.error||this.cls.buildFilesRow(a))};ajax.exec("/controller/AntFs/getAttachment",a)};
AntObjectLoader_FormAttachments.prototype.buildFilesRow=function(a){var b=new CToolTable;b.print(this.filesCon);for(file in a){var c=a[file],d=b.addRow(),e=alib.dom.createElement("a");e.href="javascript:void(0);";e.id=c.id;e.onclick=function(){window.open("/antfs/"+this.id)};e.innerHTML=c.name;d.addCell(e);e=alib.dom.createElement("a");e.href="javascript:void(0);";e.cls=this;e.id=c.id;e.name=c.name;e.rw=d;e.onclick=function(){confirm("Are you sure to removed "+this.name+"?")&&this.cls.removeSavedFile(this.rw,
this.id,this.name)};e.innerHTML="<img src='/images/icons/deleteTask.gif' border='0'>";d.addCell(e)}};
AntObjectLoader_FormAttachments.prototype.removeSavedFile=function(a,b,c){var d=[];d[d.length]=["id",b];ajax=new CAjax("json");ajax.cls=this;ajax.name=c;ajax.rw=a;ajax.dlg=showDialog("Deleting "+c+", please wait...");ajax.onload=function(a){a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):(this.dlg.hide(),ALib.statusShowAlert(this.name+" has been deleted!",3E3,"bottom","right"),this.rw.deleteRow()))};ajax.exec("/controller/AntFs/removeAttachment",d)};
function AntObjectLoader_Uname(){this.data={};this.uname=null;this.editMode=!1;this.name="uname";this.title="Uname";this.mainObject=null;this.saveParentObject=!1;this.mainCon=null;this.ajax=new CAjax("json");this.ajax.cbData.cls=this}AntObjectLoader_Uname.prototype.main=function(a){this.mainCon=a;this.mainObject.id&&(this.editMode=!1,this.getUname())};
AntObjectLoader_Uname.prototype.buildInterface=function(){this.mainCon.innerHTML="";var a=alib.dom.createElement("div",this.mainCon);this.data.label=alib.dom.setElementAttr(alib.dom.createElement("span",a),[["innerHTML","URI: "]]);this.data.tooltip=alib.dom.setElementAttr(alib.dom.createElement("img",a),[["src","/images/icons/help_12.png"]]);this.data.input=alib.dom.setElementAttr(alib.dom.createElement("input",a),[["value",this.uname]]);this.data.display=alib.dom.setElementAttr(alib.dom.createElement("span",
a),[["innerHTML",this.uname]]);this.data.status=alib.dom.setElementAttr(alib.dom.createElement("span",a));alib.dom.styleSetClass(this.data.label,"formLabel");alib.dom.styleSetClass(this.data.display,"formValue");alib.dom.styleSet(this.data.status,"margin-left","10px");alib.dom.styleSet(this.data.display,"padding-bottom","0px");alib.dom.styleSet(this.data.input,"width","250px");alib.dom.styleSet(this.data.tooltip,"margin-right","10px");alib.dom.styleSet(this.data.tooltip,"cursor","help");alib.ui.Tooltip(this.data.tooltip,
"Each object has a unique name in addition to the unique id. This name is often used in the API to load objects by human readable names rather than by an id. This will be automatically generated by default but you can also manually edit it here.");this.data.input.cls=this;this.data.input.onchange=function(){this.cls.checkUname(!0)};this.data.input.onkeyup=function(){this.cls.checkUname(!1)};this.onMainObjectToggleEdit()};
AntObjectLoader_Uname.prototype.save=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.onsave();a?(a.error&&(ALib.statusShowAlert(a.error,3E3,"bottom","right"),this.cbData.cls.data.status.innerHTML=""),a.currentName&&(this.cbData.cls.data.input.value=a.currentName,this.cbData.cls.uname=a.currentName)):ALib.statusShowAlert("Error occurred while saving uname!",3E3,"bottom","right")};var a=[];if(this.data.input){a[a.length]=["objId",this.mainObject.id];a[a.length]=
["objType",this.mainObject.obj_type];a[a.length]=["uniqueName",this.data.input.value];a[a.length]=["currentName",this.uname];var b=this.mainObject.getFields(),c;for(c in b)"uname"!=b[c].name&&"id"!=b[c].name&&"fkey_multi"!=b[c].type&&"object_multi"!=b[c].type&&(a[a.length]=[b[c].name,this.mainObject.getValue(b[c].name)]);ajax.exec("/controller/Object/saveUniqueName",a)}else this.onsave()};AntObjectLoader_Uname.prototype.onsave=function(){};
AntObjectLoader_Uname.prototype.getUname=function(){var a=[];a[a.length]=["objId",this.mainObject.id];a[a.length]=["objType",this.mainObject.obj_type];ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):this.cbData.cls.uname=a.uniqueName);this.cbData.cls.buildInterface()};var b=this.mainObject.getFields(),c;for(c in b)"uname"!=b[c].name&&"id"!=b[c].name&&"fkey_multi"!=b[c].type&&"object_multi"!=b[c].type&&(a[a.length]=
[b[c].name,this.mainObject.getValue(b[c].name)]);ajax.exec("/controller/Object/getUniqueName",a)};AntObjectLoader_Uname.prototype.onMainObjectToggleEdit=function(a){this.data&&("undefined"==typeof a&&(a=this.editMode),a?(alib.dom.styleSet(this.data.input,"display","inline-block"),alib.dom.styleSet(this.data.display,"display","none")):(alib.dom.styleSet(this.data.input,"display","none"),alib.dom.styleSet(this.data.display,"display","inline-block")))};
AntObjectLoader_Uname.prototype.checkUname=function(a){this.ajax.abort();this.ajax.onload=function(b){b.error&&ALib.statusShowAlert(b.error,3E3,"bottom","right");a&&-1==b.value?(this.cbData.cls.data.input.value=this.cbData.cls.uname,this.cbData.cls.data.status.innerHTML=""):this.cbData.cls.data.status.innerHTML=b.message};var b=[];b[b.length]=["objId",this.mainObject.id];b[b.length]=["objType",this.mainObject.obj_type];b[b.length]=["uniqueName",this.data.input.value];var c=this.mainObject.getFields(),
d;for(d in c)if("fkey"==c[d].type||"object"==c[d].type)b[b.length]=[c[d].name,this.mainObject.getValue(c[d].name,!0)];this.ajax.exec("/controller/Object/verifyUniqueName",b)};function AntObjectLoader_StatusUpdate(){this.data={};this.name="status_update";this.title="Status Update";this.con=this.formObj=this.mainObject=null}AntObjectLoader_StatusUpdate.prototype.main=function(a){this.con=a;this.mainObject.id?this.buildInterface():a.innerHTML=""};
AntObjectLoader_StatusUpdate.prototype.objectsaved=function(){this.mainObject.id&&this.buildInterface()};AntObjectLoader_StatusUpdate.prototype.buildInterface=function(){this.con.innerHTML="";alib.dom.createElement("h4",this.con).innerHTML="Add status update for this "+this.mainObject.title.toLowerCase()+":";this.buildCommentForm(alib.dom.createElement("div",this.con))};AntObjectLoader_StatusUpdate.prototype.save=function(){this.onsave()};AntObjectLoader_StatusUpdate.prototype.onsave=function(){};
AntObjectLoader_StatusUpdate.prototype.buildCommentForm=function(a){a.innerHTML="";var b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","48px");b.innerHTML="<img src='/files/userimages/current/48/48' style='width:48px;' />";b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"margin-bottom","5px");alib.dom.styleSet(b,"margin-left","51px");b=alib.dom.createElement("textarea",b);alib.dom.styleSet(b,"width","100%");alib.dom.styleSet(b,"height","25px");
alib.dom.textAreaAutoResizeHeight(b,48);var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"clear","both");c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"float","left");alib.dom.styleSet(c,"width","48px");alib.dom.styleSet(c,"padding-top","5px");c.innerHTML="Notify:";c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin-left","51px");alib.dom.styleSet(c,"margin-bottom","5px");c=alib.dom.createElement("input",c);c=new CTextBoxList(c,{bitsOptions:{editable:{addKeys:[188,13,186,
59],addOnBlur:!0}},plugins:{autocomplete:{placeholder:!1,minLength:2,queryRemote:!0,remote:{url:"/users/json_autocomplete.php"}}}});this.findNotifyCandidates(c);b=alib.ui.Button("Update Status",{className:"b1 nomargin",tooltip:"Click to save and send your status update",cls:this,textarea:b,notify:c,onclick:function(){alib.dom.styleAddClass(this,"working");this.cls.saveStatusUpdate(this.textarea,this.notify,this)}});a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"text-align","right");b.print(a)};
AntObjectLoader_StatusUpdate.prototype.saveStatusUpdate=function(a,b,c){if(0!=a.value.length){var d=new CAntObject("status_update");d.setValue("comment",a.value);d.setValue("obj_reference",this.mainObject.obj_type+":"+this.mainObject.id);d.setMultiValue("associations",this.mainObject.obj_type+":"+this.mainObject.id);for(var e="",f=b.getValues(),g=0;g<f.length;g++)e&&(e+=","),f[g][0]?e+=f[g][0]:f[g][1]&&(e+=f[g][1]);e&&d.setValue("notify",e);d.setValue("owner_id","-3");d.cbData.textarea=a;d.cbData.t_notify=
b;d.cbData.plCls=this;d.cbData.btn=c;d.onsave=function(){this.cbData.textarea.value="";this.cbData.t_notify.clear();this.cbData.plCls.refreshBrowsers();alib.dom.styleRemoveClass(this.cbData.btn,"working")};d.save()}};AntObjectLoader_StatusUpdate.prototype.refreshBrowsers=function(){if(this.formObj)for(var a in this.formObj.objectBrowsers){var b=this.formObj.objectBrowsers[a];"activity"==b.obj_type&&b.refresh()}};AntObjectLoader_StatusUpdate.prototype.findNotifyCandidates=function(){};
function AntObjectLoader_Reminders(){this.name="reminders";this.title="Reminders";this.remindersTableBody=this.mainCon=this.mainObject=null;this.reminders=[];this.addDefault=!1;this.fieldName=""}
AntObjectLoader_Reminders.prototype.main=function(a){this.mainCon=a;this.mainObject.id?(a=new AntObjectList("reminder"),a.addCondition("and","obj_reference","is_equal",this.mainObject.obj_type+":"+this.mainObject.id),a.cbData.cls=this,a.onLoad=function(){for(var a=0;a<this.getNumObjects();a++)this.cbData.cls.addReminder(this.getObject(a));this.cbData.cls.buildInterface()},a.getObjects()):this.buildInterface()};
AntObjectLoader_Reminders.prototype.save=function(){var a=[],b;for(b in this.reminders)this.reminders[b].dirty&&(this.reminders[b].setValue("obj_reference",this.mainObject.obj_type+":"+this.mainObject.id),this.reminders[b].setValue("field_name",this.fieldName),a[a.length]=this.reminders[b]);if(a.length)a[0].cbData.cls=this,a[0].onsave=function(){this.cbData.cls.save()},a[0].save();else this.onsave()};AntObjectLoader_Reminders.prototype.onsave=function(){};
AntObjectLoader_Reminders.prototype.buildInterface=function(){if(this.addDefault&&0==this.reminders.length&&!this.mainObject.id){var a=new CAntObject("reminder");a.setValue("action_type","sms");a.setValue("interval","30");a.setValue("interval_unit","minutes");this.addReminder(a);a=new CAntObject("reminder");a.setValue("action_type","popup");a.setValue("interval","30");a.setValue("interval_unit","minutes");this.addReminder(a)}a=alib.dom.createElement("div",this.mainCon);a=alib.dom.createElement("a",
a);a.href="javascript:void(0);";a.cls=this;a.onclick=function(){this.cls.addReminder()};a.innerHTML="Add Reminder"};AntObjectLoader_Reminders.prototype.addReminder=function(a){"undefined"==typeof a&&(a=new CAntObject("reminder"),a.setValue("action_type","email"),a.setValue("interval","30"),a.setValue("interval_unit","minutes"));this.fieldName&&this.renderRowWithField(a);this.reminders[this.reminders.length]=a};
AntObjectLoader_Reminders.prototype.removeReminder=function(a){a.cbData.row.parentNode.removeChild(a.cbData.row);a.id&&a.remove();for(var b in this.reminders)this.reminders[b]==a&&this.reminders.splice(b,1)};
AntObjectLoader_Reminders.prototype.renderRowWithField=function(a){var b=this.getTable(),b=alib.dom.createElement("tr",b);a.cbData.row=b;var c=alib.dom.createElement("td",b),c=alib.dom.createElement("select",c);c[c.length]=new Option("Send Email","email",!1,"email"==a.getValue("action_type")?!0:!1);c[c.length]=new Option("Send Text Message (SMS)","sms",!1,"sms"==a.getValue("action_type")?!0:!1);c[c.length]=new Option("Pop-up Alert","popup",!1,"popup"==a.getValue("action_type")?!0:!1);c.obj=a;c.onchange=
function(){this.obj.setValue("action_type",this.value)};c=alib.dom.createElement("td",b);c=alib.dom.createElement("input",c);c.size=2;c.value=a.getValue("interval");c.obj=a;c.onchange=function(){isNaN(this.value)&&(this.value=30);this.obj.setValue("interval",this.value)};c=alib.dom.createElement("td",b);c=alib.dom.createElement("select",c);c[c.length]=new Option("minute(s)","minutes",!1,"minutes"==a.getValue("interval_unit")?!0:!1);c[c.length]=new Option("hour(s)","hours",!1,"hours"==a.getValue("interval_unit")?
!0:!1);c[c.length]=new Option("day(s)","days",!1,"days"==a.getValue("interval_unit")?!0:!1);c[c.length]=new Option("week(s)","weeks",!1,"weeks"==a.getValue("interval_unit")?!0:!1);c[c.length]=new Option("month(s)","months",!1,"months"==a.getValue("interval_unit")?!0:!1);c[c.length]=new Option("year(s)","years",!1,"years"==a.getValue("interval_unit")?!0:!1);c.obj=a;c.onchange=function(){this.obj.setValue("interval_unit",this.value)};c=alib.dom.createElement("td",b);b=alib.dom.createElement("img",c);
alib.dom.styleSet(b,"cursor","pointer");b.src="/images/icons/delete_16.png";b.obj=a;b.cls=this;b.onclick=function(){this.cls.removeReminder(this.obj)}};AntObjectLoader_Reminders.prototype.getTable=function(){if(this.remindersTableBody)return this.remindersTableBody;var a=alib.dom.createElement("table",this.mainCon);return this.remindersTableBody=alib.dom.createElement("tbody",a)};
function AntObjectLoader_EmailThread(a,b){this.mainObject=a;this.loaderCls=b;this.oid=a.id;this.bodyGroupCon=this.bodyFormCon=this.toolbar=this.customTitleCon=this.ctbl=this.formCon=null;this.plugins=[];this.fEnableClose=this.printOuterTable=!0}AntObjectLoader_EmailThread.prototype.refresh=function(){};AntObjectLoader_EmailThread.prototype.toggleEdit=function(){};
AntObjectLoader_EmailThread.prototype.print=function(a){a.innerHTML="";this.isPopup=this.loaderCls.isPopup?!0:!1;this.formCon=a;this.loaderCls.inline&&(this.customTitleCon=alib.dom.createElement("div",this.formCon),this.customTitleCon.className="objectLoaderHeader",this.onNameChange=function(a){this.loaderCls.antView&&this.loaderCls.antView.setTitle(a);this.customTitleCon.innerHTML=a});this.bodyGroupCon=alib.dom.createElement("div",this.formCon);this.bodyFormCon=alib.dom.createElement("div",this.formCon);
this.buildInterface()};AntObjectLoader_EmailThread.prototype.onValueChange=function(){};AntObjectLoader_EmailThread.prototype.onNameChange=function(){};
AntObjectLoader_EmailThread.prototype.buildInterface=function(){var a=new CToolbar;this.toolbar=a;var b=new CButton("Close",function(a){a.close()},[this.loaderCls],"b1");this.loaderCls.fEnableClose&&!this.loaderCls.isMobile&&a.AddItem(b.getButton(),"left");if(this.mainObject.security.edit){b=alib.dom.createElement("div");a.AddItem(b);var c=new AntObjectGroupingSel("Move","email_thread","mailbox_id",null,this.mainObject,{noNull:!0,staticLabel:!0});c.print(b,"b1 grLeft");c.fwdEmailThView=this;c.onSelect=
function(a,b){this.fwdEmailThView.moveThread(a,b,!1)};b=alib.dom.createElement("div");a.AddItem(b);c=new AntObjectGroupingSel("Add Group","email_thread","mailbox_id",null,this.mainObject,{noNull:!0,staticLabel:!0});c.print(b,"b1 grRight");c.fwdEmailThView=this;c.onSelect=function(a,b){this.fwdEmailThView.moveThread(a,b,!0)};b=new CButton("Print",function(a){window.open("/print/engine.php?obj_type=email_thread&objects[]="+a.oid)},[this],"b1");a.AddItem(b.getButton(),"left");this.isPopup||(b=new CButton("New Window",
function(a){window.open("/obj/email_thread/"+a.oid,null,"width=1024,height=768,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes")},[this],"b1"),a.AddItem(b.getButton(),"right"))}this.oid&&this.mainObject.security.del&&(b=new CButton("Delete",function(a,b){a.deleteObject(b)},[this.loaderCls,this.oid],"b1"),a.AddItem(b.getButton(),"left"));a.print(this.loaderCls.toolbarCon);this.onNameChange(this.mainObject.getLabel());this.getMessages(this.bodyFormCon);this.getGroups()};
AntObjectLoader_EmailThread.prototype.getMessages=function(a){a.innerHTML="Loading...";ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=a;ajax.onload=function(a){this.cbData.con.innerHTML="";if(a)try{if(a.length)for(message in a){var c=a[message],d=new AntObjectLoader("email_message",c.id);d.fEnableClose=!1;d.fThreadView=!0;d.inline=!0;d.printOuterTable=!1;"t"==c.flag_seen&&message<a.length-1?d.printCollapsed(this.cbData.con,!1,c):d.print(this.cbData.con)}else this.cbData.con.innerHTML=
"None available"}catch(e){alert(e)}};ajax.exec("/controller/Email/threadGetMessages",[["tid",this.oid]])};
AntObjectLoader_EmailThread.prototype.getGroups=function(){alib.dom.styleSet(this.bodyGroupCon,"margin","3px 0 5px 5px");ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=this.bodyGroupCon;ajax.onload=function(a){if(a)try{if(this.cbData.con.innerHTML="",a.length){for(group in a){var b=a[group];if(b.color)var c=b.color,d=getColorTextForGroup(b.color);else"t"==b.flag_special?(c="e3e3e3",d="000000"):(c=G_GROUP_COLORS[0][1],d=getColorTextForGroup(c));var e=alib.dom.createElement("div");alib.dom.styleSet(e,
"display","inline-block");alib.dom.styleSet(e,"zoom","1");alib.dom.styleSet(e,"*display","inline");alib.dom.styleSet(e,"padding","1px 3px 1px 3px");alib.dom.styleSet(e,"margin-right","5px");alib.dom.styleSet(e,"background-color","#"+c);alib.dom.styleSet(e,"color","#"+d);alib.dom.styleSet(e,"border-radius","3px");alib.dom.styleSet(e,"-webkit-border-radius","3px");alib.dom.styleSet(e,"-moz-border-radius","3px");alib.dom.createElement("span",e).innerHTML=b.name+" | ";var f=alib.dom.createElement("span",
e);f.innerHTML="x";alib.dom.styleSet(f,"cursor","pointer");f.pdiv=this.cbData.con;f.box=e;f.cls=this.cbData.cls;f.gid=b.id;f.gname=b.name;f.onclick=function(){this.cls.removeMailbox(this.gid,this.gname,this.box)};this.cbData.con.appendChild(e)}e=alib.dom.createElement("div",this.cbData.con)}}catch(g){alert(g)}};ajax.exec("/controller/Email/threadGetGroups",[["tid",this.oid]])};
AntObjectLoader_EmailThread.prototype.moveThread=function(a,b,c){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.name=b;ajax.cbData.addMailBox=c;ajax.onload=function(a){a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):this.cbData.addMailBox?ALib.statusShowAlert("This message is added to "+this.cbData.name,3E3,"bottom","right"):ALib.statusShowAlert("This message is moved to "+this.cbData.name,3E3,"bottom","right"),this.cbData.cls.getGroups())};b=[];b[b.length]=["obj_type","email_thread"];
b[b.length]=["field_name","mailbox_id"];b[b.length]=["move_to",a];b[b.length]=["objects[]",this.oid];c&&(b[b.length]=["addMailbox",1]);ajax.exec("/controller/Object/moveByGrouping",b)};
AntObjectLoader_EmailThread.prototype.removeMailbox=function(a,b,c){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.name=b;ajax.cbData.groupDiv=c;ajax.onload=function(a){a&&(a.error?ALib.statusShowAlert(a.error,3E3,"bottom","right"):(this.cbData.groupDiv.parentNode.removeChild(this.cbData.groupDiv),ALib.statusShowAlert(this.cbData.name+" is removed to this message.",3E3,"bottom","right")))};b=[];b[b.length]=["gid",a];b[b.length]=["tid",this.oid];ajax.exec("/controller/Email/threadDeleteGroup",
b)};function AntObjectLoader_EmailMessage(a,b){if(!a.id||!0==a.getValue("flag_draft"))return new AntObjectLoader_EmailMessageCmp(a,b);this.mainObject=a;this.oid=this.mainObject.id;this.loaderCls=b;this.bodyNoticeCon=this.bodyFormCon=this.bodyCon=this.toolbarCon=this.toolbar=this.ctbl=this.formPopupCon=this.formCon=this.mainCon=this.mainConMin=this.messageBodyCon=this.outerCon=null;this.plugins=[];this.printOuterTable=!0;this.emailHeaderData=null}AntObjectLoader_EmailMessage.prototype.refresh=function(){};
AntObjectLoader_EmailMessage.prototype.toggleEdit=function(){};
AntObjectLoader_EmailMessage.prototype.print=function(a){this.loaderCls.fThreadView&&(this.mainConMin=alib.dom.createElement("div",a),alib.dom.styleSet(this.mainConMin,"display","none"),alib.dom.styleAddClass(this.mainConMin,"emailThreadMessageCol"));this.isPopup=this.loaderCls.isPopup?!0:!1;this.outerCon=a;this.formCon=this.mainCon=alib.dom.createElement("div",a);this.loaderCls.fThreadView&&alib.dom.styleAddClass(this.mainCon,"emailThreadMessageExp");this.toolbarCon=alib.dom.createElement("div",
this.formCon);this.isPopup&&alib.dom.styleSetClass(this.toolbarCon,"popup_toolbar");a=alib.dom.createElement("div",this.formCon);this.isPopup&&a.setAttribute("id","bdy_outer");this.bodyCon=alib.dom.createElement("div",a);this.isPopup?(this.bodyCon.setAttribute("id","bdy"),alib.dom.styleSetClass(this.bodyCon,"popup_body")):alib.dom.styleSet(this.bodyCon,"margin-top","5px");this.bodyNoticeCon=alib.dom.createElement("div",this.bodyCon);this.bodyFormCon=alib.dom.createElement("div",this.bodyCon);this.formPopupCon=
alib.dom.createElement("div",this.bodyCon);this.buildInterface()};AntObjectLoader_EmailMessage.prototype.printCollapsed=function(a,b,c){c&&(this.emailHeaderData=c);a=alib.dom.createElement("div",a);c=alib.dom.createElement("div",a);alib.dom.styleAddClass(c,"emailThreadMessageCol");c.emvCls=this;c.con=a;c.popup=b;c.onclick=function(){this.con.innerHTML="";this.emvCls.print(this.con)};c.innerHTML=this.emailHeaderCollapse()};AntObjectLoader_EmailMessage.prototype.onValueChange=function(){};
AntObjectLoader_EmailMessage.prototype.onNameChange=function(){};
AntObjectLoader_EmailMessage.prototype.emailHeaderCollapse=function(){var a="";this.emailHeaderData?(a="<div style='float:right;'>"+this.emailHeaderData.message_date+"</div>",a=a+"<img src='/images/icons/email-add_16.png' /> "+this.emailHeaderData.from,a=a+" - "+this.emailHeaderData.subject):(a="<div style='float:right;'>"+this.mainObject.getValue("message_date")+"</div>",a=a+"<img src='/images/icons/email-add_16.png' /> "+this.mainObject.getValue("sent_from"),a=a+" - "+this.mainObject.getValue("subject"));
return a};AntObjectLoader_EmailMessage.prototype.emailHeaderExpand=function(){var a="";this.emailHeaderData?(a="<div style='float:right;'>"+this.emailHeaderData.message_date+"</div>",a+=this.emailHeaderData.from,a=a+" - "+this.emailHeaderData.subject):(a="<div style='float:right;'>"+this.mainObject.getValue("message_date")+"</div>",a+=this.mainObject.getValue("sent_from"),a=a+" - "+this.mainObject.getValue("subject"));return a};
AntObjectLoader_EmailMessage.prototype.buildInterface=function(){if(this.loaderCls.fThreadView){this.mainConMin.emvCls=this;this.mainConMin.onclick=function(){this.emvCls.expandView()};this.mainConMin.innerHTML=this.emailHeaderCollapse();var a=alib.dom.createElement("table",this.toolbarCon),b=alib.dom.createElement("tbody",a);alib.dom.styleSet(a,"width","100%");alib.dom.styleSet(a,"table-layout","fixed");var c=alib.dom.createElement("tr",b),a=alib.dom.createElement("td",c);alib.dom.styleSet(a,"width",
"50px");a.rowSpan=2;a.innerHTML="<img src='/images/icons/mail_48_short.png' />";this.getImage(a);a=alib.dom.createElement("td",c);alib.dom.styleSet(a,"width","100%");var d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"cursor","pointer");d.appCls=this;d.onclick=function(){this.appCls.collapseView()};d.innerHTML=this.emailHeaderExpand();d=alib.dom.createElement("div",a);alib.dom.styleSet(d,"display","none");var e=this.mainObject.getValueName("mailbox_id");d.innerHTML="<table><tr><td>from:</td><td>"+
this.mainObject.getValue("sent_from").escapeHTML()+"</td></tr><tr><td>to:</td><td>"+this.mainObject.getValue("send_to").escapeHTML()+"</td></tr><tr><td>group:</td><td>"+e+"</td></tr><tr><td>more:</td><td><a href='/email/message_view_original.awp?mid="+this.oid+"' target='_blank'>original message</a></td></tr></table>";c=alib.dom.createElement("tr",b);a=alib.dom.createElement("td",c);"Drafts"==e?b=new CButton("Edit",function(a){emailComposeOpen(null,[["mid",a.oid],["reply_type","draft"]])},[this],
"b2 small"):(a.colSpan=2,b=new CButton("Reply",function(a){emailComposeOpen(null,[["reply_mid",a.oid],["reply_type","reply"]])},[this],"b2 small grLeft"),b.print(a),b=new CButton("Reply All",function(a){emailComposeOpen(null,[["reply_mid",a.oid],["reply_type","reply_all"]])},[this],"b1 small grCenter"),b.print(a),b=new CButton("Forward",function(a){emailComposeOpen(null,[["reply_mid",a.oid],["reply_type","forward"]])},[this],"b1 small grRight"));b.print(a);c=new CDropdownMenu;b=c.addSubmenu("Create New",
null,null,null);b.addEntry("Calendar Event",function(a){a.createObject("calendar_event")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Task",function(a){a.createObject("task")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Case",function(a){a.createObject("case")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Personal Contact",function(a){a.createObject("contact_personal")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Customer",function(a){a.createObject("customer")},
"/images/icons/circle_blue.png",null,[this]);b.addEntry("Lead",function(a){a.createObject("lead")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Note",function(a){a.createObject("note")},"/images/icons/circle_blue.png",null,[this]);b=c.addSubmenu("Associate With",null,null,null);b.addEntry("Customer",function(a){emailAssocObj(a.oid,"customer")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Opportunity",function(a){emailAssocObj(a.oid,"opportunity")},"/images/icons/circle_blue.png",
null,[this]);b.addEntry("Lead",function(a){emailAssocObj(a.oid,"lead")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Project",function(a){emailAssocObj(a.oid,"project")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Task",function(a){emailAssocObj(a.oid,"task")},"/images/icons/circle_blue.png",null,[this]);b.addEntry("Case",function(a){emailAssocObj(a.oid,"case")},"/images/icons/circle_blue.png",null,[this]);a.appendChild(c.createButtonMenu("Actions",null,null,"b1 small"));
b=new CButton("Print",function(a){window.open("/print/engine.php?obj_type=email_message&&format=html&objects[]="+a.oid)},[this],"b1 small");b.print(a);b=new CButton("More Info",function(a,b){b.style.display="block"==b.style.display?"none":"block"},[this,d],"b1 small");b.print(a)}else this.isPopup?document.title="View Message":this.ctbl&&this.ctbl.setTitle("View Message"),this.toolbar=a=new CToolbar,b=new CButton("Close",function(a){a.close()},[this.loaderCls],"b1"),this.loaderCls.fEnableClose&&!this.loaderCls.isMobile&&
a.AddItem(b.getButton(),"left"),this.mainObject.security.edit&&(b=new CButton("Reply",function(a){emailComposeOpen(null,[["reply_mid",a.oid],["reply_type","reply"]])},[this],"b2"),a.AddItem(b.getButton(),"left"),b=new CButton("Reply All",function(a){emailComposeOpen(null,[["reply_mid",a.oid],["reply_type","reply_all"]])},[this],"b1"),a.AddItem(b.getButton(),"left"),b=new CButton("Forward",function(a){emailComposeOpen(null,[["reply_mid",a.oid],["reply_type","forward"]])},[this],"b1"),a.AddItem(b.getButton(),
"left"),b=new CButton("Print",function(){window.print()},[this],"b1"),a.AddItem(b.getButton(),"left"),b=new CDropdownMenu,b.addEntry("Calendar Event",function(a){a.createObject("calendar_event")},"/images/icons/circle_blue.png",null,[this]),b.addEntry("Task",function(a){a.createObject("task")},"/images/icons/circle_blue.png",null,[this]),b.addEntry("Case",function(a){a.createObject("case")},"/images/icons/circle_blue.png",null,[this]),b.addEntry("Personal Contact",function(a){a.createObject("contact_personal")},
"/images/icons/circle_blue.png",null,[this]),b.addEntry("Customer",function(a){a.createObject("customer")},"/images/icons/circle_blue.png",null,[this]),b.addEntry("Lead",function(a){a.createObject("lead")},"/images/icons/circle_blue.png",null,[this]),b.addEntry("Note",function(a){a.createObject("note")},"/images/icons/circle_blue.png",null,[this]),a.AddItem(b.createButtonMenu("Create New")),b=new CDropdownMenu,b.addEntry("Customer",function(a){emailAssocCustomer(a.oid)},"/images/icons/circle_blue.png",
null,[this]),a.AddItem(b.createButtonMenu("Associate With"))),this.oid&&this.mainObject.security.del&&(b=new CButton("Delete",function(a,b){a.deleteObject(b)},[this,this.oid],"b3"),a.AddItem(b.getButton(),"left")),a.print(this.loaderCls.toolbarCon),this.onNameChange(this.mainObject.getLabel()),this.loaderCls.antView&&this.loaderCls.antView.setTitle(this.mainObject.getLabel()),d=alib.dom.createElement("div",this.toolbarCon),d.innerHTML="<table><tr><td>From:</td><td>"+this.mainObject.getValue("sent_from").escapeHTML()+
"</td></tr><tr><td>To:</td><td>"+this.mainObject.getValue("send_to").escapeHTML()+"</td></tr><tr><td>Group:</td><td>"+this.mainObject.getValueName("mailbox_id")+"</td></tr><tr><td>More:</td><td>\t<a href='/email/message_view_original.awp?mid="+this.oid+"' target='_blank'>original message</a></td></tr></table>";this.bodyFormCon.innerHTML="";a=alib.dom.createElement("div",this.bodyFormCon);alib.dom.styleSet(a,"margin-left","5px");this.getAssociations(a);this.messageBodyCon=alib.dom.createElement("div",
this.bodyFormCon);alib.dom.styleAddClass(this.messageBodyCon,"emailMessageBody");alib.dom.styleAddClass(this.messageBodyCon,"formHtmlBody");this.getMessageBody()};AntObjectLoader_EmailMessage.prototype.collapseView=function(){this.mainCon.style.display="none";this.mainConMin.style.display="block"};AntObjectLoader_EmailMessage.prototype.expandView=function(){this.mainCon.style.display="block";this.mainConMin.style.display="none"};
AntObjectLoader_EmailMessage.prototype.createObject=function(a){var b=new CAjax("json");b.cbData.cls=this;b.cbData.dlg=showDialog("please wait...");b.cbData.objectType=a;b.onload=function(a){this.cbData.dlg.hide();if(a){if(a.error)ALib.statusShowAlert(a.error,3E3,"bottom","right");else switch(this.cbData.objectType){case "case":c[c.length]=["title",a.subject];c[c.length]=["description",a.body_txt];c[c.length]=["customer_id",a.customer_id];break;case "note":c[c.length]=["name",a.subject];c[c.length]=
["body",a.body_txt];break;case "calendar_event":case "task":c[c.length]=["name",a.subject],c[c.length]=["obj_reference","email_message:"+this.cbData.cls.oid];default:c[c.length]=["notes",a.body_txt],c[c.length]=["first_name",a.first_name],c[c.length]=["last_name",a.last_name],c[c.length]=["email",a.email]}this.cbData.cls.popupForm(this.cbData.objectType,c)}};var c=[];c[c.length]=["mid",this.oid];b.exec("/controller/Email/getConvFields",c)};
AntObjectLoader_EmailMessage.prototype.getAssociations=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=a;ajax.onload=function(a){if(a)try{var c="";a.length&&(c+="Associations: ");for(association in a)var d=a[association],e=d.obj_ref.split(":"),c=c+("<a href='javascript:void(0);' title='Click to open "+unescape(d.label)+"' onclick=\"loadObjectForm('"+e[0]+"', '"+e[1]+'\');";">'+d.label+"</a> ");this.cbData.con.innerHTML=c}catch(f){}};ajax.exec("/controller/Email/getAssociations",
[["mid",this.oid]])};AntObjectLoader_EmailMessage.prototype.getImage=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=a;ajax.onload=function(a){!a.error&&"-1"!=a&&(this.cbData.con.innerHTML="<img src='/files/images/"+a+"/48/48' />")};ajax.exec("/controller/Email/getEmailUserImage",[["email",this.mainObject.getValue("sent_from")]])};
AntObjectLoader_EmailMessage.prototype.getMessageBody=function(){this.messageBodyCon.innerHTML="loading...";var a=new alib.net.Xhr;alib.events.listen(a,"load",function(a){var c=this.getResponse();a.data.msgcls.messageBodyCon.innerHTML="";if(c.body||"object"==typeof c.body){if(alib.dom.createElement("div",a.data.msgcls.messageBodyCon).innerHTML="object"==typeof c.body?c.cleanBody:c.body,c.attachments.length){a=alib.dom.createElement("div",a.data.msgcls.messageBodyCon);a.innerHTML="<br /><br />";for(var a=
alib.dom.createElement("table",a),a=alib.dom.createElement("tbody",a),d=0;d<c.attachments.length;d++){var e=alib.dom.createElement("tr",a),f=alib.dom.createElement("td",e);f.innerHTML=c.attachments[d].preview;f=alib.dom.createElement("td",e);f.innerHTML=c.attachments[d].name+" ("+c.attachments[d].size+") ";f=alib.dom.createElement("td",e);c.attachments[d].link_view&&(e=alib.dom.createElement("a",f),e.target="_blank",e.href=c.attachments[d].link_view,e.innerHTML="view",alib.dom.createElement("span",
f,"&nbsp;&nbsp;"));c.attachments[d].link_download&&(e=alib.dom.createElement("a",f),e.target="_blank",e.href=c.attachments[d].link_download,e.innerHTML="download")}}}else a.data.msgcls.messageBodyCon.innerHTML="object"==typeof c?"":c},{msgcls:this});alib.events.listen(a,"error",function(a){a.data.msgcls.messageBodyCon.innerHTML="There was a problem loading this message."});a.send("/controller/Email/getMessageBody?mid="+this.oid)};
AntObjectLoader_EmailMessage.prototype.popupForm=function(a,b){this.formPopupCon.innerHTML="";var c="/obj/"+a,d=a+"New",e=alib.dom.createElement("div",this.formPopupCon);alib.dom.styleSet(e,"display","none");alib.dom.styleSet(e,"position","absolute");e=alib.dom.createElement("form",e);e.setAttribute("method","post");e.setAttribute("target",d);e.setAttribute("action",c);if(b)for(param in b){var f=b[param],f=[["type","hidden"],["name",f[0]],["value",f[1]]];alib.dom.setElementAttr(alib.dom.createElement("input",
e),f)}window.open(c,d,"width=950,height=750,toolbar=no,scrollbars=yes");try{e.submit()}catch(g){alert("You must allow popups for this map to work.")}};
function AntObjectLoader_EmailMessageCmp(a,b){this.mainObject=a;this.loaderCls=b;this.toolbar=this.ctbl=this.infoCon=this.formCon=this.mainConMin=null;this.plugins=[];this.printOuterTable=!0;this.headerHeight=90;this.emailArgs=[];this.emailFormData={};this.attachmentUploading=!1;this.attachedFiles=[];this.emailAttachments=[];this.emailAccounts={};this.emailAddress={};this.messageDetails=[];this.sendTo=this.inReplyTo=this.messageId=this.userId=null;this.mid=this.mainObject.id;this.rteBody=this.replyMid=
this.replyType=this.fid=this.tid=null}AntObjectLoader_EmailMessageCmp.prototype.refresh=function(){};AntObjectLoader_EmailMessageCmp.prototype.toggleEdit=function(){};
AntObjectLoader_EmailMessageCmp.prototype.print=function(a){this.isPopup=this.loaderCls.isPopup?!0:!1;this.formCon=a;this.replyMid=this.emailArgs.replyMid?this.emailArgs.replyMid:null;this.replyType=this.emailArgs.replyType?this.emailArgs.replyType:null;this.mid=this.emailArgs.mid?this.emailArgs.mid:null;this.fid=this.mainObject.getValue("fid")?this.mainObject.getValue("fid"):this.emailArgs.fid?this.emailArgs.fid:null;a=[];a[a.length]=["reply_mid",this.replyMid];a[a.length]=["reply_type",this.replyType];
a[a.length]=["mid",this.mid];a[a.length]=["fid",this.fid];a[a.length]=["objects",this.emailArgs.objects];a[a.length]=["all_selected",this.emailArgs.allSelected];a[a.length]=["obj_type",this.emailArgs.objType];a[a.length]=["send_method",this.emailArgs.sendMethod];a[a.length]=["using",this.emailArgs.using];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a&&(this.cls.userId=a.userId,this.cls.messageId=a.messageId,this.cls.messageDetails=a.messageDetails,this.cls.emailAccounts=a.emailAccounts,
this.cls.emailAddress=a.emailAddress,this.cls.inReplyTo=this.cls.messageDetails.in_reply_to,this.cls.sendTo=this.cls.messageDetails.send_to,this.cls.tid=this.cls.messageDetails.tid);!this.cls.messageDetails.cmp_to&&this.cls.mainObject.getValue("send_to")&&(this.cls.messageDetails.cmp_to=this.cls.mainObject.getValue("send_to"));!this.cls.messageDetails.subject&&this.cls.mainObject.getValue("subject")&&(this.cls.messageDetails.subject=this.cls.mainObject.getValue("subject"));!this.cls.messageDetails.body&&
this.cls.mainObject.getValue("body")&&(this.cls.messageDetails.body=this.cls.mainObject.getValue("body"));this.cls.buildInterface()};ajax.exec("/controller/Email/getEmailDetails",a)};AntObjectLoader_EmailMessageCmp.prototype.onValueChange=function(){};AntObjectLoader_EmailMessageCmp.prototype.onNameChange=function(){};
AntObjectLoader_EmailMessageCmp.prototype.buildInterface=function(){this.loaderCls.setTitle("Compose Email Message");var a=new CToolbar;this.toolbar=a;if(this.mainObject.security.edit){var b="Save Draft";if(this.fid)b="Save Template";else{var c=new CButton("Send",function(a){a.sendEmail()},[this],"b2");a.AddItem(c.getButton(),"left")}c=new CButton(b,function(a){a.saveEmail()},[this],"b1");a.AddItem(c.getButton(),"left")}c=new CButton("Add CC",function(a){alib.dom.styleSet(a.emailFormData.txtCc.parentNode.parentNode,
"display","table-row");a.resize()},[this],"b1");a.AddItem(c.getButton(),"left");c=new CButton("Add BCC",function(a){alib.dom.styleSet(a.emailFormData.txtBcc.parentNode.parentNode,"display","table-row");a.resize()},[this],"b1");a.AddItem(c.getButton(),"left");c=new CButton("Discard",function(a){a.close()},[this.loaderCls],"b3");this.loaderCls.fEnableClose&&!this.loaderCls.isMobile&&a.AddItem(c.getButton(),"left");c=alib.ui.Button("Use Template",{className:"b1",cls:this,onclick:function(){var a=new AntObjectBrowser("html_template");
a.cbData.clsRef=this.cls;a.onSelect=function(a){a=new CAntObject("html_template",a);a.cbData.clsRef=this.cbData.clsRef;a.onload=function(){this.cbData.clsRef.rteBody.setValue(this.getValue("body_html"))};a.load()};a.displaySelect()}});a.AddItem(c.getButton(),"left");this.mid&&this.mainObject.security.del&&(c=new CButton("Delete",function(a,b){a.deleteObject(b)},[this,this.mid],"b1"),a.AddItem(c.getButton(),"left"));a.print(this.loaderCls.toolbarCon);this.onNameChange(this.mainObject.getLabel());this.loaderCls.antView&&
this.loaderCls.antView.setTitle(this.mainObject.getLabel());this.infoCon=alib.dom.createElement("div",this.formCon);this.infoCon.id="infoCon";this.emailHeaderCon=alib.dom.createElement("div",this.infoCon);this.emailHeaderCon.id="emailHeaderCon";this.emailCon=alib.dom.createElement("div",this.emailHeaderCon);this.emailCon.id="emailCon";a="";if(1<this.emailAccounts[0].num){this.emailFormData.txtFrom=createInputAttribute(alib.dom.createElement("select"),null,"use_account","From","600px");for(account in this.emailAccounts){var b=
this.emailAccounts[account],d=c=!1;0>=b.id||(d||(this.sendTo?(0<=this.sendTo.indexOf(b.email_address)&&(c=!0),d=!0):b.f_default&&(c=!0)),c&&(a=b.signature),this.emailFormData.txtFrom[this.emailFormData.txtFrom.length]=new Option(b.name+" ("+b.email_address+")",b.id,!1,c))}this.emailFormData.txtFrom.cls=this;this.emailFormData.txtFrom.onchange=function(){var a=this.cls.emailAccounts[this.value],b=document.getElementById("CRteIframe");(b.contentDocument||b.contentWindow.document).getElementById("accountSignature").innerHTML=
a.signature}}else for(account in this.emailAccounts){b=this.emailAccounts[account];this.emailFormData.txtFrom=createInputAttribute(alib.dom.createElement("input"),"hidden","use_account",null,"600px",b.id);a=b.signature;break}b=b=this.messageDetails.cmp_cc;c=c=this.messageDetails.cmp_bcc;if(1==this.emailArgs.sendMethod)this.emailFormData.txtTo=createInputAttribute(alib.dom.createElement("label"),null,null,"To"),this.emailFormData.txtTo.inputLabel="Bulk email will be sent to multiple recipients";else switch(d=
"",this.messageDetails.cmp_to&&(d=this.messageDetails.cmp_to),this.emailArgs.sendTo&&!d&&(d=this.emailArgs.sendTo),d=[["type","text"],["id","cmp_to"],["label","To"],["width","600px"],["value",d],["labelWidth","50px"],["floatDir","Left"]],this.emailFormData.txtTo=setElementAttr(alib.dom.createElement("input"),d),alib.dom.styleSetClass(this.emailFormData.txtTo,"fancy"),this.emailArgs.inpField){case "cmp_cc":b=this.emailAddress.join(", ");break;case "cmp_bcc":c=this.emailAddress.join(", ")}this.emailFormData.txtCc=
createInputAttribute(alib.dom.createElement("input"),"text","cmp_cc","CC","600px",b,"50px","Left");alib.dom.styleSetClass(this.emailFormData.txtCc,"fancy");this.emailFormData.txtBcc=createInputAttribute(alib.dom.createElement("input"),"text","cmp_bcc","BCC","600px",c,"50px","Left");alib.dom.styleSetClass(this.emailFormData.txtBcc,"fancy");this.emailFormData.txtSubject=createInputAttribute(alib.dom.createElement("input"),"text","cmp_subject","Subject","600px",this.messageDetails.subject,"50px","Left");
this.emailFormData.txtSubject.label="Subject";this.emailFormData.txtSubject.floatDir="Left";alib.dom.styleSetClass(this.emailFormData.txtSubject,"fancy");buildFormInput(this.emailFormData,this.emailCon,!0);"undefined"==typeof c&&alib.dom.styleSet(this.emailFormData.txtBcc.parentNode.parentNode,"display","none");"undefined"==typeof b&&alib.dom.styleSet(this.emailFormData.txtCc.parentNode.parentNode,"display","none");new alib.ui.AutoComplete(this.emailFormData.txtTo,{url:"/controller/Contact/getUserContactsEmail"});
new alib.ui.AutoComplete(this.emailFormData.txtCc,{url:"/controller/Contact/getUserContactsEmail"});new alib.ui.AutoComplete(this.emailFormData.txtBcc,{url:"/controller/Contact/getUserContactsEmail"});c=alib.dom.createElement("div",this.emailCon);b=alib.dom.createElement("div",c);c=alib.dom.createElement("div",c);d=new AntFsUpload("%tmp%",this.m_dlg);d.cbData.cls=this;d.onRemoveUpload=function(a){this.cbData.cls.attachedFiles=[];for(file in this.m_uploadedFiles){var b=this.cbData.cls.attachedFiles.length,
c=this.m_uploadedFiles[file].id;c!==a&&(this.cbData.cls.attachedFiles[b]=c)}this.cbData.cls.resize()};d.onUploadStarted=function(){this.cbData.cls.attachmentUploading=!0;this.cbData.cls.resize()};d.onQueueComplete=function(){this.cbData.cls.attachmentUploading=!1;this.cbData.cls.attachedFiles=[];for(file in this.m_uploadedFiles)this.cbData.cls.attachedFiles[this.cbData.cls.attachedFiles.length]=this.m_uploadedFiles[file].id};d.showTmpUpload(b,c,"Add Attachment");b=alib.dom.createElement("div",this.emailCon);
b.id="attachments";if(this.messageDetails.attachment)for(attachment in this.messageDetails.attachment){var c=this.messageDetails.attachment[attachment],d=alib.dom.createElement("div",b),e=c.value,f=c.name;this.emailAttachments[e]=createInputAttribute(alib.dom.createElement("input",d),"checkbox","attachment_"+e,null,null,c.value);if("forward"==this.replyType||"draft"==this.replyType)this.emailAttachments[e].checked=!0;alib.dom.createElement("label",d).innerHTML=" "+f}b=alib.dom.createElement("div",
this.infoCon);b.id="divBodyRte";this.createSpellForm(alib.dom.createElement("div",b));setElementAttr(alib.dom.createElement("form",b),[["name","composeForm"],["autocomplete","off"]]).onsubmit=function(a){a.preventDefault()};c=alib.dom.createElement("div");!this.mid&&a&&(d=alib.dom.createElement("div",c),d.innerHTML="<br /><br />"+a,d.id="accountSignature");a=alib.dom.createElement("div",c);this.messageDetails.body&&(a.innerHTML=this.messageDetails.body);this.emailFormData.txtBody=this.buildRte(b,
"composeBody",c.innerHTML);this.resize()};AntObjectLoader_EmailMessageCmp.prototype.buildRte=function(a,b,c){formDataRte=createInputAttribute(alib.dom.createElement("input"),"hidden",b,null,null,c);formDataRte.setAttribute("name",b);a.innerHTML="";alib.dom.getElementHeight(this.formCon);alib.dom.getElementHeight(this.infoCon);b=alib.ui.Editor(formDataRte);b.defaultBlockElement="";b.print(a,"100%","100%",c);this.rteBody=b;return formDataRte};
AntObjectLoader_EmailMessageCmp.prototype.createSpellForm=function(a){a=alib.dom.createElement("form",a);a.id="spell_form";a.setAttribute("name","spell_form");a.setAttribute("method","POST");a.setAttribute("target","spellWindow");a.setAttribute("action","/lib/spell/checkspelling.php");var b=alib.dom.createElement("input",a);b.setAttribute("name","spell_formname");b.setAttribute("type","hidden");b=alib.dom.createElement("input",a);b.setAttribute("name","spell_fieldname");b.setAttribute("type","hidden");
a=alib.dom.createElement("input",a);a.setAttribute("name","spellstring");a.setAttribute("type","hidden")};AntObjectLoader_EmailMessageCmp.prototype.showDialog=function(a){var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML=a;b.statusDialog(c,250,100);return b};
AntObjectLoader_EmailMessageCmp.prototype.saveEmail=function(){var a=this.filterAttachments(),b=[];b[b.length]=["message_id",this.messageId];b[b.length]=["mid",this.mid];b[b.length]=["tid",this.tid];b[b.length]=["fid",this.fid];b[b.length]=["cmp_to",this.emailFormData.txtTo.value];b[b.length]=["cmp_subject",this.emailFormData.txtSubject.value];b[b.length]=["cmp_cc",this.emailFormData.txtCc.value];b[b.length]=["cmp_bcc",this.emailFormData.txtBcc.value];b[b.length]=["cmpbody",this.emailFormData.txtBody.value];
b[b.length]=["in_reply_to",""];b[b.length]=["uploaded_file",this.attachedFiles];b[b.length]=["email_attachments",a];a=this.showDialog("Saving email, please wait...");ajax=new CAjax("json");ajax.cls=this;ajax.dlg=a;ajax.onload=function(a){a&&(this.cls.mid=a.mid,this.cls.tid=a.tid,this.dlg.hide())};ajax.exec("/controller/Email/saveEmail",b)};
AntObjectLoader_EmailMessageCmp.prototype.sendEmail=function(){var a=this.filterAttachments(),b=[];b[b.length]=["message_id",this.messageId];b[b.length]=["mid",this.mid];b[b.length]=["use_account",this.emailFormData.txtFrom.value];b[b.length]=["cmp_to",this.emailFormData.txtTo.value];b[b.length]=["cmp_subject",this.emailFormData.txtSubject.value];b[b.length]=["cmp_cc",this.emailFormData.txtCc.value];b[b.length]=["cmp_bcc",this.emailFormData.txtBcc.value];b[b.length]=["cmpbody",this.emailFormData.txtBody.value];
b[b.length]=["uploaded_file",this.attachedFiles];b[b.length]=["email_attachments",a];b[b.length]=["in_reply_to",this.inReplyTo];b[b.length]=["objects",this.emailArgs.objects];b[b.length]=["all_selected",this.emailArgs.allSelected];b[b.length]=["obj_type",this.emailArgs.objType];b[b.length]=["send_method",this.emailArgs.sendMethod];b[b.length]=["using",this.emailArgs.using];a=this.showDialog("Sending email, please wait...");ajax=new CAjax("json");ajax.cls=this;ajax.dlg=a;ajax.onload=function(){this.dlg.hide();
this.cls.loaderCls.close()};ajax.exec("/controller/Email/sendEmail",b)};AntObjectLoader_EmailMessageCmp.prototype.filterAttachments=function(){var a="";for(attachment in this.emailAttachments)this.emailAttachments[attachment].checked&&(0<a.length&&(a+=","),a+=attachment);return a};
AntObjectLoader_EmailMessageCmp.prototype.resize=function(){var a=0;this.isPopup&&(a=100);var b=document.getElementById("CRteIframe"),c=alib.dom.getContentHeight(this.emailCon),d=getHeaderHeights(),a=getWorkspaceHeight()-(c+d.totalHeaderHeight+a);alib.dom.styleSet(b,"height",a+"px");alib.dom.getContentHeight(this.infoCon)};REPORT_TYPE_OBJECT="object";REPORT_TYPE_DATAWARE="dataware";REPORT_TYPE_CUSTOM="custom";GRAPH_TYPE_SINGLE="single";GRAPH_TYPE_MULTI="multi";TABLE_TABULAR="tabular";
TABLE_SUMMARY="summary";TABLE_PIVOT="pivot_matrix";MEASURE_COUNT="count";
function AntObjectLoader_Report(a,b){this.mainObject=a;this.reportId=this.mainObject.id;this.loaderCls=b;this.toolbar=this.ctbl=this.graphCon=this.tableResultCon=this.bodyNoticeCon=this.bodyFormCon=this.bodyCon=this.formCon=this.mainCon=this.mainConMin=this.outerCon=this.reportObject=null;this.plugins=[];this.fEnableClose=this.printOuterTable=!0;this.finishBuilding=this.measureHasCount=this.editMode=this.hideToolbar=this.forceEdit=!1;this.filterCount=0;this.reportForm={};this.reportData={};this.reportDimensionData=
{};this.reportMeasureData={};this.objectData={};this.measureData={};this.dimensionData={};this.dimTypeData={};this.aggregateData=[];this.sortData=[];this.formatData=[];this.reportFilterData=[];this.reportType=REPORT_TYPE_OBJECT;this.graphType=this.customReport=this.tableType=this.objType=null;this.chartWidth="800";this.deleteImage=this.cubePath=this.cube=null}AntObjectLoader_Report.prototype.refresh=function(){};
AntObjectLoader_Report.prototype.toggleEdit=function(){if(this.buttonEdit){this.editMode=this.editMode?!1:!0;var a="block",b="inline-block",c="none";this.editMode?this.buttonEdit.setText("Finished Editing"):(b=a="none",c="inline-block",this.buttonEdit.setText("Edit Values"));alib.dom.styleSet(this.reportForm.reportInfo.reportName,"display",b);alib.dom.styleSet(this.fsGraph,"display",a);alib.dom.styleSet(this.fsTableOptions,"display",a);alib.dom.styleSet(this.tableResultCon,"display",a);alib.dom.styleSet(this.reportForm.reportInfo.lblReportName,
"display",c)}};AntObjectLoader_Report.prototype.print=function(a){this.outerCon=a;this.formCon=this.mainCon=alib.dom.createElement("div",a);a=alib.dom.createElement("div",this.formCon);this.bodyCon=alib.dom.createElement("div",a);alib.dom.styleSet(this.bodyCon,"margin-top","5px");this.bodyNoticeCon=alib.dom.createElement("div",this.bodyCon);this.bodyFormCon=alib.dom.createElement("div",this.bodyCon);this.bodyFormCon.innerHTML="<div class='loading'></div>";this.buildInterface()};
AntObjectLoader_Report.prototype.onValueChange=function(){};AntObjectLoader_Report.prototype.onNameChange=function(){};
AntObjectLoader_Report.prototype.buildInterface=function(){if(0<this.reportId)this.reportObject=new Report(this.reportId),this.reportObject.cls=this,this.reportObject.chartWidth=this.chartWidth,this.reportObject.onload=function(a){this.cls.cube=this.cube;this.cls.deleteImage="/images/icons/deleteTask.gif";this.cls.tableType=this.tableType;this.cls.reportData=this.reportData;this.cls.reportFilterData=this.filterData;this.cls.reportDimensionData=this.reportDimensionData;this.cls.reportMeasureData=this.reportMeasureData;
var c=a.reportData.obj_type,d=a.reportData.dataware_cube,a=a.reportData.custom_report;c?(this.cls.objType=c,this.cls.reportType=REPORT_TYPE_OBJECT):d?(this.cls.cubePath=d,this.cls.reportType=REPORT_TYPE_DATAWARE):a&&(this.cls.customReport=a,this.cls.reportType=REPORT_TYPE_CUSTOM);this.cls.aggregateData=this.aggregateData;this.cls.sortData=this.sortData;this.cls.formatData=this.formatData;this.cls.dimTypeData=this.dimTypeData;this.cls.dimensionData=this.dimensionData;this.cls.measureData=this.measureData;
for(measure in this.measureData)if(this.measureData[measure].name==MEASURE_COUNT){this.cls.measureHasCount=!0;break}this.cls.buildReport();this.cls.forceEdit&&this.cls.toggleEdit(!0)},this.reportObject.loadReport();else{var a=new AntObjectLoader_Report_Dialog(this);a.cls=this;a.onsave=function(a){this.cls.forceEdit=!0;this.cls.reportId=a;this.cls.buildInterface()};a.print()}};
AntObjectLoader_Report.prototype.buildReport=function(){this.bodyFormCon.innerHTML="";this.reportToolbar();var a=alib.dom.createElement("table",this.bodyFormCon),a=alib.dom.createElement("tbody",a);this.reportForm.reportInfo={};var b=[["id","name"],["type","text"],["width","430px"],["label","Report Name: "],["value",this.reportData.name]];this.reportForm.reportInfo.reportName=alib.dom.setElementAttr(alib.dom.createElement("input"),b);this.loaderCls.buildFormInput(this.reportForm.reportInfo,a);this.reportForm.reportInfo.lblReportName=
alib.dom.setElementAttr(alib.dom.createElement("div",this.reportForm.reportInfo.reportName.parentNode),[["innerHTML",this.reportForm.reportInfo.reportName.value]]);alib.dom.styleSet(this.reportForm.reportInfo.reportName,"display","none");this.fsFilter=alib.dom.createElement("fieldset",this.bodyFormCon);alib.dom.setElementAttr(alib.dom.createElement("legend",this.fsFilter),[["innerHTML","Filter"]]);a=alib.dom.createElement("div",this.fsFilter);this.objType?this.buildObjectFilter(a):(this.reportForm.reportFilter=
[],this.displaySavedFilter(a),this.reportFilterLinks(this.fsFilter,a));this.fsGraph=alib.dom.createElement("fieldset",this.bodyFormCon);alib.dom.styleSet(this.fsGraph,"display","none");alib.dom.setElementAttr(alib.dom.createElement("legend",this.fsGraph),[["innerHTML","Graph Options"]]);this.buildGraphOptions(alib.dom.createElement("div",this.fsGraph));this.graphCon=alib.dom.setElementAttr(alib.dom.createElement("div",this.bodyFormCon),[["innerHTML","<div class='loading'></div>"]]);alib.dom.styleSet(this.graphCon,
"border","1px solid");alib.dom.styleSet(this.graphCon,"margin","10px 0px");alib.dom.styleSet(this.graphCon,"padding","10px");alib.dom.styleSet(this.graphCon,"height","50px");this.fsTableOptions=alib.dom.createElement("fieldset",this.bodyFormCon);alib.dom.styleSet(this.fsTableOptions,"display","none");alib.dom.setElementAttr(alib.dom.createElement("legend",this.fsTableOptions),[["innerHTML","Table Options"]]);this.tableResultCon=alib.dom.createElement("div",this.bodyFormCon);alib.dom.styleSet(this.tableResultCon,
"display","none");alib.dom.styleSet(this.tableResultCon,"minHeight","200px");this.buildTableOptions(alib.dom.createElement("div",this.fsTableOptions));this.finishBuilding=!0;this.loadOlapData()};
AntObjectLoader_Report.prototype.reportToolbar=function(){if(!this.hideToolbar){var a=new CToolbar,b=new CButton("Close",function(a){a.close()},[this.loaderCls],"b1");this.loaderCls.fEnableClose&&!this.loaderCls.isMobile&&a.AddItem(b.getButton(),"left");b=new CButton("Save and Close",function(a){a.saveReport(!0)},[this],"b1");this.loaderCls.fEnableClose&&!this.loaderCls.isMobile&&a.AddItem(b.getButton(),"left");b=new CButton("Save Changes",function(a){a.saveReport(!1)},[this],"b1");a.AddItem(b.getButton(),
"left");b=new CButton("Delete",function(a){confirm("Are you sure to delete this user?")&&a.deleteUser()},[this],"b3");a.AddItem(b.getButton(),"left");this.buttonEdit=new CButton("Edit Values",function(a){a.toggleEdit(a.editMode)},[this],"b2");a.AddItem(this.buttonEdit.getButton(),"left");b=new CButton("Permissions",function(){},[this],"b1");a.AddItem(b.getButton(),"left");a.print(this.loaderCls.toolbarCon)}};
AntObjectLoader_Report.prototype.buildObjectFilter=function(a){var b=new CAntObject(this.objType);b.loadQuerySubObjects=!1;this.reportFilterData=b.buildAdvancedQuery(a,this.reportFilterData);var b=alib.dom.createElement("div",a),c=alib.dom.setElementAttr(alib.dom.createElement("a",b),[["innerHTML","Apply & Refresh Data"],["href","javascript: void(0);"]]),d=c.parentNode.previousSibling;alib.dom.divClear(a);alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"marginLeft","15px");alib.dom.styleSet(d,
"float","left");c.cls=this;c.onclick=function(){this.cls.loadOlapData();this.cls.processGraphDisplay()}};
AntObjectLoader_Report.prototype.buildReportFilter=function(a){this.reportForm.reportFilter[this.filterCount]={};var b=this.reportForm.reportFilter[this.filterCount],c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"marginTop","5px");b.blogic=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","filter_blogic_"+this.filterCount]]);b.field=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","filter_field_"+this.filterCount]]);b.operator=alib.dom.setElementAttr(alib.dom.createElement("select"),
[["id","filter_operator_"+this.filterCount]]);b.condValue=alib.dom.setElementAttr(alib.dom.createElement("input"),[["type","text"],["id","filter_value_"+this.filterCount],["value","Query Value"]]);b.removeFilter=alib.dom.createElement("img");this.loaderCls.buildFormInputDiv(b,c,!1,"10px");alib.dom.divClear(a);b.id=null;alib.dom.setInputBlurText(b.condValue,"Query Value","","","");b.removeFilter.divFilterCon=a;b.removeFilter.divFilter=c;b.removeFilter.filterCount=this.filterCount;b.removeFilter.cls=
this;b.removeFilter.onclick=function(){this.divFilterCon.removeChild(this.divFilter);delete this.cls.reportForm.reportFilter[this.filterCount];this.cls.loadOlapData()};b.field.cls=this;b.field.operator=b.operator;b.field.onchange=function(){var a=this.operator;this.dimType=this.cls.dimTypeData[this.value];var b=this.cls.getFilterOperator(this.dimType);a.innerHTML="";this.cls.loaderCls.buildDropdown(a,b)};b.removeFilter.src=this.deleteImage;alib.dom.styleSet(b.removeFilter,"cursor","pointer");alib.dom.styleSet(b.removeFilter,
"marginTop","3px");alib.dom.styleSet(b.condValue,"height","20px");alib.dom.styleSet(b.condValue,"fontSize","12px");this.loaderCls.buildDropdown(b.blogic,[["and","And"],["or","Or"]]);a=null;for(dimension in this.dimensionData){var c=this.dimensionData[dimension],d=b.field.length;b.field[d]=new Option(c.name,c.name);b.field[d].dimType=c.type;null==a&&(a=c.type)}a=this.getFilterOperator(a);this.loaderCls.buildDropdown(b.operator,a);this.filterCount++};
AntObjectLoader_Report.prototype.reportFilterLinks=function(a,b){var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"marginTop","10px");var d=alib.dom.setElementAttr(alib.dom.createElement("a",c),[["href","javascript: void(0);"],["innerHTML","Add Filter"]]);alib.dom.styleSet(d,"marginRight","15px");d.cls=this;d.divFilterCon=b;d.onclick=function(){this.cls.buildReportFilter(this.divFilterCon)};c=alib.dom.setElementAttr(alib.dom.createElement("a",c),[["href","javascript: void(0);"],["innerHTML",
"Apply & Refresh Data"]]);c.cls=this;c.onclick=function(){this.cls.loadOlapData()}};AntObjectLoader_Report.prototype.displaySavedFilter=function(a){if(this.reportFilterData.length){for(filter in this.reportFilterData){var b=this.reportFilterData[filter];this.buildReportFilter(a);var c=this.reportForm.reportFilter[this.filterCount-1];c.id=b.id;c.blogic.value=b.blogic;c.field.value=b.fieldName;c.field.onchange();c.operator.value=b.operator;c.condValue.value=b.condValue}this.processFilter()}};
AntObjectLoader_Report.prototype.processFilter=function(){this.filterData=[];if(this.reportForm.reportFilter)for(filter in this.reportForm.reportFilter){var a=this.reportForm.reportFilter[filter];this.filterData[filter]={};this.filterData[filter].id=a.id;this.filterData[filter].blogic=a.blogic.value;this.filterData[filter].fieldName=a.field.value;this.filterData[filter].operator=a.operator.value;this.filterData[filter].condValue=a.condValue.value}else for(var b=0;b<this.reportFilterData.getNumConditions();b++)a=
this.reportFilterData.getCondition(b),this.filterData[b]={},this.filterData[b].id=a.condId,this.filterData[b].blogic=a.blogic,this.filterData[b].fieldName=a.fieldName,this.filterData[b].operator=a.operator,this.filterData[b].condValue=a.condValue};
AntObjectLoader_Report.prototype.buildGraphOptions=function(a){this.reportForm.reportGraph={};this.reportForm.reportGraph.type=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","chart_type"],["label","Type: "]]);this.reportForm.reportGraph.measure=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","chart_measure"],["label","X-Axis: "]]);this.reportForm.reportGraph.dimension=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","chart_dim1"],["label","Y-Axis: "]]);
this.reportForm.reportGraph.grouping=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","chart_dim2"],["label","Grouping: "]]);this.loaderCls.buildFormInput(this.reportForm.reportGraph,a);this.reportForm.reportGraph.aggregate=alib.dom.setElementAttr(alib.dom.createElement("select",this.reportForm.reportGraph.measure.parentNode),[["id","chart_measure_agg"]]);var b=this.reportForm.reportGraph.dimension.parentNode,a=alib.dom.setElementAttr(alib.dom.createElement("label",b),[["innerHTML",
"By"]]);this.reportForm.reportGraph.dimensionFormat=alib.dom.setElementAttr(alib.dom.createElement("select",b),[["id","chart_dim1_grp"]]);var c=this.reportForm.reportGraph.grouping.parentNode,b=alib.dom.setElementAttr(alib.dom.createElement("label",c),[["innerHTML","By"]]);this.reportForm.reportGraph.groupingFormat=alib.dom.setElementAttr(alib.dom.createElement("select",c),[["id","chart_dim2_grp"]]);alib.dom.styleSet(this.reportForm.reportGraph.aggregate,"marginLeft","10px");alib.dom.styleSet(this.reportForm.reportGraph.aggregate,
"display","none");alib.dom.styleSet(a,"margin","0px 10px");alib.dom.styleSet(b,"margin","0px 10px");this.reportForm.reportGraph.type.cls=this;this.reportForm.reportGraph.type.onchange=function(){this.cls.processGraphDisplay()};this.reportForm.reportGraph.measure.cls=this;this.reportForm.reportGraph.measure.onchange=function(){"count"==this.value?alib.dom.styleSet(this.cls.reportForm.reportGraph.aggregate,"display","none"):alib.dom.styleSet(this.cls.reportForm.reportGraph.aggregate,"display","inline-block");
this.cls.processGraphDisplay()};this.reportForm.reportGraph.dimension.cls=this;this.reportForm.reportGraph.dimension.lblDimension=a;this.reportForm.reportGraph.dimension.onchange=function(){this.dimType=this.cls.dimTypeData[this.value];this.cls.displayFormat(this.dimType,this.lblDimension,this.cls.reportForm.reportGraph.dimensionFormat);this.cls.getGraphTypes()};this.reportForm.reportGraph.dimensionFormat.cls=this;this.reportForm.reportGraph.dimensionFormat.onchange=function(){this.cls.processGraphDisplay()};
this.reportForm.reportGraph.grouping.cls=this;this.reportForm.reportGraph.grouping.lblGrouping=b;this.reportForm.reportGraph.grouping.onchange=function(){this.dimType=this.cls.dimTypeData[this.value];this.cls.displayFormat(this.dimType,this.lblGrouping,this.cls.reportForm.reportGraph.groupingFormat);this.cls.getGraphTypes()};this.reportForm.reportGraph.groupingFormat.cls=this;this.reportForm.reportGraph.groupingFormat.onchange=function(){this.cls.processGraphDisplay()};this.reportForm.reportGraph.aggregate.cls=
this;this.reportForm.reportGraph.aggregate.onchange=function(){this.cls.processGraphDisplay()};this.loaderCls.buildDropdown(this.reportForm.reportGraph.aggregate,this.aggregateData,this.reportData.chart_measure_agg);this.loaderCls.buildDropdown(this.reportForm.reportGraph.dimensionFormat,this.formatData,this.reportData.chart_dim1_grp);this.loaderCls.buildDropdown(this.reportForm.reportGraph.groupingFormat,this.formatData,this.reportData.chart_dim2_grp);this.loaderCls.buildDropdown(this.reportForm.reportGraph.grouping,
[["","none"]]);this.loaderCls.buildDropdown(this.reportForm.reportGraph.dimension,[["","none"]]);this.measureHasCount||this.loaderCls.buildDropdown(this.reportForm.reportGraph.measure,[MEASURE_COUNT]);for(measure in this.measureData){var d=this.measureData[measure],c=this.reportForm.reportGraph.measure.length,e=!1;d.name==this.reportData.chart_measure&&(alib.dom.styleSet(this.reportForm.reportGraph.aggregate,"display","inline-block"),e=!0);this.reportForm.reportGraph.measure[c]=new Option(d.name,
d.name,!1,e)}e=d=null;for(dimension in this.dimensionData){var f=this.dimensionData[dimension],c=this.reportForm.reportGraph.dimension.length,g=!1;f.name==this.reportData.chart_dim1&&(d=f.type,g=!0);this.reportForm.reportGraph.dimension[c]=new Option(f.name,f.name,!1,g);this.reportForm.reportGraph.dimension[c].dimType=f.type;null==d&&(d=f.type);c=this.reportForm.reportGraph.grouping.length;g=!1;f.name==this.reportData.chart_dim2&&(e=f.type,g=!0);this.reportForm.reportGraph.grouping[c]=new Option(f.name,
f.name,!1,g);this.reportForm.reportGraph.grouping[c].dimType=f.type;null==e&&(e=f.type)}this.displayFormat(d,a,this.reportForm.reportGraph.dimensionFormat);this.displayFormat(e,b,this.reportForm.reportGraph.groupingFormat);this.getGraphTypes()};
AntObjectLoader_Report.prototype.processGraphDisplay=function(){if(this.finishBuilding){this.processFilter();var a=this.reportForm.reportGraph,b={};b.type=a.type.value;b.dimension=a.dimension.value;b.dimensionFormat=a.dimensionFormat.value;b.grouping=a.grouping.value;b.groupingFormat=a.groupingFormat.value;b.measure=a.measure.value;b.aggregate=a.aggregate.value;this.reportObject.displayGraph(this.graphCon,b,this.filterData)}};
AntObjectLoader_Report.prototype.getGraphTypes=function(){var a=GRAPH_TYPE_SINGLE;this.reportForm.reportGraph.grouping.value.length&&(a=GRAPH_TYPE_MULTI);if(this.graphType==a)this.processGraphDisplay();else{var b=this.reportData.chart_type,c=this.reportForm.reportGraph.type;c.innerHTML="";this.loaderCls.buildDropdown(c,[["","none"]]);this.reportObject.onloadGraphs=function(a){if(a){for(graphType in a){var e=a[graphType],f=!1;e.name==b&&(f=!0);c[c.length]=new Option(e.title,e.name,!1,f)}this.cls.processGraphDisplay()}};
this.reportObject.getGraphTypes(a);this.graphType=a}};
AntObjectLoader_Report.prototype.buildTableOptions=function(a){this.tabularReport=new AntObjectLoader_Report_Tabular(this);this.summaryReport=new AntObjectLoader_Report_Summary(this);this.pivotReport=new AntObjectLoader_Report_PivotMatrix(this);this.reportForm.reportTable={};this.reportForm.reportTable.type=alib.dom.setElementAttr(alib.dom.createElement("select"),[["id","table_type"],["label","Type: "]]);this.loaderCls.buildFormInput(this.reportForm.reportTable,a);this.tableDataCon=alib.dom.createElement("div",
a);this.reportForm.reportTable.type.cls=this;this.reportForm.reportTable.type.onchange=function(){this.cls.tableDataCon.innerHTML="";this.cls.tableResultCon.innerHTML="";this.cls.tableType=this.value;switch(this.cls.tableType){case TABLE_TABULAR:this.cls.tabularReport.buildTableTabular(this.cls.tableDataCon);break;case TABLE_SUMMARY:this.cls.summaryReport.buildTableSummary(this.cls.tableDataCon);break;case TABLE_PIVOT:this.cls.pivotReport.buildTablePivot(this.cls.tableDataCon)}this.cls.loadOlapData()};
this.loaderCls.buildDropdown(this.reportForm.reportTable.type,[["","none"],[TABLE_TABULAR,"Tabular"],[TABLE_SUMMARY,"Summary"],[TABLE_PIVOT,"Pivot / Matrix"]],this.tableType);this.reportForm.reportTable.type.onchange()};AntObjectLoader_Report.prototype.loadOlapData=function(){this.processFilter();if(this.finishBuilding)switch(this.tableType){case TABLE_TABULAR:this.tabularReport.buildOlapData();break;case TABLE_SUMMARY:this.summaryReport.buildOlapData();break;case TABLE_PIVOT:this.pivotReport.buildOlapData()}};
AntObjectLoader_Report.prototype.displayFormat=function(a,b,c){switch(a){case "timestamp":case "date":case "time":alib.dom.styleSet(b,"display","inline-block");alib.dom.styleSet(c,"display","inline-block");break;default:alib.dom.styleSet(b,"display","none"),alib.dom.styleSet(c,"display","none")}};
AntObjectLoader_Report.prototype.getFilterOperator=function(a){var b=[];switch(a){case "timestamp":case "time":case "date":b="is_equal,is_not_equal,is_greater,is_less,is_greater_or_equal,is_less_or_equal,day_is_equal,year_is_equal,last_x_days,last_x_weeks,last_x_months,last_x_years,next_x_days,next_x_weeks,next_x_months,next_x_years".split(",");break;case "numeric":case "number":case "real":case "integer":b="is_equal,is_not_equal,is_greater,is_less,is_greater_or_equal,is_less_or_equal".split(",");
break;case "string":case "text":case "object":case "multi_fkey":b=["is_equal","is_not_equal","begins_with","contains"]}return b};
AntObjectLoader_Report.prototype.saveReport=function(a){var b=[];b[b.length]=["id",this.reportId];b[b.length]=["name",this.reportForm.reportInfo.reportName.value];b[b.length]=["table_type",this.tableType];if(this.reportForm.reportTable.type.value==TABLE_PIVOT){var c=this.pivotReport.getReportForm();for(pivot in c.pivotTotals){var d=c.pivotTotals[pivot];"checkbox"==d.type&&(b[b.length]=[d.id,d.checked])}}else b[b.length]=["f_row_totals",!1],b[b.length]=["f_column_totals",!1],b[b.length]=["f_sub_totals",
!1];for(graph in this.reportForm.reportGraph)c=this.reportForm.reportGraph[graph],c.id&&"none"!==c.style.display&&(b[b.length]=[c.id,c.value]);this.processFilter();for(filter in this.filterData)c=this.filterData[filter],b[b.length]=["filters[]",filter],b[b.length]=["filter_id_"+filter,c.id],b[b.length]=["filter_blogic_"+filter,c.blogic],b[b.length]=["filter_field_"+filter,c.fieldName],b[b.length]=["filter_operator_"+filter,c.operator],b[b.length]=["filter_value_"+filter,c.condValue];switch(this.tableType){case TABLE_TABULAR:b=
b.concat(this.tabularReport.getTableOptions());break;case TABLE_SUMMARY:b=b.concat(this.summaryReport.getTableOptions());break;case TABLE_PIVOT:b=b.concat(this.pivotReport.getTableOptions())}var e=showDialog("Saving report...");this.reportObject.onsave=function(b){e.hide();a&&this.cls.loaderCls.close();b?b.error?ALib.statusShowAlert(b.error,3E3,"bottom","right"):ALib.statusShowAlert("Report was successfully saved!",3E3,"bottom","right"):ALib.statusShowAlert("Error occured when saving the report data.",
3E3,"bottom","right")};this.reportObject.saveReport(b)};
function AntObjectLoader_Dashboard(a,b){this.mainObject=a;this.dashboardId=this.mainObject.id;this.loaderCls=b;this.toolbar=this.ctbl=this.bodyNoticeCon=this.bodyFormCon=this.bodyCon=this.formCon=this.mainCon=this.mainConMin=this.outerCon=null;this.plugins=[];this.fEnableClose=this.printOuterTable=!0;this.dropZone="dashboardDropZone";this.appNavname=null;this.allowEdit=this.dropdownPopulated=!1;this.dashboardWidgets=[];this.layout=[];this.columns=[];this.columnChange=!1}
AntObjectLoader_Dashboard.prototype.refresh=function(){};AntObjectLoader_Dashboard.prototype.toggleEdit=function(){};AntObjectLoader_Dashboard.prototype.onValueChange=function(a){"num_columns"==a&&(this.columnChange=!0)};AntObjectLoader_Dashboard.prototype.onNameChange=function(){};
AntObjectLoader_Dashboard.prototype.print=function(a){this.outerCon=a;this.formCon=this.mainCon=alib.dom.createElement("div",a);a=alib.dom.createElement("div",this.formCon);this.bodyCon=alib.dom.createElement("div",a);alib.dom.styleSet(this.bodyCon,"margin-top","5px");this.bodyNoticeCon=alib.dom.createElement("div",this.bodyCon);this.bodyFormCon=alib.dom.createElement("div",this.bodyCon);this.dashboardFormCon=alib.dom.createElement("div",this.bodyFormCon);this.dashboardHeaderCon=alib.dom.createElement("div",
this.bodyFormCon);this.dashboardWidgetCon=alib.dom.createElement("div",this.bodyFormCon);alib.dom.styleSet(this.loaderCls.titleCon,"display","none");this.initDashboard();this.loadDashboard()};AntObjectLoader_Dashboard.prototype.initDashboard=function(){this.mainObject.security.edit&&(this.allowEdit=!0);this.displayObjectForm()};AntObjectLoader_Dashboard.prototype.loadDashboard=function(){this.dashboardData={};this.dashboardCols=[];this.dashboardWidgets=[];this.dashboardMenus=[];this.buildInterface()};
AntObjectLoader_Dashboard.prototype.buildInterface=function(){this.dashboardWidgetCon.innerHTML="";this.dashboardId&&this.loadLayout();this.refreshWidgets()};
AntObjectLoader_Dashboard.prototype.displayObjectForm=function(){if(this.mainObject.security.edit){var a=new AntObjectLoader_Form(this.mainObject,this.loaderCls);this.loaderCls.pluginAddToolbarEntry("Add Widgets",function(a){var c=new CWidgetBrowser;c.cls=a.cls;c.onSelect=function(a){this.cls.addWidget(a)};c.showDialog()},{cls:this},"first");a.print(this.dashboardFormCon);this.loaderCls.cbData.cls=this;this.loaderCls.onSave=function(){this.cbData.cls.columnChange&&(this.cbData.cls.loadDashboard(),
this.cbData.cls.columnChange=!1)}}};AntObjectLoader_Dashboard.prototype.addWidget=function(a){var b=new CAjax("json");b.cbData.cls=this;b.onload=function(a){this.cbData.cls.renderWidget(0,a)};var c=[];c[c.length]=["dashboardId",this.mainObject.id];c[c.length]=["widgetId",a];c[c.length]=["col",0];b.exec("/controller/Dashboard/addWidget",c)};
AntObjectLoader_Dashboard.prototype.removeWidget=function(a){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){for(widget in this.cbData.cls.dashboardWidgets){var b=this.cbData.cls.dashboardWidgets[widget];if(b.m_id==a){var e=b.m_widgetBox.getCon();e.parentNode.removeChild(e);b.exit();delete b}}};var b=[];b[b.length]=["dwid",a];b[b.length]=["dashboardId",this.mainObject.id];ajax.exec("/controller/Dashboard/removeWidget",b)};
AntObjectLoader_Dashboard.prototype.loadLayout=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.layout=a;this.cbData.cls.renderDashboard()};var a=[];a[a.length]=["dbid",this.mainObject.id];ajax.exec("/controller/Dashboard/getLayout",a)};
AntObjectLoader_Dashboard.prototype.renderDashboard=function(){var a=new CSplitContainer("verticle","100%");a.resizable=!0;a.print(this.dashboardWidgetCon);for(col in this.layout)this.columns[col]=a.addPanel(this.layout[col].width?this.layout[col].width:null,"hidden");for(col in this.layout){if(this.layout[col].widgets)for(var b in this.layout[col].widgets)alib.dom.createElement("div",this.columns[col]),this.renderWidget(col,this.layout[col].widgets[b]);var c=new CWidgetBox(this.dropZone,"300px");
c.wbCls=this;c.onMoved=function(){this.wbCls.saveLayout()};c.print(this.columns[col])}a.cls=this;a.onPanelResize=function(){this.cls.saveLayout(this.m_columns)}};
AntObjectLoader_Dashboard.prototype.renderWidget=function(a,b){var c=this.columns[a].childNodes[this.columns[a].childNodes.length-1],d=this.dashboardWidgets.length,e=new CWidgetBox(this.dropZone);e.cls=this;e.wIndex=d;e.onMoved=function(){this.cls.saveLayout();this.cls.dashboardWidgets[this.wIndex].main()};e.onBeforeMove=function(){};var f=e.getCon();f.m_id=b.id;e.printBefore(this.columns[a],c);c=alib.dom.createElement("div",f);alib.dom.styleSetClass(c,"dbWidget");var g=alib.dom.createElement("div",
c);alib.dom.styleSetClass(g,"dbWidgetHeader");var h=alib.dom.createElement("div",g);alib.dom.styleSetClass(h,"dbWidgetOpt");g=alib.dom.createElement("div",g);alib.dom.styleSetClass(g,"dbWidgetTitle");var k=alib.dom.createElement("div",c);alib.dom.styleSetClass(k,"dbWidgetBody");f.m_con=k;f=eval("new "+b.widget+"()");g.innerHTML=f.title;f.m_widgetBox=e;this.dashboardWidgets[d]=f;f.dashboardCls=this;f.m_widTitle=g;f.m_container=k;f.m_id=b.id;"undefined"!=typeof b.data&&(f.m_data=b.data);d=new CDropdownMenu;
d.handleDuplicates=!0;this.dashboardMenus.push(d);f.m_dm=d;this.loaderCls.antView&&(f.antView=this.loaderCls.antView);this.allowEdit&&(d.addEntry("Remove Widget",function(a,b){a.removeWidget(b)},null,null,[this,b.id]),h.appendChild(d.createImageMenu("/images/icons/gear_16.png","/images/icons/gear_16.png","/images/icons/gear_16.png")),DragAndDrop.registerDragable(g,c,this.dropZone),d=ALib.m_document.createElement("div"),d.innerHTML="Move: "+g.innerHTML,DragAndDrop.setDragGuiCon(g,d,15,15));f.main()};
AntObjectLoader_Dashboard.prototype.executeWidgets=function(){for(widget in this.dashboardWidgets)this.dashboardWidgets[widget].main()};AntObjectLoader_Dashboard.prototype.exitWidgets=function(){for(widget in this.dashboardWidgets){var a=this.dashboardWidgets[widget];a.exit();a.m_dm&&a.m_dm.destroyMenu()}};
AntObjectLoader_Dashboard.prototype.saveLayout=function(a){var b=[];b[b.length]=["dashboardId",this.dashboardId];b[b.length]=["columnCount",this.columns.length];for(col in this.columns){for(var c=this.columns[col],d="",e=0;e<c.childNodes.length;e++)c.childNodes[e].m_id&&(d+=d?":":"",d+=c.childNodes[e].m_id);b[b.length]=["col_"+col,d]}if("undefined"!==typeof a)for(column in a)b[b.length]=["columnWidth_"+column,a[column].offsetWidth];ajax=new CAjax("json");ajax.exec("/controller/Dashboard/saveLayout",
b)};AntObjectLoader_Dashboard.prototype.onColResize=function(){this.executeWidgets();var a=[];a[a.length]=["dashboardId",this.dashboardId];for(col in this.dashboardCols)a[a.length]=["col_"+col,this.dashboardCols[col].offsetWidth+"px"];ajax=new CAjax("json");ajax.exec("/controller/Dashboard/saveLayoutResize",a)};
AntObjectLoader_Dashboard.prototype.onColResizeStart=function(){this.exitWidgets();for(col in this.dashboardCols)for(var a=this.dashboardCols[col],b=0;b<a.childNodes.length;b++)a.childNodes[b].m_id&&(a.childNodes[b].m_con.innerHTML="")};AntObjectLoader_Dashboard.prototype.saveData=function(a,b){var c=[];c[c.length]=["dwid",a];c[c.length]=["data",b];ajax=new CAjax("json");ajax.exec("/controller/Dashboard/saveData",c)};
AntObjectLoader_Dashboard.prototype.refreshWidgets=function(){for(widget in this.dashboardWidgets){var a=this.dashboardWidgets[widget];"function"==typeof a.refresh&&a.refresh()}var b=this;window.setTimeout(function(){b.refreshWidgets()},6E4)};
function AntObject_FieldInput(a,b,c,d){this.value=c?c:"";this.valueName="";this.objType="string"==typeof a?a:a.obj_type;this.obj="string"==typeof a?new CAntObject(a):a;this.options=d||{};this.fieldName=b;this.field=this.obj.getFieldByName(b);this.input=null;this.validator="";null!=a&&"string"!=typeof a&&alib.events.listen(a,"fieldchange",{context:this,method:"objectFieldChanged"});alib.events.listen(this,"change",{context:this,method:"onChange"})}
AntObject_FieldInput.prototype.render=function(a,b){var c=b?b:{};a.innerHTML="";this.value||(this.value=this.obj.getValue(this.fieldName));this.valueName||(this.valueName=this.obj.getValueName(this.fieldName));switch(this.field.type){case "fkey":case "fkey_multi":this.input=new AntObject_FieldInput_Grouping(this,a,c);break;case "object":this.input=new AntObject_FieldInput_Object(this,a,c);break;case "bool":this.input=new AntObject_FieldInput_Bool(this,a,c);break;case "alias":this.input=new AntObject_FieldInput_Alias(this,
a,c);break;case "date":this.input=new AntObject_FieldInput_Date(this,a,c);break;case "timestamp":this.input=new AntObject_FieldInput_Timestamp(this,a,c);break;case "number":case "numeric":case "integer":case "float":this.input=new AntObject_FieldInput_Number(this,a,c);break;default:this.input=new AntObject_FieldInput_Text(this,a,c)}alib.events.listen(this.input,"change",{context:this,method:"checkValidators"});c.validator&&(this.validator=c.validator)};
AntObject_FieldInput.prototype.buildInputDropDown=function(a,b,c,d,e){for(var c=c?c:null,d=d?d:"",e=e?e:"",f=0;f<b.length;f++)b[f][3]==d&&(a[a.length]=new Option(e+b[f][1],b[f][0],!1,c==b[f][0]?!0:!1),b[f][2]&&this.buildInputDropDown(a,b,c,b[f][0],e+"\u00a0\u00a0"))};AntObject_FieldInput.prototype.getInput=function(){};AntObject_FieldInput.prototype.getValue=function(){return this.value};AntObject_FieldInput.prototype.getValueName=function(){return this.valueName};
AntObject_FieldInput.prototype.setValue=function(a,b){b=b||"";this.input.setValue(a,b);this.value=a;this.valueName=b};AntObject_FieldInput.prototype.getName=function(){return this.fieldName};AntObject_FieldInput.prototype.checkValidators=function(a){if(this.validator){var b=new AntObject_FieldValidator(this.validator,this);b.cbData.cls=this;b.cbData.evt=a;b.onValid=function(){this.cbData.cls.fieldInputChanged(this.cbData.evt)};b.onInvalid=function(a){alert(a)};b.validate(a.data.value)}else this.fieldInputChanged(a)};
AntObject_FieldInput.prototype.fieldInputChanged=function(a){this.supressObjChangePush=!0;"fkey_multi"==this.field.type||"object_multi"==this.field.type?"remove"==a.data.action?this.obj.delMultiValue(this.fieldName,a.data.value):this.obj.setMultiValue(this.fieldName,a.data.value,a.data.valueName):this.obj.setValue(this.fieldName,a.data.value,a.data.valueName);this.value=a.data.value;this.valueName=a.data.valueName;alib.events.triggerEvent(this,"change")};
AntObject_FieldInput.prototype.objectFieldChanged=function(a){a.data.fieldName==this.fieldName&&(this.supressObjChangePush?this.supressObjChangePush=!1:this.setValue(a.data.value,a.data.valueName))};AntObject_FieldInput.prototype.onChange=function(){};AntObject_FieldInput.prototype.setHeight=function(a){return this.input&&this.input.setHeight?this.input.setHeight(a):!1};
function AntObject_FieldInput_Alias(a,b){for(var c=alib.dom.createElement("select",b),d=0;d<a.obj.fields.length;d++){var e=a.obj.fields[d];a.field.subtype==e.subtype&&"alias"!=e.type&&(c[c.length]=new Option(e.title,e.name,!1,a.value==e.name?!0:!1))}b.inptType="select";b.inpRef=c;c.clsRef=this;c.onchange=function(){alib.events.triggerEvent(this.clsRef,"change",{value:this.value,valueName:null})}}AntObject_FieldInput_Alias.prototype.setValue=function(){};
AntObject_FieldInput_Alias.prototype.getValue=function(){};function AntObject_FieldInput_Bool(a,b){var c=alib.dom.createElement("input");c.type="checkbox";c.checked=a.value?!0:!1;b.inptType="checkbox";b.inpRef=a;b.appendChild(c);c.clsRef=this;c.onclick=function(){alib.events.triggerEvent(this.clsRef,"change",{value:this.checked,valueName:null})}}AntObject_FieldInput_Bool.prototype.setValue=function(){};AntObject_FieldInput_Bool.prototype.getValue=function(){};
function AntObject_FieldInput_Date(a,b,c){var d=alib.dom.createElement("input");d.type="text";b.inptType="input";alib.dom.styleSetClass(d,"fancy");c.width&&alib.dom.styleSet(d,"width",c.width);a.value&&(d.value=a.value);b.inpRef=d;b.appendChild(d);new CAutoCompleteCal(d);alib.dom.styleSet(d,"width","100px");d.clsRef=this;d.onchange=function(){alib.events.triggerEvent(this.clsRef,"change",{value:this.value,valueName:null})}}AntObject_FieldInput_Date.prototype.setValue=function(){};
AntObject_FieldInput_Date.prototype.getValue=function(){};
function AntObject_FieldInput_Grouping(a,b,c){this.fieldInput=a;var d=new AntObjectGroupingSel("None",a.objType,a.field.name,a.value,a.obj,c);this.sel=d;for(var e=0;e<a.obj.m_filters.length;e++)d.setFilter(a.obj.m_filters[e].fieldName,a.obj.m_filters[e].value);e=null;if("form"==c.mode&&"fkey_multi"==a.field.type){e=alib.dom.createElement("span",b);for(c=0;c<a.value.length;c++){var f=a.value[c],g=f,g=a.obj.getValueName(a.field.name,f);if(""==g||null==g)g=f;for(var h=0;h<a.field.optional_vals.length;h++)a.field.optional_vals[h][0]==
f&&(g=a.field.optional_vals[h][1]);this.addGroupingItem(e,f,g)}}d.getInput();d.print(b);b.inptType="dynselect";b.inpRef=d;d.clsRef=this;d.dv_opt_con=e;d.onSelect=function(){alib.events.triggerEvent(this.clsRef,"change",{value:this.value,valueName:this.valueName,action:"add"});this.dv_opt_con&&this.clsRef.addGroupingItem(this.dv_opt_con,this.value,this.valueName)}}AntObject_FieldInput_Grouping.prototype.setValue=function(){};AntObject_FieldInput_Grouping.prototype.getValue=function(){};
AntObject_FieldInput_Grouping.prototype.addGroupingItem=function(a,b,c){a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"display","inline-block");alib.dom.styleSet(a,"zoom","1");alib.dom.styleSet(a,"*display","inline");alib.dom.styleSet(a,"padding","3px 5px 3px 5px");alib.dom.styleSet(a,"margin-right","5px");alib.dom.styleSet(a,"background-color","#e3e3e3");alib.dom.styleSet(a,"color","#000000");var d=alib.dom.createElement("span",a,c+" | ");if(b==c){var e=new CAjax("json");e.cbData.lblsp=d;
e.onload=function(a){a&&!a.error&&(this.cbData.lblsp.innerHTML=a.title+" ")};e.exec("/controller/Object/getGroupingById",[["obj_type",this.fieldInput.objType],["field",this.fieldInput.field.name],["gid",b]])}d=alib.dom.createElement("a",a);d.href="javascript:void(0);";d.innerHTML="X";d.m_id=b;d.m_label=c;d.m_div=a;d.m_cls=this;d.m_fieldname=this.fieldInput.field.name;d.dynSelObject=this.sel;d.onclick=function(){this.m_div.style.display="none";alib.events.triggerEvent(this.m_cls,"change",{value:this.m_id,
valueName:"",action:"remove"});for(mVar in this.dynSelObject.multiVars)this.m_id==this.dynSelObject.multiVars[mVar]&&delete this.dynSelObject.multiVars[mVar]}};
function AntObject_FieldInput_Number(a,b,c){if(a.field.optional_vals&&a.field.optional_vals.length)return new AntObject_FieldInput_OptionalValues(a,b,c);var d=alib.dom.createElement("input");d.type="text";b.inptType="input";alib.dom.styleSetClass(d,"fancy");c.width?alib.dom.styleSet(d,"width",c.width):alib.dom.styleSet(d,"width","99%");a.value&&(d.value=a.value);"real"==a.field.type&&(d.maxLength=15);b.inpRef=d;b.appendChild(d);d.clsRef=this;d.onchange=function(){alib.events.triggerEvent(this.clsRef,
"change",{value:this.value,valueName:null})}}AntObject_FieldInput_Number.prototype.setValue=function(){};AntObject_FieldInput_Number.prototype.getValue=function(){};function AntObject_FieldInput_Object(a,b,c){this.fieldInput=a;"file"==a.field.subtype?this.renderInputObjectFile(b,c):this.renderInputObject(b,c)}AntObject_FieldInput_Object.prototype.setValue=function(){};AntObject_FieldInput_Object.prototype.getValue=function(){};
AntObject_FieldInput_Object.prototype.renderInputObject=function(a,b){var c=alib.dom.createElement("div",a),d=alib.dom.createElement("label",c);if(this.fieldInput.valueName)this.renderLabel(d,this.fieldInput.valueName);else if(this.fieldInput.value){var e=alib.dom.createElement("span",d,"loading...");if(this.fieldInput.field.subtype)-3==this.fieldInput.value&&"user"==this.fieldInput.field.subtype?e.innerHTML="Me":objectSetNameLabel(this.fieldInput.field.subtype,this.fieldInput.value,e);else{var f=
this.fieldInput.value.split(":");2==f.length&&objectSetNameLabel(f[0],f[1],e)}this.renderLabel(d,e)}else d.innerHTML="None Selected";alib.dom.styleSet(d,"font-size","12px");alib.dom.styleSet(d,"margin-right","10px");this.fieldInput.field.subtype?(d=alib.ui.Button("Select",{className:"b1",clsRef:this,label:d,objType:this.fieldInput.field.subtype,options:b,onclick:function(){var a=new AntObjectBrowser(this.objType);a.cbData.label=this.label;a.cbData.clsRef=this.clsRef;if(this.options.refField&&(this.options.refThis||
b.refValue)){var c=this.options.refValue?this.options.refValue:this.clsRef.fieldInput.obj.getValue(this.options.refThis);c&&a.setFilter(this.options.refField,c)}a.onSelect=function(a,b){this.cbData.clsRef.renderLabel(this.cbData.label,b);alib.events.triggerEvent(this.cbData.clsRef,"change",{value:a,valueName:b})};a.displaySelect()}}),c.appendChild(d.getButton())):(e=new AntObjectTypeSel(this.fieldInput.value),e.render(c),e.cbData.cls=this,e.cbData.label=d,e.cbData.clsRef=this,e.onchange=function(a){var b=
new AntObjectBrowser(a);b.cbData.label=this.cbData.label;b.cbData.clsRef=this.cbData.clsRef;b.onSelect=function(b,c){this.cbData.clsRef.renderLabel(this.cbData.label,c);alib.events.triggerEvent(this.cbData.clsRef,"change",{value:a+":"+b,valueName:c})};b.displaySelect()})};
AntObject_FieldInput_Object.prototype.renderInputObjectFile=function(a,b){var c=alib.dom.createElement("label",a);c.innerHTML=this.fieldInput.value?b.profileImage?'<img src="/antfs/images/'+this.fieldInput.value+"/48\" border='0' />":'<a href="/antfs/'+this.fieldInput.value+'">'+this.fieldInput.valueName+"</a>":b.profileImage?"<img src=\"/images/icons/objects/files/image_48.png\" border='0' />":"None Selected";var d=alib.dom.createElement("div",a);new CDropdownMenu;var e=new alib.ui.PopupMenu,f=new alib.ui.MenuItem("Upload File",
{icon:"<img src='/images/icons/add_10.png' />"});f.cbData.cls=this;f.cbData.label=c;f.cbData.options=b;f.onclick=function(){var a=new AntFsUpload;a.cbData.cls=this.cbData.cls;a.cbData.opts=this.cbData.options;a.cbData.lbl=this.cbData.label;0<this.cbData.options.folderRoot?a.setFolderId(this.cbData.options.folderRoot):this.cbData.cls.fieldInput.obj.id?a.setPath("/System/Objects/"+this.cbData.cls.fieldInput.objType+"/"+this.cbData.cls.fieldInput.obj.id):a.setPath("%tmp%");a.onUploadFinished=function(){var a=
this.getUploadedFile(0);this.cbData.lbl.innerHTML=this.cbData.opts.profileImage?'<img src="/antfs/images/'+a.id+"/48\" border='0' />":'<a href="/antfs/'+a.id+'">'+a.name+"</a>";alib.events.triggerEvent(this.cbData.cls,"change",{value:a.id,valueName:a.name})};a.showDialog()};e.addItem(f);f=new alib.ui.MenuItem("Select Uploaded File",{icon:"<img src='/images/icons/folder_open_10.png' />"});f.cbData.cls=this;f.cbData.label=c;f.cbData.options=b;f.onclick=function(){var a=new AntFsOpen;a.cbData.cls=this.cbData.cls;
a.cbData.opts=this.cbData.options;a.cbData.lbl=this.cbData.label;this.cbData.options.folderRoot&&a.setPathById(this.cbData.options.folderRoot);a.onSelect=function(a,b){this.cbData.lbl.innerHTML=this.cbData.opts.profileImage?'<img src="/antfs/images/'+a+"/48\" border='0' />":'<a href="/antfs/'+a+'">'+b+"</a>";alib.events.triggerEvent(this.cbData.cls,"change",{value:a,valueName:b})};a.showDialog()};e.addItem(f);f=new alib.ui.MenuItem("Remove File",{icon:"<img src='/images/icons/delete_10.png' />"});
f.cbData.cls=this;f.cbData.label=c;f.cbData.options=b;f.onclick=function(){this.cbData.label.innerHTML="None Selected";alib.events.triggerEvent(this.cbData.cls,"change",{value:"",valueName:""})};e.addItem(f);(new alib.ui.MenuButton("change",e,{className:"b1"})).print(d)};
AntObject_FieldInput_Object.prototype.renderLabel=function(a,b){if(b){if("string"==typeof b?a.innerHTML=b:a.appendChild(b),!this.fieldInput.field.required){alib.dom.createElement("span",a,"&nbsp;");var c=alib.dom.createElement("a",a);c.href="javascript:void(0);";c.clsRef=this;c.label=a;c.onclick=function(){alib.events.triggerEvent(this.clsRef,"change",{value:"",valueName:""});this.clsRef.renderLabel(this.label,"")};c.innerHTML="<img src='/images/icons/delete_16.png' />"}}else a.innerHTML="None Selected"};
function AntObject_FieldInput_OptionalValues(a,b){if(a.field.optional_vals&&a.field.optional_vals.length){var c=alib.dom.createElement("select",b);a.buildInputDropDown(c,a.field.optional_vals,a.value)}c.clsRef=this;c.onchange=function(){alib.events.triggerEvent(this.clsRef,"change",{value:this.value,valueName:null})}}AntObject_FieldInput_OptionalValues.prototype.setValue=function(){};AntObject_FieldInput_OptionalValues.prototype.getValue=function(){};
AntObject_FieldInput_OptionalValues.prototype.buildInputDropDown=function(a,b,c,d,e){for(var c=c?c:null,d=d?d:"",e=e?e:"",f=0;f<b.length;f++)b[f][3]==d&&(a[a.length]=new Option(e+b[f][1],b[f][0],!1,c==b[f][0]?!0:!1),b[f][2]&&this.buildInputDropDown(a,b,c,b[f][0],e+"\u00a0\u00a0"))};
function AntObject_FieldInput_Text(a,b,c){if(a.field.optional_vals&&a.field.optional_vals.length)return new AntObject_FieldInput_OptionalValues(a,b,c);c=c||{};if(c.rich){var d=alib.ui.Editor();b.inptType="rte"}else c.multiLine?(d=alib.dom.createElement("textarea"),b.inptType="input"):(d=alib.dom.createElement("input"),d.type="text",b.inptType="input",alib.dom.styleSetClass(d,"fancy"));c.height&&alib.dom.styleSet(d,"height",c.height);c.width&&alib.dom.styleSet(d,"width",c.width);a.value&&!c.rich&&
(d.value=a.value);b.inpRef=d;c.rich?(c.plugins&&"cms"==c.plugins&&(d.cssFiles=["/css/bootstrap.min.css","/css/bootstrap-theme.min.css"]),d.print(b,"100%","250px"),a.value&&d.setValue(a.value)):b.appendChild(d);alib.dom.styleSet(d,"width","99%");c.multiLine&&!c.rich&&alib.dom.textAreaAutoResizeHeight(d,50,400);d.clsRef=this;c.rich?d.onChange=function(){alib.events.triggerEvent(this.clsRef,"change",{value:this.getValue(),valueName:null})}:(c.hidelabel&&(d.placeholder=a.field.title),d.onchange=function(){alib.events.triggerEvent(this.clsRef,
"change",{value:this.value,valueName:null})});this.options=c;this.inp=d}AntObject_FieldInput_Text.prototype.setValue=function(){};AntObject_FieldInput_Text.prototype.getValue=function(){};AntObject_FieldInput_Text.prototype.setHeight=function(a){if(!this.inp)return!1;return this.options.rich&&this.inp.setHeight?(this.inp.setHeight(a),!0):!1};
function AntObject_FieldInput_Timestamp(a,b,c){var d=alib.dom.createElement("input");d.type="text";b.inptType="input";alib.dom.styleSetClass(d,"fancy");c=c||{};c.width&&alib.dom.styleSet(d,"width",c.width);a.value&&(d.value=a.value);b.inpRef=d;b.appendChild(d);"time"==c.part?(new CAutoCompleteTime(d),alib.dom.styleSet(d,"width","75px")):(new CAutoCompleteCal(d),alib.dom.styleSet(d,"width","100px"));c.part&&(d.part=c.part,a.value&&(d.value=a.obj.getInputPartValue(a.field.name,a.value,c.part)));d.clsRef=
this;d.onchange=function(){this.clsRef.triggerChange()};this.fieldCls=a;this.inp=d;this.options=c||{}}AntObject_FieldInput_Timestamp.prototype.setValue=function(){};AntObject_FieldInput_Timestamp.prototype.getValue=function(){};
AntObject_FieldInput_Timestamp.prototype.triggerChange=function(){var a=this.inp.value;"time"==this.options.part?(a=this.fieldCls.obj.getInputPartValue(this.fieldCls.field.name,this.fieldCls.value,"date"),a+=" "+this.inp.value):"date"==this.options.part&&(a=this.inp.value+" ",a+=this.fieldCls.obj.getInputPartValue(this.fieldCls.field.name,this.fieldCls.value,"time"));alib.events.triggerEvent(this,"change",{value:a,valueName:null})};
AntObject_FieldInput_Timestamp.prototype.updateTime=function(){var a=this.fieldCls.obj.getInputPartValue(this.fieldCls.field.name,this.fieldCls.value,"date"),a=a+(" "+this.inp.value);alib.events.triggerEvent(this,"change",{value:a,valueName:null})};AntObject_FieldInput_Timestamp.prototype.updateDate=function(){var a=this.inp.value+" ",a=a+this.fieldCls.obj.getInputPartValue(this.fieldCls.field.name,this.fieldCls.value,"time");alib.events.triggerEvent(this,"change",{value:a,valueName:null})};
function AntObject_FieldValidator(a,b){this.name=a;this.fieldInput=b;this.cbData={}}
AntObject_FieldValidator.prototype.validate=function(a){switch(this.name){case "username":var b=new CDialog,c=alib.dom.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Checking values, please wait...";b.statusDialog(c,150,100);c=new CAjax("json");c.cbData.cls=this;c.cbData.dlg=b;c.onload=function(a){b.hide();if(1==a)this.cbData.cls.onValid();else this.cbData.cls.onInvalid(a)};c.exec("/controller/User/checkUserName",[["name",a],["uid",
this.fieldInput.obj.id]]);break;default:this.onValid()}};AntObject_FieldValidator.prototype.onValid=function(){};AntObject_FieldValidator.prototype.onInvalid=function(){};function spellCheck(a,b){var c=document.forms.spell_form;c.spell_formname.value=a;c.spell_fieldname.value=b;c.spellstring.value=document.forms[a][b].value;openSpellWin(520,480);c.submit();return!0}var wordindex=-1,offsetindex=0,ignoredWords=[];function misp(a,b,c,d){this.word=a;this.start=b;this.end=c;this.suggestions=d}
function replaceWord(){var a=document.fm1,b="",c;0!=misps[wordindex].start&&(b=mispstr.slice(0,misps[wordindex].start+offsetindex));c=mispstr.slice(misps[wordindex].end+1+offsetindex);mispstr=b+a.changeto.value+c;offsetindex+=a.changeto.value.length-misps[wordindex].word.length;misps[wordindex].word=a.changeto.value;nextWord(!1)}
function replaceAll(){var a=document.fm1,b="",c,d,e,f=offsetindex;e=misps[wordindex].word;for(d=wordindex;d<misps.length;d++)misps[d].start+=f,misps[d].end+=f;for(d=f=0;d<misps.length;d++)misps[d].word==e&&(0!=misps[d].start&&(b=mispstr.slice(0,misps[d].start+f)),c=mispstr.slice(misps[d].end+1+f),mispstr=b+a.changeto.value+c,f+=a.changeto.value.length-misps[d].word.length),misps[d].start+=f,misps[d].end+=f;ignoredWords[e]=1;offsetindex=0;nextWord(!1)}
function hilightWord(){var a="",b="";0!=misps[wordindex].start&&(a=mispstr.slice(0,misps[wordindex].start+offsetindex));var b=mispstr.slice(misps[wordindex].end+1+offsetindex),c=iFrameBody;c.innerHTML="";c.innerHTML=a;c.innerHTML+="<span class='hilight' id='h1'>"+misps[wordindex].word+"</span>"+htmlToText(b);c.innerHTML=c.innerHTML.replace(/_\|_/g,"<br>")}function startsp(){nextWord(!1)}function getCorrectedText(){return mispstr}
function xmlSpellAddWord(){var a=null,b="xml_spell_action.awp?act=addword&val="+escape(misps[wordindex].word);window.XMLHttpRequest?a=new XMLHttpRequest:window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP"));a&&(a.onreadystatechange=function(){},a.open("GET",b,!0),a.send(null));nextWord(!0)}
function nextWord(a,b){var c=document.fm1,d=document.fm1.suggestions,e=0,f,g=0;a&&(ignoredWords[misps[wordindex].word]=1);0<=wordindex&&(misps[wordindex].start+=offsetindex,misps[wordindex].end+=offsetindex);wordindex++;if(misps.length<=wordindex||b)return iFrameBody.innerHTML=mispstr,iFrameBody.innerHTML=iFrameBody.innerHTML.replace(/_\|_/g,"<br>"),alert("Spell checking complete."),d&&(clearBox(d),mispstr=mispstr.replace(/_\|_/g,"\n"),window.opener.document.forms[spell_formname][spell_fieldname].value=
mispstr),window.opener.spell_complete(),window.close(),!0;if(1==ignoredWords[misps[wordindex].word])nextWord(!1);else{clearBox(d);if(misps[wordindex].suggestions.length)for(e=0;e<misps[wordindex].suggestions.length;e++)g=0==e?1:0,f=new Option(misps[wordindex].suggestions[e],misps[wordindex].suggestions[e],0,g),d.options[e]=f,g&&(c.changeto.value=misps[wordindex].suggestions[e],c.changeto.select());hilightWord()}}function htmlToText(a){return a}
function clearBox(a){var b=a.length;for(i=0;i<b;i++)a.options[0]=null}function openSpellWin(a,b){window.open("","spellWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no,width="+a+",height="+b+"'")}
function CVideoWizard(a){this.user_id=a;this.template_id=null;this.templates=[];this.video_file_id=this.video_file_name=null;this.video_file_jobid=0;this.f_videoIsTmp=!1;this.logo_file_id=this.logo_file_name=null;this.buttons=[];this.title="My Message";this.subtitle="My Name/title";this.footer=this.message="";this.theme="white";this.save_template_name=null;this.f_template_video=this.save_template_changes="f";this.twitter=this.facebook="";this.steps=[];this.steps[0]="Getting Started";this.steps[1]=
"Upload Video";this.steps[2]="Page Layout";this.steps[3]="Select Theme &amp; Preview Message";this.steps[4]="Save &amp; Finish"}CVideoWizard.prototype.showDialog=function(a){this.parentDlg=a?a:null;this.m_dlg=new CDialog("Video Message Wizard",this.parentDlg);this.m_dlg.f_close=!0;a=this.m_dlg;this.body_dv=alib.dom.createElement("div");a.customDialog(this.body_dv,775,520);this.showStep(0)};
CVideoWizard.prototype.showStep=function(a){this.body_dv.innerHTML="";this.cbTemplates=null;this.verify_step_data={};this.pathDiv=alib.dom.createElement("div",this.body_dv);this.pathDiv.innerHTML="Step "+(a+1)+" of "+this.steps.length+" - "+this.steps[a];alib.dom.styleSetClass(this.pathDiv,"wizardTitle");var b=alib.dom.createElement("div",this.body_dv);alib.dom.styleSetClass(b,"wizardBody");switch(a){case 0:var c=alib.dom.createElement("h3",b);alib.dom.styleSet(c,"margin","5px 0 10px 0");c.innerHTML=
"This wizard will guide you through sending your video message/email";c=alib.dom.createElement("div",b);c.innerHTML="Would you like to:";alib.dom.styleSetClass(c,"formLabel");var d=this.cbTemplates=alib.dom.createElement("select",b);d.size=20;d.style.width="98%";d.cls=this;d.onchange=function(){this.value&&(this.cls.template_id=this.value,this.cls.setTemplate(this.value))};var e=new CButton("Delete Selected Template",function(a,b){a.deleteTemplates(b)},[this,d]);e.disable();var c=alib.dom.createElement("div",
b),f=alib.dom.createElement("input");f.type="radio";f.name="create";f.checked=this.template_id?!1:!0;f.cbTemplates=d;f.btn_delt=e;f.cls=this;f.onchange=function(){d.disabled=!0;this.btn_delt.disable();this.cls.template_id=null};c.appendChild(f);c=alib.dom.createElement("span",c);c.innerHTML=" Create New Video Message";c=alib.dom.createElement("div",b);f=alib.dom.createElement("input");f.type="radio";f.name="create";f.checked=this.template_id?!0:!1;f.cbTemplates=d;f.btn_delt=e;f.onchange=function(){d.disabled=
!1;this.btn_delt.enable()};c.appendChild(f);c=alib.dom.createElement("span",c);c.innerHTML=" Use A Template";f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin","5px 0 3px 0");d.disabled=!0;f.appendChild(d);e.print(f);this.templates.length?this.populateTemplates():this.loadTemplates();break;case 1:c=alib.dom.createElement("h3",b);alib.dom.styleSet(c,"margin","5px 0 10px 0");c.innerHTML="Select a video:. ";c=alib.dom.createElement("h5",b);alib.dom.styleSet(c,"margin","5px 0 10px 0");c.innerHTML=
"We highly recommend the flash (FLV) format but  AVI, WMV, and MPEG files will also work";e=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin","5px 0 3px 0");c=alib.dom.createElement("p",b);c.innerHTML="-- OR --";var c=alib.dom.createElement("a",b),g=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin","5px 0 3px 0");var h=alib.dom.createElement("div",b);alib.dom.styleSetClass(h,"formLabel");alib.dom.styleSet(h,"margin","10px");alib.dom.styleSet(h,"padding","5px");alib.dom.styleSet(h,
"text-align","center");this.video_file_name&&(alib.dom.styleSet(h,"border","1px solid"),h.innerHTML="Selected File: "+this.video_file_name);var k=new AntFsUpload("%tmp%",m_dlg);k.process_function="toflv";k.m_appcls=this;k.div_display=h;k.onUploadStarted=function(){this.m_appcls.wait_uploading=!0};k.onQueueComplete=function(){this.m_appcls.wait_uploading=!1};k.onUploadSuccess=function(a,b,c){this.m_appcls.video_file_id=a;this.m_appcls.video_file_name=b;this.m_appcls.video_file_jobid=c;this.m_appcls.f_videoIsTmp=
!0;alib.dom.styleSet(this.div_display,"border","1px solid");this.div_display.innerHTML="Selected File: "+b};k.showTmpUpload(e,g,"Upload Video",1);e=new AntFsUpload("%tmp%",m_dlg);e.filterType="avi:wmv:mpg:mpeg:m4v:flv:f4v:jpeg:jpg:png:gif";e.m_appcls=this;e.div_display=h;e.onSelect=function(a,b){this.m_appcls.video_file_id=a;this.m_appcls.video_file_name=b;this.m_appcls.f_videoIsTmp=!1;alib.dom.styleSet(this.div_display,"border","1px solid");this.div_display.innerHTML="Selected Video: "+b};c.innerHTML=
"Select a file from ANT File System";c.href="javascript:void(0);";c.cbrowser=e;c.m_dlg=this.m_dlg;c.onclick=function(){this.cbrowser.showDialog(this.m_dlg)};c=alib.dom.createElement("h3",b);alib.dom.styleSet(c,"margin","5px 0 10px 0");c.innerHTML="Select a logo/image (will go next to your title and name): ";c=alib.dom.createElement("a",b);alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin","5px 0 3px 0");b=alib.dom.createElement("div",b);alib.dom.styleSetClass(b,"formLabel");this.logo_file_id&&
(b.innerHTML="<img src='/files/"+this.logo_file_id+"' style='height:70px;' />");e=new AntFsOpen;e.filterType="jpg:jpeg:gif:png";e.cbData.m_appcls=this;e.cbData.div_display=b;e.onSelect=function(a,b){this.cbData.m_appcls.logo_file_id=a;this.cbData.m_appcls.logo_file_name=b;this.cbData.div_display.innerHTML="<img src='/files/"+a+"' style='height:70px;' />"};c.innerHTML="Select a file from ANT File System";c.href="javascript:void(0);";c.cbrowser=e;c.m_dlg=this.m_dlg;c.onclick=function(){this.cbrowser.showDialog(this.m_dlg)};
this.veriftyStep=function(){if(this.video_file_id)return!0;this.verify_step_data.message="Please upload a video file before continuing";return!1};break;case 2:c=alib.dom.createElement("h3",b);alib.dom.styleSet(c,"margin","5px 0 10px 0");c.innerHTML="Build the page you would like your recipient to see when they click to watch your video";f=alib.dom.createElement("div",b);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Page Header / Title:";f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin-bottom",
"5px");e=alib.dom.createElement("input");e.type="text";e.style.width="98%";e.value=this.title;e.cls=this;e.onchange=function(){this.cls.title=this.value};f.appendChild(e);f=alib.dom.createElement("div",b);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Your Name &amp; Title (optional):";f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin-bottom","5px");e=alib.dom.createElement("input");e.type="text";e.style.width="98%";e.value=this.subtitle;e.cls=this;e.onchange=function(){this.cls.subtitle=
this.value};f.appendChild(e);f=alib.dom.createElement("div",b);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Page Footer:";f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin-bottom","5px");e=alib.dom.createElement("input");e.type="text";e.style.width="98%";e.value=this.footer;e.cls=this;e.onchange=function(){this.cls.footer=this.value};f.appendChild(e);f=alib.dom.createElement("div",b);alib.dom.styleSetClass(f,"formLabel");f.innerHTML="Message (optional):";f=alib.dom.createElement("div",
b);alib.dom.styleSet(f,"margin-bottom","5px");e=alib.dom.createElement("textarea");e.style.width="98%";e.style.height="75px";e.value=this.message;e.cls=this;e.onchange=function(){this.cls.message=this.value};f.appendChild(e);f=alib.dom.createElement("div",b);c=alib.dom.createElement("span",f);alib.dom.styleSetClass(c,"formLabel");c.innerHTML="Buttons - these will be to the right of your video:";c=alib.dom.createElement("span",f);c.innerHTML=" (TIP: enter an email address to compose email)";f=alib.dom.createElement("div",
b);alib.dom.styleSet(f,"height","120px");alib.dom.styleSet(f,"border","1px solid");alib.dom.styleSet(f,"overflow","auto");if(this.buttons.length)for(c=0;c<this.buttons.length;c++)this.addButtonRow(f,c);else this.addButtonRow(f),this.addButtonRow(f),this.addButtonRow(f);c=alib.dom.createElement("div",b);alib.dom.styleSet(h,"margin-top","3px");h=alib.dom.createElement("a",c);h.innerHTML="[add button]";h.href="javascript:void(0);";h.dv=f;h.cls=this;h.onclick=function(){this.cls.addButtonRow(this.dv)};
h=alib.dom.createElement("table",b);alib.dom.styleSet(h,"margin-top","5px");h.style.width="98%";var g=alib.dom.createElement("tbody",h),k=alib.dom.createElement("tr",g),l=alib.dom.createElement("td",k),f=alib.dom.createElement("div",b),c=alib.dom.createElement("strong",f);c.innerHTML="Facebook page: ";e=alib.dom.createElement("input");e.type="text";e.style.width="250px";e.value=this.facebook;e.cls=this;e.onchange=function(){this.cls.facebook=this.value};f.appendChild(e);l.appendChild(c);l.appendChild(e);
l=alib.dom.createElement("td",k);c=alib.dom.createElement("strong",f);c.innerHTML=" Twitter url: ";e=alib.dom.createElement("input");e.type="text";e.style.width="250px";e.value=this.twitter;e.cls=this;e.onchange=function(){this.cls.twitter=this.value};f.appendChild(e);l.appendChild(c);l.appendChild(e);k.appendChild(l);h.appendChild(g);break;case 3:f=alib.dom.createElement("div",b);alib.dom.styleSet(f,"margin","5px 0 5px 0");c=alib.dom.createElement("span",f);alib.dom.styleSetClass(c,"formLabel");
c.innerHTML="Select Theme: ";c=alib.dom.createElement("select",f);c[c.length]=new Option("Default","white",!1,"white"==this.theme?!0:!1);c[c.length]=new Option("Red","red",!1,"red"==this.theme?!0:!1);c[c.length]=new Option("Blue","blue",!1,"blue"==this.theme?!0:!1);this.getThemes(c);f=alib.dom.createElement("div",b);b=alib.dom.createElement("iframe",f);alib.dom.styleSet(b,"height","360px");alib.dom.styleSet(b,"width","100%");c.ifrm=b;c.cls=this;c.onchange=function(){this.cls.theme=this.value;this.cls.loadPreview(this.ifrm,
this.value)};this.loadPreview(b,this.theme);break;case 4:f=alib.dom.createElement("h2",b),f.innerHTML="Congratulations!",f=alib.dom.createElement("h3",b),f.innerHTML='Your Video Message is ready to be sent. Click "Finish" below and compose an email message to your desired recipients of this video. They will receive a link to the video.',b=alib.dom.createElement("fieldset",b),alib.dom.styleSet(b,"margin","20px 0 5px 0"),alib.dom.createElement("legend",b).innerHTML="Save Template (optional)",h=alib.dom.createElement("input"),
this.template_id&&(f=alib.dom.createElement("div",b),alib.dom.styleSet(f,"margin","5px 0 5px 0"),c=alib.dom.createElement("span",f),alib.dom.styleSetClass(c,"formLabel"),c.innerHTML="Save Changes: ",e=alib.dom.createElement("input"),e.type="checkbox",e.checked=!1,e.cls=this,e.inp_name=h,e.onclick=function(){this.cls.save_template_changes=this.checked?"t":"f";this.inp_name.disabled=this.checked?!0:!1},f.appendChild(e),c=alib.dom.createElement("span",f),c.innerHTML=" (save the changes I have made to this template)"),
c=alib.dom.createElement("span",b),alib.dom.styleSetClass(c,"formLabel"),c.innerHTML="Save As: ",h.type="text",h.style.width="100px",h.cls=this,h.onchange=function(){this.cls.save_template_name=this.value},b.appendChild(h),c=alib.dom.createElement("span",b),c.innerHTML=" (save settings to re-use later, leave blank if you do not wish to save)",f=alib.dom.createElement("div",b),alib.dom.styleSet(f,"margin","5px 0 5px 0"),c=alib.dom.createElement("span",f),alib.dom.styleSetClass(c,"formLabel"),c.innerHTML=
"Save Video: ",e=alib.dom.createElement("input"),e.type="checkbox",e.cls=this,e.onclick=function(){this.cls.f_template_video=this.checked?"t":"f"},f.appendChild(e),c=alib.dom.createElement("span",f),c.innerHTML=" (use this video any time template is loaded in the future)"}b=alib.dom.createElement("div",this.body_dv);alib.dom.styleSetClass(b,"wizardFooter");f=new CButton("Back",function(a,b){a.showStep(b-1)},[this,a]);f.print(b);0==a&&f.disable();f=a==this.steps.length-1?new CButton("Finish",function(a){a.save()},
[this]):new CButton("Next",function(a,b){a.veriftyStep()?a.showStep(b+1):ALib.Dlg.messageBox(a.verify_step_data.message,a.m_dlg)},[this,a],"b2");f.print(b);f=new CButton("Cancel",function(a){a.hide()},[this.m_dlg],"b3");f.print(b)};CVideoWizard.prototype.veriftyStep=function(){return!0};CVideoWizard.prototype.onCancel=function(){};CVideoWizard.prototype.onFinished=function(){};
CVideoWizard.prototype.addButtonRow=function(a,b){"undefined"==typeof b&&(b=this.buttons.length,this.buttons[b]={},this.buttons[b].id=b,this.buttons[b].label="Button "+(b+1),this.buttons[b].link="");var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin","3px");var d=alib.dom.createElement("span",c);d.innerHTML="Button label ";d=alib.dom.createElement("input");d.setAttribute("maxLength",32);d.type="text";d.style.width="100px";d.cls=this;d.button=this.buttons[b];d.value=this.buttons[b].label;
d.onchange=function(){this.button.label=this.value};c.appendChild(d);d=alib.dom.createElement("span",c);d.innerHTML=" link ";d=alib.dom.createElement("input");d.type="text";d.style.width="200px";d.cls=this;d.button=this.buttons[b];d.value=this.buttons[b].link;d.onchange=function(){this.button.link=this.value};c.appendChild(d);d=alib.dom.createElement("span",c);d.innerHTML="&nbsp;";d=alib.dom.createElement("a",c);d.innerHTML="[remove]";d.href="javascript:void(0);";d.thiscon=c;d.parentcon=a;d.bid=this.buttons[b].id;
d.cls=this;d.onclick=function(){for(var a=0;a<this.cls.buttons.length;a++)this.cls.buttons[a].id==this.bid&&this.cls.buttons.splice(a,1);this.parentcon.removeChild(this.thiscon)}};
CVideoWizard.prototype.loadPreview=function(a,b){var c="/email/vmail_player.php?title="+(this.title?escape(this.title):"Untitled");this.subtitle&&(c+="&subtitle="+escape(this.subtitle));this.video_file_id&&(c+="&video_file_id="+escape(this.video_file_id));this.logo_file_id&&(c+="&logo_file_id="+escape(this.logo_file_id));this.video_file_jobid&&(c+="&video_file_jobid="+escape(this.video_file_jobid));for(var d=0;d<this.buttons.length;d++)c+="&buttons[]="+escape(this.buttons[d].label)+"|"+escape(this.buttons[d].link);
this.message&&(c+="&message="+escape(this.message));this.footer&&(c+="&footer="+escape(this.footer));b&&(c+="&theme="+escape(b));this.facebook&&(c+="&facebook="+escape(this.facebook));this.twitter&&(c+="&twitter="+escape(this.twitter));a.src=c};
CVideoWizard.prototype.save=function(){for(var a=[["video_file_id",this.video_file_id],["logo_file_id",this.logo_file_id],["title",this.title],["subtitle",this.subtitle],["message",this.message],["footer",this.footer],["theme",this.theme],["save_template_name",this.save_template_name],["f_template_video",this.f_template_video],["template_id",this.template_id],["save_template_changes",this.save_template_changes],["facebook",this.facebook],["twitter",this.twitter],["f_video_is_tmp",this.f_videoIsTmp?
"t":"f"]],b=0;b<this.buttons.length;b++)a[a.length]=["buttons[]",this.buttons[b].label+"|"+this.buttons[b].link];this.m_dlg.hide();var b=new CDialog,c=document.createElement("div");alib.dom.styleSetClass(c,"statusAlert");alib.dom.styleSet(c,"text-align","center");c.innerHTML="Preparing message, please wait...";b.statusDialog(c,250,100);ajax=new CAjax("json");ajax.cls=this;ajax.dlg=b;ajax.onload=function(a){if(!a.error)this.cls.onFinished(a,this.cls.message);this.dlg.hide()};ajax.exec("/controller/Email/saveVideoMail",
a)};CVideoWizard.prototype.loadTemplates=function(){ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){if(a.length)for(template in a)this.cls.templates[this.cls.templates.length]=a[template];cls.populateTemplates()};ajax.exec("/controller/Email/getVmailTemplates")};
CVideoWizard.prototype.getThemes=function(a){ajax=new CAjax("json");ajax.cls=this;ajax.sel=a;ajax.onload=function(a){if(a.length)for(theme in a){var c=a[theme],d=c.id;this.sel[this.sel.length]=new Option(c.name,d,!1,this.cls.theme==d?!0:!1)}};ajax.exec("/controller/Email/getVmailThemes")};
CVideoWizard.prototype.populateTemplates=function(){if(this.cbTemplates)for(var a=0;a<this.templates.length;a++){var b=this.templates[a];this.cbTemplates[this.cbTemplates.length]=new Option(b.name,b.id,!1,b.id==this.template_id?!0:!1)}};
CVideoWizard.prototype.setTemplate=function(a){for(var b=0;b<this.templates.length;b++)if(this.templates[b].id==a){this.title=this.templates[b].title;this.video_file_id=this.templates[b].file_id;this.video_file_name=this.templates[b].file_name;this.logo_file_id=this.templates[b].logo_file_id;this.logo_file_name=this.templates[b].logo_file_name;this.subtitle=this.templates[b].subtitle;this.message=this.templates[b].message;this.facebook=this.templates[b].facebook;this.twitter=this.templates[b].twitter;
this.name=this.templates[b].name;this.footer=this.templates[b].footer;this.theme=this.templates[b].theme;this.buttons=[];for(a=0;a<this.templates[b].buttons.length;a++)this.buttons[a]={},this.buttons[a].id=this.templates[b].buttons[a].id,this.buttons[a].label=this.templates[b].buttons[a].label,this.buttons[a].link=this.templates[b].buttons[a].link;break}};
CVideoWizard.prototype.deleteTemplates=function(a){var b=[["tid",a.value]];ajax=new CAjax("json");ajax.cbTemplates=a;ajax.onload=function(a){if(!a.error)for(a=0;a<this.cbTemplates.options.length;a++)this.cbTemplates.options[a].selected&&(this.cbTemplates.options[a]=null)};ajax.exec("/controller/Email/deleteVmailTemplate",b)};
function AntWizard(a,b){this.subclass=null;this.steps=[];this.nStep=0;this.wizardClassName=a;this.title="Wizard";this.processing=this.showOnLoad=this.loading=!1;this.processingSuccess=!0;this.processingTimer=null;this.cbData=b||{};this.showPath=!0;this.width=820;a&&this.loadSubclass(a)}AntWizard.prototype.onFinished=function(){};AntWizard.prototype.onCancel=function(){};AntWizard.prototype.addStep=function(a,b){var c={};c.callback=a;c.title=b;this.steps.push(c)};AntWizard.prototype.nextStep=function(){this.showStep(this.nStep)};
AntWizard.prototype.setWizardSubclass=function(){this.subclass=eval("new AntWizard_"+this.wizardClassName+"();");this.subclass.setup(this);this.loading=!1;this.showOnLoad&&(this.showOnLoad=!1,this.show(this.parentDlg))};
AntWizard.prototype.loadSubclass=function(a){var b=a.split("_");if(2==b.length)var c=b[0],d=b[1];1==b.length&&(c="",d=b[0]);b="/wizards";c&&(b+="/"+c);b+="/"+d+".js";document.getElementById("js_wiz_"+a)?this.setWizardSubclass():(this.loading=!0,c=document.createElement("script"),c.wizardClassName=a,c.wizard=this,alib.userAgent.ie?c.onreadystatechange=function(){("complete"==this.readyState||"loaded"==this.readyState)&&this.wizard.setWizardSubclass()}:c.onload=function(){this.wizard.setWizardSubclass()},
c.type="text/javascript",c.id="js_wiz_"+a,c.src=b,document.getElementsByTagName("head")[0].appendChild(c))};AntWizard.prototype.show=function(a){this.parentDlg=a?a:null;this.loading?this.showOnLoad=!0:(this.dlg=new CDialog(this.title,this.parentDlg),this.dlg.f_close=!0,this.bodyDiv=alib.dom.createElement("div"),this.dlg.customDialog(this.bodyDiv,this.width,555),0<this.steps.length&&this.showStep(0))};AntWizard.prototype.hide=function(){this.dlg.hide()};
AntWizard.prototype.showStep=function(a){if(!this.subclass)return!1;if(this.processing){this.processingTimer&&window.clearTimeout(this.processingTimer);var b=this;this.processingTimer=window.setTimeout(function(){b.showStep(a)},1E3);return!0}if(!this.processingSuccess)return!1;var c=!1;this.nStep>a&&(c=!0);this.bodyDiv.innerHTML="";this.nStep=a+1;this.processing=!1;this.processingSuccess=!0;this.subclass.processStep=function(){return!0};c&&"function"==typeof this.subclass.processBackStep&&this.subclass.processBackStep();
this.pathDiv=alib.dom.createElement("div",this.bodyDiv);this.pathDiv.innerHTML="Step "+(a+1)+" of "+this.steps.length+" - "+this.steps[a].title;alib.dom.styleSetClass(this.pathDiv,"wizardTitle");this.showPath||alib.dom.styleSet(this.pathDiv,"display","none");c=alib.dom.createElement("div",this.bodyDiv);alib.dom.styleSetClass(c,"wizardBody");this.steps[a].callback(c);"function"==typeof this.subclass.processPostStep&&this.subclass.processPostStep();c=alib.dom.createElement("div",this.bodyDiv);alib.dom.styleSet(c,
"margin-top","8px");alib.dom.styleSet(c,"text-align","right");if(this.saveAndFinishLater){var d=alib.ui.Button("Save & Finish Later",{className:"b1",tooltip:"Save changes to finish at a later time",cls:this,step:a,onclick:function(){this.cls.saveAndFinishLater(this.step);this.cls.hide();this.cls.onCancel()}});d.print(c)}0<a&&(d=alib.ui.Button("Back",{className:"b1",tooltip:"Go back one step",cls:this,step:a,onclick:function(){this.cls.showStep(this.step-1)}}),d.print(c));a==this.steps.length-1?(d=
alib.ui.Button("Finished",{className:"b2",tooltip:"Finish and close wizard",cls:this,onclick:function(){this.cls.hide();this.cls.onFinished()}}),d.print(c)):(d=alib.ui.Button("Continue",{className:"b2",tooltip:"Continue to next step",cls:this,step:a,onclick:function(){this.cls.subclass.processStep()?this.cls.showStep(this.step+1):alib.Dlg.messageBox(this.cls.subclass.lastErrorMessage,this.cls.dlg)}}),d.print(c),alib.ui.Button("Cancel",{className:"b1",tooltip:"Cancel Wizard",cls:this,dlg:this.dlg,
onclick:function(){confirm("Are you sure you want to cancel the wizard?")&&(this.cls.hide(),this.cls.onCancel(),"function"==typeof this.cls.refresh&&this.cls.refresh())}}).print(c))};AntWizard.prototype.setProcessing=function(){this.processing=!0};AntWizard.prototype.setProcessingFinished=function(a){this.processingSuccess="undefined"!=typeof a?a:!0;this.processing=!1};AntWizard.prototype.getCurrentStep=function(){return this.nStep};AntWizard.prototype.saveAndFinishLater=null;
function WorkflowWizard(a,b){a&&b?(this.g_wid=b,this.g_workflow=new WorkFlow(this.g_wid),this.g_workflow.object_type=a,this.g_workflow.cls=this,this.g_workflow.onload=function(){this.cls.showStep(0)},this.g_workflow.load()):(this.g_workflow=new WorkFlow,this.g_workflow.object_type=null,this.g_workflow.name="My Workflow",this.g_workflow.notes="Place notes here");this.g_tblTasks=new CToolTable("100%");this.g_theme="undefined"!=typeof Ant?Ant.theme.name:"cheery";this.g_objTypes=[];this.getObjects();
this.buildActionTbl=!0;this.steps=[];this.steps[0]="Workflow Description";this.steps[1]="Workflow Conditions";this.steps[2]="Workflow Actions";this.steps[3]="Finished"}
WorkflowWizard.prototype.showDialog=function(a){var b=null==this.g_workflow.object_type?"Create Workflow":"Edit Workflow";this.parentDlg=a?a:null;this.m_dlg=new CDialog(b,this.parentDlg);this.m_dlg.f_close=!0;a=this.m_dlg;this.body_dv=alib.dom.createElement("div");a.customDialog(this.body_dv,820,550);this.body_dv.innerHTML="<div class='loading'></div>";null==this.g_workflow.object_type&&this.showStep(0)};
WorkflowWizard.prototype.showStep=function(a){this.body_dv.innerHTML="";this.verify_step_data={};this.nextStep=a+1;this.pathDiv=alib.dom.createElement("div",this.body_dv);this.pathDiv.innerHTML="Step "+(a+1)+" of "+this.steps.length+" - "+this.steps[a];alib.dom.styleSetClass(this.pathDiv,"wizardTitle");var b=alib.dom.createElement("div",this.body_dv);alib.dom.styleSetClass(b,"wizardBody");switch(a){case 0:this.buildDescription(b);this.veriftyStep=function(){if(this.g_workflow.object_type)return!0;
this.verify_step_data.message="Object Type not specified! Please select an Object Type.";return!1};break;case 1:this.buildConditions(b);break;case 2:this.buildActions(b);break;case 3:b.innerHTML="<h2>Congratulations, your workflow has been created!</h2>Click 'Save Workflow' below to save changes and continue working."}b=alib.dom.createElement("div",this.body_dv);alib.dom.styleSet(b,"text-align","right");var c=new CButton("Back",function(a,b){1==b&&a.updateConditions();a.showStep(b-1)},[this,a],"b1");
c.print(b);0==a&&c.disable();c=a==this.steps.length-1?new CButton("Save Workflow",function(a){a.save()},[this],"b2"):new CButton("Continue",function(a,b){a.veriftyStep()?(1==b&&a.updateConditions(),a.showStep(b+1)):ALib.Dlg.messageBox(a.verify_step_data.message,a.m_dlg)},[this,a],"b2");c.print(b);c=new CButton("Cancel",function(a,b){b.cancel()},[this.m_dlg,this],"b3");c.print(b)};WorkflowWizard.prototype.veriftyStep=function(){return!0};
WorkflowWizard.prototype.buildDescription=function(a){var a=alib.dom.createElement("div",a),b=alib.dom.createElement("p",a);alib.dom.styleSetClass(b,"info");b.innerHTML="Welcome to the workflow wizard. Workflows automate both simple and complex tasks like 'if a lead gets updated by someone other than the owner, send the owner an email notifying them of the change' or 'if an opportunity is older than 30 days and has not been contacted, email a manager.' This wizard will guide you through the steps needed to create powerful automated workflows.";
var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin","10px 0px 3px 0px");b=alib.dom.createElement("div",c,"Name");alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","75px");alib.dom.styleSet(b,"margin-top","5px");alib.dom.styleSetClass(b,"strong");b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"margin-left","80px");c=alib.dom.createElement("input");c.cls=this;c.type="text";alib.dom.styleSet(c,"width","98%");c.onchange=function(){this.cls.g_workflow.name=this.value};
b.appendChild(c);this.g_workflow.name&&(c.value=this.g_workflow.name);c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin","3px 0px 3px 0px");b=alib.dom.createElement("div",c,"Description");alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","75px");alib.dom.styleSet(b,"margin-top","5px");alib.dom.styleSetClass(b,"strong");b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"margin-left","80px");c=alib.dom.createElement("textarea");c.cls=this;alib.dom.styleSet(c,"width","98%");
c.onchange=function(){this.cls.g_workflow.notes=this.value};b.appendChild(c);this.g_workflow.notes&&(c.value=this.g_workflow.notes);c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin","3px 0px 3px 0px");b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","75px");alib.dom.styleSet(b,"margin-top","5px");alib.dom.styleSetClass(b,"strong");b.innerHTML="Object Type";b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"margin-left","80px");c=alib.dom.createElement("select");
c.cls=this;c.onchange=function(){""!=this.value&&(this.cls.g_workflow.object_type=this.value)};c[c.length]=new Option("Select Object Type","");if(this.g_objTypes)for(object in this.g_objTypes){var d=this.g_objTypes[object];c[c.length]=new Option(d.title,d.name)}b.appendChild(c);this.g_workflow.object_type&&(c.value=this.g_workflow.object_type);alib.dom.createElement("span",b," select the type of object this workflow will be working with");c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin",
"3px 0px 3px 0px");b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","75px");alib.dom.styleSet(b,"margin-top","5px");alib.dom.styleSetClass(b,"strong");b.innerHTML="Published";b=alib.dom.createElement("div",c);alib.dom.styleSet(b,"margin-left","80px");d=alib.dom.createElement("input",b);d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fActive;d.onchange=function(){this.cls.g_workflow.fActive=this.checked};alib.dom.createElement("span",b," if checked this workflow is active and will execute when conditions are met");
alib.dom.createElement("br",a);b=new CWindowFrame("Start Workflow When");b.print(a);b=b.getCon();c=alib.dom.createElement("div",b);d=alib.dom.createElement("input");d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fOnCreate;d.onchange=function(){this.cls.g_workflow.fOnCreate=this.checked};c.appendChild(d);c.appendChild(document.createTextNode("An object is first created"));var c=alib.dom.createElement("div",b),e=alib.dom.createElement("input");e.cls=this;e.type="checkbox";e.checked=this.g_workflow.fOnUpdate;
e.onchange=function(){this.cls.g_workflow.fOnUpdate=this.checked};c.appendChild(e);c.appendChild(document.createTextNode("An object is updated/changed (conditions for update will be set later)"));c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"margin-left","20px");d=alib.dom.createElement("input",c);d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fConditionUnmet;d.disabled=this.g_workflow.fOnUpdate?!1:!0;d.onchange=function(){this.cls.g_workflow.fConditionUnmet=this.checked};alib.dom.createElement("span",
c,"Only if conditions are previously unmet");alib.events.listen(e,"click",function(a){a.data.subCond.disabled=this.checked?!1:!0},{subCond:d});c=alib.dom.setElementAttr(alib.dom.createElement("img",c),[["src","/images/icons/help_12.png"]]);alib.dom.styleSet(c,"cursor","help");alib.dom.styleSet(c,"margin-left","3px");alib.ui.Tooltip(c,"Use this option for launching workflows on the update of an object if and only if the properties have changed to make it match the conditions for this workflow. An example would be sending an email notification the first time a lead is assigned to a user, but after that subsequent updates will not cause notifications to be sent.",
!0);c=alib.dom.createElement("div",b);d=alib.dom.createElement("input");d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fOnDelete;d.onchange=function(){this.cls.g_workflow.fOnDelete=this.checked};c.appendChild(d);c.appendChild(document.createTextNode("An object is deleted"));c=alib.dom.createElement("div",b);d=alib.dom.createElement("input");d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fOnDaily;d.onchange=function(){this.cls.g_workflow.fOnDaily=this.checked};c.appendChild(d);c.appendChild(document.createTextNode("Check daily if there are any objects matching the conditions for this workflow. Example use: send email to any customers if their birthday is today."));
b=new CWindowFrame("Options",null,"3px");b.print(a);a=b.getCon();c=alib.dom.createElement("div",a);d=alib.dom.createElement("input");d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fSingleton;d.onchange=function(){this.cls.g_workflow.fSingleton=this.checked};c.appendChild(d);c.appendChild(document.createTextNode("Only allow one instance of this workflow per object at a time. Make sure longer running and complex workflows do not overlap."));c=alib.dom.createElement("div",a);d=alib.dom.createElement("input");
d.cls=this;d.type="checkbox";d.checked=this.g_workflow.fAllowManual;d.onchange=function(){this.cls.g_workflow.fAllowManual=this.checked};c.appendChild(d);c.appendChild(document.createTextNode("Allow user to manually start workflow"))};
WorkflowWizard.prototype.buildConditions=function(a){this.g_antObject=new CAntObject(this.g_workflow.object_type);var b=alib.dom.createElement("p",a);alib.dom.styleSetClass(b,"info");b.innerHTML="Use the form below to set any condtions required in order for this workflow to start. For example: if you only want a workflow to launch if a sales opportunity status was changed from 'Open' to 'Lost,' then you would add a condition below ['And' 'Status' 'is equal' 'Lost'] which would make sure the workflow only starts when those conditions are met. You can add multiple conditions if desired. If this workflow should launch on all objects without condition then just continue on to the next step.";a=
alib.dom.createElement("div",a);alib.dom.styleSet(a,"margin","3px 0px 3px 0px");var b=new CWindowFrame("Only start if the following conditions are met",null,"3px"),c=b.getCon();b.print(a);this.g_conditions=this.g_antObject.buildAdvancedQuery(c,this.g_workflow.conditions)};
WorkflowWizard.prototype.updateConditions=function(){this.g_workflow.delConditions();for(var a=0;a<this.g_conditions.getNumConditions();a++){var b=this.g_conditions.getCondition(a);this.g_workflow.addCondition(b.blogic,b.fieldName,b.operator,b.condValue,b.condId)}};
WorkflowWizard.prototype.buildActions=function(a){var b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"margin","3px 0px 3px 0px");var c=new CWindowFrame("Set actions to be performed by this workflow once started"),a=c.getCon();c.print(b);b=new WorkFlow_ActionsGrid(this.g_workflow);b.parentDlg=this.m_dlg;b.print(a)};
WorkflowWizard.prototype.buildActionsTbl=function(a){this.g_tblTasks.clear();this.buildActionTbl&&(this.g_tblTasks.addHeader("Name"),this.g_tblTasks.addHeader("Do"),this.g_tblTasks.addHeader("When"),this.g_tblTasks.addHeader("Condition"),this.g_tblTasks.addHeader("Delete","center","50px"));this.g_tblTasks.print(a);this.buildActionTbl=!1;for(var b=0;b<this.g_workflow.getNumTasks();b++)this.addAction(this.g_workflow.getTasks(b));a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"padding","3px");
b=new CDropdownMenu;b.addEntry("Send Email",function(a){a.editAction(null,WF_ATYPE_SENDEMAIL)},null,null,[this]);b.addEntry("Create Task",function(a){a.editAction(null,WF_ATYPE_CREATEOBJ,"task")},null,null,[this]);b.addEntry("Create Invoice",function(a){a.editAction(null,WF_ATYPE_CREATEOBJ,"invoice")},null,null,[this]);b.addEntry("Update Field",function(a){a.editAction(null,WF_ATYPE_UPDATEFLD)},null,null,[this]);b.addEntry("Start Child Workflow",function(a){a.editAction(null,WF_ATYPE_STARTCHLD)},
null,null,[this]);a.appendChild(b.createButtonMenu("Add Action"))};
WorkflowWizard.prototype.addAction=function(a){var b=this.g_tblTasks.addRow(),c=alib.dom.createElement("a");c.href="javascript:void(0);";c.act=a;c.cls=this;c.onclick=function(){this.cls.editAction(this.act,this.act.type,this.act.create_obj)};c.innerHTML=a.name;b.addCell(c);b.addCell(a.getTypeDesc());b.addCell(a.getWhenDesc());b.addCell(a.getCondDesc());c=alib.dom.createElement("div");b.addCell(c,!0,"center");c.innerHTML="<img border='0' src='/images/themes/"+this.g_theme+"/icons/deleteTask.gif' />";
alib.dom.styleSet(c,"cursor","pointer");c.cls=this;c.m_rw=b;c.m_id=a.id;c.onclick=function(){var a=new CDialog("Remove Action",this.cls.m_dlg),b=alib.dom.createElement("div");a.customDialog(b,260,40);var c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"text-align","center");c.innerHTML="Are you sure you want to remove this action?";b.appendChild(c);b=alib.dom.createElement("div",b);alib.dom.styleSet(b,"text-align","right");c=new CButton("Yes",function(a,b,c,d){a.hide();c.deleteRow();b.g_workflow.delActionById(d)},
[a,this.cls,this.m_rw,this.m_id],"b1");c.print(b);c=new CButton("No",function(a){a.hide()},[a],"b1");c.print(b)}};
WorkflowWizard.prototype.editAction=function(a,b,c){var d=a?a:new WorkFlow_Action(g_workflow),e,f=new CDialog(a?"Edit Action":"Create New Action",this.m_dlg);f.f_close=!0;var g=alib.dom.createElement("div");f.customDialog(g,560,500);var h=alib.dom.createElement("table",g),k=alib.dom.createElement("tbody",h);e=alib.dom.createElement("tr",k);h=alib.dom.createElement("td",e);alib.dom.styleSetClass(h,"formLabel");h.innerHTML="Name";h=alib.dom.createElement("td",e);e=alib.dom.createElement("input",h);
e.m_task_obj=d;e.value=d.name;e.onchange=function(){this.m_task_obj.name=this.value};e=alib.dom.createElement("span",h);e.innerHTML="&nbsp;give this action a unique name";e=alib.dom.createElement("tr",k);h=alib.dom.createElement("td",e);alib.dom.styleSetClass(h,"formLabel");h.innerHTML="When";h=alib.dom.createElement("td",e);k=alib.dom.createElement("input",h);alib.dom.styleSet(k,"width","14px");k.m_task_obj=d;k.value=d.when.interval;k.onchange=function(){this.m_task_obj.when.interval=this.value};
e=alib.dom.createElement("span",h);e.innerHTML="&nbsp;";k=alib.dom.createElement("select",h);e=wfGetTimeUnits();for(var l=0;l<e.length;l++)k[k.length]=new Option(e[l][1],e[l][0],!1,d.when.unit==e[l][0]?!0:!1);k.m_task_obj=d;k.onchange=function(){this.m_task_obj.when.unit=this.value};e=alib.dom.createElement("span",h);e.innerHTML=" after workflow starts (enter 0 for immediate)";e=alib.dom.createElement("div",g);alib.dom.styleSetClass(e,"formLabel");alib.dom.styleSet(e,"margin","6px 0px 3px 3px");e.innerHTML=
"If the following conditions are met:";h=alib.dom.createElement("div",g);h=(new CAntObject(this.g_workflow.object_type)).buildAdvancedQuery(h,d.conditions);switch(b){case WF_ATYPE_SENDEMAIL:(new WorkFlow_Action_Email(this.g_workflow.object_type)).taskSendEmail(g,d);break;case WF_ATYPE_UPDATEFLD:this.actUpdateField(g,d);break;case WF_ATYPE_STARTCHLD:this.actChildWf(g,d);break;default:"task"==c&&(new WorkFlow_Action_Task(this.g_workflow.object_type)).taskCreateTask(g,d),"invoice"==c&&(new WorkFlow_Action_Invoice(this.g_workflow.object_type)).taskCreateInvoice(g,
d)}b=alib.dom.createElement("div",g);alib.dom.styleSet(b,"margin","6px 0px 3px 3px");a=new CButton("Save",function(a,b,c,d,e){b.hide();a.saveTask(c,d,e)},[this,f,d,h,a?!1:!0],"b2");a.print(b);a=new CButton("Cancel",function(a){a.hide()},[f],"b1");a.print(b)};
WorkflowWizard.prototype.actUpdateField=function(a,b){var c=alib.dom.createElement("fieldset",a);alib.dom.styleSet(c,"margin","6px 0px 3px 3px");var d=alib.dom.createElement("legend",c);d.innerHTML="Update Field";d=alib.dom.createElement("div",c);d.innerHTML="Change: ";var e=alib.dom.createElement("select",d),d=alib.dom.createElement("div",c);d.innerHTML="To: ";c=alib.dom.createElement("span",d);d=new CAntObject(this.g_workflow.object_type);e.m_task_obj=b;e.m_inp_con=c;e.m_ant_obj=d;e.onchange=function(){if(-1!=
this.value.indexOf(".")){var a=this.value.split(".");3==a.length&&(this.m_task_obj.frm_changeto=(new CAntObject(a[1])).fieldCreateValueInput(this.m_inp_con,a[2]))}else this.m_task_obj.frm_changeto=this.m_ant_obj.fieldCreateValueInput(this.m_inp_con,this.value);this.m_task_obj.update_field=this.value};for(var f=d.getFields(),g=0;g<f.length;g++)if(e[e.length]=new Option(f[g].title,f[g].name,!1,b.update_field==f[g].name?!0:!1),"object"==f[g].type)if(f[g].subtype)for(var h=new CAntObject(f[g].subtype),
k=h.getFields(),l=0;l<k.length;l++){var m=f[g].name+"."+h.name+"."+k[l].name;e[e.length]=new Option(f[g].title+"."+k[l].title,m,!1,b.update_field==m?!0:!1)}else for(var n=0;n<this.g_objTypes.length;n++)if(this.g_objTypes[n][0]!=d.name){h=new CAntObject(this.g_objTypes[n][0]);k=h.getFields();for(l=0;l<k.length;l++)m=f[g].name+"."+h.name+"."+k[l].name,e[e.length]=new Option(f[g].title+"."+h.title+"."+k[l].title,m,!1,b.update_field==m?!0:!1)}b.frm_changeto=d.fieldCreateValueInput(c,b.update_field?b.update_field:
f[0].name,b.update_to)};
WorkflowWizard.prototype.actChildWf=function(a,b){b.type=WF_ATYPE_STARTCHLD;var c=alib.dom.createElement("div",a);alib.dom.styleSetClass(c,"formLabel");alib.dom.styleSet(c,"margin","6px 0px 3px 3px");c.innerHTML="Select a child workflow to launch:";var c=alib.dom.createElement("div",a),d=alib.dom.createElement("select",c);d.size=20;d.style.width="98%";d.task_obj=b;d.onchange=function(){this.task_obj.start_wfid=this.value};c=new CAjax;c.workflows=d;c.task_obj=b;c.onload=function(a){if(a.length)for(workflow in a){var b=a[workflow],
c=b.name,d=b.id;"t"==b.f_active&&(this.workflows[this.workflows.length]=new Option(c,d,!1,d==this.task_obj.start_wfid?!0:!1))}};d=[];d[d.length]=["otypes",this.g_workflow.object_type];c.exec("/controller/Workflow/getWorkflow",d)};WorkflowWizard.prototype.saveTask=function(a,b,c){a.delConditions();for(var d=0;d<b.getNumConditions();d++){var e=b.getCondition(d);a.addCondition(e.blogic,e.fieldName,e.operator,e.condValue)}a.frm_changeto&&(a.update_to=a.frm_changeto.value);c&&(this.addAction(a),this.g_workflow.addAction(a))};
WorkflowWizard.prototype.getObjects=function(){this.g_objTypes||(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.onload=function(a){a?this.cbData.cls.g_objTypes=a:ALib.statusShowAlert("Error occured while loading objects!",5E3,"bottom","right")},ajax.exec("/controller/Object/getObjects"))};
WorkflowWizard.prototype.cancel=function(){var a=new CDialog("Close Workflow",this.m_dlg),b=alib.dom.createElement("div");a.customDialog(b,260);var c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"text-align","center");c.innerHTML="Are you sure you want to close this workflow?";b.appendChild(c);b=alib.dom.createElement("div",b);alib.dom.styleSet(b,"text-align","right");c=new CButton("Yes",function(a,b){b.hide();a.m_dlg.hide()},[this,a],"b1");c.print(b);c=new CButton("No",function(a){a.hide()},
[a],"b1");c.print(b)};
WorkflowWizard.prototype.save=function(){var a=new CDialog;a.parentDlg=this.m_dlg;var b=document.createElement("div");alib.dom.styleSetClass(b,"statusAlert");alib.dom.styleSet(b,"text-align","center");b.innerHTML="Saving, please wait...";a.statusDialog(b,150,100);this.g_workflow.dlg=a;this.g_workflow.cls=this;this.g_workflow.onsave=function(){this.dlg.hide();ALib.statusShowAlert("Workflow Saved!",3E3,"bottom","right");this.cls.m_dlg.hide();this.cls.onsave()};this.g_workflow.onsaveError=function(){this.dlg.hide();
ALib.statusShowAlert("ERROR SAVING WORKFLOW!",3E3,"bottom","right")};this.g_workflow.save()};WorkflowWizard.prototype.onsave=function(){};function CWidWelcome(){this.title="Welcome";this.m_container=null;this.m_image=new Image;this.appNavname=null}
CWidWelcome.prototype.main=function(){Ant.setHinst(this,"/widgets/welcome");this.mdiv=ALib.m_document.createElement("div");this.m_container.appendChild(this.mdiv);this.mdiv.id="wWelcomeMsgBoard";this.mdiv.style.height="130px";this.mdiv.style.padding="3px;";this.mdiv.align="right";this.loadMessage(this.mdiv);this.loadImage();var a=this.m_dm.addSubmenu("Change Text Color"),b=[["Black","000000"],["Aqua","00FFFF"],["Blue","0000FF"],["DarkSlate Blue","483D8B"],["Midnite Blue","191970"],["Fuchia","FF00FF"],
["Yellow","FFFF00"],["Green","008000"],["Army Green","45463E"],["Lime","00FF00"],["Maroon","800000"],["Navy","000080"],["Olive","808000"],["Purple","800080"],["Mild Purple","3A58BA"],["Lite Purple","666699"],["Dark Purple","5B005B"],["Silver","C0C0C0"],["Teal","008080"],["White","FFFFFF"],["Gray","808080"],["Level 2 Grey","333"],["Level 3 Grey","666"],["Level 4 Grey","999"]];funct=function(a,b){a.setTextColor(b,!0)};for(var c=0;c<b.length;c++)a.addEntry(b[c][0],funct,null,"<div style='width:9px;height:9px;background-color:#"+
b[c][1]+"'></div>",[this,b[c][1]]);this.m_dm.addEntry("Use Default Background",function(a){a.changeImage("default")},"/images/themes/"+Ant.m_theme+"/icons/taskIcon.gif",null,[this]);this.m_dm.addEntry("Use Custom Background",function(a){var b=new AntFsOpen;b.filterType="jpg:jpeg:png:gif";b.cbData.m_cls=a;b.onSelect=function(a){this.cbData.m_cls.changeImage(a)};b.showDialog()},"/images/themes/"+Ant.m_theme+"/icons/taskIcon.gif",null,[this]);this.m_dm.addEntry("Remove Background (blank)",function(a){a.changeImage("none")},
"/images/themes/"+Ant.m_theme+"/icons/taskIcon.gif",null,[this])};CWidWelcome.prototype.exit=function(){Ant.clearHinst("/widgets/welcome");this.m_container.innerHTML=""};
CWidWelcome.prototype.loadMessage=function(a){var b=ALib.m_document.createElement("div");alib.dom.styleSet(b,"font-weight","bold");b.innerHTML="Greetings";a.appendChild(b);b=ALib.m_document.createElement("div");alib.dom.styleSet(b,"margin-bottom","20px");b.innerHTML=Ant.user.name;a.appendChild(b);b=ALib.m_document.createElement("div");alib.dom.styleSet(b,"font-weight","bold");b.innerHTML="Getting Started";a.appendChild(b);b=ALib.m_document.createElement("div");alib.dom.styleSet(b,"margin-bottom",
"5px");b.innerHTML="<img src='/images/icons/question_16.png' /> <a href='javascript:void(0);' onclick=\"loadSupportDoc(108);\" style='margin-bottom:5px;'> Watch Home Tutorial</a>";a.appendChild(b);b=ALib.m_document.createElement("div");alib.dom.styleSet(b,"margin-bottom","5px");b.innerHTML="<img src='/images/icons/question_16.png' /> <a href='javascript:void(0);' onclick=\"loadSupportDoc(121);\" style='margin-bottom:5px;'> Watch ANT Overview</a>";a.appendChild(b);this.getTextColor()};
CWidWelcome.prototype.setTextColor=function(a,b){alib.dom.styleSet(this.mdiv,"color","#"+a);b&&this.savePref("setWelColor",a)};CWidWelcome.prototype.getTextColor=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){a&&this.cbData.cls.setTextColor(a)};ajax.exec("/controller/Application/getWelColor",[["appNavname",this.appNavname]])};
CWidWelcome.prototype.savePref=function(a,b){var c=[];c[0]=["val",b];c[1]=["appNavname",this.appNavname];ajax=new CAjax("json");ajax.exec("/controller/Application/"+a,c)};
CWidWelcome.prototype.loadImage=function(){ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.widImage=this.m_image;ajax.onload=function(a){this.cbData.widImage.cls=this.cbData.cls;this.cbData.widImage.onload=function(){130<this.height&&(this.cls.m_container.style.height=this.height+"px");this.cls.m_container.style.backgroundImage="url("+this.src+")";this.cls.m_container.style.backgroundRepeat="no-repeat";this.cls.m_container.style.backgroundPosition="top left"};this.cbData.widImage.src=unescape(a)};
var a=[];a[0]=["width",this.mdiv.offsetWidth];a[1]=["appNavname",this.appNavname];ajax.exec("/controller/Application/getWelImage",a)};CWidWelcome.prototype.changeImage=function(a){"default"==a?(this.m_cust_img_id=null,this.setTextColor("none"),this.savePref("setWelImgDef",a)):("none"==a?(this.m_cust_img_id=null,this.m_container.style.backgroundImage=""):this.m_cust_img_id=a,this.savePref("setWelImg",a));this.loadImage()};function CWidWeather(){this.title="Weather";this.m_container=null}
CWidWeather.prototype.main=function(){this.m_container.innerHTML="Loading, please wait...";this.m_dm.addEntry("Change Location",function(a){a.setZip()},null,null,[this]);this.loadWeather()};CWidWeather.prototype.exit=function(){this.m_container.innerHTML=""};
CWidWeather.prototype.setZip=function(){var a=prompt("Please enter a symbol to add",this.m_zip?this.m_zip:"97477");this.m_container.innerHTML="Setting zip, please wait";ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.m_zip=a;this.cbData.cls.loadWeather()};ajax.exec("/controller/Application/setZipcode",[["zipcode",a]])};
CWidWeather.prototype.loadWeatherOld=function(){this.ajax=new CAjax;this.ajax.m_con=this.m_container;this.ajax.m_appcls=this;this.ajax.onload=function(a){var b=null,c="",d="",e=alib.dom.createElement("table");e.style.width="100%";var f=alib.dom.createElement("tbody");e.appendChild(f);var g=alib.dom.createElement("tr");f.appendChild(g);var h=alib.dom.createElement("tr");f.appendChild(h);var k=alib.dom.createElement("tr");f.appendChild(k);var l=alib.dom.createElement("tr");f.appendChild(l);if(a){f=
a.getNumChildren();for(i=0;i<f;i++){var m=a.getChildNode(i);"error"==m.m_name&&"nozip"==m.m_text&&(b=alib.dom.createElement("div"),b.style.paddingTop="6px",b.style.paddingLeft="3px",b.style.cursor="pointer",b.m_appcls=this.m_appcls,b.onclick=function(){this.m_appcls.setZip()},b.innerHTML="Click here to enter your location!");"zip"==m.m_name&&(this.m_appcls.m_zip=m.m_text);"city"==m.m_name&&(c=m.m_text);"state"==m.m_name&&(d=m.m_text);if("day"==m.m_name){var n=m.getNumChildren();for(j=0;j<n;j++)switch(dayvar=
m.getChildNode(j),dayvar.m_name){case "name":var o=dayvar.m_text;break;case "icon":var p=dayvar.m_text;break;case "forecast":var q=dayvar.m_text;break;case "tempMax":var r=dayvar.m_text;break;case "tempMin":var u=dayvar.m_text}m=alib.dom.createElement("td");m.style.width="20%";m.style.textAlign="center";m.innerHTML=o;g.appendChild(m);m=null;m=alib.dom.createElement("td");m.style.textAlign="center";m.style.width="20%";img=alib.dom.createElement("img");img.src=p;img.border="0";m.appendChild(img);h.appendChild(m);
m=null;m=alib.dom.createElement("td");m.style.textAlign="center";m.style.width="20%";m.innerHTML=q;k.appendChild(m);m=null;m=alib.dom.createElement("td");m.style.textAlign="center";m.style.width="20%";m.innerHTML=r+" | "+u;l.appendChild(m);m=null}d&&c&&this.m_appcls.m_cct.setTitle(c+" "+d)}}this.m_con.innerHTML="";b?this.m_con.appendChild(b):this.m_con.appendChild(e)};this.ajax.exec("/widgets/xml_weather.awp")};
CWidWeather.prototype.loadWeather=function(){this.ajax=new CAjax("json");this.ajax.m_con=this.m_container;this.ajax.m_appcls=this;this.ajax.onload=function(a){if(a)if(this.m_con.innerHTML="",a.error)this.m_con.innerHTML="",a=alib.dom.createElement("div",this.m_con),a.style.paddingTop="6px",a.style.paddingLeft="3px",a.style.cursor="pointer",a.m_appcls=this.m_appcls,a.onclick=function(){this.m_appcls.setZip()},a.innerHTML="Click here to enter your location!";else{var b=alib.dom.createElement("table",
this.m_con);b.style.width="100%";var c=alib.dom.createElement("tbody");b.appendChild(c);b=alib.dom.createElement("tr");c.appendChild(b);var d=alib.dom.createElement("tr");c.appendChild(d);var e=alib.dom.createElement("tr");c.appendChild(e);var f=alib.dom.createElement("tr");c.appendChild(f);for(var g in a.days){this.m_appcls.m_zip=a.days[g].zip;var c=a.days[g].name,h=a.days[g].icon,k=a.days[g].forecast,l=a.days[g].tempMax,m=a.days[g].tempMin,n=alib.dom.createElement("td");n.style.width="20%";n.style.textAlign=
"center";n.innerHTML=c;b.appendChild(n);n=null;n=alib.dom.createElement("td");n.style.textAlign="center";n.style.width="20%";img=alib.dom.createElement("img");img.src=h;img.border="0";n.appendChild(img);d.appendChild(n);n=null;n=alib.dom.createElement("td");n.style.textAlign="center";n.style.width="20%";n.innerHTML=k;e.appendChild(n);n=null;n=alib.dom.createElement("td");n.style.textAlign="center";n.style.width="20%";n.innerHTML=l+" | "+m;f.appendChild(n);n=null}}};this.ajax.exec("/controller/Application/getWeather")};
function CWidStocks(){this.title="Stock Ticker";this.m_dm=this.m_container=null;this.m_menus=[]}CWidStocks.prototype.main=function(){this.m_container.innerHTML="Loading, please wait...";Ant.setHinst(this,"/widgets/stocks");this.loadStocks();this.m_dm.addEntry("Add Stock Symbol",function(a){a.addStock()},"/images/themes/"+Ant.m_theme+"/icons/addStock.gif",null,[this])};
CWidStocks.prototype.exit=function(){Ant.clearHinst("/widgets/stocks");this.m_timer&&clearTimeout(this.m_timer);this.m_container.innerHTML=""};CWidStocks.prototype.addStock=function(){var a=prompt("Please enter a symbol to add","");""==a||null==a||new CAjaxRpc("/stocks/xml_act_stocks.awp","stock_add",[["sym",a]],function(a,c){c.loadStocks()},[this])};
CWidStocks.prototype.deleteStock=function(a,b){confirm("Are you sure you want to remove "+b+"?")&&new CAjaxRpc("/stocks/xml_act_stocks.awp","stock_delete",[["eid",a]],function(a,b){b.loadStocks()},[this])};
CWidStocks.prototype.loadStocks=function(){this.ajax=new CAjax;this.ajax.m_con=this.m_container;this.ajax.m_appcls=this;this.ajax.onload=function(a){var b=ALib.m_document.createElement("table");b.style.width="100%";var c=ALib.m_document.createElement("tbody");b.appendChild(c);var d=a.getNumChildren();for(i=0;i<d;i++){var e=a.getChildNode(i);if("stock"==e.m_name){var f="",g="",h="",k="",l="",m="",n=e.getNumChildren();for(j=0;j<n;j++)switch(stockvar=e.getChildNode(j),stockvar.m_name){case "stock_memid":f=
stockvar.m_text;break;case "stock_name":g=stockvar.m_text;break;case "price":h=stockvar.m_text;break;case "price_change":k=stockvar.m_text;break;case "percent_change":l=stockvar.m_text;break;case "stock_class":m=stockvar.m_text}2==i&&(e=ALib.m_document.createElement("tr"),e.className="HStocksHeaderHr",n=ALib.m_document.createElement("td"),n.colspan="5",e.appendChild(n),c.appendChild(e));n=2>i?"HStocksMarketsRow":i%2?"HStocksRow1":"HStocksRow2";e=ALib.m_document.createElement("tr");e.className=n;n=
ALib.m_document.createElement("td");n.innerHTML=unescape(g);e.appendChild(n);n=ALib.m_document.createElement("td");n.innerHTML=unescape(h);n.align="right";e.appendChild(n);n=ALib.m_document.createElement("td");n.innerHTML=unescape(k);n.className=unescape(m);n.align="right";e.appendChild(n);n=ALib.m_document.createElement("td");n.innerHTML=unescape(l);n.className=unescape(m);n.align="right";e.appendChild(n);2>i?n=ALib.m_document.createElement("td"):(h=ALib.m_document.createElement("div"),h.innerHTML=
"<img src='/images/themes/"+Ant.m_theme+"/icons/deleteTask.gif' border='0'>",h.m_id=f,h.m_name=unescape(g),h.m_appcls=this.m_appcls,h.onclick=function(){this.m_appcls.deleteStock(this.m_id,this.m_name)},Ant.Dom.styleSet(h,"cursor","pointer"),n=ALib.m_document.createElement("td"),n.appendChild(h));e.appendChild(n);c.appendChild(e)}}this.m_con.innerHTML="";this.m_con.appendChild(b);this.m_appcls.m_timer=window.setTimeout("Ant.getHinst('/widgets/stocks').loadStocks()",3E4)};this.ajax.exec("/stocks/xml_act_stocks.awp")};
function CWidTasks(){this.title="Tasks";this.m_id=this.m_dm=this.m_container=null;this.tasksObjects=[];this.m_data={}}
CWidTasks.prototype.main=function(){var a=this;this.m_container.innerHTML="";a=this;funct=function(a,b,e){a.displayTasks(b,e);a.m_data="['"+b+"', '"+e+"']";a.saveWidgetData()};var b=this.m_dm.addSubmenu("Group By");b.addEntry("None",funct,null,"<div id='widg_home_tasks_group_none'></div>",[a,null,null]);b.addEntry("Overview",funct,null,"<div id='widg_home_tasks_group_overview'></div>",[a,null,"overview"]);b.addEntry("Project",funct,null,"<div id='widg_home_tasks_group_project'></div>",[a,null,"project"]);
b.addEntry("Contact/Customer",funct,null,"<div id='widg_home_tasks_group_contact'></div>",[a,null,"customer_id"]);b.addEntry("Priority",funct,null,"<div id='widg_home_tasks_group_priority'></div>",[a,null,"priority"]);b.addEntry("Due Date",funct,null,"<div id='widg_home_tasks_group_deadline'></div>",[a,null,"deadline"]);b.addEntry("Category",funct,null,"<div id='widg_home_tasks_group_category'></div>",[a,null,"category"]);this.m_container.innerHTML="<div class='loading'></div>";this.loadTasks()};
CWidTasks.prototype.exit=function(){this.m_container.innerHTML=""};
CWidTasks.prototype.displayTasks=function(a,b){if("undefined"==typeof a&&"undefined"==typeof b&&this.m_data)var c=eval(this.m_data),a=c[0],b=c[1];this.tasks=[];this.taskContainers=[];this.m_container.innerHTML="";c=alib.dom.createElement("div",this.m_container);alib.dom.styleSet(c,"margin-bottom","10px");alib.dom.styleSet(c,"text-align","right");var d=alib.dom.createElement("a",c);d.innerHTML="add task";d.href="javascript:void(0);";d.cls=this;d.onclick=function(){var a=loadObjectForm("task");alib.events.listen(a,
"close",function(a){a.data.cls.loadTasks()},{cls:this.cls})};alib.dom.createElement("span",c," | ");d=alib.dom.createElement("a",c);d.innerHTML="refresh";d.href="javascript:void(0);";d.cls=this;d.onclick=function(){this.cls.loadTasks()};"overview"==b&&(this.getContainer("Due Today"),this.getContainer("Upcoming"),this.getContainer("Later"));for(i in this.tasksObjects){c=this.tasksObjects[i];d={};d.id=c.id;var e="";if(b)switch(b){case "start_date":case "deadline":e=c.getValue(b);e=c.getValue(b);break;
case "overview":e=this.getOverviewGroup(c);break;default:e=c.getValue(b),e=c.getValueName(b)}var e=this.getContainer(e),f=alib.dom.createElement("div",e);alib.dom.styleSet(f,"float","left");alib.dom.styleSet(f,"width","20px");f=alib.dom.setElementAttr(alib.dom.createElement("input",f),[["type","checkbox"]]);f.checked="t"==c.getValue("done")?!0:!1;f.taskId=c.id;f.cls=this;f.onchange=function(){this.cls.checkTask(this.taskId,this.checked?"t":"f")};d.checkbox=f;f=alib.dom.createElement("div",e);alib.dom.styleSet(f,
"float","left");alib.dom.styleSet(f,"max-width","80%");var g="";c.getValue("project")&&(g+=c.getValueName("project")+": ");c.getValue("customer_id")&&(g+=c.getValueName("customer_id")+": ");g+=c.getValue("name");f=alib.dom.createElement("a",f,g);f.href="javascript:void(0);";f.cls=this;f.taskId=c.id;f.onclick=function(){var a=loadObjectForm("task",this.taskId);alib.events.listen(a,"close",function(a){a.data.cls.loadTasks()},{cls:this.cls})};d.label=f;f=alib.dom.createElement("div",e);alib.dom.styleSet(f,
"float","right");alib.dom.styleSet(f,"width","20px");f=alib.dom.createElement("img",f);f.src="/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif";alib.dom.styleSet(f,"cursor","pointer");f.cls=this;f.taskId=c.id;f.taskName=c.getValue("name");f.onclick=function(){this.cls.deleteTask(this.taskId,this.taskName)};d.deleteIcon=f;this.tasks[this.tasks.length]=d;alib.dom.divClear(e)}};
CWidTasks.prototype.getContainer=function(a){a=a||"None";if(this.taskContainers[a])return this.taskContainers[a];var b=alib.dom.createElement("div",this.m_container);alib.dom.styleSet(b,"margin-bottom","10px");this.taskContainers[a]=b;var c=alib.dom.createElement("div",b),d=alib.dom.setElementAttr(alib.dom.createElement("span",c),[["innerHTML",a]]);alib.dom.styleSet(d,"font-weight","bold");c=alib.dom.createElement("div",c);alib.dom.styleSetClass(c,"horizontalline");alib.dom.styleSet(c,"margin-bottom",
"5px");c=alib.dom.createElement("div",b);alib.dom.styleSetClass(c,"group"+a);return b};CWidTasks.prototype.getOverviewGroup=function(a){var b=new Date;if(a.getValue("deadline")){var c=new Date(a.getValue("deadline"));if(c<=b)return"Due Today"}if(a.getValue("deadline")){var d=new Date;d.setDate(b.getDate()+3);c=new Date(a.getValue("deadline"));if(c<=d)return"Upcoming"}return"Later"};
CWidTasks.prototype.loadTasks=function(){this.tasksObjects=[];var a=new AntObjectList("task");a.cbData.cls=this;a.addCondition("and","user_id","is_equal",-3);a.addCondition("and","done","is_equal","f");a.onLoad=function(){for(var a=0;a<this.getNumObjects();a++)this.cbData.cls.tasksObjects.push(this.getObject(a));this.cbData.cls.displayTasks()};a.getObjects()};
CWidTasks.prototype.deleteTask=function(a,b){confirm("Are you sure you want to remove "+b+"?")&&(ajax=new CAjax("json"),ajax.cbData.cls=this,ajax.onload=function(){this.cbData.cls.loadTasks()},ajax.exec("/controller/Project/checkTask",[["type","delete"],["task_id",a]]))};
CWidTasks.prototype.checkTask=function(a,b){ajax=new CAjax("json");ajax.exec("/controller/Project/checkTask",[["type","check"],["task_id",a],["task_res",b]]);for(var c=0;c<this.tasks.length;c++)this.tasks[c].id==a&&("t"==b?(this.tasks[c].label.style.textDecoration="line-through",this.tasks[c].checkbox.checked=!0):(this.tasks[c].label.style.textDecoration="",this.tasks[c].checkbox.checked=!1))};
CWidTasks.prototype.saveWidgetData=function(){var a=[];a[a.length]=["data",this.m_data];a[a.length]=["dwid",this.m_id];ajax=new CAjax("json");ajax.cbData.cls=this;ajax.exec("/controller/Dashboard/saveData",a)};function CWidFriends(){this.title="Online Friends";this.m_dm=this.m_container=null;this.m_menus=[]}
CWidFriends.prototype.main=function(){Ant.setHinst(this,"/home/widgets/friends");var a=new CDropdownMenu;this.m_menus.push(a);a.addEntry("Available",this.setMyStatus,"/images/themes/"+Ant.theme.name+"/icons/circle_blue.png",null,["Available"]);a.addEntry("Busy",this.setMyStatus,"/images/themes/"+Ant.theme.name+"/icons/circle_blue.png",null,["Busy"]);a.addEntry("Invisible",this.setMyStatus,"/images/themes/"+Ant.theme.name+"/icons/circle_blue.png",null,["Invisible"]);a.addEntry("Be Right Back",this.setMyStatus,
"/images/themes/"+Ant.theme.name+"/icons/circle_blue.png",null,["Be Right Back"]);a.addEntry("Not at My Desk",this.setMyStatus,"/images/themes/"+Ant.theme.name+"/icons/circle_blue.png",null,["Not at My Desk"]);a.addEntry("Custom",this.setMyStatus,"/images/themes/"+Ant.theme.name+"/icons/circle_blue.png");var b=a.createButtonMenu("<span id='friends_statusid'>Loading...</span>"),a=ALib.m_document.createElement("div"),c=ALib.m_document.createElement("div");Ant.m_browser.ie?c.style.styleFloat="right":
c.style.cssFloat="right";c.style.paddingRight="3px";c.style.paddingTop="3px";a.appendChild(b);c.appendChild(a);this.m_container.appendChild(c);a=ALib.m_document.createElement("div");a.style.clear="both";b=ALib.m_document.createElement("table");b.style.width="100%";this.m_friendsTbody=c=ALib.m_document.createElement("tbody");b.appendChild(c);a.appendChild(b);this.m_container.appendChild(a);this.m_dm.addEntry("Manage Friends",function(a){window.open("/chat/ant_messenger.awp","messenger",a)},null,null,
["top=200,left=100,width=300,height=350,toolbar=no,menubar=no,scrollbars=yes,location=no,directories=no,status=no,resizable=yes"]);this.m_dm.addEntry("Change My Display Name",this.changeMyName);this.updateFriends();this.getMyStatus()};CWidFriends.prototype.exit=function(){this.m_timer&&clearTimeout(this.m_timer);Ant.clearHinst("/home/widgets/friends");for(var a=0;a<this.m_menus.length;a++)this.m_menus[a].destroyMenu();this.m_container.innerHTML=""};
CWidFriends.prototype.updateFriends=function(){var a=new CAjax;a.m_tbody=this.m_friendsTbody;a.m_widcls=this;a.onload=function(a){try{for(i=0;i<a.getNumChildren();i++){var c=a.getChildNode(i);if("friend"==c.m_name){var d=c.getChildNodeValByName("uid"),e=unescape(c.getChildNodeValByName("uname")),f=c.getChildNodeValByName("online"),g=unescape(c.getChildNodeValByName("status_text"));c.getChildNodeValByName("friend_id");var h=this.m_tbody,k=ALib.m_document.getElementById("widget_friends_row_"+d);if(k)1!=
f?h.removeChild(k):ALib.m_document.getElementById("widget_frinds_uid_status"+d).innerHTML=g;else if(1==f){var l=ALib.m_document.createElement("tr");l.id="widget_friends_row_"+d;l.valign="middle";h.appendChild(l);var m=ALib.m_document.createElement("td");m.style.width="16px";m.style.cursor="pointer";m.align="center";m.innerHTML="<img src='/images/icons/comments_double_16.png' border='0' />";m.m_uid=d;m.onclick=function(){InitiateChat(this.m_uid)};l.appendChild(m);m=ALib.m_document.createElement("td");
m.innerHTML="<a href='javascript:void(0);' onclick=\"InitiateChat('"+d+"')\">"+e+"</a> (<span style='font-size:9px;' id='widget_frinds_uid_status"+d+"'>"+g+"</span>)";l.appendChild(m)}}}}catch(n){}this.m_widcls.m_timer=window.setTimeout("Ant.getHinst('/home/widgets/friends').updateFriends()",3E4)};a.exec("/chat/xml_update_list.awp")};
CWidFriends.prototype.changeMyName=function(){(name=prompt("Please enter your display name (128 chars) max",""))&&"null"!=name&&"undefined"!=name&&new CAjaxRpc("/contacts/xml_friends_status.awp","setname",[["myname",name]],function(){alert("Your display name has been changed to: "+name)})};
CWidFriends.prototype.setMyStatus=function(a){a||(a=prompt("Please enter your status (128 chars) max",""));a&&new CAjaxRpc("/contacts/xml_friends_status.awp","setstatus",[["mystatus",a]],function(a){ALib.m_document.getElementById("friends_statusid").innerHTML=unescape(a)})};CWidFriends.prototype.getMyStatus=function(){new CAjaxRpc("/contacts/xml_friends_status.awp","getmystatus",null,function(a){ALib.m_document.getElementById("friends_statusid").innerHTML=a})};
function CWidSettings(){this.title="Settings";this.appNavname=this.m_dashclass=this.m_id=this.m_container=null;this.m_menus=[]}
CWidSettings.prototype.main=function(){var a=ALib.m_document.createElement("table"),b=ALib.m_document.createElement("tbody");a.appendChild(b);var c=ALib.m_document.createElement("tr");b.appendChild(c);var d=ALib.m_document.createElement("td");c.appendChild(d);d.innerHTML="<img src='/images/icons/settings_16.png' border='0' />";d=ALib.m_document.createElement("td");c.appendChild(d);d.innerHTML="Current Theme:";d=ALib.m_document.createElement("td");c.appendChild(d);c=new CDropdownMenu;this.m_menus.push(c);
var e=new CAjax;e.m_dm=c;e.m_td=d;e.onload=function(a){for(var b=a.getNumChildren(),c=0;c<b;c++){var d=a.getChildNode(c),e=unescape(d.m_text),d=d.getAttribute("id");this.m_dm.addEntry(e,"location='main?change_theme="+d+"'","/images/icons/circle_blue.png")}};e.exec("/widgets/xml_settings.php?function=get_themes");d.appendChild(c.createButtonMenu(Ant.m_themeTitle));c=ALib.m_document.createElement("tr");b.appendChild(c);d=ALib.m_document.createElement("td");c.appendChild(d);d.innerHTML="<img src='/images/icons/windows_16.png' border='0' />";
d=ALib.m_document.createElement("td");c.appendChild(d);d.innerHTML="Desktop Client";d=ALib.m_document.createElement("td");c.appendChild(d);d.innerHTML="<a href='http://www.aereus.com/downloads/antclient_setup.exe'>Download ANTClient</a>";this.m_container.appendChild(a)};CWidSettings.prototype.exit=function(){for(var a=0;a<this.m_menus.length;a++)this.m_menus[a].destroyMenu();this.m_container.innerHTML=""};function CWidBookmarks(){this.title="Bookmarks";this.m_dm=this.m_container=null}
CWidBookmarks.prototype.main=function(){this.loadBookmarks()};CWidBookmarks.prototype.exit=function(){this.m_container.innerHTML=""};CWidBookmarks.prototype.addRootActions=function(){this.m_dm.addEntry("Add Category",function(a){a.addCategory(null,a.m_tv)},null,null,[this]);this.m_dm.addEntry("Add Bookmark",function(a,b,c,d){a.m_id=null;a.name_txt.value="";a.url_txt.value="http://";a.m_cid=c;a.m_tvnode=d;a.customDialog(b,300,300)},null,null,[this.dlgProperties,this.dlgProperties.m_dv,null,this.m_tv])};
CWidBookmarks.prototype.loadBookmarks=function(){this.ajax=new CAjax;this.ajax.m_con=this.m_container;this.ajax.m_appcls=this;this.ajax.onload=function(a){this.m_appcls.m_tv=new CTreeView;this.m_appcls.loadCategory(a,this.m_appcls.m_tv);this.m_con.innerHTML="";this.m_appcls.m_tv.print(this.m_con);this.m_appcls.addRootActions()};this.ajax.exec("/widgets/xml_bookmarks.php?function=get_bookmarks")};
CWidBookmarks.prototype.loadCategory=function(a,b){this.dlgProperties||this.createPropertiesDialog();for(var c=a.getNumChildren(),d=0;d<c;d++){var e=a.getChildNode(d);if("category"==e.m_name){var f=e.getAttribute("name"),g=e.getAttribute("id"),f=this.insertCategory(unescape(f),g,b);this.loadCategory(e,f)}if("bookmark"==e.m_name){var f=e.getChildNodeValByName("name"),h=e.getChildNodeValByName("url"),g=e.getChildNodeValByName("id"),e=e.getChildNodeValByName("cid");this.insertBookmark(g,e,unescape(h),
unescape(f),b)}}};
CWidBookmarks.prototype.insertCategory=function(a,b,c){a||(a="untitled");a=c.addNode(a,"/images/icons/closedfolderlink_small.gif");a.m_cid=b;a.onBodyEdit=function(a){new CAjaxRpc("/widgets/xml_bookmarks.php","rename_category",[["cid",this.m_cid],["cname",a]])};c=a.createContextMenu();c.addEntry("Delete Category",function(a,b,c){a.deleteCategory(c,b)},"/images/icons/deleteTask.gif",null,[this,b,a]);c.addEntry("Rename Category",function(a,b,c){c.editBody()},null,null,[this,b,a]);c.addEntry("New Subcategory",function(a,
b,c){a.addCategory(b,c)},null,null,[this,b,a]);c.addEntry("Add Bookmark",function(a,b,c,g){a.m_id=null;a.name_txt.value="";a.url_txt.value="http://";a.m_cid=c;a.m_tvnode=g;a.customDialog(b,300,300)},null,null,[this.dlgProperties,this.dlgProperties.m_dv,b,a]);return a};
CWidBookmarks.prototype.insertBookmark=function(a,b,c,d,e){d||(d="untitled");var f=e.addNode(unescape(d),"/images/icons/link_icon.gif");f.m_url=c;f.m_name=d;f.m_id=a;f.id="fav"+a;f.setAction(function(a){window.open(a)},[f.m_url]);c=f.createContextMenu();c.addEntry("Delete Bookmark",function(a,b,c){a.deleteBookmark(c,b)},"/images/themes/"+Ant.theme.name+"/icons/deleteTask.gif",null,[this,a,f]);c.addEntry("Properties",function(a,b,c,d,e){a.m_id=d.m_id;a.m_cid=c;a.m_tvnode=e;a.name_txt.value=d.m_name;
a.url_txt.value=d.m_url;a.customDialog(b,300,300)},null,null,[this.dlgProperties,this.dlgProperties.m_dv,b,f,e])};
CWidBookmarks.prototype.createPropertiesDialog=function(){this.dlgProperties=new CDialog("Edit Bookmark");this.dlgProperties.m_id=null;this.dlgProperties.m_cid=null;this.dlgProperties.m_tvnode=null;this.dlgProperties.m_dv=alib.dom.createElement("div");var a=alib.dom.createElement("div");a.innerHTML="Name:";this.dlgProperties.m_dv.appendChild(a);this.dlgProperties.name_txt=alib.dom.createElement("input");alib.dom.styleSet(this.dlgProperties.name_txt,"width","99%");this.dlgProperties.m_dv.appendChild(this.dlgProperties.name_txt);
a=alib.dom.createElement("div");a.innerHTML="URL:";this.dlgProperties.m_dv.appendChild(a);this.dlgProperties.url_txt=alib.dom.createElement("input");alib.dom.styleSet(this.dlgProperties.url_txt,"width","99%");this.dlgProperties.m_dv.appendChild(this.dlgProperties.url_txt);a=alib.dom.createElement("div",this.dlgProperties.m_dv);alib.dom.styleSet(a,"text-align","center");alib.dom.styleSet(a,"padding-top","5px");var b=new CButton("OK",function(a,b){a.editBookmark(b.name_txt.value,b.url_txt.value,b.m_cid,
b.m_id,b.m_tvnode);b.hide()},[this,this.dlgProperties],"b2");b.print(a);b=new CButton("Cancel",function(a){a.hide()},[this.dlgProperties],"b1");b.print(a);return this.dlgProperties};CWidBookmarks.prototype.deleteBookmark=function(a,b){ALib.Dlg.onConfirmOk=function(a,b){new CAjaxRpc("/widgets/xml_bookmarks.php","delete_bookmark",[["bid",b]],function(a,b){b.remove()},[a])};ALib.Dlg.confirmBox("Are you sure you want to delete this bookmark?","Delete Bookmark",[a,b])};
CWidBookmarks.prototype.deleteCategory=function(a,b){confirm("Are you sure you want to delete this category and all associated bookmarks?")&&new CAjaxRpc("/widgets/xml_bookmarks.php","delete_category",[["catid",b]],function(a,b){b.remove()},[a])};
CWidBookmarks.prototype.editBookmark=function(a,b,c,d,e){new CAjaxRpc("/widgets/xml_bookmarks.php","edit_bookmark",[["bid",d?d:""],["cid",c],["name",a],["url",b]],function(a,b,c,d,e,m){var n=b.m_tv.getTvNodeById("fav"+a);null==n?b.insertBookmark(a,c,d,e,m):(n.m_url=d,n.m_name=e,n.setBody(e))},[this,c,b,a,e])};
CWidBookmarks.prototype.addCategory=function(a,b){new CAjaxRpc("/widgets/xml_bookmarks.php","add_category",[["pcid",a?a:""]],function(a,b,e){e.insertCategory("New Category",a,b).editBody()},[b,this])};function CWidRssManager(){this.title="RSS Manager";this.m_dm=this.m_container=null}
CWidRssManager.prototype.main=function(){mdiv=ALib.m_document.createElement("div");mdiv.id="wBookmarks";mdiv.innerHTML='<IFRAME ALLOWTRANSPARENCY="true" SRC="/rss_favorites.awp" WIDTH="100%" HEIGHT="50" frameborder="0" name="rss_favorites" id="rss_favorites"></IFRAME>';this.m_container.appendChild(mdiv)};CWidRssManager.prototype.exit=function(){this.m_container.innerHTML=""};function CWidWebsearch(){this.title="Web Search";this.m_container=null;this.m_menus=[]}
CWidWebsearch.prototype.main=function(){var a=ALib.m_document.createElement("div");a.id="websearch_action";a.style.height="0px";a.style.width="0px";this.m_container.appendChild(a);webform=ALib.m_document.createElement("form");webform.name="webform";webform.id="webform_id";webform.method="get";webform.target="_blank";webform.action="http://www.google.com/search";a=ALib.m_document.createElement("table");a.style.width="100%";var b=ALib.m_document.createElement("tbody");a.appendChild(b);var c=ALib.m_document.createElement("tr");
b.appendChild(c);b=ALib.m_document.createElement("td");c.appendChild(b);b.align="center";b.innerHTML="<input maxLength='500' id='websearch_input' name='q' value='' class='websearchStyles'>";b=ALib.m_document.createElement("td");c.appendChild(b);b.align="center";b.style.width="63px";b.style.paddingLeft="6px";var d=new CDropdownMenu;this.m_menus.push(d);d.addEntry("Google","HomeSearchSelect('google')","/images/icons/google_fav.png");d.addEntry("MSN","HomeSearchSelect('msn')","/images/icons/msn_fav.png");
d.addEntry("Dogpile","HomeSearchSelect('dogpile')","/images/icons/dog_fav.png");d.addEntry("AlltheWeb","HomeSearchSelect('alltheweb')","/images/icons/allweb_fav.png");d.addEntry("Yahoo!","HomeSearchSelect('yahoo')","/images/icons/yahoo_fav.png");b.appendChild(d.createButtonMenu("Engine"));b=ALib.m_document.createElement("td");c.appendChild(b);b.align="center";b.style.width="50px";b.style.paddingLeft="2px";c=new CButton("Search","ALib.m_document.websearch.submit()");b.appendChild(c.getButton());webform.appendChild(a);
this.m_container.appendChild(webform)};CWidWebsearch.prototype.exit=function(){this.m_container.innerHTML=""};function CWidCalendar(){this.title="Calendar";this.appNavname=this.m_container=null;this.m_menus=[]}
CWidCalendar.prototype.main=function(){Ant.setHinst(this,"/widgets/calendar");this.m_container.innerHTML="Loading, please wait...";var a=function(a,b){a.setSpan(b)},b=this.m_dm.addSubmenu("Show Events For");b.addEntry("1 Day",a,null,"<div id='widg_home_cal_span_1'></div>",[this,1]);b.addEntry("2 Days",a,null,"<div id='widg_home_cal_span_2'></div>",[this,2]);b.addEntry("3 Days",a,null,"<div id='widg_home_cal_span_3'></div>",[this,3]);b.addEntry("4 Days",a,null,"<div id='widg_home_cal_span_4'></div>",
[this,4]);b.addEntry("5 Days",a,null,"<div id='widg_home_cal_span_5'></div>",[this,5]);b.addEntry("6 Days",a,null,"<div id='widg_home_cal_span_6'></div>",[this,6]);b.addEntry("1 Week",a,null,"<div id='widg_home_cal_span_7'></div>",[this,7]);b.addEntry("2 Weeks",a,null,"<div id='widg_home_cal_span_14'></div>",[this,14]);b.addEntry("3 Weeks",a,null,"<div id='widg_home_cal_span_21'></div>",[this,21]);b.addEntry("4 Weeks",a,null,"<div id='widg_home_cal_span_30'></div>",[this,30]);this.getSpan()};
CWidCalendar.prototype.exit=function(){Ant.clearHinst("/widgets/calendar");this.m_timer&&clearTimeout(this.m_timer);for(var a=0;a<this.m_menus.length;a++)this.m_menus[a].destroyMenu();this.m_container.innerHTML=""};
CWidCalendar.prototype.getEvents=function(){var a=new Date,b=("0"+a.getDate()).slice(-2),c=a.getFullYear(),a=a.getMonth()+1,a=("0"+a).slice(-2),c=b=a+"/"+b+"/"+c;this.m_timer&&clearTimeout(this.m_timer);ajax=new CAjax("json");ajax.cbData.con=this.m_container;ajax.cbData.cls=this;ajax.cbData.currentDate=b;ajax.onload=function(a){this.cbData.con.innerHTML="";if(a.objects.length){var b=alib.dom.createElement("div",this.cbData.con),c=null;for(event in a.objects){var d=a.objects[event],k=d.id,l=d.name,
m=d.ts_start,n=d.ts_end,d=d.all_day,o=m.split(" ",1).toString();n.split(" ",1);m=this.cbData.cls.getEventTime(m);n=this.cbData.cls.getEventTime(n);if(c!==o){var p=new Date(o),q=alib.dom.createElement("div",b);c&&alib.dom.styleSet(q,"margin-top","10px");this.currentDate==o?p="Today":(p=p.toString("dddd, MMMM ,yyyy"),p=p.split(" ",4).toString(),c=p.split(","),p=c[0]+" "+c[1]+" "+c[2]+", "+c[3]);c=alib.dom.setElementAttr(alib.dom.createElement("div",q),[["innerHTML",p]]);alib.dom.styleSet(c,"font-weight",
"bold");c=alib.dom.createElement("div",q);c.innerHTML="&nbsp;";alib.dom.styleSetClass(c,"horizontalline");alib.dom.styleSet(c,"float","left");alib.dom.styleSet(c,"min-width","110px");alib.dom.styleSet(c,"margin-right","10px");c=alib.dom.createElement("div",q);c.innerHTML="&nbsp;";alib.dom.styleSetClass(c,"horizontalline");alib.dom.styleSet(c,"overflow","hidden");alib.dom.divClear(q)}q=alib.dom.createElement("div",b);c=alib.dom.createElement("div",q);p=alib.dom.createElement("div",q);alib.dom.styleSet(q,
"cursor","pointer");alib.dom.styleSet(q,"margin-top","3px");alib.dom.styleSet(c,"float","left");alib.dom.styleSet(c,"min-width","120px");alib.dom.styleSet(p,"overflow","hidden");c.innerHTML="t"==d?"[All Day Event]":m+" - "+n;p.innerHTML=l;q.eventId=k;q.cls=this.cbData.cls;q.onclick=function(){var a=loadObjectForm("calendar_event",this.eventId);alib.events.listen(a,"close",function(a){a.data.cls.getEvents()},{cls:this.cls})};c=o;alib.dom.divClear(q)}}};var a=[],d=1;a[a.length]=["conditions[]",d];a[a.length]=
["condition_blogic_"+d,"and"];a[a.length]=["condition_fieldname_"+d,"ts_start"];a[a.length]=["condition_operator_"+d,"is_greater_or_equal"];a[a.length]=["condition_condvalue_"+d,b];this.date_end&&(c=this.date_end);c<b&&(c=b);d=2;a[a.length]=["conditions[]",d];a[a.length]=["condition_blogic_"+d,"and"];a[a.length]=["condition_fieldname_"+d,"ts_end"];a[a.length]=["condition_operator_"+d,"is_less_or_equal"];a[a.length]=["condition_condvalue_"+d,c+" 11:59:59 pm"];a[a.length]=["order_by[]","ts_start asc"];
a[a.length]=["obj_type","calendar_event"];ajax.exec("/controller/Calendar/getEvents",a)};
CWidCalendar.prototype.setShowSpan=function(a){if(a)for(var b=[["1","widg_home_cal_span_1"],["2","widg_home_cal_span_2"],["3","widg_home_cal_span_3"],["4","widg_home_cal_span_4"],["5","widg_home_cal_span_5"],["6","widg_home_cal_span_6"],["7","widg_home_cal_span_7"],["14","widg_home_cal_span_14"],["21","widg_home_cal_span_21"],["30","widg_home_cal_span_30"]],c=0;c<b.length;c++)b[c][0]==a?ALib.m_document.getElementById(b[c][1]).innerHTML="<img src='/images/themes/"+Ant.theme.name+"/icons/circle_blue.png' />":
ALib.m_document.getElementById(b[c][1]).innerHTML=""};CWidCalendar.prototype.setSpan=function(a){var b=[];b[0]=["val",a];b[1]=["appNavname",this.appNavname];ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a&&(this.cls.date_end=unescape(a));this.cls.m_container.innerHTML="Loading, please wait...";this.cls.getEvents()};ajax.exec("/controller/Application/setCalTimespan",b);this.numdays=a;this.setShowSpan(a)};
CWidCalendar.prototype.getSpan=function(){ajax=new CAjax("json");ajax.cls=this;ajax.onload=function(a){a&&(this.cls.date_end=unescape(a));this.cls.getEvents()};ajax.exec("/controller/Application/getCalTimespan",[["appNavname",this.appNavname]])};CWidCalendar.prototype.getEventTime=function(a){var a=a.split(" "),b="";for(parts in a)0<parts&&parts<a.length-1&&(b+=a[parts]+" ");return b};CWidCalendar.prototype.refresh=function(){this.getEvents()};
function CWidRss(){this.title="RSS Reader";this.appNavname=this.m_data=this.m_dm=this.m_container=null}CWidRss.prototype.main=function(){alib.dom.styleSet(this.m_container,"padding","3px");if(this.m_data)this.loadRss();else{var a=ALib.m_document.createElement("div");a.m_widcls=this;a.onclick=function(){this.m_widcls.setData()};alib.dom.styleSet(a,"cursor","pointer");a.innerHTML="Click here to set RSS url";this.m_container.appendChild(a)}};
CWidRss.prototype.exit=function(){this.m_container.innerHTML=""};
CWidRss.prototype.loadRss=function(){var a=new CAjax;a.m_widcls=this;a.onload=function(a){this.m_widcls.m_container.innerHTML="";for(var c=a.getNumChildren(),d=0;d<c;d++){var e=a.getChildNode(d),f="",g=ALib.m_document.createElement("table"),h=ALib.m_document.createElement("tbody");g.appendChild(h);for(var k=0;k<e.getNumChildren();k++){var l=e.getChildNode(k);"title"==l.m_name&&(f=unescape(l.m_text));if("item"==l.m_name){var m=l.getChildNodeValByName("title"),n=l.getChildNodeValByName("link"),l=l.getChildNodeValByName("description"),
o=ALib.m_document.createElement("tr");h.appendChild(o);var p=ALib.m_document.createElement("td");o.appendChild(p);p.innerHTML="<img src='/images/icons/rss_link2.gif' border='0'>";p=ALib.m_document.createElement("td");o.appendChild(p);p.innerHTML="<a target='_blank' href='"+unescape(n)+"'>"+unescape(m)+"</a>";o=ALib.m_document.createElement("tr");h.appendChild(o);p=ALib.m_document.createElement("td");o.appendChild(p);p=ALib.m_document.createElement("td");o.appendChild(p);p.innerHTML=unescape(l)}}f&&
this.m_widcls.m_cct.setTitle(f);this.m_widcls.m_container.appendChild(g)}};a.exec("/widgets/xml_rss_reader.php?url="+escape(this.m_data)+"&id="+this.m_id)};
CWidRss.prototype.setData=function(){var a=prompt("Please enter an rss url",this.m_data?this.m_data:"http://examplefeed.com/path/to/rss.xml");this.m_container.innerHTML="Setting url, please wait";var b=[];b[0]=["id",this.m_id];b[1]=["data",a];b[2]=["appNavname",this.appNavname];ajax=new CAjax("json");ajax.cbData.cls=this;ajax.onload=function(a){this.cbData.cls.m_data=unescape(a);this.cbData.cls.loadRss()};ajax.exec("/controller/Application/setRssData",b)};
function CWidReport(){this.m_report=this.m_data=this.m_dm=this.m_container=null;this.m_show_summary=this.m_show_graph=!0;this.dashboardCls=this.m_reportid=this.widgetWidth=this.appNavname=null;this.title="Report"}
CWidReport.prototype.main=function(){if(this.m_data){var a=eval(this.m_data);this.m_reportid=a[0];this.m_show_graph="f"==a[1]?!1:!0;this.m_show_summary="f"==a[2]?!1:!0}this.m_dm.addEntry("Select Report",function(a){a.setReport()},null,null,[this]);this.m_dm.addEntry("Toggle Chart Display",function(a){a.m_report.toggleDisplay(!0)},null,null,[this]);this.m_dm.addEntry("Toggle Table Display",function(a){a.m_report.toggleDisplay(!1)},null,null,[this]);this.toggleTitleCon=this.m_dm.m_tbody.lastChild;this.m_dm.addEntry("View Full Report",
function(a){a.m_report?loadObjectForm("report",a.m_reportid):alert("Please load a report first")},null,null,[this]);this.m_data?this.loadReport():(a=ALib.m_document.createElement("div"),a.m_widcls=this,a.onclick=function(){this.m_widcls.setReport()},alib.dom.styleSet(a,"cursor","pointer"),a.innerHTML="Click here to select report",this.m_container.appendChild(a))};CWidReport.prototype.exit=function(){this.m_container.innerHTML=""};
CWidReport.prototype.loadReport=function(){this.m_container.innerHTML="";var a;a=this.m_container.offsetWidth?this.m_container.offsetWidth:this.widgetWidth;this.m_report=new Report(this.m_reportid);this.m_report.cls=this;this.m_report.chartWidth=a-10;this.m_report.onload=function(a){var c=this.cls.toggleTitleCon.childNodes[1];a.reportData.table_type&&(c.innerHTML="Toggle Table Display ("+a.reportData.table_type.capitalize()+")");this.print(this.cls.m_container)};this.m_report.loadReport()};
CWidReport.prototype.setReport=function(){var a=new AntObjectBrowser("report");a.cbData.cls=this;a.onSelect=function(a){this.cbData.cls.m_reportid=a;this.cbData.cls.loadReport();this.cbData.cls.dashboardCls?this.cbData.cls.dashboardCls.saveData(this.cbData.cls.m_id,"["+this.cbData.cls.m_reportid+"]"):this.cbData.cls.saveSettings()};a.displaySelect()};
CWidReport.prototype.saveSettings=function(){var a="["+this.m_reportid+", '"+(this.m_show_graph?"t":"f")+"', '"+(this.m_show_summary?"t":"f")+"']",b=[];b[0]=["id",this.m_id];b[1]=["data",a];b[2]=["appNavname",this.appNavname];ajax=new CAjax("json");ajax.exec("/controller/Application/widgetSetData",b)};function CWidgetBrowser(){this.title="Widget Browser";this.title="Add Widget";this.appNavname=null}
CWidgetBrowser.prototype.showDialog=function(){var a=new CDialog(this.title);this.m_dlg=a;a.f_close=!0;var b=alib.dom.createElement("div"),c=alib.dom.createElement("span",b);alib.dom.styleSet(c,"margin-left","10px");c.innerHTML="Select a widget...";a.customDialog(b,600,410);this.m_browsedv=alib.dom.createElement("div",b);alib.dom.styleSet(this.m_browsedv,"height","350px");alib.dom.styleSet(this.m_browsedv,"border","1px solid");alib.dom.styleSet(this.m_browsedv,"overflow","auto");alib.dom.styleSet(this.m_browsedv,
"margin","10px");this.loadWidgets()};CWidgetBrowser.prototype.select=function(a){this.m_dlg.hide();this.onSelect(a)};CWidgetBrowser.prototype.onSelect=function(){};CWidgetBrowser.prototype.onCancel=function(){};
CWidgetBrowser.prototype.loadWidgets=function(){alib.dom.createElement("div");this.m_ajax=new CAjax;this.m_ajax.m_browseclass=this;this.m_browsedv.innerHTML="<div class='loading'></div>";this.m_ajax.onload=function(a){this.m_browseclass.m_browsedv.innerHTML="";var b=alib.dom.createElement("div",this.m_browseclass.m_browsedv),c=alib.dom.createElement("div",this.m_browseclass.m_browsedv),d=alib.dom.createElement("div",this.m_browseclass.m_browsedv),e=alib.dom.createElement("div",c),f=alib.dom.createElement("div",
c),g=alib.dom.createElement("div",c);alib.dom.styleSet(e,"font-weight","bold");alib.dom.styleSet(e,"font-size","20px");alib.dom.styleSet(f,"margin-top","15px");alib.dom.styleSet(f,"margin-bottom","15px");alib.dom.styleSet(f,"height","225px");alib.dom.styleSet(f,"overflow","auto");alib.dom.styleSet(f,"width","300");alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","200");alib.dom.styleSet(b,"margin","20px");alib.dom.styleSet(c,"float","left");alib.dom.styleSet(c,"width","320px");alib.dom.styleSet(c,
"margin-top","20px");alib.dom.styleSet(d,"clear","both");var h=alib.dom.createElement("select",b);h.setAttribute("size","20");alib.dom.styleSet(h,"height","300px");alib.dom.styleSet(h,"width","200px");b=a.getNumChildren();for(c=0;c<b;c++){var k=a.getChildNode(c),d=unescape(k.m_text),l=k.getAttribute("id");k.getAttribute("class_name");var k=k.getAttribute("description"),m=alib.dom.createElement("option");m.text=d;m.value=l;m.setAttribute("description",k);m.onclick=function(){e.innerHTML=unescape(this.text);
f.innerHTML=unescape(this.getAttribute("description"))};try{h.add(m,null)}catch(n){h.add(m)}0==c&&(e.innerHTML=unescape(d),f.innerHTML=unescape(k))}h.selectedIndex=0;(new CButton("Add This Widget",function(a){a.select(h.options[h.selectedIndex].value)},[this.m_browseclass])).print(g)};this.m_ajax.exec("/widgets/xml_settings.php?function=get_widgets")};
function CWidWebpage(){this.title="Web Page";this.widgetWidth=this.m_webpageId=this.dashboardCls=this.appNavname=this.m_id=this.m_data=this.m_dm=this.m_widTitle=this.m_container=null}CWidWebpage.prototype.main=function(){0!=this.m_container.offsetWidth&&(this.m_dm.addEntry("Set Webpage Url",function(a){a.setWidgetData()},null,null,[this]),this.m_container.innerHTML="",this.loadWidgetData())};CWidWebpage.prototype.exit=function(){this.m_container.innerHTML=""};
CWidWebpage.prototype.setWidgetData=function(){var a=new CDialog("Webpage Details");a.f_close=!0;var b=alib.dom.createElement("div"),c=alib.dom.createElement("table",b),c=alib.dom.createElement("tbody",c),d="",e="";if(this.m_data)var f=eval(this.m_data),d=f[0],e=f[1];f={};f.title=alib.dom.setElementAttr(alib.dom.createElement("input"),[["type","text"],["label","Title: "],["value",d],["width","200px"]]);f.url=alib.dom.setElementAttr(alib.dom.createElement("input"),[["type","text"],["label","Url: "],
["value",e],["width","400"]]);buildFormInput(f,c);c=alib.dom.createElement("div",b);alib.dom.styleSet(c,"text-align","right");d=new CButton("Save and Close",function(a,b,c){b.saveWidgetData(c);a.hide()},[a,this,f],"b1");d.print(c);d=new CButton("Cancel",function(a){a.hide()},[a],"b1");d.print(c);a.customDialog(b,450)};
CWidWebpage.prototype.saveWidgetData=function(a){var b=a.url.value,a=a.title.value;ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.title=a;ajax.cbData.dlg=showDialog("Saving, please wait...");ajax.onload=function(){this.cbData.cls.loadWidgetData();this.cbData.title&&(this.cbData.cls.m_widTitle.innerHTML="Web Page - "+this.cbData.title);this.cbData.dlg.hide();ALib.statusShowAlert("Webpage Url successfully saved!",3E3,"bottom","right")};this.m_data="['"+a+"', '"+b+"']";b=[];b[b.length]=["data",
this.m_data];this.dashboardCls?(a="/controller/Dashboard/saveData",b[b.length]=["dwid",this.m_id]):(a="/controller/Application/widgetSetData",b[b.length]=["id",this.m_id],b[b.length]=["appNavname",this.appNavname]);ajax.exec(a,b)};
CWidWebpage.prototype.loadWidgetData=function(){if(this.m_data){var a=eval(this.m_data);title=a[0];url=a[1];this.m_widTitle.innerHTML="Web Page - "+title;if(url){var b=this.m_container.offsetWidth-15,a=url.replace(/<%width%>/g,b);this.m_container.innerHTML="<div class='loading'></div>";ajax=new CAjax("json");ajax.cbData.cls=this;ajax.cbData.con=this.m_container;ajax.cbData.widgetWidth=b;ajax.cbData.cleanUrl=a;ajax.onload=function(a){this.cbData.con.innerHTML="";var b=alib.dom.createElement("div",
this.cbData.con);alib.dom.styleSet(b,"width",this.cbData.widgetWidth);alib.dom.styleSet(b,"overflow","auto");alib.dom.styleSet(b,"maxHeight","700px");switch(a.type){case "image":alib.dom.setElementAttr(alib.dom.createElement("img",b),[["src",this.cbData.cleanUrl]]);break;default:(a=a.data)||(a="Webpage Url was not able to retrieve any data."),alib.dom.setElementAttr(alib.dom.createElement("div",b),[["innerHTML",a]])}};b=[];b[b.length]=["url",a];ajax.exec("/controller/Application/loadWidgetUrl",b)}}else a=
alib.dom.setElementAttr(alib.dom.createElement("div",this.m_container),[["innerHTML","Click to enter a page location"]]),alib.dom.styleSet(a,"width","100%"),alib.dom.styleSet(a,"cursor","pointer"),a.cls=this,a.onclick=function(){this.cls.setWidgetData()}};function CWidActivity(){this.title="News & Updates";this.activityBrowser=this.antView=this.widgetWidth=this.m_webpageId=this.dashboardCls=this.appNavname=this.m_id=this.m_data=this.m_dm=this.m_cct=this.m_container=null}
CWidActivity.prototype.main=function(){this.m_container.innerHTML="";var a=alib.dom.createElement("div",this.m_container);alib.dom.styleSet(a,"margin-bottom","10px");this.buildStatusUpdateForm(a);a=new AntObjectBrowser("status_update");a.addCondition("and","associations","is_equal","user:-3");a.addCondition("or","owner_id.team_id","is_equal","-3");var b=alib.dom.createElement("div",this.m_container);a.printInline(b,!0);this.activityBrowser=a;this.antView&&a.setAntView(this.antView)};
CWidActivity.prototype.exit=function(){this.m_container.innerHTML=""};
CWidActivity.prototype.buildStatusUpdateForm=function(a){a.innerHTML="";var b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"float","left");alib.dom.styleSet(b,"width","48px");b.innerHTML="<img src='/files/userimages/current/48/48' style='width:48px;' />";b=alib.dom.createElement("div",a);alib.dom.styleSet(b,"margin-bottom","5px");alib.dom.styleSet(b,"margin-left","51px");b=alib.dom.createElement("textarea",b);b.placeholder="What are you working on right now?";alib.dom.styleSet(b,"width","100%");
alib.dom.styleSet(b,"height","25px");alib.dom.textAreaAutoResizeHeight(b,48);var c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"clear","both");c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"float","left");alib.dom.styleSet(c,"width","48px");alib.dom.styleSet(c,"padding-top","5px");c.innerHTML="Notify:";c=alib.dom.createElement("div",a);alib.dom.styleSet(c,"margin-left","51px");alib.dom.styleSet(c,"margin-bottom","5px");c=alib.dom.createElement("input",c);c=new CTextBoxList(c,{bitsOptions:{editable:{addKeys:[188,
13,186,59],addOnBlur:!0}},plugins:{autocomplete:{placeholder:!1,minLength:2,queryRemote:!0,remote:{url:"/users/json_autocomplete.php"}}}});b=alib.ui.Button("Save Status Update",{className:"b1 nomargin",tooltip:"Click to save and send your status update",cls:this,textarea:b,notify:c,onclick:function(){alib.dom.styleAddClass(this,"working");this.cls.postStatusUpdate(this.textarea,this.notify,this)}});a=alib.dom.createElement("div",a);alib.dom.styleSet(a,"text-align","right");b.print(a)};
CWidActivity.prototype.postStatusUpdate=function(a,b,c){for(var d="",e=b.getValues(),f=0;f<e.length;f++)d&&(d+=","),e[f][0]?d+=e[f][0]:e[f][1]&&(d+=e[f][1]);e=new CAjax("json");e.cbData.cls=this;e.cbData.textarea=a;e.cbData.btn=c;e.cbData.t_notify=b;e.onload=function(){this.cbData.textarea.value="";this.cbData.cls.activityBrowser&&this.cbData.cls.activityBrowser.refresh();this.cbData.t_notify.clear();alib.dom.styleRemoveClass(this.cbData.btn,"working")};e.exec("/controller/User/logStatusUpdate",[["status",
a.value],["notify",d]])};CWidActivity.prototype.buildNotices=function(a){a.innerHTML="";var b=alib.dom.createElement("div",a,"Unread Notices");alib.dom.styleSet(b,"font-weight","bold");a=alib.dom.createElement("div",a);alib.dom.styleSetClass(a,"notice");a.innerHTML="<h3>Title</h3>Put notice here"};
